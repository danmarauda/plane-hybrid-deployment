import{r as T,o as e,w as y}from"./chunk-UIGDSWPH-DWOOOxqk.js";import{a as E,o as A}from"./store.provider-C9rYaGrA.js";import{u as S}from"./index-Dc4aw0qJ.js";import{s as j,a as N,b as v}from"./index-BVHUuPnE.js";import{E as k,z as w,w as L,L as i}from"./index-vgvgxTJM.js";import{g as D}from"./gitea-logo-B7V18nrw.js";import{A as R}from"./authentication-method-card-QbZyRS5a.js";import{u as C}from"./use-instance-CkArE5we.js";import{L as O}from"./link-CvXtRfRL.js";import{u as F}from"./index.esm-XeU7nagb.js";import{b as B}from"./index-CzOQsu2R.js";import{i as P,b as H,C as U,a as M}from"./copy-field-B4xugwUu.js";import{C as q}from"./controller-input-Ch9fJpKv.js";import"./index-Dq3cOres.js";import"./classname-iNHf9Pb8-5LSAqF-w.js";import"./helper-CmYjNUif.js";import"./button-CJES52DI-LZmtqnY7.js";import"./transition-Cll_7jRI.js";import"./dialog-DvpWpn9V.js";import"./eye-CKm8Qo8U.js";function Y(I){const{config:o}=I,[a,d]=T.useState(!1),{updateInstanceConfigurations:m}=C(),{handleSubmit:r,control:p,reset:g,formState:{errors:s,isDirty:u,isSubmitting:n}}=F({defaultValues:{GITEA_HOST:o.GITEA_HOST||"https://gitea.com",GITEA_CLIENT_ID:o.GITEA_CLIENT_ID,GITEA_CLIENT_SECRET:o.GITEA_CLIENT_SECRET}}),f=P(E)?typeof window<"u"?window.location.origin:"":E,h=[{key:"GITEA_HOST",type:"text",label:"Gitea Host",description:e.jsx(e.Fragment,{children:'Use the URL of your Gitea instance. For the official Gitea instance, use "https://gitea.com".'}),placeholder:"https://gitea.com",error:!!s.GITEA_HOST,required:!0},{key:"GITEA_CLIENT_ID",type:"text",label:"Client ID",description:e.jsxs(e.Fragment,{children:["You will get this from your"," ",e.jsx("a",{tabIndex:-1,href:"https://gitea.com/user/settings/applications",target:"_blank",className:"text-custom-primary-100 hover:underline",rel:"noreferrer",children:"Gitea OAuth application settings."})]}),placeholder:"70a44354520df8bd9bcd",error:!!s.GITEA_CLIENT_ID,required:!0},{key:"GITEA_CLIENT_SECRET",type:"password",label:"Client secret",description:e.jsxs(e.Fragment,{children:["Your client secret is also found in your"," ",e.jsx("a",{tabIndex:-1,href:"https://gitea.com/user/settings/applications",target:"_blank",className:"text-custom-primary-100 hover:underline",rel:"noreferrer",children:"Gitea OAuth application settings."})]}),placeholder:"9b0050f94ec1b744e32ce79ea4ffacd40d4119cb",error:!!s.GITEA_CLIENT_SECRET,required:!0}],x=[{key:"Callback_URI",label:"Callback URI",url:`${f}/auth/gitea/callback/`,description:e.jsxs(e.Fragment,{children:["We will auto-generate this. Paste this into your ",e.jsx(H,{darkerShade:!0,children:"Authorized Callback URI"})," ","field"," ",e.jsx("a",{tabIndex:-1,href:`${p._formValues.GITEA_HOST||"https://gitea.com"}/user/settings/applications`,target:"_blank",className:"text-custom-primary-100 hover:underline",rel:"noreferrer",children:"here."})]})}],b=async t=>{const G={...t};await m(G).then((l=[])=>{j({type:N.SUCCESS,title:"Done!",message:"Your Gitea authentication is configured. You should test it now."}),g({GITEA_HOST:l.find(c=>c.key==="GITEA_HOST")?.value,GITEA_CLIENT_ID:l.find(c=>c.key==="GITEA_CLIENT_ID")?.value,GITEA_CLIENT_SECRET:l.find(c=>c.key==="GITEA_CLIENT_SECRET")?.value})}).catch(l=>console.error(l))},_=t=>{u&&(t.preventDefault(),d(!0))};return e.jsxs(e.Fragment,{children:[e.jsx(U,{isOpen:a,onDiscardHref:"/authentication",handleClose:()=>d(!1)}),e.jsx("div",{className:"flex flex-col gap-8",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-12 gap-y-8 w-full",children:[e.jsxs("div",{className:"flex flex-col gap-y-4 col-span-2 md:col-span-1 pt-1",children:[e.jsx("div",{className:"pt-2.5 text-xl font-medium",children:"Gitea-provided details for Plane"}),h.map(t=>e.jsx(q,{control:p,type:t.type,name:t.key,label:t.label,description:t.description,placeholder:t.placeholder,error:t.error,required:t.required},t.key)),e.jsx("div",{className:"flex flex-col gap-1 pt-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(k,{variant:"primary",onClick:r(b),loading:n,disabled:!u,children:n?"Saving...":"Save changes"}),e.jsx(O,{href:"/authentication",className:B(w("neutral-primary","md"),"font-medium"),onClick:_,children:"Go back"})]})})]}),e.jsx("div",{className:"col-span-2 md:col-span-1",children:e.jsxs("div",{className:"flex flex-col gap-y-4 px-6 pt-1.5 pb-4 bg-custom-background-80/60 rounded-lg",children:[e.jsx("div",{className:"pt-2 text-xl font-medium",children:"Plane-provided details for Gitea"}),x.map(t=>e.jsx(M,{label:t.label,url:t.url,description:t.description},t.key))]})})]})})]})}const z=A(function(){const{fetchInstanceConfigurations:o,formattedConfig:a,updateInstanceConfigurations:d}=C(),[m,r]=T.useState(!1),p=a?.IS_GITEA_ENABLED??"";S("INSTANCE_CONFIGURATIONS",()=>o());const g=async(u,n)=>{r(!0);const f={[u]:n},h=d(f);v(h,{loading:"Saving Configuration...",success:{title:"Configuration saved",message:()=>`Gitea authentication is now ${n==="1"?"active":"disabled"}.`},error:{title:"Error",message:()=>"Failed to save configuration"}}),await h.then(()=>{r(!1)}).catch(x=>{console.error(x),r(!1)})},s=p==="1";return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative container mx-auto w-full h-full p-4 py-4 space-y-6 flex flex-col",children:[e.jsx("div",{className:"border-b border-custom-border-100 mx-4 py-4 space-y-1 flex-shrink-0",children:e.jsx(R,{name:"Gitea",description:"Allow members to login or sign up to plane with their Gitea accounts.",icon:e.jsx("img",{src:D,height:24,width:24,alt:"Gitea Logo"}),config:e.jsx(L,{value:s,onChange:()=>{g("IS_GITEA_ENABLED",s?"0":"1")},size:"sm",disabled:m||!a}),disabled:m||!a,withBorder:!1})}),e.jsx("div",{className:"flex-grow overflow-hidden overflow-y-scroll vertical-scrollbar scrollbar-md px-4",children:a?e.jsx(Y,{config:a}):e.jsxs(i,{className:"space-y-8",children:[e.jsx(i.Item,{height:"50px",width:"25%"}),e.jsx(i.Item,{height:"50px"}),e.jsx(i.Item,{height:"50px"}),e.jsx(i.Item,{height:"50px"}),e.jsx(i.Item,{height:"50px",width:"50%"})]})})]})})}),pe=()=>[{title:"Gitea Authentication - God Mode"}],ue=y(z);export{ue as default,pe as meta};
