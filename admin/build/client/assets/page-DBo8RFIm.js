import{r as T,o as e,w as E}from"./chunk-UIGDSWPH-DWOOOxqk.js";import{a as b,o as A}from"./store.provider-C9rYaGrA.js";import{u as S}from"./index-Dc4aw0qJ.js";import{s as j,a as B,b as v}from"./index-BVHUuPnE.js";import{w as N,L as i}from"./index-vgvgxTJM.js";import{G as w}from"./gitlab-logo-Di094duH.js";import{A as k}from"./authentication-method-card-QbZyRS5a.js";import{u as _}from"./use-instance-CkArE5we.js";import{L as D}from"./link-CvXtRfRL.js";import{u as R}from"./index.esm-XeU7nagb.js";import{B as O,g as F}from"./button-CJES52DI-LZmtqnY7.js";import{b as P}from"./index-CzOQsu2R.js";import{i as H,b as L,C as U,a as M}from"./copy-field-B4xugwUu.js";import{C as q}from"./controller-input-Ch9fJpKv.js";import"./index-Dq3cOres.js";import"./classname-iNHf9Pb8-5LSAqF-w.js";import"./helper-CmYjNUif.js";import"./transition-Cll_7jRI.js";import"./dialog-DvpWpn9V.js";import"./eye-CKm8Qo8U.js";function Y(I){const{config:c}=I,[u,a]=T.useState(!1),{updateInstanceConfigurations:f}=_(),{handleSubmit:d,control:r,reset:m,formState:{errors:o,isDirty:p,isSubmitting:s}}=R({defaultValues:{GITLAB_HOST:c.GITLAB_HOST,GITLAB_CLIENT_ID:c.GITLAB_CLIENT_ID,GITLAB_CLIENT_SECRET:c.GITLAB_CLIENT_SECRET}}),g=H(b)?typeof window<"u"?window.location.origin:"":b,h=[{key:"GITLAB_HOST",type:"text",label:"Host",description:e.jsxs(e.Fragment,{children:["This is either https://gitlab.com or the ",e.jsx(L,{children:"domain.tld"})," where you host GitLab."]}),placeholder:"https://gitlab.com",error:!!o.GITLAB_HOST,required:!0},{key:"GITLAB_CLIENT_ID",type:"text",label:"Application ID",description:e.jsxs(e.Fragment,{children:["Get this from your"," ",e.jsx("a",{tabIndex:-1,href:"https://docs.gitlab.com/ee/integration/oauth_provider.html",target:"_blank",className:"text-custom-primary-100 hover:underline",rel:"noreferrer",children:"GitLab OAuth application settings"}),"."]}),placeholder:"c2ef2e7fc4e9d15aa7630f5637d59e8e4a27ff01dceebdb26b0d267b9adcf3c3",error:!!o.GITLAB_CLIENT_ID,required:!0},{key:"GITLAB_CLIENT_SECRET",type:"password",label:"Secret",description:e.jsxs(e.Fragment,{children:["The client secret is also found in your"," ",e.jsx("a",{tabIndex:-1,href:"https://docs.gitlab.com/ee/integration/oauth_provider.html",target:"_blank",className:"text-custom-primary-100 hover:underline",rel:"noreferrer",children:"GitLab OAuth application settings"}),"."]}),placeholder:"gloas-f79cfa9a03c97f6ffab303177a5a6778a53c61e3914ba093412f68a9298a1b28",error:!!o.GITLAB_CLIENT_SECRET,required:!0}],x=[{key:"Callback_URL",label:"Callback URL",url:`${g}/auth/gitlab/callback/`,description:e.jsxs(e.Fragment,{children:["We will auto-generate this. Paste this into the ",e.jsx(L,{darkerShade:!0,children:"Redirect URI"})," field of your"," ",e.jsx("a",{tabIndex:-1,href:"https://docs.gitlab.com/ee/integration/oauth_provider.html",target:"_blank",className:"text-custom-primary-100 hover:underline",rel:"noreferrer",children:"GitLab OAuth application"}),"."]})}],C=async t=>{const y={...t};await f(y).then((n=[])=>{j({type:B.SUCCESS,title:"Done!",message:"Your GitLab authentication is configured. You should test it now."}),m({GITLAB_HOST:n.find(l=>l.key==="GITLAB_HOST")?.value,GITLAB_CLIENT_ID:n.find(l=>l.key==="GITLAB_CLIENT_ID")?.value,GITLAB_CLIENT_SECRET:n.find(l=>l.key==="GITLAB_CLIENT_SECRET")?.value})}).catch(n=>console.error(n))},G=t=>{p&&(t.preventDefault(),a(!0))};return e.jsxs(e.Fragment,{children:[e.jsx(U,{isOpen:u,onDiscardHref:"/authentication",handleClose:()=>a(!1)}),e.jsx("div",{className:"flex flex-col gap-8",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-12 gap-y-8 w-full",children:[e.jsxs("div",{className:"flex flex-col gap-y-4 col-span-2 md:col-span-1 pt-1",children:[e.jsx("div",{className:"pt-2.5 text-xl font-medium",children:"GitLab-provided details for Plane"}),h.map(t=>e.jsx(q,{control:r,type:t.type,name:t.key,label:t.label,description:t.description,placeholder:t.placeholder,error:t.error,required:t.required},t.key)),e.jsx("div",{className:"flex flex-col gap-1 pt-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(O,{variant:"primary",onClick:d(C),loading:s,disabled:!p,children:s?"Saving...":"Save changes"}),e.jsx(D,{href:"/authentication",className:P(F("neutral-primary","md"),"font-medium"),onClick:G,children:"Go back"})]})})]}),e.jsx("div",{className:"col-span-2 md:col-span-1",children:e.jsxs("div",{className:"flex flex-col gap-y-4 px-6 pt-1.5 pb-4 bg-custom-background-80/60 rounded-lg",children:[e.jsx("div",{className:"pt-2 text-xl font-medium",children:"Plane-provided details for GitLab"}),x.map(t=>e.jsx(M,{label:t.label,url:t.url,description:t.description},t.key))]})})]})})]})}const V=A(function(c){const{fetchInstanceConfigurations:u,formattedConfig:a,updateInstanceConfigurations:f}=_(),[d,r]=T.useState(!1),m=a?.IS_GITLAB_ENABLED??"";S("INSTANCE_CONFIGURATIONS",()=>u());const o=async(p,s)=>{r(!0);const g={[p]:s},h=f(g);v(h,{loading:"Saving Configuration...",success:{title:"Configuration saved",message:()=>`GitLab authentication is now ${s==="1"?"active":"disabled"}.`},error:{title:"Error",message:()=>"Failed to save configuration"}}),await h.then(()=>{r(!1)}).catch(x=>{console.error(x),r(!1)})};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative container mx-auto w-full h-full p-4 py-4 space-y-6 flex flex-col",children:[e.jsx("div",{className:"border-b border-custom-border-100 mx-4 py-4 space-y-1 flex-shrink-0",children:e.jsx(k,{name:"GitLab",description:"Allow members to login or sign up to plane with their GitLab accounts.",icon:e.jsx("img",{src:w,height:24,width:24,alt:"GitLab Logo"}),config:e.jsx(N,{value:!!parseInt(m),onChange:()=>{parseInt(m)?o("IS_GITLAB_ENABLED","0"):o("IS_GITLAB_ENABLED","1")},size:"sm",disabled:d||!a}),disabled:d||!a,withBorder:!1})}),e.jsx("div",{className:"flex-grow overflow-hidden overflow-y-scroll vertical-scrollbar scrollbar-md px-4",children:a?e.jsx(Y,{config:a}):e.jsxs(i,{className:"space-y-8",children:[e.jsx(i.Item,{height:"50px",width:"25%"}),e.jsx(i.Item,{height:"50px"}),e.jsx(i.Item,{height:"50px"}),e.jsx(i.Item,{height:"50px"}),e.jsx(i.Item,{height:"50px",width:"50%"})]})})]})})}),pe=()=>[{title:"GitLab Authentication - God Mode"}],he=E(V);export{he as default,pe as meta};
