import{r as a,o as e,w as P}from"./chunk-UIGDSWPH-DWOOOxqk.js";import{e as R,o as F}from"./store.provider-C9rYaGrA.js";import{u as k}from"./index-Dc4aw0qJ.js";import{s as L,a as I}from"./index-BVHUuPnE.js";import{I as D,x as A,L as d,w as H}from"./index-vgvgxTJM.js";import{u as w}from"./use-instance-CkArE5we.js";import{u as q}from"./index.esm-XeU7nagb.js";import{B as f}from"./button-CJES52DI-LZmtqnY7.js";import{C as N}from"./controller-input-Ch9fJpKv.js";import{q as _}from"./transition-Cll_7jRI.js";import{_ as b}from"./dialog-DvpWpn9V.js";import"./index-Dq3cOres.js";import"./classname-iNHf9Pb8-5LSAqF-w.js";import"./index-CzOQsu2R.js";import"./eye-CKm8Qo8U.js";const B=new R;function z(E){const{isOpen:t,handleClose:u}=E,[r,S]=a.useState(""),[l,c]=a.useState("SEND_EMAIL"),[i,o]=a.useState(!1),[n,m]=a.useState(""),h=()=>{S(""),c("SEND_EMAIL"),o(!1),m("")};a.useEffect(()=>{t||h()},[t]);const x=async p=>{p.preventDefault(),o(!0),await B.sendTestEmail(r).then(()=>{c("SUCCESS")}).catch(y=>{m(y?.error||"Failed to send email"),c("FAILED")}).finally(()=>{o(!1)})};return e.jsx(_.Root,{show:t,as:a.Fragment,children:e.jsxs(b,{as:"div",className:"relative z-20",onClose:u,children:[e.jsx(_.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-custom-backdrop transition-opacity"})}),e.jsx("div",{className:"fixed inset-0 z-20 overflow-y-auto",children:e.jsx("div",{className:"my-10 flex justify-center p-4 text-center sm:p-0 md:my-20",children:e.jsx(_.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:e.jsxs(b.Panel,{className:"relative transform rounded-lg bg-custom-background-100 p-5 px-4 text-left shadow-custom-shadow-md transition-all w-full sm:max-w-xl",children:[e.jsxs("h3",{className:"text-lg font-medium leading-6 text-custom-text-100",children:[l==="SEND_EMAIL"?"Send test email":l==="SUCCESS"?"Email send":"Failed"," "]}),e.jsxs("div",{className:"pt-6 pb-2",children:[l==="SEND_EMAIL"&&e.jsx(D,{id:"receiver_email",type:"email",value:r,onChange:p=>S(p.target.value),placeholder:"Receiver email",className:"w-full resize-none text-lg",tabIndex:1}),l==="SUCCESS"&&e.jsxs("div",{className:"flex flex-col gap-y-4 text-sm",children:[e.jsxs("p",{children:["We have sent the test email to ",r,". Please check your spam folder if you cannot find it."]}),e.jsx("p",{children:"If you still cannot find it, recheck your SMTP configuration and trigger a new test email."})]}),l==="FAILED"&&e.jsx("div",{className:"text-sm",children:n}),e.jsxs("div",{className:"flex items-center gap-2 justify-end mt-5",children:[e.jsx(f,{variant:"neutral-primary",size:"sm",onClick:u,tabIndex:2,children:l==="SEND_EMAIL"?"Cancel":"Close"}),l==="SEND_EMAIL"&&e.jsx(f,{variant:"primary",size:"sm",loading:i,onClick:x,tabIndex:3,children:i?"Sending email...":"Send email"})]})]})]})})})})]})})}const T={EMAIL_USE_TLS:"TLS",EMAIL_USE_SSL:"SSL",NONE:"No email security"};function W(E){const{config:t}=E,[u,r]=a.useState(!1),{updateInstanceConfigurations:S}=w(),{handleSubmit:l,watch:c,setValue:i,control:o,formState:{errors:n,isValid:m,isDirty:h,isSubmitting:x}}=q({defaultValues:{EMAIL_HOST:t.EMAIL_HOST,EMAIL_PORT:t.EMAIL_PORT,EMAIL_HOST_USER:t.EMAIL_HOST_USER,EMAIL_HOST_PASSWORD:t.EMAIL_HOST_PASSWORD,EMAIL_USE_TLS:t.EMAIL_USE_TLS,EMAIL_USE_SSL:t.EMAIL_USE_SSL,EMAIL_FROM:t.EMAIL_FROM,ENABLE_SMTP:t.ENABLE_SMTP}}),p=[{key:"EMAIL_HOST",type:"text",label:"Host",placeholder:"email.google.com",error:!!n.EMAIL_HOST,required:!0},{key:"EMAIL_PORT",type:"text",label:"Port",placeholder:"8080",error:!!n.EMAIL_PORT,required:!0},{key:"EMAIL_FROM",type:"text",label:"Sender's email address",description:"This is the email address your users will see when getting emails from this instance. You will need to verify this address.",placeholder:"no-reply@projectplane.so",error:!!n.EMAIL_FROM,required:!0}],y=[{key:"EMAIL_HOST_USER",type:"text",label:"Username",placeholder:"getitdone@projectplane.so",error:!!n.EMAIL_HOST_USER,required:!1},{key:"EMAIL_HOST_PASSWORD",type:"password",label:"Password",placeholder:"Password",error:!!n.EMAIL_HOST_PASSWORD,required:!1}],O=async s=>{const g={...s,ENABLE_SMTP:"1"};await S(g).then(()=>L({type:I.SUCCESS,title:"Success",message:"Email Settings updated successfully"})).catch(U=>console.error(U))},j=c("EMAIL_USE_TLS"),v=c("EMAIL_USE_SSL"),M=a.useMemo(()=>j==="1"?"EMAIL_USE_TLS":v==="1"?"EMAIL_USE_SSL":"NONE",[j,v]),C=s=>{s==="EMAIL_USE_SSL"&&(i("EMAIL_USE_TLS","0"),i("EMAIL_USE_SSL","1")),s==="EMAIL_USE_TLS"&&(i("EMAIL_USE_TLS","1"),i("EMAIL_USE_SSL","0")),s==="NONE"&&(i("EMAIL_USE_TLS","0"),i("EMAIL_USE_SSL","0"))};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx(z,{isOpen:u,handleClose:()=>r(!1)}),e.jsxs("div",{className:"grid-col grid w-full max-w-4xl grid-cols-1 items-start justify-between gap-10 lg:grid-cols-2",children:[p.map(s=>e.jsx(N,{control:o,type:s.type,name:s.key,label:s.label,description:s.description,placeholder:s.placeholder,error:s.error,required:s.required},s.key)),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h4",{className:"text-sm text-custom-text-300",children:"Email security"}),e.jsx(A,{value:M,label:T[M],onChange:C,buttonClassName:"rounded-md border-custom-border-200",input:!0,children:Object.entries(T).map(([s,g])=>e.jsx(A.Option,{value:s,className:"w-full",children:g},s))})]})]}),e.jsxs("div",{className:"flex flex-col gap-6 my-6 pt-4 border-t border-custom-border-100",children:[e.jsx("div",{className:"flex w-full max-w-xl flex-col gap-y-10 px-1",children:e.jsx("div",{className:"mr-8 flex items-center gap-10 pt-4",children:e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"text-sm font-medium text-custom-text-100",children:"Authentication"}),e.jsx("div",{className:"text-xs font-normal text-custom-text-300",children:"This is optional, but we recommend setting up a username and a password for your SMTP server."})]})})}),e.jsx("div",{className:"grid-col grid w-full max-w-4xl grid-cols-1 items-center justify-between gap-10 lg:grid-cols-2",children:y.map(s=>e.jsx(N,{control:o,type:s.type,name:s.key,label:s.label,description:s.description,placeholder:s.placeholder,error:s.error,required:s.required},s.key))})]})]}),e.jsxs("div",{className:"flex max-w-4xl items-center py-1 gap-4",children:[e.jsx(f,{variant:"primary",onClick:l(O),loading:x,disabled:!m||!h,children:x?"Saving...":"Save changes"}),e.jsx(f,{variant:"outline-primary",onClick:()=>r(!0),loading:x,disabled:!m,children:"Send test email"})]})]})}const V=F(function(t){const{fetchInstanceConfigurations:u,formattedConfig:r,disableEmail:S}=w(),{isLoading:l}=k("INSTANCE_CONFIGURATIONS",()=>u()),[c,i]=a.useState(!1),[o,n]=a.useState(!1),m=async()=>{if(o){i(!0);try{await S(),n(!1),L({title:"Email feature disabled",message:"Email feature has been disabled",type:I.SUCCESS})}catch{L({title:"Error disabling email",message:"Failed to disable email feature. Please try again.",type:I.ERROR})}finally{i(!1)}return}n(!0)};return a.useEffect(()=>{r&&n(r.ENABLE_SMTP==="1")},[r]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative container mx-auto w-full h-full p-4 py-4 space-y-6 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-custom-border-100 mx-4 py-4 space-y-1 flex-shrink-0",children:[e.jsxs("div",{className:"py-4 space-y-1 flex-shrink-0",children:[e.jsx("div",{className:"text-xl font-medium text-custom-text-100",children:"Secure emails from your own instance"}),e.jsxs("div",{className:"text-sm font-normal text-custom-text-300",children:["Plane can send useful emails to you and your users from your own instance without talking to the Internet.",e.jsxs("div",{className:"text-sm font-normal text-custom-text-300",children:["Set it up below and please test your settings before you save them.Â ",e.jsx("span",{className:"text-red-400",children:"Misconfigs can lead to email bounces and errors."})]})]})]}),l?e.jsx(d,{children:e.jsx(d.Item,{width:"24px",height:"16px",className:"rounded-full"})}):e.jsx(H,{value:o,onChange:m,size:"sm",disabled:c})]}),o&&!l&&e.jsx("div",{className:"flex-grow overflow-hidden overflow-y-scroll vertical-scrollbar scrollbar-md px-4",children:r?e.jsx(W,{config:r}):e.jsxs(d,{className:"space-y-10",children:[e.jsx(d.Item,{height:"50px",width:"75%"}),e.jsx(d.Item,{height:"50px",width:"75%"}),e.jsx(d.Item,{height:"50px",width:"40%"}),e.jsx(d.Item,{height:"50px",width:"40%"}),e.jsx(d.Item,{height:"50px",width:"20%"})]})})]})})}),ne=()=>[{title:"Email Settings - God Mode"}],oe=P(V);export{oe as default,ne as meta};
