import{o as e,r as n,w as q}from"./chunk-UIGDSWPH-DWOOOxqk.js";import{o as M,A as F,E as $,a as k,b as i,c as G}from"./store.provider-C9rYaGrA.js";import{L as K}from"./logo-spinner-BV29B0G2.js";import{y as J}from"./index.module-D2LUA61L.js";import{B as C}from"./button-CJES52DI-LZmtqnY7.js";import{L as D}from"./link-CvXtRfRL.js";import{c as O,P as Z,C as ee,g as se,a as te}from"./index-CzOQsu2R.js";import{a as U}from"./navigation-BHLSI9iT.js";import{I as p,P as ae,C as re,S as V}from"./index-vgvgxTJM.js";import{E as R,a as P}from"./eye-CKm8Qo8U.js";import{u as ne}from"./use-instance-CkArE5we.js";import"./password-config-switch-CPChmo_o.js";import"./index-Dq3cOres.js";import"./classname-iNHf9Pb8-5LSAqF-w.js";import"./helper-CmYjNUif.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=O("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=O("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);function T(){return e.jsx("div",{className:"flex items-center justify-between gap-6 w-full flex-shrink-0 sticky top-0",children:e.jsx(D,{href:"/",children:e.jsx(Z,{height:20,width:95,className:"text-custom-text-100"})})})}const ie="/god-mode/assets/instance-failure-dark-DE7I22mw.svg",ce="/god-mode/assets/instance-failure-C1aRKNan.svg",me=M(function(){const{resolvedTheme:r}=J(),o=r==="dark"?ie:ce,m=()=>{window.location.reload()};return e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsx("div",{className:"flex flex-col justify-center items-center flex-grow w-full py-6 mt-10",children:e.jsxs("div",{className:"relative flex flex-col gap-6 max-w-[22.5rem] w-full",children:[e.jsxs("div",{className:"relative flex flex-col justify-center items-center space-y-4",children:[e.jsx("img",{src:o,alt:"Instance failure illustration"}),e.jsx("h3",{className:"font-medium text-2xl text-white text-center",children:"Unable to fetch instance details."}),e.jsx("p",{className:"font-medium text-base text-center",children:"We were unable to fetch the details of the instance. Fret not, it might just be a connectivity issue."})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(C,{size:"md",onClick:m,children:"Retry"})})]})})]})});function W(a){const{type:r,message:o}=a;return e.jsx("div",{className:`rounded-md p-2 w-full border ${r==="error"?"bg-red-500/5 border-red-400":"bg-green-500/5 border-green-400"}`,children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"flex-shrink-0",children:r==="error"?e.jsx("span",{className:"flex items-center justify-center h-6 w-6 rounded-full",children:e.jsx(oe,{className:"h-5 w-5 text-red-600","aria-hidden":"true"})}):e.jsx(ee,{className:"h-5 w-5 text-green-600","aria-hidden":"true"})}),e.jsx("div",{className:"ml-1",children:e.jsx("p",{className:`text-sm font-medium ${r==="error"?"text-red-600":"text-green-600"}`,children:o})})]})})}function z({heading:a,subHeading:r}){return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-2xl font-semibold text-custom-text-100 leading-7",children:a}),e.jsx("span",{className:"text-lg font-semibold text-custom-text-400 leading-7",children:r})]})}const de=new F,ue={first_name:"",last_name:"",email:"",company_name:"",password:"",is_telemetry_enabled:!0};function xe(){const a=U(),r=a.get("first_name")||void 0,o=a.get("last_name")||void 0,m=a.get("company")||void 0,_=a.get("email")||void 0,I=a.get("is_telemetry_enabled")==="True"||!0,f=a.get("error_code")||void 0,u=a.get("error_message")||void 0,[d,w]=n.useState({password:!1,retypePassword:!1}),[h,j]=n.useState(void 0),[t,x]=n.useState(ue),[A,N]=n.useState(!1),[y,l]=n.useState(!1),[v,E]=n.useState(!1),b=s=>w(S=>({...S,[s]:!S[s]})),g=(s,S)=>x(Y=>({...Y,[s]:S}));n.useEffect(()=>{h===void 0&&de.requestCSRFToken().then(s=>s?.csrf_token&&j(s.csrf_token))},[h]),n.useEffect(()=>{r&&x(s=>({...s,first_name:r})),o&&x(s=>({...s,last_name:o})),m&&x(s=>({...s,company_name:m})),_&&x(s=>({...s,email:_})),x(s=>({...s,is_telemetry_enabled:I}))},[r,o,m,_,I]);const c=n.useMemo(()=>{if(f&&u)switch(f){case"INSTANCE_NOT_CONFIGURED":return{type:"INSTANCE_NOT_CONFIGURED",message:u};case"ADMIN_ALREADY_EXIST":return{type:"ADMIN_ALREADY_EXIST",message:u};case"REQUIRED_EMAIL_PASSWORD_FIRST_NAME":return{type:"REQUIRED_EMAIL_PASSWORD_FIRST_NAME",message:u};case"INVALID_EMAIL":return{type:"INVALID_EMAIL",message:u};case"INVALID_PASSWORD":return{type:"INVALID_PASSWORD",message:u};case"USER_ALREADY_EXISTS":return{type:"USER_ALREADY_EXISTS",message:u};default:return{type:void 0,message:void 0}}else return{type:void 0,message:void 0}},[f,u]),B=n.useMemo(()=>!(!y&&t.first_name&&t.email&&t.password&&se(t.password)===$.STRENGTH_VALID&&t.password===t.confirm_password),[t.confirm_password,t.email,t.first_name,t.password,y]),H=t?.password??"",X=t?.confirm_password??"",Q=!v||X.length>=H.length;return e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsx("div",{className:"flex flex-col justify-center items-center flex-grow w-full py-6 mt-10",children:e.jsxs("div",{className:"relative flex flex-col gap-6 max-w-[22.5rem] w-full",children:[e.jsx(z,{heading:"Setup your Plane Instance",subHeading:"Post setup you will be able to manage this Plane instance."}),c.type&&c?.message&&!["INVALID_EMAIL","INVALID_PASSWORD"].includes(c.type)&&e.jsx(W,{type:"error",message:c?.message}),e.jsxs("form",{className:"space-y-4",method:"POST",action:`${k}/api/instances/admins/sign-up/`,onSubmit:()=>l(!0),onError:()=>l(!1),children:[e.jsx("input",{type:"hidden",name:"csrfmiddlewaretoken",value:h}),e.jsx("input",{type:"hidden",name:"is_telemetry_enabled",value:t.is_telemetry_enabled?"True":"False"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[e.jsxs("div",{className:"w-full space-y-1",children:[e.jsxs("label",{className:"text-sm text-custom-text-300 font-medium",htmlFor:"first_name",children:["First name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p,{className:"w-full border border-custom-border-100 !bg-custom-background-100 placeholder:text-custom-text-400",id:"first_name",name:"first_name",type:"text",inputSize:"md",placeholder:"Wilber",value:t.first_name,onChange:s=>g("first_name",s.target.value),autoComplete:"on",autoFocus:!0})]}),e.jsxs("div",{className:"w-full space-y-1",children:[e.jsxs("label",{className:"text-sm text-custom-text-300 font-medium",htmlFor:"last_name",children:["Last name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p,{className:"w-full border border-custom-border-100 !bg-custom-background-100 placeholder:text-custom-text-400",id:"last_name",name:"last_name",type:"text",inputSize:"md",placeholder:"Wright",value:t.last_name,onChange:s=>g("last_name",s.target.value),autoComplete:"on"})]})]}),e.jsxs("div",{className:"w-full space-y-1",children:[e.jsxs("label",{className:"text-sm text-custom-text-300 font-medium",htmlFor:"email",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p,{className:"w-full border border-custom-border-100 !bg-custom-background-100 placeholder:text-custom-text-400",id:"email",name:"email",type:"email",inputSize:"md",placeholder:"name@company.com",value:t.email,onChange:s=>g("email",s.target.value),hasError:!!(c.type&&c.type==="INVALID_EMAIL"),autoComplete:"on"}),c.type&&c.type==="INVALID_EMAIL"&&c.message&&e.jsx("p",{className:"px-1 text-xs text-red-500",children:c.message})]}),e.jsxs("div",{className:"w-full space-y-1",children:[e.jsxs("label",{className:"text-sm text-custom-text-300 font-medium",htmlFor:"company_name",children:["Company name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p,{className:"w-full border border-custom-border-100 !bg-custom-background-100 placeholder:text-custom-text-400",id:"company_name",name:"company_name",type:"text",inputSize:"md",placeholder:"Company name",value:t.company_name,onChange:s=>g("company_name",s.target.value)})]}),e.jsxs("div",{className:"w-full space-y-1",children:[e.jsxs("label",{className:"text-sm text-custom-text-300 font-medium",htmlFor:"password",children:["Set a password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{className:"w-full border border-custom-border-100 !bg-custom-background-100 placeholder:text-custom-text-400",id:"password",name:"password",type:d.password?"text":"password",inputSize:"md",placeholder:"New password...",value:t.password,onChange:s=>g("password",s.target.value),hasError:!!(c.type&&c.type==="INVALID_PASSWORD"),onFocus:()=>N(!0),onBlur:()=>N(!1),autoComplete:"on"}),d.password?e.jsx("button",{type:"button",tabIndex:-1,className:"absolute right-3 top-3.5 flex items-center justify-center text-custom-text-400",onClick:()=>b("password"),children:e.jsx(R,{className:"h-4 w-4"})}):e.jsx("button",{type:"button",tabIndex:-1,className:"absolute right-3 top-3.5 flex items-center justify-center text-custom-text-400",onClick:()=>b("password"),children:e.jsx(P,{className:"h-4 w-4"})})]}),c.type&&c.type==="INVALID_PASSWORD"&&c.message&&e.jsx("p",{className:"px-1 text-xs text-red-500",children:c.message}),e.jsx(ae,{password:t.password,isFocused:A})]}),e.jsxs("div",{className:"w-full space-y-1",children:[e.jsxs("label",{className:"text-sm text-custom-text-300 font-medium",htmlFor:"confirm_password",children:["Confirm password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{type:d.retypePassword?"text":"password",id:"confirm_password",name:"confirm_password",inputSize:"md",value:t.confirm_password,onChange:s=>g("confirm_password",s.target.value),placeholder:"Confirm password",className:"w-full border border-custom-border-100 !bg-custom-background-100 pr-12 placeholder:text-custom-text-400",onFocus:()=>E(!0),onBlur:()=>E(!1)}),d.retypePassword?e.jsx("button",{type:"button",tabIndex:-1,className:"absolute right-3 top-3.5 flex items-center justify-center text-custom-text-400",onClick:()=>b("retypePassword"),children:e.jsx(R,{className:"h-4 w-4"})}):e.jsx("button",{type:"button",tabIndex:-1,className:"absolute right-3 top-3.5 flex items-center justify-center text-custom-text-400",onClick:()=>b("retypePassword"),children:e.jsx(P,{className:"h-4 w-4"})})]}),!!t.confirm_password&&t.password!==t.confirm_password&&Q&&e.jsxs("span",{className:"text-sm text-red-500",children:["Passwords don","'","t match"]})]}),e.jsxs("div",{className:"relative flex gap-2",children:[e.jsx("div",{children:e.jsx(re,{className:"w-4 h-4",iconClassName:"w-3 h-3",id:"is_telemetry_enabled",onChange:()=>g("is_telemetry_enabled",!t.is_telemetry_enabled),checked:t.is_telemetry_enabled})}),e.jsxs("label",{className:"text-sm text-custom-text-300 font-medium cursor-pointer",htmlFor:"is_telemetry_enabled",children:["Allow Plane to anonymously collect usage events."," ",e.jsx("a",{tabIndex:-1,href:"https://developers.plane.so/self-hosting/telemetry",target:"_blank",rel:"noopener noreferrer",className:"text-sm font-medium text-blue-500 hover:text-blue-600 flex-shrink-0",children:"See More"})]})]}),e.jsx("div",{className:"py-2",children:e.jsx(C,{type:"submit",size:"lg",className:"w-full",disabled:B,children:y?e.jsx(V,{height:"20px",width:"20px"}):"Continue"})})]})]})})]})}function pe(a){const{bannerData:r,handleBannerData:o}=a;return r?e.jsxs("div",{className:"relative flex items-center p-2 rounded-md gap-2 border border-custom-primary-100/50 bg-custom-primary-100/10",children:[e.jsx("div",{className:"w-4 h-4 flex-shrink-0 relative flex justify-center items-center",children:e.jsx(le,{size:16,className:"text-custom-primary-100"})}),e.jsx("div",{className:"w-full text-sm font-medium text-custom-primary-100",children:r?.message}),e.jsx("div",{className:"relative ml-auto w-6 h-6 rounded-sm flex justify-center items-center transition-all cursor-pointer hover:bg-custom-primary-100/20 text-custom-primary-100/80",onClick:()=>o&&o(void 0),children:e.jsx(te,{className:"w-4 h-4 flex-shrink-0"})})]}):e.jsx(e.Fragment,{})}const L={[i.ADMIN_ALREADY_EXIST]:{title:"Admin already exists",message:()=>"Admin already exists. Please try again."},[i.REQUIRED_ADMIN_EMAIL_PASSWORD_FIRST_NAME]:{title:"Email, password and first name required",message:()=>"Email, password and first name required. Please try again."},[i.INVALID_ADMIN_EMAIL]:{title:"Invalid admin email",message:()=>"Invalid admin email. Please try again."},[i.INVALID_ADMIN_PASSWORD]:{title:"Invalid admin password",message:()=>"Invalid admin password. Please try again."},[i.REQUIRED_ADMIN_EMAIL_PASSWORD]:{title:"Email and password required",message:()=>"Email and password required. Please try again."},[i.ADMIN_AUTHENTICATION_FAILED]:{title:"Authentication failed",message:()=>"Authentication failed. Please try again."},[i.ADMIN_USER_ALREADY_EXIST]:{title:"Admin user already exists",message:()=>e.jsxs("div",{children:["Admin user already exists. ",e.jsx(D,{className:"underline underline-offset-4 font-medium hover:font-bold transition-all",href:"/admin",children:"Sign In"})," now."]})},[i.ADMIN_USER_DOES_NOT_EXIST]:{title:"Admin user does not exist",message:()=>e.jsxs("div",{children:["Admin user does not exist. ",e.jsx(D,{className:"underline underline-offset-4 font-medium hover:font-bold transition-all",href:"/admin",children:"Sign In"})," now."]})},[i.ADMIN_USER_DEACTIVATED]:{title:"User account deactivated",message:()=>`User account deactivated. Please contact ${G}.`}},fe=(a,r)=>{if([i.ADMIN_ALREADY_EXIST,i.REQUIRED_ADMIN_EMAIL_PASSWORD_FIRST_NAME,i.INVALID_ADMIN_EMAIL,i.INVALID_ADMIN_PASSWORD,i.REQUIRED_ADMIN_EMAIL_PASSWORD,i.ADMIN_AUTHENTICATION_FAILED,i.ADMIN_USER_ALREADY_EXIST,i.ADMIN_USER_DOES_NOT_EXIST,i.ADMIN_USER_DEACTIVATED].includes(a))return{type:"BANNER_ALERT",code:a,title:L[a]?.title||"Error",message:L[a]?.message(r)||"Something went wrong. Please try again."}},he=new F,ge={email:"",password:""};function _e(){const a=U(),r=a.get("email")||void 0,o=a.get("error_code")||void 0,m=a.get("error_message")||void 0,[_,I]=n.useState(!1),[f,u]=n.useState(void 0),[d,w]=n.useState(ge),[h,j]=n.useState(!1),[t,x]=n.useState(void 0),A=(l,v)=>w(E=>({...E,[l]:v}));n.useEffect(()=>{f===void 0&&he.requestCSRFToken().then(l=>l?.csrf_token&&u(l.csrf_token))},[f]),n.useEffect(()=>{r&&w(l=>({...l,email:r}))},[r]);const N=n.useMemo(()=>{if(o&&m)switch(o){case"INSTANCE_NOT_CONFIGURED":return{type:"INSTANCE_NOT_CONFIGURED",message:m};case"REQUIRED_EMAIL_PASSWORD":return{type:"REQUIRED_EMAIL_PASSWORD",message:m};case"INVALID_EMAIL":return{type:"INVALID_EMAIL",message:m};case"USER_DOES_NOT_EXIST":return{type:"USER_DOES_NOT_EXIST",message:m};case"AUTHENTICATION_FAILED":return{type:"AUTHENTICATION_FAILED",message:m};default:return{type:void 0,message:void 0}}else return{type:void 0,message:void 0}},[o,m]),y=n.useMemo(()=>!(!h&&d.email&&d.password),[d.email,d.password,h]);return n.useEffect(()=>{if(o){const l=fe(o?.toString());l&&x(l)}},[o]),e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsx("div",{className:"flex flex-col justify-center items-center flex-grow w-full py-6 mt-10",children:e.jsxs("div",{className:"relative flex flex-col gap-6 max-w-[22.5rem] w-full",children:[e.jsx(z,{heading:"Manage your Plane instance",subHeading:"Configure instance-wide settings to secure your instance"}),e.jsxs("form",{className:"space-y-4",method:"POST",action:`${k}/api/instances/admins/sign-in/`,onSubmit:()=>j(!0),onError:()=>j(!1),children:[N.type&&N?.message?e.jsx(W,{type:"error",message:N?.message}):e.jsx(e.Fragment,{children:t&&e.jsx(pe,{bannerData:t,handleBannerData:l=>x(l)})}),e.jsx("input",{type:"hidden",name:"csrfmiddlewaretoken",value:f}),e.jsxs("div",{className:"w-full space-y-1",children:[e.jsxs("label",{className:"text-sm text-custom-text-300 font-medium",htmlFor:"email",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p,{className:"w-full border border-custom-border-100 !bg-custom-background-100 placeholder:text-custom-text-400",id:"email",name:"email",type:"email",inputSize:"md",placeholder:"name@company.com",value:d.email,onChange:l=>A("email",l.target.value),autoComplete:"on",autoFocus:!0})]}),e.jsxs("div",{className:"w-full space-y-1",children:[e.jsxs("label",{className:"text-sm text-custom-text-300 font-medium",htmlFor:"password",children:["Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{className:"w-full border border-custom-border-100 !bg-custom-background-100 placeholder:text-custom-text-400",id:"password",name:"password",type:_?"text":"password",inputSize:"md",placeholder:"Enter your password",value:d.password,onChange:l=>A("password",l.target.value),autoComplete:"on"}),_?e.jsx("button",{type:"button",className:"absolute right-3 top-3.5 flex items-center justify-center text-custom-text-400",onClick:()=>I(!1),children:e.jsx(R,{className:"h-4 w-4"})}):e.jsx("button",{type:"button",className:"absolute right-3 top-3.5 flex items-center justify-center text-custom-text-400",onClick:()=>I(!0),children:e.jsx(P,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"py-2",children:e.jsx(C,{type:"submit",size:"lg",className:"w-full",disabled:y,children:h?e.jsx(V,{height:"20px",width:"20px"}):"Sign in"})})]})]})})]})}function Ne(){const{instance:a,error:r}=ne();return!a&&!r?e.jsx("div",{className:"flex items-center justify-center h-screen w-full",children:e.jsx(K,{})}):r?e.jsx(me,{}):a&&!a?.is_setup_done?e.jsx(xe,{}):e.jsx(_e,{})}const Me=q(M(Ne)),Fe=()=>[{title:"Admin – Instance Setup & Sign-In"},{name:"description",content:"Configure your Plane instance or sign in to the admin portal."}];export{Me as default,Fe as meta};
