{"version":3,"file":"document-collaborative-events-DhUvi1fB.js","names":["DEFAULT_DISPLAY_CONFIG: TDisplayConfig","CORE_EXTENSIONS","CORE_EXTENSIONS","insertEmptyParagraphAtNodeBoundaries: (\n  direction: Direction,\n  nodeType: string\n) => KeyboardShortcutCommand","targetNode: ProseMirrorNode | null","targetNodePos: number | null","CORE_EXTENSIONS","TYPOGRAPHY_ITEMS: ToolbarMenuItem<\"text\" | \"h1\" | \"h2\" | \"h3\" | \"h4\" | \"h5\" | \"h6\">[]","TEXT_ALIGNMENT_ITEMS: ToolbarMenuItem<\"text-align\">[]","BASIC_MARK_ITEMS: ToolbarMenuItem<\"bold\" | \"italic\" | \"underline\" | \"strikethrough\">[]","LIST_ITEMS: ToolbarMenuItem<\"bulleted-list\" | \"numbered-list\" | \"to-do-list\">[]","USER_ACTION_ITEMS: ToolbarMenuItem<\"quote\" | \"code\">[]","COMPLEX_ITEMS: ToolbarMenuItem<\"table\" | \"image\">[]","TOOLBAR_ITEMS: {\n  [editorType in TEditorTypes]: {\n    [key: string]: ToolbarMenuItem[];\n  };\n}","COLORS_LIST: {\n  key: string;\n  label: string;\n  textColor: string;\n  backgroundColor: string;\n}[]","DEFAULT_CALLOUT_BLOCK_ATTRIBUTES: TCalloutBlockAttributes","fallBackValues: TStoredLogoValue","parsedData: TLogoProps","CustomCalloutExtensionConfig: CustomCalloutExtensionType","Node","CORE_EXTENSIONS","Node","CORE_EXTENSIONS","text","decorations: Decoration[]","lowlight","lowlightPlugin: Plugin","inputRegex","pasteRegex","CORE_EXTENSIONS","textBlock: NodeWithPos | undefined","textBeforeWhitespace: string | undefined","els: HTMLElement[]","CORE_EXTENSIONS","foundLinks: PasteRuleMatch[]","plugins: Plugin[]","DEFAULT_CUSTOM_IMAGE_ATTRIBUTES: TCustomImageAttributes","IMAGE_ALIGNMENT_OPTIONS: {\n  label: string;\n  value: TCustomImageAlignment;\n  icon: LucideIcon;\n}[]","targetZoom: number","uploadStatus: number | undefined","editor","closestEditorContainer: HTMLDivElement | null","initialComputedSize: TCustomImageSize","fileType: \"image\" | \"attachment\" | null","CORE_EXTENSIONS","error: unknown","BaseImageExtension","props","updateFloatingUIFloaterPosition: UpdateFloatingUIFloaterPosition","virtualElement: ReferenceElement","CORE_EXTENSIONS","offset","rows: TableRows","cells: (ProseMirrorNode | null)[]","Fragment","CORE_EXTENSIONS","CORE_EXTENSIONS","DROPDOWN_ITEMS: {\n  key: string;\n  label: string;\n  icon: LucideIcon | React.FC<ISvgIcons>;\n  action: (editor: Editor) => void;\n}[]","DROPDOWN_ITEMS","result: TableColumn[]","flip","shift","CORE_EXTENSIONS","autoUpdate","table","pseudoColumn: HTMLElement | undefined","decorations: Decoration[]","DROPDOWN_ITEMS: {\n  key: string;\n  label: string;\n  icon: LucideIcon | React.FC<ISvgIcons>;\n  action: (editor: Editor) => void;\n}[]","result: TableRow[]","flip","shift","CORE_EXTENSIONS","autoUpdate","table","pseudoRow: HTMLElement | undefined","decorations: Decoration[]","tables: TableInfo[]","tableNode: ProseMirrorNode | null","roles: { [key: string]: NodeType }","headerCells: ProsemirrorNode[]","cells: ProsemirrorNode[]","rows: ProsemirrorNode[]","deleteColumnOrTable: () => Command","handleDeleteKeyOnTable: KeyboardShortcutCommand","findParentNodeClosestToPos","CORE_EXTENSIONS","selectedCellCoords: CellCoord[]","deleteRowOrTable: () => Command","insertLineAboveTableAction: KeyboardShortcutCommand","CORE_EXTENSIONS","insertLineBelowTableAction: KeyboardShortcutCommand","CORE_EXTENSIONS","Table","Node","CORE_EXTENSIONS","offset","classes: string[]","decorations: Decoration[]","selectedCells: number[]","Node","CORE_EXTENSIONS","Node","CORE_EXTENSIONS","Node","CORE_EXTENSIONS","Node","CORE_EXTENSIONS","CoreEditorAdditionalExtensionsWithoutProps: Extensions","CORE_EXTENSIONS","elementAttributes: Record<string, string>","CustomImageExtensionConfig: CustomImageExtensionType","BaseImageExtension","CORE_EXTENSIONS","Node","Fragment","supportMap: Record<number, boolean>","emojis","inputRules: InputRule[]","EmojisListDropdown","emojiSuggestion: EmojiOptions[\"suggestion\"]","emojis","component: ReactRenderer<CommandListInstance, EmojisListDropdownProps> | null","cleanup: () => void","editorRef: Editor | null","CORE_EXTENSIONS","Node","CORE_EXTENSIONS","CORE_EXTENSIONS","Underline","Table","TitleExtensions: Extensions","TITLE_EDITOR_EXTENSIONS: Extensions","document","allFormats: TDocumentPayload"],"sources":["../src/core/constants/config.ts","../src/core/constants/extension.ts","../src/core/helpers/common.ts","../src/core/helpers/insert-empty-paragraph-at-node-boundary.ts","../src/core/constants/common.ts","../src/core/extensions/callout/types.ts","../src/core/extensions/callout/utils.ts","../src/core/extensions/callout/extension-config.ts","../src/core/extensions/code/code-block.ts","../src/core/extensions/code/lowlight-plugin.ts","../src/core/extensions/code/code-block-lowlight.ts","../src/core/extensions/code-inline/index.tsx","../src/core/extensions/custom-link/helpers/autolink.ts","../src/core/extensions/custom-link/helpers/clickHandler.ts","../src/core/extensions/custom-link/helpers/pasteHandler.ts","../src/core/extensions/custom-link/extension.tsx","../src/core/extensions/custom-image/types.ts","../src/core/extensions/custom-image/utils.ts","../src/core/extensions/custom-image/components/toolbar/alignment.tsx","../src/core/extensions/custom-image/components/toolbar/download.tsx","../src/core/extensions/custom-image/components/toolbar/full-screen/modal.tsx","../src/core/extensions/custom-image/components/toolbar/full-screen/root.tsx","../src/core/extensions/custom-image/components/toolbar/root.tsx","../src/core/extensions/custom-image/components/upload-status.tsx","../src/core/extensions/custom-image/components/block.tsx","../src/core/helpers/file.ts","../src/core/plugins/drop.ts","../src/core/hooks/use-file-upload.ts","../src/core/extensions/custom-image/components/uploader.tsx","../src/core/extensions/custom-image/components/node-view.tsx","../src/core/extensions/image/extension-config.tsx","../src/core/extensions/image/extension.tsx","../src/core/extensions/mentions/types.ts","../src/core/extensions/mentions/extension-config.ts","../src/core/helpers/floating-ui.ts","../src/core/helpers/tippy.ts","../src/core/extensions/table/table/utilities/helpers.ts","../src/core/extensions/table/plugins/drag-handles/actions.ts","../src/core/extensions/table/plugins/drag-handles/marker-utils.ts","../src/core/constants/meta.ts","../src/core/extensions/table/plugins/drag-handles/utils.ts","../src/core/extensions/table/plugins/drag-handles/color-selector.tsx","../src/core/extensions/table/plugins/drag-handles/column/dropdown.tsx","../src/core/extensions/table/plugins/drag-handles/column/utils.ts","../src/core/extensions/table/plugins/drag-handles/column/drag-handle.tsx","../src/core/extensions/table/plugins/drag-handles/column/plugin.ts","../src/core/extensions/table/plugins/drag-handles/row/dropdown.tsx","../src/core/extensions/table/plugins/drag-handles/row/utils.ts","../src/core/extensions/table/plugins/drag-handles/row/drag-handle.tsx","../src/core/extensions/table/plugins/drag-handles/row/plugin.ts","../src/core/extensions/table/plugins/insert-handlers/utils.ts","../src/core/extensions/table/plugins/insert-handlers/plugin.ts","../src/core/extensions/table/table/table-view.tsx","../src/core/extensions/table/table/utilities/create-cell.ts","../src/core/extensions/table/table/utilities/get-table-node-types.ts","../src/core/extensions/table/table/utilities/create-table.ts","../src/core/extensions/table/table/utilities/delete-column.ts","../src/core/extensions/table/table/utilities/delete-key-shortcut.ts","../src/core/extensions/table/table/utilities/delete-row.ts","../src/core/extensions/table/table/utilities/insert-line-above-table-action.ts","../src/core/extensions/table/table/utilities/insert-line-below-table-action.ts","../src/core/extensions/table/table/table.ts","../src/core/extensions/table/table/index.ts","../src/core/extensions/table/plugins/selection-outline/utils.ts","../src/core/extensions/table/plugins/selection-outline/plugin.ts","../src/core/extensions/table/table-cell.ts","../src/core/extensions/table/table-header.ts","../src/core/extensions/table/table-row.ts","../src/core/extensions/work-item-embed/extension-config.ts","../src/ce/extensions/core/without-props.ts","../src/core/extensions/code/without-props.tsx","../src/core/extensions/custom-color.ts","../src/core/extensions/custom-image/extension-config.ts","../src/core/helpers/find-suggestion-match.ts","../src/core/extensions/emoji/emoji.ts","../src/core/extensions/emoji/components/emojis-list.tsx","../src/core/extensions/emoji/suggestion.ts","../src/core/extensions/emoji/extension.ts","../src/core/extensions/horizontal-rule.ts","../src/core/extensions/quote.ts","../src/core/extensions/starter-kit.ts","../src/core/extensions/text-align.ts","../src/core/extensions/core-without-props.ts","../src/core/extensions/title-extension.ts","../src/core/helpers/yjs-utils.ts","../src/core/types/document-collaborative-events.ts"],"sourcesContent":["// types\nimport type { TDisplayConfig } from \"@/types\";\n\nexport const DEFAULT_DISPLAY_CONFIG: TDisplayConfig = {\n  fontSize: \"large-font\",\n  fontStyle: \"sans-serif\",\n  lineSpacing: \"regular\",\n  wideLayout: false,\n};\n\nexport const ACCEPTED_IMAGE_MIME_TYPES = [\"image/jpeg\", \"image/jpg\", \"image/png\", \"image/webp\", \"image/gif\"];\n\nexport const ACCEPTED_ATTACHMENT_MIME_TYPES = [\n  \"image/jpeg\",\n  \"image/png\",\n  \"image/gif\",\n  \"image/svg+xml\",\n  \"image/webp\",\n  \"image/tiff\",\n  \"image/bmp\",\n  \"application/pdf\",\n  \"application/msword\",\n  \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\n  \"application/vnd.ms-excel\",\n  \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n  \"application/vnd.ms-powerpoint\",\n  \"application/vnd.openxmlformats-officedocument.presentationml.presentation\",\n  \"text/plain\",\n  \"application/rtf\",\n  \"audio/mpeg\",\n  \"audio/wav\",\n  \"audio/ogg\",\n  \"audio/midi\",\n  \"audio/x-midi\",\n  \"audio/aac\",\n  \"audio/flac\",\n  \"audio/x-m4a\",\n  \"video/mp4\",\n  \"video/mpeg\",\n  \"video/ogg\",\n  \"video/webm\",\n  \"video/quicktime\",\n  \"video/x-msvideo\",\n  \"video/x-ms-wmv\",\n  \"application/zip\",\n  \"application/x-rar-compressed\",\n  \"application/x-tar\",\n  \"application/gzip\",\n  \"model/gltf-binary\",\n  \"model/gltf+json\",\n  \"application/octet-stream\",\n  \"font/ttf\",\n  \"font/otf\",\n  \"font/woff\",\n  \"font/woff2\",\n  \"text/css\",\n  \"text/javascript\",\n  \"application/json\",\n  \"text/xml\",\n  \"text/csv\",\n  \"application/xml\",\n];\n","export enum CORE_EXTENSIONS {\n  BLOCKQUOTE = \"blockquote\",\n  BOLD = \"bold\",\n  BULLET_LIST = \"bulletList\",\n  CALLOUT = \"calloutComponent\",\n  CHARACTER_COUNT = \"characterCount\",\n  CODE_BLOCK = \"codeBlock\",\n  CODE_INLINE = \"code\",\n  CUSTOM_COLOR = \"customColor\",\n  CUSTOM_IMAGE = \"imageComponent\",\n  CUSTOM_LINK = \"link\",\n  DOCUMENT = \"doc\",\n  DROP_CURSOR = \"dropCursor\",\n  ENTER_KEY = \"enterKey\",\n  GAP_CURSOR = \"gapCursor\",\n  HARD_BREAK = \"hardBreak\",\n  HEADING = \"heading\",\n  HEADINGS_LIST = \"headingsList\",\n  HISTORY = \"history\",\n  HORIZONTAL_RULE = \"horizontalRule\",\n  IMAGE = \"image\",\n  ITALIC = \"italic\",\n  LIST_ITEM = \"listItem\",\n  MARKDOWN_CLIPBOARD = \"markdownClipboard\",\n  MENTION = \"mention\",\n  ORDERED_LIST = \"orderedList\",\n  PARAGRAPH = \"paragraph\",\n  PLACEHOLDER = \"placeholder\",\n  SIDE_MENU = \"editorSideMenu\",\n  SLASH_COMMANDS = \"slash-command\",\n  STRIKETHROUGH = \"strike\",\n  TABLE = \"table\",\n  TABLE_CELL = \"tableCell\",\n  TABLE_HEADER = \"tableHeader\",\n  TABLE_ROW = \"tableRow\",\n  TASK_ITEM = \"taskItem\",\n  TASK_LIST = \"taskList\",\n  TEXT_ALIGN = \"textAlign\",\n  TEXT_STYLE = \"textStyle\",\n  TYPOGRAPHY = \"typography\",\n  UNDERLINE = \"underline\",\n  UTILITY = \"utility\",\n  WORK_ITEM_EMBED = \"issue-embed-component\",\n  EMOJI = \"emoji\",\n  UNIQUE_ID = \"uniqueID\",\n}\n\nexport const BLOCK_NODE_TYPES = [\n  // Basic block nodes\n  CORE_EXTENSIONS.PARAGRAPH,\n  CORE_EXTENSIONS.HEADING,\n  CORE_EXTENSIONS.BLOCKQUOTE,\n  CORE_EXTENSIONS.CODE_BLOCK,\n  CORE_EXTENSIONS.HORIZONTAL_RULE,\n\n  // List nodes\n  CORE_EXTENSIONS.BULLET_LIST,\n  CORE_EXTENSIONS.ORDERED_LIST,\n  CORE_EXTENSIONS.LIST_ITEM,\n  CORE_EXTENSIONS.TASK_LIST,\n  CORE_EXTENSIONS.TASK_ITEM,\n\n  // Table nodes\n  CORE_EXTENSIONS.TABLE,\n\n  // Media and embed nodes\n  CORE_EXTENSIONS.IMAGE,\n  CORE_EXTENSIONS.CUSTOM_IMAGE,\n  CORE_EXTENSIONS.CALLOUT,\n  CORE_EXTENSIONS.WORK_ITEM_EMBED,\n];\n","import type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\nimport type { EditorState, Selection } from \"@tiptap/pm/state\";\n// plane imports\nimport { cn } from \"@plane/utils\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n\ntype EditorClassNameArgs = {\n  noBorder?: boolean;\n  borderOnFocus?: boolean;\n  containerClassName?: string;\n};\n\nexport const getEditorClassNames = ({ noBorder, borderOnFocus, containerClassName }: EditorClassNameArgs) =>\n  cn(\n    \"w-full max-w-full sm:rounded-lg focus:outline-none focus:border-0\",\n    {\n      \"border border-custom-border-200\": !noBorder,\n      \"focus:border border-custom-border-300\": borderOnFocus,\n    },\n    containerClassName\n  );\n\n// Helper function to find the parent node of a specific type\nexport const findParentNodeOfType = (\n  selection: Selection,\n  typeName: string[]\n): {\n  node: ProseMirrorNode;\n  pos: number;\n  depth: number;\n} | null => {\n  let depth = selection.$anchor.depth;\n  while (depth > 0) {\n    const node = selection.$anchor.node(depth);\n    if (typeName.includes(node.type.name)) {\n      return {\n        node,\n        pos: selection.$anchor.start(depth) - 1,\n        depth,\n      };\n    }\n    depth--;\n  }\n  return null;\n};\n\nexport const findTableAncestor = (node: Node | null): HTMLTableElement | null => {\n  while (node !== null && node.nodeName !== \"TABLE\") {\n    node = node.parentNode;\n  }\n  return node as HTMLTableElement;\n};\n\nexport const getTrimmedHTML = (html: string) =>\n  html\n    .replace(/^(?:<p><\\/p>)+/g, \"\") // Remove from beginning\n    .replace(/(?:<p><\\/p>)+$/g, \"\"); // Remove from end\n\nexport const isValidHttpUrl = (string: string): { isValid: boolean; url: string } => {\n  // List of potentially dangerous protocols to block\n  const blockedProtocols = [\"javascript:\", \"data:\", \"vbscript:\", \"file:\", \"about:\"];\n\n  // First try with the original string\n  try {\n    const url = new URL(string);\n\n    // Check for potentially dangerous protocols\n    const protocol = url.protocol.toLowerCase();\n    if (blockedProtocols.some((p) => protocol === p)) {\n      return {\n        isValid: false,\n        url: string,\n      };\n    }\n\n    // If URL has any valid protocol, return as is\n    if (url.protocol && url.protocol !== \"\") {\n      return {\n        isValid: true,\n        url: string,\n      };\n    }\n  } catch {\n    // Original string wasn't a valid URL - that's okay, we'll try with https\n  }\n\n  // Try again with https:// prefix\n  try {\n    const urlWithHttps = `https://${string}`;\n    new URL(urlWithHttps);\n    return {\n      isValid: true,\n      url: urlWithHttps,\n    };\n  } catch {\n    return {\n      isValid: false,\n      url: string,\n    };\n  }\n};\n\nexport const getParagraphCount = (editorState: EditorState | undefined) => {\n  if (!editorState) return 0;\n  let paragraphCount = 0;\n  editorState.doc.descendants((node) => {\n    if (node.type.name === CORE_EXTENSIONS.PARAGRAPH && node.content.size > 0) paragraphCount++;\n  });\n  return paragraphCount;\n};\n","import type { KeyboardShortcutCommand } from \"@tiptap/core\";\nimport type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n\ntype Direction = \"up\" | \"down\";\n\nexport const insertEmptyParagraphAtNodeBoundaries: (\n  direction: Direction,\n  nodeType: string\n) => KeyboardShortcutCommand =\n  (direction, nodeType) =>\n  ({ editor }) => {\n    try {\n      const { selection, doc } = editor.state;\n      const { $from, $to } = selection;\n\n      let targetNode: ProseMirrorNode | null = null;\n      let targetNodePos: number | null = null;\n\n      // Check if the selection itself is the target node\n      doc.nodesBetween($from.pos, $to.pos, (node, pos) => {\n        if (node.type.name === nodeType) {\n          targetNode = node;\n          targetNodePos = pos;\n          return false; // Stop iterating once the target node is found\n        }\n        return true;\n      });\n\n      if (targetNode === null || targetNodePos === null) return false;\n\n      const docSize = doc.content.size; // Get the size of the document\n\n      switch (direction) {\n        case \"up\": {\n          const insertPosUp = targetNodePos;\n\n          // Ensure the insert position is within the document boundaries\n          if (insertPosUp < 0 || insertPosUp > docSize) return false;\n\n          if (insertPosUp === 0) {\n            // If at the very start of the document, insert a new paragraph at the start\n            editor.chain().insertContentAt(insertPosUp, { type: CORE_EXTENSIONS.PARAGRAPH }).run();\n            editor.chain().setTextSelection(insertPosUp).run(); // Set the cursor to the new paragraph\n          } else {\n            // Otherwise, check the node immediately before the target node\n            const prevNode = doc.nodeAt(insertPosUp - 1);\n\n            if (prevNode && prevNode.type.name === CORE_EXTENSIONS.PARAGRAPH) {\n              // If the previous node is a paragraph, move the cursor there\n              editor\n                .chain()\n                .setTextSelection(insertPosUp - 1)\n                .run();\n            } else {\n              return false; // If the previous node is not a paragraph, do not proceed\n            }\n          }\n          break;\n        }\n\n        case \"down\": {\n          const insertPosDown = targetNodePos + (targetNode as ProseMirrorNode).nodeSize;\n\n          // Ensure the insert position is within the document boundaries\n          if (insertPosDown < 0 || insertPosDown > docSize) return false;\n\n          // Check the node immediately after the target node\n          const nextNode = doc.nodeAt(insertPosDown);\n\n          if (nextNode && nextNode.type.name === CORE_EXTENSIONS.PARAGRAPH) {\n            // If the next node is a paragraph, move the cursor to the end of it\n            const endOfParagraphPos = insertPosDown + nextNode.nodeSize - 1;\n            editor.chain().setTextSelection(endOfParagraphPos).run();\n          } else if (!nextNode) {\n            // If there is no next node (end of document), insert a new paragraph\n            editor.chain().insertContentAt(insertPosDown, { type: CORE_EXTENSIONS.PARAGRAPH }).run();\n            editor\n              .chain()\n              .setTextSelection(insertPosDown + 1)\n              .run(); // Set the cursor to the new paragraph\n          } else {\n            return false; // If the next node is not a paragraph, do not proceed\n          }\n          break;\n        }\n\n        default:\n          return false; // If the direction is not recognized, do not proceed\n      }\n\n      return true; // Return true if the operation was successful\n    } catch (error) {\n      console.error(`An error occurred while inserting a line ${direction} the ${nodeType}:`, error);\n      return false; // Return false if an error occurred\n    }\n  };\n","import type { LucideIcon } from \"lucide-react\";\nimport {\n  AlignCenter,\n  AlignLeft,\n  AlignRight,\n  Bold,\n  CaseSensitive,\n  Code2,\n  Heading1,\n  Heading2,\n  Heading3,\n  Heading4,\n  Heading5,\n  Heading6,\n  Image,\n  Italic,\n  List,\n  ListOrdered,\n  ListTodo,\n  Strikethrough,\n  Table,\n  TextQuote,\n  Underline,\n} from \"lucide-react\";\nimport type { TCommandExtraProps, TEditorCommands } from \"@/types/editor\";\n\nexport type TEditorTypes = \"lite\" | \"document\";\n\n// Utility type to enforce the necessary extra props or make extraProps optional\nexport type ExtraPropsForCommand<T extends TEditorCommands> = T extends keyof TCommandExtraProps\n  ? TCommandExtraProps[T]\n  : object; // Default to empty object for commands without extra props\n\nexport type ToolbarMenuItem<T extends TEditorCommands = TEditorCommands> = {\n  itemKey: T;\n  renderKey: string;\n  name: string;\n  icon: LucideIcon;\n  shortcut?: string[];\n  editors: TEditorTypes[];\n  extraProps?: ExtraPropsForCommand<T>;\n};\n\nexport const TYPOGRAPHY_ITEMS: ToolbarMenuItem<\"text\" | \"h1\" | \"h2\" | \"h3\" | \"h4\" | \"h5\" | \"h6\">[] = [\n  { itemKey: \"text\", renderKey: \"text\", name: \"Text\", icon: CaseSensitive, editors: [\"document\"] },\n  { itemKey: \"h1\", renderKey: \"h1\", name: \"Heading 1\", icon: Heading1, editors: [\"document\"] },\n  { itemKey: \"h2\", renderKey: \"h2\", name: \"Heading 2\", icon: Heading2, editors: [\"document\"] },\n  { itemKey: \"h3\", renderKey: \"h3\", name: \"Heading 3\", icon: Heading3, editors: [\"document\"] },\n  { itemKey: \"h4\", renderKey: \"h4\", name: \"Heading 4\", icon: Heading4, editors: [\"document\"] },\n  { itemKey: \"h5\", renderKey: \"h5\", name: \"Heading 5\", icon: Heading5, editors: [\"document\"] },\n  { itemKey: \"h6\", renderKey: \"h6\", name: \"Heading 6\", icon: Heading6, editors: [\"document\"] },\n];\n\nexport const TEXT_ALIGNMENT_ITEMS: ToolbarMenuItem<\"text-align\">[] = [\n  {\n    itemKey: \"text-align\",\n    renderKey: \"text-align-left\",\n    name: \"Left align\",\n    icon: AlignLeft,\n    shortcut: [\"Cmd\", \"Shift\", \"L\"],\n    editors: [\"lite\", \"document\"],\n    extraProps: {\n      alignment: \"left\",\n    },\n  },\n  {\n    itemKey: \"text-align\",\n    renderKey: \"text-align-center\",\n    name: \"Center align\",\n    icon: AlignCenter,\n    shortcut: [\"Cmd\", \"Shift\", \"E\"],\n    editors: [\"lite\", \"document\"],\n    extraProps: {\n      alignment: \"center\",\n    },\n  },\n  {\n    itemKey: \"text-align\",\n    renderKey: \"text-align-right\",\n    name: \"Right align\",\n    icon: AlignRight,\n    shortcut: [\"Cmd\", \"Shift\", \"R\"],\n    editors: [\"lite\", \"document\"],\n    extraProps: {\n      alignment: \"right\",\n    },\n  },\n];\n\nconst BASIC_MARK_ITEMS: ToolbarMenuItem<\"bold\" | \"italic\" | \"underline\" | \"strikethrough\">[] = [\n  {\n    itemKey: \"bold\",\n    renderKey: \"bold\",\n    name: \"Bold\",\n    icon: Bold,\n    shortcut: [\"Cmd\", \"B\"],\n    editors: [\"lite\", \"document\"],\n  },\n  {\n    itemKey: \"italic\",\n    renderKey: \"italic\",\n    name: \"Italic\",\n    icon: Italic,\n    shortcut: [\"Cmd\", \"I\"],\n    editors: [\"lite\", \"document\"],\n  },\n  {\n    itemKey: \"underline\",\n    renderKey: \"underline\",\n    name: \"Underline\",\n    icon: Underline,\n    shortcut: [\"Cmd\", \"U\"],\n    editors: [\"lite\", \"document\"],\n  },\n  {\n    itemKey: \"strikethrough\",\n    renderKey: \"strikethrough\",\n    name: \"Strikethrough\",\n    icon: Strikethrough,\n    shortcut: [\"Cmd\", \"Shift\", \"S\"],\n    editors: [\"lite\", \"document\"],\n  },\n];\n\nconst LIST_ITEMS: ToolbarMenuItem<\"bulleted-list\" | \"numbered-list\" | \"to-do-list\">[] = [\n  {\n    itemKey: \"bulleted-list\",\n    renderKey: \"bulleted-list\",\n    name: \"Bulleted list\",\n    icon: List,\n    shortcut: [\"Cmd\", \"Shift\", \"7\"],\n    editors: [\"lite\", \"document\"],\n  },\n  {\n    itemKey: \"numbered-list\",\n    renderKey: \"numbered-list\",\n    name: \"Numbered list\",\n    icon: ListOrdered,\n    shortcut: [\"Cmd\", \"Shift\", \"8\"],\n    editors: [\"lite\", \"document\"],\n  },\n  {\n    itemKey: \"to-do-list\",\n    renderKey: \"to-do-list\",\n    name: \"To-do list\",\n    icon: ListTodo,\n    shortcut: [\"Cmd\", \"Shift\", \"9\"],\n    editors: [\"lite\", \"document\"],\n  },\n];\n\nexport const USER_ACTION_ITEMS: ToolbarMenuItem<\"quote\" | \"code\">[] = [\n  { itemKey: \"quote\", renderKey: \"quote\", name: \"Quote\", icon: TextQuote, editors: [\"lite\", \"document\"] },\n  { itemKey: \"code\", renderKey: \"code\", name: \"Code\", icon: Code2, editors: [\"lite\", \"document\"] },\n];\n\nexport const COMPLEX_ITEMS: ToolbarMenuItem<\"table\" | \"image\">[] = [\n  { itemKey: \"table\", renderKey: \"table\", name: \"Table\", icon: Table, editors: [\"document\"] },\n  { itemKey: \"image\", renderKey: \"image\", name: \"Image\", icon: Image, editors: [\"lite\", \"document\"] },\n];\n\nexport const TOOLBAR_ITEMS: {\n  [editorType in TEditorTypes]: {\n    [key: string]: ToolbarMenuItem[];\n  };\n} = {\n  lite: {\n    basic: BASIC_MARK_ITEMS.filter((item) => item.editors.includes(\"lite\")),\n    alignment: TEXT_ALIGNMENT_ITEMS.filter((item) => item.editors.includes(\"lite\")),\n    list: LIST_ITEMS.filter((item) => item.editors.includes(\"lite\")),\n    userAction: USER_ACTION_ITEMS.filter((item) => item.editors.includes(\"lite\")),\n    complex: COMPLEX_ITEMS.filter((item) => item.editors.includes(\"lite\")),\n  },\n  document: {\n    basic: BASIC_MARK_ITEMS.filter((item) => item.editors.includes(\"document\")),\n    alignment: TEXT_ALIGNMENT_ITEMS.filter((item) => item.editors.includes(\"document\")),\n    list: LIST_ITEMS.filter((item) => item.editors.includes(\"document\")),\n    userAction: USER_ACTION_ITEMS.filter((item) => item.editors.includes(\"document\")),\n    complex: COMPLEX_ITEMS.filter((item) => item.editors.includes(\"document\")),\n  },\n};\n\nexport const COLORS_LIST: {\n  key: string;\n  label: string;\n  textColor: string;\n  backgroundColor: string;\n}[] = [\n  {\n    key: \"gray\",\n    label: \"Gray\",\n    textColor: \"var(--editor-colors-gray-text)\",\n    backgroundColor: \"var(--editor-colors-gray-background)\",\n  },\n  {\n    key: \"peach\",\n    label: \"Peach\",\n    textColor: \"var(--editor-colors-peach-text)\",\n    backgroundColor: \"var(--editor-colors-peach-background)\",\n  },\n  {\n    key: \"pink\",\n    label: \"Pink\",\n    textColor: \"var(--editor-colors-pink-text)\",\n    backgroundColor: \"var(--editor-colors-pink-background)\",\n  },\n  {\n    key: \"orange\",\n    label: \"Orange\",\n    textColor: \"var(--editor-colors-orange-text)\",\n    backgroundColor: \"var(--editor-colors-orange-background)\",\n  },\n  {\n    key: \"green\",\n    label: \"Green\",\n    textColor: \"var(--editor-colors-green-text)\",\n    backgroundColor: \"var(--editor-colors-green-background)\",\n  },\n  {\n    key: \"light-blue\",\n    label: \"Light blue\",\n    textColor: \"var(--editor-colors-light-blue-text)\",\n    backgroundColor: \"var(--editor-colors-light-blue-background)\",\n  },\n  {\n    key: \"dark-blue\",\n    label: \"Dark blue\",\n    textColor: \"var(--editor-colors-dark-blue-text)\",\n    backgroundColor: \"var(--editor-colors-dark-blue-background)\",\n  },\n  {\n    key: \"purple\",\n    label: \"Purple\",\n    textColor: \"var(--editor-colors-purple-text)\",\n    backgroundColor: \"var(--editor-colors-purple-background)\",\n  },\n  // {\n  //   key: \"pink-blue-gradient\",\n  //   label: \"Pink blue gradient\",\n  //   textColor: \"var(--editor-colors-pink-blue-gradient-text)\",\n  //   backgroundColor: \"var(--editor-colors-pink-blue-gradient-background)\",\n  // },\n];\n","import type { Node as ProseMirrorNode } from \"@tiptap/core\";\n\nexport enum ECalloutAttributeNames {\n  ICON_COLOR = \"data-icon-color\",\n  ICON_NAME = \"data-icon-name\",\n  EMOJI_UNICODE = \"data-emoji-unicode\",\n  EMOJI_URL = \"data-emoji-url\",\n  LOGO_IN_USE = \"data-logo-in-use\",\n  BACKGROUND = \"data-background\",\n  BLOCK_TYPE = \"data-block-type\",\n}\n\nexport type TCalloutBlockIconAttributes = {\n  [ECalloutAttributeNames.ICON_COLOR]: string | undefined;\n  [ECalloutAttributeNames.ICON_NAME]: string | undefined;\n};\n\nexport type TCalloutBlockEmojiAttributes = {\n  [ECalloutAttributeNames.EMOJI_UNICODE]: string | undefined;\n  [ECalloutAttributeNames.EMOJI_URL]: string | undefined;\n};\n\nexport type TCalloutBlockAttributes = {\n  [ECalloutAttributeNames.LOGO_IN_USE]: \"emoji\" | \"icon\";\n  [ECalloutAttributeNames.BACKGROUND]: string | undefined;\n  [ECalloutAttributeNames.BLOCK_TYPE]: \"callout-component\";\n} & TCalloutBlockIconAttributes &\n  TCalloutBlockEmojiAttributes;\n\nexport type CustomCalloutExtensionOptions = unknown;\nexport type CustomCalloutExtensionStorage = unknown;\n\nexport type CustomCalloutExtensionType = ProseMirrorNode<CustomCalloutExtensionOptions, CustomCalloutExtensionStorage>;\n","// plane imports\nimport type { TLogoProps } from \"@plane/types\";\nimport { sanitizeHTML } from \"@plane/utils\";\n// types\nimport type { TCalloutBlockAttributes, TCalloutBlockEmojiAttributes, TCalloutBlockIconAttributes } from \"./types\";\nimport { ECalloutAttributeNames } from \"./types\";\n\nexport const DEFAULT_CALLOUT_BLOCK_ATTRIBUTES: TCalloutBlockAttributes = {\n  [ECalloutAttributeNames.LOGO_IN_USE]: \"emoji\",\n  [ECalloutAttributeNames.ICON_COLOR]: undefined,\n  [ECalloutAttributeNames.ICON_NAME]: undefined,\n  [ECalloutAttributeNames.EMOJI_UNICODE]: \"128161\",\n  [ECalloutAttributeNames.EMOJI_URL]: \"https://cdn.jsdelivr.net/npm/emoji-datasource-apple/img/apple/64/1f4a1.png\",\n  [ECalloutAttributeNames.BACKGROUND]: undefined,\n  [ECalloutAttributeNames.BLOCK_TYPE]: \"callout-component\",\n};\n\ntype TStoredLogoValue = Pick<TCalloutBlockAttributes, ECalloutAttributeNames.LOGO_IN_USE> &\n  (TCalloutBlockEmojiAttributes | TCalloutBlockIconAttributes);\n\n// function to get the stored logo from local storage\nexport const getStoredLogo = (): TStoredLogoValue => {\n  const fallBackValues: TStoredLogoValue = {\n    [ECalloutAttributeNames.LOGO_IN_USE]: \"emoji\",\n    [ECalloutAttributeNames.EMOJI_UNICODE]: DEFAULT_CALLOUT_BLOCK_ATTRIBUTES[ECalloutAttributeNames.EMOJI_UNICODE],\n    [ECalloutAttributeNames.EMOJI_URL]: DEFAULT_CALLOUT_BLOCK_ATTRIBUTES[ECalloutAttributeNames.EMOJI_URL],\n  };\n\n  if (typeof window !== \"undefined\") {\n    const storedData = sanitizeHTML(localStorage.getItem(\"editor-calloutComponent-logo\") ?? \"\");\n    if (storedData) {\n      let parsedData: TLogoProps;\n      try {\n        parsedData = JSON.parse(storedData);\n      } catch (error) {\n        console.error(`Error parsing stored callout logo, stored value- ${storedData}`, error);\n        localStorage.removeItem(\"editor-calloutComponent-logo\");\n        return fallBackValues;\n      }\n      if (parsedData.in_use === \"emoji\" && parsedData.emoji?.value) {\n        return {\n          [ECalloutAttributeNames.LOGO_IN_USE]: \"emoji\",\n          [ECalloutAttributeNames.EMOJI_UNICODE]:\n            parsedData.emoji.value || DEFAULT_CALLOUT_BLOCK_ATTRIBUTES[ECalloutAttributeNames.EMOJI_UNICODE],\n          [ECalloutAttributeNames.EMOJI_URL]:\n            parsedData.emoji.url || DEFAULT_CALLOUT_BLOCK_ATTRIBUTES[ECalloutAttributeNames.EMOJI_URL],\n        };\n      }\n      if (parsedData.in_use === \"icon\" && parsedData.icon?.name) {\n        return {\n          [ECalloutAttributeNames.LOGO_IN_USE]: \"icon\",\n          [ECalloutAttributeNames.ICON_NAME]:\n            parsedData.icon.name || DEFAULT_CALLOUT_BLOCK_ATTRIBUTES[ECalloutAttributeNames.ICON_NAME],\n          [ECalloutAttributeNames.ICON_COLOR]:\n            parsedData.icon.color || DEFAULT_CALLOUT_BLOCK_ATTRIBUTES[ECalloutAttributeNames.ICON_COLOR],\n        };\n      }\n    }\n  }\n  // fallback values\n  return fallBackValues;\n};\n// function to update the stored logo on local storage\nexport const updateStoredLogo = (value: TLogoProps): void => {\n  if (typeof window === \"undefined\") return;\n  localStorage.setItem(\"editor-calloutComponent-logo\", JSON.stringify(value));\n};\n// function to get the stored background color from local storage\nexport const getStoredBackgroundColor = (): string | null => {\n  if (typeof window !== \"undefined\") {\n    return sanitizeHTML(localStorage.getItem(\"editor-calloutComponent-background\") ?? \"\");\n  }\n  return null;\n};\n// function to update the stored background color on local storage\nexport const updateStoredBackgroundColor = (value: string | null): void => {\n  if (typeof window === \"undefined\") return;\n  if (value === null) {\n    localStorage.removeItem(\"editor-calloutComponent-background\");\n    return;\n  } else {\n    localStorage.setItem(\"editor-calloutComponent-background\", value);\n  }\n};\n","import { Node, mergeAttributes } from \"@tiptap/core\";\nimport type { MarkdownSerializerState } from \"@tiptap/pm/markdown\";\nimport type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// types\nimport { ECalloutAttributeNames } from \"./types\";\nimport type { CustomCalloutExtensionType, TCalloutBlockAttributes } from \"./types\";\n// utils\nimport { DEFAULT_CALLOUT_BLOCK_ATTRIBUTES } from \"./utils\";\n\ndeclare module \"@tiptap/core\" {\n  interface Commands<ReturnType> {\n    [CORE_EXTENSIONS.CALLOUT]: {\n      insertCallout: () => ReturnType;\n    };\n  }\n}\n\nexport const CustomCalloutExtensionConfig: CustomCalloutExtensionType = Node.create({\n  name: CORE_EXTENSIONS.CALLOUT,\n  group: \"block\",\n  content: \"block+\",\n\n  addAttributes() {\n    const attributes = {\n      // Reduce instead of map to accumulate the attributes directly into an object\n      ...Object.values(ECalloutAttributeNames).reduce(\n        (acc, value) => {\n          acc[value] = {\n            default: DEFAULT_CALLOUT_BLOCK_ATTRIBUTES[value],\n          };\n          return acc;\n        },\n        {} as Record<ECalloutAttributeNames, { default: TCalloutBlockAttributes[ECalloutAttributeNames] }>\n      ),\n    };\n\n    return attributes;\n  },\n\n  addStorage() {\n    return {\n      markdown: {\n        serialize(state: MarkdownSerializerState, node: ProseMirrorNode) {\n          const attrs = node.attrs as TCalloutBlockAttributes;\n          const logoInUse = attrs[\"data-logo-in-use\"];\n          // add callout logo\n          if (logoInUse === \"emoji\") {\n            state.write(\n              `> <img src=\"${attrs[\"data-emoji-url\"]}\" alt=\"${attrs[\"data-emoji-unicode\"]}\" width=\"30px\" />\\n`\n            );\n          } else {\n            state.write(`> <icon>${attrs[\"data-icon-name\"]} icon</icon>\\n`);\n          }\n          // add an empty line after the logo\n          state.write(\"> \\n\");\n          // add '> ' before each line of the callout content\n          state.wrapBlock(\"> \", null, node, () => state.renderContent(node));\n          state.closeBlock(node);\n        },\n      },\n    };\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: `div[${ECalloutAttributeNames.BLOCK_TYPE}=\"${DEFAULT_CALLOUT_BLOCK_ATTRIBUTES[ECalloutAttributeNames.BLOCK_TYPE]}\"]`,\n      },\n    ];\n  },\n\n  // Render HTML for the callout node\n  renderHTML({ HTMLAttributes }) {\n    return [\"div\", mergeAttributes(HTMLAttributes), 0];\n  },\n});\n","import { mergeAttributes, Node, textblockTypeInputRule } from \"@tiptap/core\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n\nexport type CodeBlockOptions = {\n  /**\n   * Adds a prefix to language classes that are applied to code tags.\n   * Defaults to `'language-'`.\n   */\n  languageClassPrefix: string;\n  /**\n   * Define whether the node should be exited on triple enter.\n   * Defaults to `true`.\n   */\n  exitOnTripleEnter: boolean;\n  /**\n   * Define whether the node should be exited on arrow down if there is no node after it.\n   * Defaults to `true`.\n   */\n  exitOnArrowDown: boolean;\n  /**\n   * Custom HTML attributes that should be added to the rendered HTML tag.\n   */\n  HTMLAttributes: Record<string, unknown>;\n};\n\ndeclare module \"@tiptap/core\" {\n  interface Commands<ReturnType> {\n    [CORE_EXTENSIONS.CODE_BLOCK]: {\n      /**\n       * Set a code block\n       */\n      setCodeBlock: (attributes?: { language: string }) => ReturnType;\n      /**\n       * Toggle a code block\n       */\n      toggleCodeBlock: (attributes?: { language: string }) => ReturnType;\n    };\n  }\n}\n\nexport const backtickInputRegex = /^```([a-z]+)?[\\s\\n]$/;\nexport const tildeInputRegex = /^~~~([a-z]+)?[\\s\\n]$/;\n\nexport const CodeBlock = Node.create<CodeBlockOptions>({\n  name: CORE_EXTENSIONS.CODE_BLOCK,\n\n  addOptions() {\n    return {\n      languageClassPrefix: \"language-\",\n      exitOnTripleEnter: true,\n      exitOnArrowDown: true,\n      HTMLAttributes: {},\n    };\n  },\n  content: \"text*\",\n\n  marks: \"\",\n\n  group: \"block\",\n\n  code: true,\n\n  defining: true,\n\n  addAttributes() {\n    return {\n      language: {\n        default: null,\n        parseHTML: (element) => {\n          const { languageClassPrefix } = this.options;\n          const classNames = [...(element.firstElementChild?.classList || [])];\n          const languages = classNames\n            .filter((className) => className.startsWith(languageClassPrefix))\n            .map((className) => className.replace(languageClassPrefix, \"\"));\n          const language = languages[0];\n\n          if (!language) {\n            return null;\n          }\n\n          return language;\n        },\n        rendered: false,\n      },\n    };\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: \"pre\",\n        preserveWhitespace: \"full\",\n      },\n    ];\n  },\n\n  renderHTML({ node, HTMLAttributes }) {\n    return [\n      \"pre\",\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes),\n      [\n        \"code\",\n        {\n          class: node.attrs.language ? this.options.languageClassPrefix + node.attrs.language : null,\n        },\n        0,\n      ],\n    ];\n  },\n\n  addCommands() {\n    return {\n      setCodeBlock:\n        (attributes) =>\n        ({ commands }) =>\n          commands.setNode(this.name, attributes),\n      toggleCodeBlock:\n        (attributes) =>\n        ({ commands }) =>\n          commands.toggleNode(this.name, CORE_EXTENSIONS.PARAGRAPH, attributes),\n    };\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      \"Mod-Alt-c\": () => this.editor.commands.toggleCodeBlock(),\n\n      // remove codeBlock when at start of document or codeBlock is empty\n      Backspace: () => {\n        try {\n          const { empty, $anchor } = this.editor.state.selection;\n          const isAtStart = $anchor.pos === 1;\n\n          if (!empty || $anchor.parent.type.name !== this.name) {\n            return false;\n          }\n\n          if (isAtStart || !$anchor.parent.textContent.length) {\n            return this.editor.commands.clearNodes();\n          }\n\n          return false;\n        } catch (error) {\n          console.error(\"Error handling Backspace in code block:\", error);\n          return false;\n        }\n      },\n\n      // exit node on triple enter\n      Enter: ({ editor }) => {\n        try {\n          if (!this.options.exitOnTripleEnter) {\n            return false;\n          }\n\n          const { state } = editor;\n          const { selection } = state;\n          const { $from, empty } = selection;\n\n          if (!empty || $from.parent.type !== this.type) {\n            return false;\n          }\n\n          const isAtEnd = $from.parentOffset === $from.parent.nodeSize - 2;\n          const endsWithDoubleNewline = $from.parent.textContent.endsWith(\"\\n\\n\");\n\n          if (!isAtEnd || !endsWithDoubleNewline) {\n            return false;\n          }\n\n          return editor\n            .chain()\n            .command(({ tr }) => {\n              tr.delete($from.pos - 2, $from.pos);\n\n              return true;\n            })\n            .exitCode()\n            .run();\n        } catch (error) {\n          console.error(\"Error handling Enter in code block:\", error);\n          return false;\n        }\n      },\n\n      // exit node on arrow down\n      ArrowDown: ({ editor }) => {\n        try {\n          if (!this.options.exitOnArrowDown) {\n            return false;\n          }\n\n          const { state } = editor;\n          const { selection, doc } = state;\n          const { $from, empty } = selection;\n\n          if (!empty || $from.parent.type !== this.type) {\n            return false;\n          }\n\n          const isAtEnd = $from.parentOffset === $from.parent.nodeSize - 2;\n\n          if (!isAtEnd) {\n            return false;\n          }\n\n          const after = $from.after();\n\n          if (after === undefined) {\n            return false;\n          }\n\n          const nodeAfter = doc.nodeAt(after);\n\n          if (nodeAfter) {\n            return false;\n          }\n\n          return editor.commands.exitCode();\n        } catch (error) {\n          console.error(\"Error handling ArrowDown in code block:\", error);\n          return false;\n        }\n      },\n    };\n  },\n\n  addInputRules() {\n    return [\n      textblockTypeInputRule({\n        find: backtickInputRegex,\n        type: this.type,\n        getAttributes: (match) => ({\n          language: match[1],\n        }),\n      }),\n      textblockTypeInputRule({\n        find: tildeInputRegex,\n        type: this.type,\n        getAttributes: (match) => ({\n          language: match[1],\n        }),\n      }),\n    ];\n  },\n  addProseMirrorPlugins() {\n    return [\n      new Plugin({\n        key: new PluginKey(\"codeBlockVSCodeHandlerCustom\"),\n        props: {\n          handlePaste: (view, event) => {\n            try {\n              if (!event.clipboardData) {\n                return false;\n              }\n\n              if (this.editor.isActive(this.type.name)) {\n                return false;\n              }\n\n              if (this.editor.isActive(CORE_EXTENSIONS.CODE_INLINE)) {\n                // Check if it's an inline code block\n                event.preventDefault();\n                const text = event.clipboardData.getData(\"text/plain\");\n\n                if (!text) {\n                  console.error(\"Pasted text is empty.\");\n                  return false;\n                }\n\n                const { tr } = view.state;\n                const { $from, $to } = tr.selection;\n\n                if ($from.pos > $to.pos) {\n                  console.error(\"Invalid selection range.\");\n                  return false;\n                }\n\n                const docSize = tr.doc.content.size;\n                if ($from.pos < 0 || $to.pos > docSize) {\n                  console.error(\"Selection range is out of document bounds.\");\n                  return false;\n                }\n\n                // Extend the current selection to replace it with the pasted text\n                // wrapped in an inline code mark\n                const codeMark = view.state.schema.marks.code.create();\n                tr.replaceWith($from.pos, $to.pos, view.state.schema.text(text, [codeMark]));\n                view.dispatch(tr);\n                return true;\n              }\n\n              event.preventDefault();\n              const text = event.clipboardData.getData(\"text/plain\");\n              const vscode = event.clipboardData.getData(\"vscode-editor-data\");\n              const vscodeData = vscode ? JSON.parse(vscode) : undefined;\n              const language = vscodeData?.mode;\n\n              if (vscodeData && language) {\n                const { tr } = view.state;\n                const { $from } = tr.selection;\n\n                // Check if the current line is empty\n                const isCurrentLineEmpty = !$from.parent.textContent.trim();\n\n                let insertPos;\n\n                if (isCurrentLineEmpty) {\n                  // If the current line is empty, use the current position\n                  insertPos = $from.pos - 1;\n                } else {\n                  // If the current line is not empty, insert below the current block node\n                  insertPos = $from.end($from.depth) + 1;\n                }\n\n                // Ensure insertPos is within document bounds\n                if (insertPos < 0 || insertPos > tr.doc.content.size) {\n                  console.error(\"Invalid insert position.\");\n                  return false;\n                }\n\n                // Create a new code block node with the pasted content\n                const textNode = view.state.schema.text(text.replace(/\\r\\n?/g, \"\\n\"));\n                const codeBlock = this.type.create({ language }, textNode);\n                if (insertPos <= tr.doc.content.size) {\n                  tr.insert(insertPos, codeBlock);\n                  view.dispatch(tr);\n                  return true;\n                }\n\n                return false;\n              } else {\n                // TODO: complicated paste logic, to be handled later\n                return false;\n              }\n            } catch (error) {\n              console.error(\"Error handling paste in CodeBlock extension:\", error);\n              return false;\n            }\n          },\n        },\n      }),\n    ];\n  },\n});\n","// TODO: check all the type errors and fix them\n\nimport { findChildren } from \"@tiptap/core\";\nimport type { Node as ProsemirrorNode } from \"@tiptap/pm/model\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\nimport { Decoration, DecorationSet } from \"@tiptap/pm/view\";\nimport highlight from \"highlight.js/lib/core\";\n\nfunction parseNodes(nodes: any[], className: string[] = []): { text: string; classes: string[] }[] {\n  return nodes\n    .map((node) => {\n      const classes = [...className, ...(node.properties ? node.properties.className : [])];\n\n      if (node.children) {\n        return parseNodes(node.children, classes);\n      }\n\n      return {\n        text: node.value,\n        classes,\n      };\n    })\n    .flat();\n}\n\nfunction getHighlightNodes(result: any) {\n  // `.value` for lowlight v1, `.children` for lowlight v2\n  return result.value || result.children || [];\n}\n\nfunction registered(aliasOrLanguage: string) {\n  return Boolean(highlight.getLanguage(aliasOrLanguage));\n}\n\nfunction getDecorations({\n  doc,\n  name,\n  lowlight,\n  defaultLanguage,\n}: {\n  doc: ProsemirrorNode;\n  name: string;\n  lowlight: any;\n  defaultLanguage: string | null | undefined;\n}) {\n  const decorations: Decoration[] = [];\n\n  findChildren(doc, (node) => node.type.name === name).forEach((block) => {\n    let from = block.pos + 1;\n    const language = block.node.attrs.language || defaultLanguage;\n    const languages = lowlight.listLanguages();\n\n    const nodes =\n      language && (languages.includes(language) || registered(language))\n        ? getHighlightNodes(lowlight.highlight(language, block.node.textContent))\n        : getHighlightNodes(lowlight.highlightAuto(block.node.textContent));\n\n    parseNodes(nodes).forEach((node) => {\n      const to = from + node.text.length;\n\n      if (node.classes.length) {\n        const decoration = Decoration.inline(from, to, {\n          class: node.classes.join(\" \"),\n        });\n\n        decorations.push(decoration);\n      }\n\n      from = to;\n    });\n  });\n\n  return DecorationSet.create(doc, decorations);\n}\n\nfunction isFunction(param: () => any) {\n  return typeof param === \"function\";\n}\n\nexport function LowlightPlugin({\n  name,\n  lowlight,\n  defaultLanguage,\n}: {\n  name: string;\n  lowlight: any;\n  defaultLanguage: string | null | undefined;\n}) {\n  if (![\"highlight\", \"highlightAuto\", \"listLanguages\"].every((api) => isFunction(lowlight[api]))) {\n    throw Error(\"You should provide an instance of lowlight to use the code-block-lowlight extension\");\n  }\n\n  const lowlightPlugin: Plugin = new Plugin({\n    key: new PluginKey(\"lowlight\"),\n\n    state: {\n      init: (_, { doc }) =>\n        getDecorations({\n          doc,\n          name,\n          lowlight,\n          defaultLanguage,\n        }),\n      apply: (transaction, decorationSet, oldState, newState) => {\n        const oldNodeName = oldState.selection.$head.parent.type.name;\n        const newNodeName = newState.selection.$head.parent.type.name;\n        const oldNodes = findChildren(oldState.doc, (node) => node.type.name === name);\n        const newNodes = findChildren(newState.doc, (node) => node.type.name === name);\n\n        if (\n          transaction.docChanged &&\n          // Apply decorations if:\n          // selection includes named node,\n          ([oldNodeName, newNodeName].includes(name) ||\n            // OR transaction adds/removes named node,\n            newNodes.length !== oldNodes.length ||\n            // OR transaction has changes that completely encapsulate a node\n            // (for example, a transaction that affects the entire document).\n            // Such transactions can happen during collab syncing via y-prosemirror, for example.\n            transaction.steps.some(\n              (step) =>\n                // @ts-expect-error type error\n                step.from !== undefined &&\n                // @ts-expect-error type error\n                step.to !== undefined &&\n                oldNodes.some(\n                  (node) =>\n                    // @ts-expect-error type error\n                    node.pos >= step.from &&\n                    // @ts-expect-error type error\n                    node.pos + node.node.nodeSize <= step.to\n                )\n            ))\n        ) {\n          return getDecorations({\n            doc: transaction.doc,\n            name,\n            lowlight,\n            defaultLanguage,\n          });\n        }\n\n        return decorationSet.map(transaction.mapping, transaction.doc);\n      },\n    },\n\n    props: {\n      decorations(state) {\n        return lowlightPlugin.getState(state);\n      },\n    },\n  });\n\n  return lowlightPlugin;\n}\n","// import CodeBlock, { CodeBlockOptions } from \"@tiptap/extension-code-block\";\n\nimport type { CodeBlockOptions } from \"./code-block\";\nimport { CodeBlock } from \"./code-block\";\nimport { LowlightPlugin } from \"./lowlight-plugin\";\n\ntype CodeBlockLowlightOptions = CodeBlockOptions & {\n  lowlight: any;\n  defaultLanguage: string | null | undefined;\n};\n\nexport const CodeBlockLowlight = CodeBlock.extend<CodeBlockLowlightOptions>({\n  addOptions() {\n    return {\n      ...(this.parent?.() ?? {\n        languageClassPrefix: \"language-\",\n        exitOnTripleEnter: true,\n        exitOnArrowDown: true,\n        HTMLAttributes: {},\n      }),\n      lowlight: {},\n      defaultLanguage: null,\n    };\n  },\n\n  addProseMirrorPlugins() {\n    return [\n      ...(this.parent?.() || []),\n      LowlightPlugin({\n        name: this.name,\n        lowlight: this.options.lowlight,\n        defaultLanguage: this.options.defaultLanguage,\n      }),\n    ];\n  },\n});\n","import { Mark, markInputRule, markPasteRule, mergeAttributes } from \"@tiptap/core\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n\ntype InlineCodeOptions = {\n  HTMLAttributes: Record<string, unknown>;\n};\n\ndeclare module \"@tiptap/core\" {\n  interface Commands<ReturnType> {\n    [CORE_EXTENSIONS.CODE_INLINE]: {\n      /**\n       * Set a code mark\n       */\n      setCode: () => ReturnType;\n      /**\n       * Toggle inline code\n       */\n      toggleCode: () => ReturnType;\n      /**\n       * Unset a code mark\n       */\n      unsetCode: () => ReturnType;\n    };\n  }\n}\n\nexport const inputRegex = /(?:^|\\s)((?:`)((?:[^`]+))(?:`))$/;\nconst pasteRegex = /(?:^|\\s)((?:`)((?:[^`]+))(?:`))/g;\n\nexport const CustomCodeInlineExtension = Mark.create<InlineCodeOptions>({\n  name: CORE_EXTENSIONS.CODE_INLINE,\n\n  addOptions() {\n    return {\n      HTMLAttributes: {\n        class:\n          \"rounded bg-custom-background-80 px-[6px] py-[1.5px] font-mono font-medium text-orange-500 border-[0.5px] border-custom-border-200\",\n        spellcheck: \"false\",\n      },\n    };\n  },\n\n  excludes: \"_\",\n\n  code: true,\n\n  exitable: true,\n\n  parseHTML() {\n    return [{ tag: \"code\" }];\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\"code\", mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), 0];\n  },\n\n  addCommands() {\n    return {\n      setCode:\n        () =>\n        ({ commands }) =>\n          commands.setMark(this.name),\n      toggleCode:\n        () =>\n        ({ commands }) =>\n          commands.toggleMark(this.name),\n      unsetCode:\n        () =>\n        ({ commands }) =>\n          commands.unsetMark(this.name),\n    };\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      \"Mod-e\": () => this.editor.commands.toggleCode(),\n    };\n  },\n\n  addInputRules() {\n    return [\n      markInputRule({\n        find: inputRegex,\n        type: this.type,\n      }),\n    ];\n  },\n\n  addPasteRules() {\n    return [\n      markPasteRule({\n        find: pasteRegex,\n        type: this.type,\n      }),\n    ];\n  },\n});\n","import type { NodeWithPos } from \"@tiptap/core\";\nimport { combineTransactionSteps, findChildrenInRange, getChangedRanges, getMarksBetween } from \"@tiptap/core\";\nimport type { MarkType } from \"@tiptap/pm/model\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\nimport { find } from \"linkifyjs\";\n\ntype AutolinkOptions = {\n  type: MarkType;\n  validate?: (url: string) => boolean;\n};\n\nexport function autolink(options: AutolinkOptions): Plugin {\n  return new Plugin({\n    key: new PluginKey(\"autolink\"),\n    appendTransaction: (transactions, oldState, newState) => {\n      const docChanges = transactions.some((transaction) => transaction.docChanged) && !oldState.doc.eq(newState.doc);\n      const preventAutolink = transactions.some((transaction) => transaction.getMeta(\"preventAutolink\"));\n\n      if (!docChanges || preventAutolink) {\n        return;\n      }\n\n      const { tr } = newState;\n      const transform = combineTransactionSteps(oldState.doc, [...transactions]);\n      const changes = getChangedRanges(transform);\n\n      changes.forEach(({ newRange }) => {\n        // Now lets see if we can add new links.\n        const nodesInChangedRanges = findChildrenInRange(newState.doc, newRange, (node) => node.isTextblock);\n\n        let textBlock: NodeWithPos | undefined;\n        let textBeforeWhitespace: string | undefined;\n\n        if (nodesInChangedRanges.length > 1) {\n          // Grab the first node within the changed ranges (ex. the first of two paragraphs when hitting enter).\n          textBlock = nodesInChangedRanges[0];\n          textBeforeWhitespace = newState.doc.textBetween(\n            textBlock.pos,\n            textBlock.pos + textBlock.node.nodeSize,\n            undefined,\n            \" \"\n          );\n        } else if (\n          nodesInChangedRanges.length &&\n          // We want to make sure to include the block separator argument to treat hard breaks like spaces.\n          newState.doc.textBetween(newRange.from, newRange.to, \" \", \" \").endsWith(\" \")\n        ) {\n          textBlock = nodesInChangedRanges[0];\n          textBeforeWhitespace = newState.doc.textBetween(textBlock.pos, newRange.to, undefined, \" \");\n        }\n\n        if (textBlock && textBeforeWhitespace) {\n          const wordsBeforeWhitespace = textBeforeWhitespace.split(\" \").filter((s) => s !== \"\");\n\n          if (wordsBeforeWhitespace.length <= 0) {\n            return false;\n          }\n\n          const lastWordBeforeSpace = wordsBeforeWhitespace[wordsBeforeWhitespace.length - 1];\n          const lastWordAndBlockOffset = textBlock.pos + textBeforeWhitespace.lastIndexOf(lastWordBeforeSpace);\n\n          if (!lastWordBeforeSpace) {\n            return false;\n          }\n\n          find(lastWordBeforeSpace)\n            .filter((link) => link.isLink)\n            // Calculate link position.\n            .map((link) => ({\n              ...link,\n              from: lastWordAndBlockOffset + link.start + 1,\n              to: lastWordAndBlockOffset + link.end + 1,\n            }))\n            // ignore link inside code mark\n            .filter((link) => {\n              if (!newState.schema.marks.code) {\n                return true;\n              }\n\n              return !newState.doc.rangeHasMark(link.from, link.to, newState.schema.marks.code);\n            })\n            // validate link\n            .filter((link) => {\n              if (options.validate) {\n                return options.validate(link.value);\n              }\n              return true;\n            })\n            // Add link mark.\n            .forEach((link) => {\n              if (getMarksBetween(link.from, link.to, newState.doc).some((item) => item.mark.type === options.type)) {\n                return;\n              }\n\n              tr.addMark(\n                link.from,\n                link.to,\n                options.type.create({\n                  href: link.href,\n                })\n              );\n            });\n        }\n      });\n\n      if (!tr.steps.length) {\n        return;\n      }\n\n      return tr;\n    },\n  });\n}\n","import { getAttributes } from \"@tiptap/core\";\nimport type { MarkType } from \"@tiptap/pm/model\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\n\ntype ClickHandlerOptions = {\n  type: MarkType;\n};\n\nexport function clickHandler(options: ClickHandlerOptions): Plugin {\n  return new Plugin({\n    key: new PluginKey(\"handleClickLink\"),\n    props: {\n      handleClick: (view, pos, event) => {\n        if (event.button !== 0) {\n          return false;\n        }\n\n        let a = event.target as HTMLElement;\n        const els: HTMLElement[] = [];\n\n        while (a?.nodeName !== \"DIV\") {\n          els.push(a);\n          a = a?.parentNode as HTMLElement;\n        }\n\n        if (!els.find((value) => value.nodeName === \"A\")) {\n          return false;\n        }\n\n        const attrs = getAttributes(view.state, options.type.name);\n        const link = event.target as HTMLLinkElement;\n\n        const href = link?.href ?? attrs.href;\n        const target = link?.target ?? attrs.target;\n\n        if (link && href) {\n          window.open(href, target);\n\n          return true;\n        }\n\n        return false;\n      },\n    },\n  });\n}\n","import type { Editor } from \"@tiptap/core\";\nimport type { MarkType } from \"@tiptap/pm/model\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\nimport { find } from \"linkifyjs\";\n\ntype PasteHandlerOptions = {\n  editor: Editor;\n  type: MarkType;\n};\n\nexport function pasteHandler(options: PasteHandlerOptions): Plugin {\n  return new Plugin({\n    key: new PluginKey(\"handlePasteLink\"),\n    props: {\n      handlePaste: (view, event, slice) => {\n        const { state } = view;\n        const { selection } = state;\n        const { empty } = selection;\n\n        if (empty) {\n          return false;\n        }\n\n        let textContent = \"\";\n\n        slice.content.forEach((node) => {\n          textContent += node.textContent;\n        });\n\n        const link = find(textContent).find((item) => item.isLink && item.value === textContent);\n\n        if (!textContent || !link) {\n          return false;\n        }\n\n        options.editor.commands.setMark(options.type, {\n          href: link.href,\n        });\n\n        return true;\n      },\n    },\n  });\n}\n","import type { PasteRuleMatch } from \"@tiptap/core\";\nimport { Mark, markPasteRule, mergeAttributes } from \"@tiptap/core\";\nimport type { Plugin } from \"@tiptap/pm/state\";\nimport { find, registerCustomProtocol, reset } from \"linkifyjs\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// helpers\nimport { isValidHttpUrl } from \"@/helpers/common\";\n// local imports\nimport { autolink } from \"./helpers/autolink\";\nimport { clickHandler } from \"./helpers/clickHandler\";\nimport { pasteHandler } from \"./helpers/pasteHandler\";\n\ntype LinkProtocolOptions = {\n  scheme: string;\n  optionalSlashes?: boolean;\n};\n\ntype LinkOptions = {\n  /**\n   * If enabled, it adds links as you type.\n   */\n  autolink: boolean;\n  /**\n   * An array of custom protocols to be registered with linkifyjs.\n   */\n  protocols: Array<LinkProtocolOptions | string>;\n  /**\n   * If enabled, links will be opened on click.\n   */\n  openOnClick: boolean;\n  /**\n   * If enabled, links will be inclusive i.e. if you move your cursor to the\n   * link text, and start typing, it'll be a part of the link itself.\n   */\n  inclusive: boolean;\n  /**\n   * Adds a link to the current selection if the pasted content only contains an url.\n   */\n  linkOnPaste: boolean;\n  /**\n   * A list of HTML attributes to be rendered.\n   */\n  HTMLAttributes: Record<string, unknown>;\n  /**\n   * A validation function that modifies link verification for the auto linker.\n   * @param url - The url to be validated.\n   * @returns - True if the url is valid, false otherwise.\n   */\n  validate?: (url: string) => boolean;\n};\n\ndeclare module \"@tiptap/core\" {\n  interface Commands<ReturnType> {\n    [CORE_EXTENSIONS.CUSTOM_LINK]: {\n      /**\n       * Set a link mark\n       */\n      setLink: (attributes: {\n        href: string;\n        target?: string | null;\n        rel?: string | null;\n        class?: string | null;\n      }) => ReturnType;\n      /**\n       * Toggle a link mark\n       */\n      toggleLink: (attributes: {\n        href: string;\n        target?: string | null;\n        rel?: string | null;\n        class?: string | null;\n      }) => ReturnType;\n      /**\n       * Unset a link mark\n       */\n      unsetLink: () => ReturnType;\n    };\n  }\n  interface Storage {\n    [CORE_EXTENSIONS.CUSTOM_LINK]: CustomLinkStorage;\n  }\n}\n\nexport type CustomLinkStorage = {\n  isPreviewOpen: boolean;\n  posToInsert: { from: number; to: number };\n  isBubbleMenuOpen: boolean;\n};\n\nexport const CustomLinkExtension = Mark.create<LinkOptions, CustomLinkStorage>({\n  name: CORE_EXTENSIONS.CUSTOM_LINK,\n\n  priority: 1000,\n\n  keepOnSplit: false,\n\n  onCreate() {\n    this.options.protocols.forEach((protocol) => {\n      if (typeof protocol === \"string\") {\n        registerCustomProtocol(protocol);\n        return;\n      }\n      registerCustomProtocol(protocol.scheme, protocol.optionalSlashes);\n    });\n  },\n\n  onDestroy() {\n    reset();\n  },\n\n  inclusive() {\n    return this.options.inclusive;\n  },\n\n  addOptions() {\n    return {\n      openOnClick: true,\n      linkOnPaste: true,\n      autolink: true,\n      inclusive: false,\n      protocols: [\"http\", \"https\"],\n      HTMLAttributes: {\n        target: \"_blank\",\n        rel: \"noopener noreferrer nofollow\",\n        class:\n          \"text-custom-primary-300 underline underline-offset-[3px] hover:text-custom-primary-500 transition-colors cursor-pointer\",\n      },\n      validate: (url: string) => isValidHttpUrl(url).isValid,\n    };\n  },\n\n  addAttributes() {\n    return {\n      href: {\n        default: null,\n      },\n      target: {\n        default: this.options.HTMLAttributes.target,\n      },\n      rel: {\n        default: this.options.HTMLAttributes.rel,\n      },\n      class: {\n        default: this.options.HTMLAttributes.class,\n      },\n    };\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: \"a[href]\",\n        getAttrs: (node) => {\n          if (typeof node === \"string\") {\n            return null;\n          }\n          const href = node.getAttribute(\"href\")?.toLowerCase() || \"\";\n          if (href.startsWith(\"javascript:\") || href.startsWith(\"data:\") || href.startsWith(\"vbscript:\")) {\n            return false;\n          }\n          return {};\n        },\n      },\n    ];\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    const href = HTMLAttributes.href?.toLowerCase() || \"\";\n    if (href.startsWith(\"javascript:\") || href.startsWith(\"data:\") || href.startsWith(\"vbscript:\")) {\n      return [\"a\", mergeAttributes(this.options.HTMLAttributes, { ...HTMLAttributes, href: \"\" }), 0];\n    }\n    return [\"a\", mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), 0];\n  },\n\n  addCommands() {\n    return {\n      setLink:\n        (attributes) =>\n        ({ chain }) =>\n          chain().setMark(this.name, attributes).setMeta(\"preventAutolink\", true).run(),\n\n      toggleLink:\n        (attributes) =>\n        ({ chain }) =>\n          chain()\n            .toggleMark(this.name, attributes, { extendEmptyMarkRange: true })\n            .setMeta(\"preventAutolink\", true)\n            .run(),\n\n      unsetLink:\n        () =>\n        ({ chain }) =>\n          chain().unsetMark(this.name, { extendEmptyMarkRange: true }).setMeta(\"preventAutolink\", true).run(),\n    };\n  },\n\n  addPasteRules() {\n    return [\n      markPasteRule({\n        find: (text) => {\n          const foundLinks: PasteRuleMatch[] = [];\n\n          if (text) {\n            const links = find(text).filter((item) => item.isLink);\n\n            if (links.length) {\n              links.forEach((link) =>\n                foundLinks.push({\n                  text: link.value,\n                  data: {\n                    href: link.href,\n                  },\n                  index: link.start,\n                })\n              );\n            }\n          }\n\n          return foundLinks;\n        },\n        type: this.type,\n        getAttributes: (match) => ({\n          href: match.data?.href,\n        }),\n      }),\n    ];\n  },\n\n  addProseMirrorPlugins() {\n    const plugins: Plugin[] = [];\n\n    if (this.options.autolink) {\n      plugins.push(\n        autolink({\n          type: this.type,\n          validate: this.options.validate,\n        })\n      );\n    }\n\n    if (this.options.openOnClick) {\n      plugins.push(\n        clickHandler({\n          type: this.type,\n        })\n      );\n    }\n\n    if (this.options.linkOnPaste) {\n      plugins.push(\n        pasteHandler({\n          editor: this.editor,\n          type: this.type,\n        })\n      );\n    }\n\n    return plugins;\n  },\n\n  addStorage() {\n    return {\n      isPreviewOpen: false,\n      isBubbleMenuOpen: false,\n      posToInsert: { from: 0, to: 0 },\n    };\n  },\n});\n","import type { Node } from \"@tiptap/core\";\n// types\nimport type { TFileHandler } from \"@/types\";\n\nexport enum ECustomImageAttributeNames {\n  ID = \"id\",\n  WIDTH = \"width\",\n  HEIGHT = \"height\",\n  ASPECT_RATIO = \"aspectRatio\",\n  SOURCE = \"src\",\n  ALIGNMENT = \"alignment\",\n  STATUS = \"status\",\n}\n\nexport type Pixel = `${number}px`;\n\nexport type PixelAttribute<TDefault> = Pixel | TDefault;\n\nexport type TCustomImageSize = {\n  width: PixelAttribute<\"35%\">;\n  height: PixelAttribute<\"auto\">;\n  aspectRatio: number | null;\n};\n\nexport type TCustomImageAlignment = \"left\" | \"center\" | \"right\";\n\nexport enum ECustomImageStatus {\n  PENDING = \"pending\",\n  UPLOADING = \"uploading\",\n  UPLOADED = \"uploaded\",\n  DUPLICATING = \"duplicating\",\n  DUPLICATION_FAILED = \"duplication-failed\",\n}\n\nexport type TCustomImageAttributes = {\n  [ECustomImageAttributeNames.ID]: string | null;\n  [ECustomImageAttributeNames.WIDTH]: PixelAttribute<\"35%\" | number> | null;\n  [ECustomImageAttributeNames.HEIGHT]: PixelAttribute<\"auto\" | number> | null;\n  [ECustomImageAttributeNames.ASPECT_RATIO]: number | null;\n  [ECustomImageAttributeNames.SOURCE]: string | null;\n  [ECustomImageAttributeNames.ALIGNMENT]: TCustomImageAlignment;\n  [ECustomImageAttributeNames.STATUS]: ECustomImageStatus;\n};\n\nexport type UploadEntity = ({ event: \"insert\" } | { event: \"drop\"; file: File }) & { hasOpenedFileInputOnce?: boolean };\n\nexport type InsertImageComponentProps = {\n  file?: File;\n  pos?: number;\n  event: \"insert\" | \"drop\";\n};\n\nexport type CustomImageExtensionOptions = {\n  getImageDownloadSource: TFileHandler[\"getAssetDownloadSrc\"];\n  getImageSource: TFileHandler[\"getAssetSrc\"];\n  restoreImage: TFileHandler[\"restore\"];\n  uploadImage?: TFileHandler[\"upload\"];\n  duplicateImage?: TFileHandler[\"duplicate\"];\n};\n\nexport type CustomImageExtensionStorage = {\n  fileMap: Map<string, UploadEntity>;\n  deletedImageSet: Map<string, boolean>;\n  maxFileSize: number;\n};\n\nexport type CustomImageExtensionType = Node<CustomImageExtensionOptions, CustomImageExtensionStorage>;\n","import type { Editor } from \"@tiptap/core\";\nimport { AlignCenter, AlignLeft, AlignRight } from \"lucide-react\";\nimport type { LucideIcon } from \"lucide-react\";\n// local imports\nimport { ECustomImageAttributeNames, ECustomImageStatus } from \"./types\";\nimport type { TCustomImageAlignment, Pixel, TCustomImageAttributes } from \"./types\";\n\nexport const DEFAULT_CUSTOM_IMAGE_ATTRIBUTES: TCustomImageAttributes = {\n  [ECustomImageAttributeNames.SOURCE]: null,\n  [ECustomImageAttributeNames.ID]: null,\n  [ECustomImageAttributeNames.WIDTH]: \"35%\",\n  [ECustomImageAttributeNames.HEIGHT]: \"auto\",\n  [ECustomImageAttributeNames.ASPECT_RATIO]: null,\n  [ECustomImageAttributeNames.ALIGNMENT]: \"left\",\n  [ECustomImageAttributeNames.STATUS]: ECustomImageStatus.PENDING,\n};\n\nexport const getImageComponentImageFileMap = (editor: Editor) => editor.storage.imageComponent?.fileMap;\n\nexport const ensurePixelString = <TDefault>(\n  value: Pixel | TDefault | number | undefined | null,\n  defaultValue?: TDefault\n) => {\n  if (!value || value === defaultValue) {\n    return defaultValue;\n  }\n\n  if (typeof value === \"number\") {\n    return `${value}px` satisfies Pixel;\n  }\n\n  return value;\n};\n\nexport const IMAGE_ALIGNMENT_OPTIONS: {\n  label: string;\n  value: TCustomImageAlignment;\n  icon: LucideIcon;\n}[] = [\n  {\n    label: \"Left\",\n    value: \"left\",\n    icon: AlignLeft,\n  },\n  {\n    label: \"Center\",\n    value: \"center\",\n    icon: AlignCenter,\n  },\n  {\n    label: \"Right\",\n    value: \"right\",\n    icon: AlignRight,\n  },\n];\nexport const getImageBlockId = (id: string) => `editor-image-block-${id}`;\n\nexport const isImageDuplicating = (status: ECustomImageStatus) => status === ECustomImageStatus.DUPLICATING;\n\nexport const isImageDuplicationComplete = (status: ECustomImageStatus) =>\n  status === ECustomImageStatus.UPLOADED || status === ECustomImageStatus.DUPLICATION_FAILED;\n\nexport const hasImageDuplicationFailed = (status: ECustomImageStatus) =>\n  status === ECustomImageStatus.DUPLICATION_FAILED;\n","import { useEffect, useRef, useState } from \"react\";\n// plane imports\nimport { useOutsideClickDetector } from \"@plane/hooks\";\nimport { ChevronDownIcon } from \"@plane/propel/icons\";\nimport { Tooltip } from \"@plane/ui\";\n// local imports\nimport type { TCustomImageAlignment } from \"../../types\";\nimport { IMAGE_ALIGNMENT_OPTIONS } from \"../../utils\";\n\ntype Props = {\n  activeAlignment: TCustomImageAlignment;\n  handleChange: (alignment: TCustomImageAlignment) => void;\n  isTouchDevice: boolean;\n  toggleToolbarViewStatus: (val: boolean) => void;\n};\n\nexport function ImageAlignmentAction(props: Props) {\n  const { activeAlignment, handleChange, isTouchDevice, toggleToolbarViewStatus } = props;\n  // states\n  const [isDropdownOpen, setIsDropdownOpen] = useState(false);\n  // refs\n  const dropdownRef = useRef<HTMLDivElement>(null);\n  // derived values\n  const activeAlignmentDetails = IMAGE_ALIGNMENT_OPTIONS.find((option) => option.value === activeAlignment);\n\n  useOutsideClickDetector(dropdownRef, () => setIsDropdownOpen(false));\n\n  useEffect(() => {\n    toggleToolbarViewStatus(isDropdownOpen);\n  }, [isDropdownOpen, toggleToolbarViewStatus]);\n\n  return (\n    <div ref={dropdownRef} className=\"h-full relative\">\n      <Tooltip disabled={isTouchDevice} tooltipContent=\"Align\">\n        <button\n          type=\"button\"\n          className=\"h-full flex items-center gap-1 text-white/60 hover:text-white transition-colors\"\n          onClick={() => setIsDropdownOpen((prev) => !prev)}\n        >\n          {activeAlignmentDetails && <activeAlignmentDetails.icon className=\"flex-shrink-0 size-3\" />}\n          <ChevronDownIcon className=\"flex-shrink-0 size-2\" />\n        </button>\n      </Tooltip>\n      {isDropdownOpen && (\n        <div className=\"absolute top-full left-1/2 -translate-x-1/2 mt-0.5 h-7 bg-black/80 flex items-center gap-2 px-2 rounded\">\n          {IMAGE_ALIGNMENT_OPTIONS.map((option) => (\n            <Tooltip disabled={isTouchDevice} key={option.value} tooltipContent={option.label}>\n              <button\n                type=\"button\"\n                className=\"flex-shrink-0 h-full grid place-items-center text-white/60 hover:text-white transition-colors\"\n                onClick={() => {\n                  handleChange(option.value);\n                  setIsDropdownOpen(false);\n                }}\n              >\n                <option.icon className=\"size-3\" />\n              </button>\n            </Tooltip>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","import { Download } from \"lucide-react\";\n// plane imports\nimport { Tooltip } from \"@plane/ui\";\n\ntype Props = {\n  src: string;\n};\n\nexport function ImageDownloadAction(props: Props) {\n  const { src } = props;\n\n  return (\n    <Tooltip tooltipContent=\"Download\">\n      <button\n        type=\"button\"\n        onClick={() => window.open(src, \"_blank\")}\n        className=\"flex-shrink-0 h-full grid place-items-center text-white/60 hover:text-white transition-colors\"\n        aria-label=\"Download image\"\n      >\n        <Download className=\"size-3\" />\n      </button>\n    </Tooltip>\n  );\n}\n","import { Download, ExternalLink, Minus, Plus } from \"lucide-react\";\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { CloseIcon } from \"@plane/propel/icons\";\n// plane imports\nimport { cn } from \"@plane/utils\";\n\nconst MIN_ZOOM = 0.5;\nconst MAX_ZOOM = 2;\nconst ZOOM_SPEED = 0.05;\nconst ZOOM_STEPS = [0.5, 1, 1.5, 2];\n\ntype Props = {\n  aspectRatio: number;\n  downloadSrc: string;\n  isFullScreenEnabled: boolean;\n  isTouchDevice: boolean;\n  src: string;\n  toggleFullScreenMode: (val: boolean) => void;\n  width: string;\n};\n\nfunction ImageFullScreenModalWithoutPortal(props: Props) {\n  const { aspectRatio, isFullScreenEnabled, isTouchDevice, downloadSrc, src, toggleFullScreenMode, width } = props;\n  // refs\n  const dragStart = useRef({ x: 0, y: 0 });\n  const dragOffset = useRef({ x: 0, y: 0 });\n\n  const [magnification, setMagnification] = useState<number>(1);\n  const [initialMagnification, setInitialMagnification] = useState(1);\n  const [isDragging, setIsDragging] = useState(false);\n  const modalRef = useRef<HTMLDivElement>(null);\n  const imgRef = useRef<HTMLImageElement | null>(null);\n\n  const widthInNumber = useMemo(() => {\n    if (!width) return 0;\n    return Number(width.replace(\"px\", \"\"));\n  }, [width]);\n\n  const setImageRef = useCallback(\n    (node: HTMLImageElement | null) => {\n      if (!node || !isFullScreenEnabled) return;\n\n      imgRef.current = node;\n\n      const viewportWidth = window.innerWidth * 0.9;\n      const viewportHeight = window.innerHeight * 0.75;\n      const imageWidth = widthInNumber;\n      const imageHeight = imageWidth / aspectRatio;\n\n      const widthRatio = viewportWidth / imageWidth;\n      const heightRatio = viewportHeight / imageHeight;\n\n      setInitialMagnification(Math.min(widthRatio, heightRatio));\n      setMagnification(1);\n\n      // Reset image position\n      node.style.left = \"0px\";\n      node.style.top = \"0px\";\n    },\n    [isFullScreenEnabled, widthInNumber, aspectRatio]\n  );\n\n  const handleClose = useCallback(() => {\n    if (isDragging) return;\n    toggleFullScreenMode(false);\n    setMagnification(1);\n    setInitialMagnification(1);\n  }, [isDragging, toggleFullScreenMode]);\n\n  const handleMagnification = useCallback((direction: \"increase\" | \"decrease\") => {\n    setMagnification((prev) => {\n      // Find the appropriate target zoom level based on current magnification\n      let targetZoom: number;\n      if (direction === \"increase\") {\n        targetZoom = ZOOM_STEPS.find((step) => step > prev) ?? MAX_ZOOM;\n      } else {\n        // Reverse the array to find the next lower step\n        targetZoom = [...ZOOM_STEPS].reverse().find((step) => step < prev) ?? MIN_ZOOM;\n      }\n\n      // Reset position when zoom matches initial magnification\n      if (targetZoom === 1 && imgRef.current) {\n        imgRef.current.style.left = \"0px\";\n        imgRef.current.style.top = \"0px\";\n      }\n\n      return targetZoom;\n    });\n  }, []);\n\n  const handleKeyDown = useCallback(\n    (e: KeyboardEvent) => {\n      if (e.key === \"Escape\" || e.key === \"+\" || e.key === \"=\" || e.key === \"-\") {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (e.key === \"Escape\") handleClose();\n        if (e.key === \"+\" || e.key === \"=\") handleMagnification(\"increase\");\n        if (e.key === \"-\") handleMagnification(\"decrease\");\n      }\n    },\n    [handleClose, handleMagnification]\n  );\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    if (!imgRef.current) return;\n\n    const imgWidth = imgRef.current.offsetWidth * magnification;\n    const imgHeight = imgRef.current.offsetHeight * magnification;\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n\n    if (imgWidth > viewportWidth || imgHeight > viewportHeight) {\n      e.preventDefault();\n      e.stopPropagation();\n      setIsDragging(true);\n      dragStart.current = { x: e.clientX, y: e.clientY };\n      dragOffset.current = {\n        x: parseInt(imgRef.current.style.left || \"0\"),\n        y: parseInt(imgRef.current.style.top || \"0\"),\n      };\n    }\n  };\n\n  const handleMouseMove = useCallback(\n    (e: MouseEvent) => {\n      if (!isDragging || !imgRef.current) return;\n\n      const dx = e.clientX - dragStart.current.x;\n      const dy = e.clientY - dragStart.current.y;\n\n      // Apply the scale factor to the drag movement\n      const scaledDx = dx / magnification;\n      const scaledDy = dy / magnification;\n\n      imgRef.current.style.left = `${dragOffset.current.x + scaledDx}px`;\n      imgRef.current.style.top = `${dragOffset.current.y + scaledDy}px`;\n    },\n    [isDragging, magnification]\n  );\n\n  const handleMouseUp = useCallback(() => {\n    if (!isDragging || !imgRef.current) return;\n    setIsDragging(false);\n  }, [isDragging]);\n\n  const handleWheel = useCallback(\n    (e: WheelEvent) => {\n      if (!imgRef.current || !isFullScreenEnabled) return;\n\n      e.preventDefault();\n\n      // Handle pinch-to-zoom\n      if (e.ctrlKey || e.metaKey) {\n        const delta = e.deltaY;\n        setMagnification((prev) => {\n          const newZoom = prev * (1 - delta * ZOOM_SPEED);\n          const clampedZoom = Math.min(Math.max(newZoom, MIN_ZOOM), MAX_ZOOM);\n\n          // Reset position when zoom matches initial magnification\n          if (clampedZoom === 1 && imgRef.current) {\n            imgRef.current.style.left = \"0px\";\n            imgRef.current.style.top = \"0px\";\n          }\n\n          return clampedZoom;\n        });\n        return;\n      }\n    },\n    [isFullScreenEnabled]\n  );\n\n  // Event listeners\n  useEffect(() => {\n    if (!isFullScreenEnabled) return;\n\n    document.addEventListener(\"keydown\", handleKeyDown);\n    window.addEventListener(\"mousemove\", handleMouseMove);\n    window.addEventListener(\"mouseup\", handleMouseUp);\n    window.addEventListener(\"wheel\", handleWheel, { passive: false });\n\n    return () => {\n      document.removeEventListener(\"keydown\", handleKeyDown);\n      window.removeEventListener(\"mousemove\", handleMouseMove);\n      window.removeEventListener(\"mouseup\", handleMouseUp);\n      window.removeEventListener(\"wheel\", handleWheel);\n    };\n  }, [isFullScreenEnabled, handleKeyDown, handleMouseMove, handleMouseUp, handleWheel]);\n\n  if (!isFullScreenEnabled) return null;\n\n  return (\n    <div\n      className={cn(\"fixed inset-0 size-full z-50 bg-black/90 opacity-0 pointer-events-none transition-opacity\", {\n        \"opacity-100 pointer-events-auto editor-image-full-screen-modal\": isFullScreenEnabled,\n        \"cursor-default\": !isDragging,\n        \"cursor-grabbing\": isDragging,\n      })}\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-label=\"Fullscreen image viewer\"\n    >\n      <div\n        ref={modalRef}\n        onMouseDown={(e) => e.target === modalRef.current && handleClose()}\n        className=\"relative size-full grid place-items-center overflow-hidden\"\n      >\n        <button\n          type=\"button\"\n          onClick={handleClose}\n          className=\"absolute top-10 right-10 size-8 grid place-items-center\"\n          aria-label=\"Close image viewer\"\n        >\n          <CloseIcon className=\"size-8 text-white/60 hover:text-white transition-colors\" />\n        </button>\n        <img\n          ref={setImageRef}\n          src={src}\n          className=\"read-only-image rounded-lg\"\n          style={{\n            width: `${widthInNumber * initialMagnification}px`,\n            maxWidth: \"none\",\n            maxHeight: \"none\",\n            aspectRatio,\n            position: \"relative\",\n            transform: `scale(${magnification})`,\n            transformOrigin: \"center\",\n            transition: \"width 0.2s ease, transform 0.2s ease\",\n          }}\n          onMouseDown={handleMouseDown}\n        />\n        <div className=\"fixed bottom-10 left-1/2 -translate-x-1/2 flex items-center justify-center gap-1 rounded-md border border-white/20 py-2 divide-x divide-white/20 bg-black\">\n          <div className=\"flex items-center\">\n            <button\n              type=\"button\"\n              onClick={(e) => {\n                if (isTouchDevice) {\n                  e.preventDefault();\n                  e.stopPropagation();\n                }\n                handleMagnification(\"decrease\");\n              }}\n              className=\"size-6 grid place-items-center text-white/60 hover:text-white disabled:text-white/30 transition-colors duration-200\"\n              disabled={magnification <= MIN_ZOOM}\n              aria-label=\"Zoom out\"\n            >\n              <Minus className=\"size-4\" />\n            </button>\n            <span className=\"text-sm w-12 text-center text-white\">{Math.round(100 * magnification)}%</span>\n            <button\n              type=\"button\"\n              onClick={(e) => {\n                if (isTouchDevice) {\n                  e.preventDefault();\n                  e.stopPropagation();\n                }\n                handleMagnification(\"increase\");\n              }}\n              className=\"size-6 grid place-items-center text-white/60 hover:text-white disabled:text-white/30 transition-colors duration-200\"\n              disabled={magnification >= MAX_ZOOM}\n              aria-label=\"Zoom in\"\n            >\n              <Plus className=\"size-4\" />\n            </button>\n          </div>\n          {!isTouchDevice && (\n            <button\n              type=\"button\"\n              onClick={() => window.open(downloadSrc, \"_blank\")}\n              className=\"flex-shrink-0 size-8 grid place-items-center text-white/60 hover:text-white transition-colors duration-200\"\n              aria-label=\"Download image\"\n            >\n              <Download className=\"size-4\" />\n            </button>\n          )}\n          {!isTouchDevice && (\n            <button\n              type=\"button\"\n              onClick={() => window.open(src, \"_blank\")}\n              className=\"flex-shrink-0 size-8 grid place-items-center text-white/60 hover:text-white transition-colors duration-200\"\n              aria-label=\"Open image in new tab\"\n            >\n              <ExternalLink className=\"size-4\" />\n            </button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport function ImageFullScreenModal(props: Props) {\n  let modal = <ImageFullScreenModalWithoutPortal {...props} />;\n  const portal = document.querySelector(\"#editor-portal\");\n  if (portal) {\n    modal = ReactDOM.createPortal(modal, portal);\n  } else {\n    console.warn(\"Portal element #editor-portal not found. Rendering in document.body\");\n    if (typeof document !== \"undefined\" && document.body) {\n      modal = ReactDOM.createPortal(modal, document.body);\n    }\n  }\n  return modal;\n}\n","import { Maximize } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\n// plane imports\nimport { Tooltip } from \"@plane/ui\";\n// local imports\nimport { ImageFullScreenModal } from \"./modal\";\n\ntype Props = {\n  image: {\n    aspectRatio: number;\n    downloadSrc: string;\n    height: string;\n    src: string;\n    width: string;\n  };\n  isTouchDevice: boolean;\n  toggleToolbarViewStatus: (val: boolean) => void;\n};\n\nexport function ImageFullScreenActionRoot(props: Props) {\n  const { image, isTouchDevice, toggleToolbarViewStatus } = props;\n  // states\n  const [isFullScreenEnabled, setIsFullScreenEnabled] = useState(false);\n  // derived values\n  const { downloadSrc, src, width, aspectRatio } = image;\n\n  useEffect(() => {\n    toggleToolbarViewStatus(isFullScreenEnabled);\n  }, [isFullScreenEnabled, toggleToolbarViewStatus]);\n\n  return (\n    <>\n      <ImageFullScreenModal\n        aspectRatio={aspectRatio}\n        downloadSrc={downloadSrc}\n        isFullScreenEnabled={isFullScreenEnabled}\n        isTouchDevice={isTouchDevice}\n        src={src}\n        width={width}\n        toggleFullScreenMode={setIsFullScreenEnabled}\n      />\n      <Tooltip tooltipContent=\"View in full screen\" disabled={isTouchDevice}>\n        <button\n          type=\"button\"\n          onClick={(e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            setIsFullScreenEnabled(true);\n          }}\n          className=\"flex-shrink-0 h-full grid place-items-center text-white/60 hover:text-white transition-colors\"\n          aria-label=\"View image in full screen\"\n        >\n          <Maximize className=\"size-3\" />\n        </button>\n      </Tooltip>\n    </>\n  );\n}\n","import type { Editor } from \"@tiptap/core\";\nimport { useState } from \"react\";\n// plane imports\nimport { cn } from \"@plane/utils\";\n// local imports\nimport type { TCustomImageAlignment } from \"../../types\";\nimport { ImageAlignmentAction } from \"./alignment\";\nimport { ImageDownloadAction } from \"./download\";\nimport { ImageFullScreenActionRoot } from \"./full-screen\";\n\ntype Props = {\n  alignment: TCustomImageAlignment;\n  editor: Editor;\n  aspectRatio: number;\n  downloadSrc: string;\n  handleAlignmentChange: (alignment: TCustomImageAlignment) => void;\n  height: string;\n  isTouchDevice: boolean;\n  src: string;\n  width: string;\n};\n\nexport function ImageToolbarRoot(props: Props) {\n  const { alignment, editor, downloadSrc, handleAlignmentChange, isTouchDevice } = props;\n  // states\n  const [shouldShowToolbar, setShouldShowToolbar] = useState(false);\n  // derived values\n  const isEditable = editor.isEditable;\n\n  return (\n    <>\n      <div\n        className={cn(\n          \"absolute top-1 right-1 h-7 z-20 bg-black/80 rounded flex items-center gap-2 px-2 opacity-0 pointer-events-none group-hover/image-component:opacity-100 group-hover/image-component:pointer-events-auto transition-opacity\",\n          {\n            \"opacity-100 pointer-events-auto\": shouldShowToolbar,\n          }\n        )}\n      >\n        {!isTouchDevice && <ImageDownloadAction src={downloadSrc} />}\n        {isEditable && (\n          <ImageAlignmentAction\n            activeAlignment={alignment}\n            handleChange={handleAlignmentChange}\n            isTouchDevice={isTouchDevice}\n            toggleToolbarViewStatus={setShouldShowToolbar}\n          />\n        )}\n        <ImageFullScreenActionRoot\n          image={props}\n          isTouchDevice={isTouchDevice}\n          toggleToolbarViewStatus={setShouldShowToolbar}\n        />\n      </div>\n    </>\n  );\n}\n","import type { Editor } from \"@tiptap/core\";\nimport { useEditorState } from \"@tiptap/react\";\nimport { useEffect, useRef, useState } from \"react\";\n\ntype Props = {\n  editor: Editor;\n  nodeId: string;\n};\n\nexport function ImageUploadStatus(props: Props) {\n  const { editor, nodeId } = props;\n  // Displayed status that will animate smoothly\n  const [displayStatus, setDisplayStatus] = useState(0);\n  // Animation frame ID for cleanup\n  const animationFrameRef = useRef<number | null>(null);\n  // subscribe to image upload status\n  const uploadStatus: number | undefined = useEditorState({\n    editor,\n    selector: ({ editor }) => editor.storage.utility?.assetsUploadStatus?.[nodeId],\n  });\n\n  useEffect(() => {\n    const animateToValue = (start: number, end: number, startTime: number) => {\n      const duration = 200;\n\n      const animation = (currentTime: number) => {\n        const elapsed = currentTime - startTime;\n        const progress = Math.min(elapsed / duration, 1);\n\n        // Easing function for smooth animation\n        const easeOutCubic = 1 - Math.pow(1 - progress, 3);\n\n        // Calculate current display value\n        const currentValue = Math.floor(start + (end - start) * easeOutCubic);\n        setDisplayStatus(currentValue);\n\n        // Continue animation if not complete\n        if (progress < 1) {\n          animationFrameRef.current = requestAnimationFrame((time) => animation(time));\n        }\n      };\n      animationFrameRef.current = requestAnimationFrame((time) => animation(time));\n    };\n    animateToValue(displayStatus, uploadStatus == undefined ? 100 : uploadStatus, performance.now());\n\n    return () => {\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n    };\n  }, [displayStatus, uploadStatus]);\n\n  if (uploadStatus === undefined) return null;\n\n  return (\n    <div className=\"absolute top-1 right-1 z-20 bg-black/60 rounded text-xs font-medium w-10 text-center\">\n      {displayStatus}%\n    </div>\n  );\n}\n","import { NodeSelection } from \"@tiptap/pm/state\";\nimport React, { useRef, useState, useCallback, useLayoutEffect, useEffect } from \"react\";\n// plane imports\nimport { cn } from \"@plane/utils\";\n// local imports\nimport type { Pixel, TCustomImageAttributes, TCustomImageSize } from \"../types\";\nimport { ensurePixelString, getImageBlockId, isImageDuplicating } from \"../utils\";\nimport type { CustomImageNodeViewProps } from \"./node-view\";\nimport { ImageToolbarRoot } from \"./toolbar\";\nimport { ImageUploadStatus } from \"./upload-status\";\n\nconst MIN_SIZE = 100;\n\ntype CustomImageBlockProps = CustomImageNodeViewProps & {\n  editorContainer: HTMLDivElement | null;\n  imageFromFileSystem: string | undefined;\n  setEditorContainer: (editorContainer: HTMLDivElement | null) => void;\n  setFailedToLoadImage: (isError: boolean) => void;\n  src: string | undefined;\n  downloadSrc: string | undefined;\n};\n\nexport function CustomImageBlock(props: CustomImageBlockProps) {\n  // props\n  const {\n    editor,\n    editorContainer,\n    extension,\n    getPos,\n    imageFromFileSystem,\n    node,\n    selected,\n    setEditorContainer,\n    setFailedToLoadImage,\n    src: resolvedImageSrc,\n    downloadSrc: resolvedDownloadSrc,\n    updateAttributes,\n  } = props;\n  const {\n    width: nodeWidth,\n    height: nodeHeight,\n    aspectRatio: nodeAspectRatio,\n    src: imgNodeSrc,\n    alignment: nodeAlignment,\n    status,\n  } = node.attrs;\n  // states\n  const [size, setSize] = useState<TCustomImageSize>({\n    width: ensurePixelString(nodeWidth, \"35%\") ?? \"35%\",\n    height: ensurePixelString(nodeHeight, \"auto\") ?? \"auto\",\n    aspectRatio: nodeAspectRatio || null,\n  });\n  const [isResizing, setIsResizing] = useState(false);\n  const [initialResizeComplete, setInitialResizeComplete] = useState(false);\n  // refs\n  const containerRef = useRef<HTMLDivElement>(null);\n  const containerRect = useRef<DOMRect | null>(null);\n  const imageRef = useRef<HTMLImageElement>(null);\n  const [hasErroredOnFirstLoad, setHasErroredOnFirstLoad] = useState(false);\n  const [hasTriedRestoringImageOnce, setHasTriedRestoringImageOnce] = useState(false);\n  // extension options\n  const isTouchDevice = !!editor.storage.utility.isTouchDevice;\n\n  const updateAttributesSafely = useCallback(\n    (attributes: Partial<TCustomImageAttributes>, errorMessage: string) => {\n      try {\n        updateAttributes(attributes);\n      } catch (error) {\n        console.error(`${errorMessage}:`, error);\n      }\n    },\n    [updateAttributes]\n  );\n\n  const handleImageLoad = useCallback(() => {\n    const img = imageRef.current;\n    if (!img) return;\n    let closestEditorContainer: HTMLDivElement | null = null;\n\n    if (editorContainer) {\n      closestEditorContainer = editorContainer;\n    } else {\n      closestEditorContainer = img.closest(\".editor-container\");\n      if (!closestEditorContainer) {\n        console.error(\"Editor container not found\");\n        return;\n      }\n    }\n    if (!closestEditorContainer) {\n      console.error(\"Editor container not found\");\n      return;\n    }\n\n    setEditorContainer(closestEditorContainer);\n    const aspectRatioCalculated = img.naturalWidth / img.naturalHeight;\n\n    if (nodeWidth === \"35%\") {\n      const editorWidth = closestEditorContainer.clientWidth;\n      const initialWidth = Math.max(editorWidth * 0.35, MIN_SIZE);\n      const initialHeight = initialWidth / aspectRatioCalculated;\n\n      const initialComputedSize: TCustomImageSize = {\n        width: `${Math.round(initialWidth)}px` satisfies Pixel,\n        height: `${Math.round(initialHeight)}px` satisfies Pixel,\n        aspectRatio: aspectRatioCalculated,\n      };\n      setSize(initialComputedSize);\n      updateAttributesSafely(\n        initialComputedSize,\n        \"Failed to update attributes while initializing an image for the first time:\"\n      );\n    } else {\n      // as the aspect ratio in not stored for old images, we need to update the attrs\n      // or if aspectRatioCalculated from the image's width and height doesn't match stored aspectRatio then also we'll update the attrs\n      if (!nodeAspectRatio || nodeAspectRatio !== aspectRatioCalculated) {\n        setSize((prevSize) => {\n          const newSize = { ...prevSize, aspectRatio: aspectRatioCalculated };\n          updateAttributesSafely(\n            newSize,\n            \"Failed to update attributes while initializing images with width but no aspect ratio:\"\n          );\n          return newSize;\n        });\n      }\n    }\n    setInitialResizeComplete(true);\n  }, [nodeWidth, updateAttributesSafely, editorContainer, nodeAspectRatio, setEditorContainer]);\n\n  // for real time resizing\n  useLayoutEffect(() => {\n    setSize((prevSize) => ({\n      ...prevSize,\n      width: ensurePixelString(nodeWidth) ?? \"35%\",\n      height: ensurePixelString(nodeHeight) ?? \"auto\",\n      aspectRatio: nodeAspectRatio,\n    }));\n  }, [nodeWidth, nodeHeight, nodeAspectRatio]);\n\n  const handleResize = useCallback(\n    (e: MouseEvent | TouchEvent) => {\n      if (!containerRef.current || !containerRect.current || !size.aspectRatio) return;\n\n      const clientX = \"touches\" in e ? e.touches[0].clientX : e.clientX;\n\n      if (nodeAlignment === \"right\") {\n        const newWidth = Math.max(containerRect.current.right - clientX, MIN_SIZE);\n        const newHeight = newWidth / size.aspectRatio;\n        setSize((prevSize) => ({ ...prevSize, width: `${newWidth}px`, height: `${newHeight}px` }));\n      } else {\n        const newWidth = Math.max(clientX - containerRect.current.left, MIN_SIZE);\n        const newHeight = newWidth / size.aspectRatio;\n        setSize((prevSize) => ({ ...prevSize, width: `${newWidth}px`, height: `${newHeight}px` }));\n      }\n    },\n    [nodeAlignment, size.aspectRatio]\n  );\n\n  const handleResizeEnd = useCallback(() => {\n    setIsResizing(false);\n    updateAttributesSafely(size, \"Failed to update attributes at the end of resizing:\");\n  }, [size, updateAttributesSafely]);\n\n  const handleResizeStart = useCallback((e: React.MouseEvent | React.TouchEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsResizing(true);\n\n    if (containerRef.current) {\n      containerRect.current = containerRef.current.getBoundingClientRect();\n    }\n  }, []);\n\n  useEffect(() => {\n    if (isResizing) {\n      window.addEventListener(\"mousemove\", handleResize);\n      window.addEventListener(\"mouseup\", handleResizeEnd);\n      window.addEventListener(\"mouseleave\", handleResizeEnd);\n      window.addEventListener(\"touchmove\", handleResize);\n      window.addEventListener(\"touchend\", handleResizeEnd);\n\n      return () => {\n        window.removeEventListener(\"mousemove\", handleResize);\n        window.removeEventListener(\"mouseup\", handleResizeEnd);\n        window.removeEventListener(\"mouseleave\", handleResizeEnd);\n        window.removeEventListener(\"touchmove\", handleResize);\n        window.removeEventListener(\"touchend\", handleResizeEnd);\n      };\n    }\n  }, [isResizing, handleResize, handleResizeEnd]);\n\n  const handleImageMouseDown = useCallback(\n    (e: React.MouseEvent) => {\n      e.stopPropagation();\n      if (isTouchDevice) {\n        e.preventDefault();\n        editor.commands.blur();\n      }\n      const pos = getPos();\n      if (pos === undefined) return;\n      const nodeSelection = NodeSelection.create(editor.state.doc, pos);\n      editor.view.dispatch(editor.state.tr.setSelection(nodeSelection));\n    },\n    [editor, getPos, isTouchDevice]\n  );\n\n  const isDuplicating = isImageDuplicating(status);\n  // show the image loader if the remote image's src or preview image from filesystem is not set yet (while loading the image post upload) (or)\n  // if the initial resize (from 35% width and \"auto\" height attrs to the actual size in px) is not complete\n  const showImageLoader =\n    (!resolvedImageSrc && !isDuplicating) || !initialResizeComplete || hasErroredOnFirstLoad || isDuplicating; // show the image upload status only when the resolvedImageSrc is not ready\n  const showUploadStatus = !resolvedImageSrc && !isDuplicating;\n  // show the image utils only if the remote image's (post upload) src is set and the initial resize is complete (but not while we're showing the preview imageFromFileSystem)\n  const showImageToolbar = resolvedImageSrc && resolvedDownloadSrc && initialResizeComplete && !isDuplicating;\n  // show the image resizer only if the editor is editable, the remote image's (post upload) src is set and the initial resize is complete (but not while we're showing the preview imageFromFileSystem)\n  const showImageResizer = editor.isEditable && resolvedImageSrc && initialResizeComplete && !isDuplicating;\n  // show the preview image from the file system if the remote image's src is not set\n  const displayedImageSrc = resolvedImageSrc || imageFromFileSystem;\n\n  return (\n    <div\n      id={getImageBlockId(node.attrs.id ?? \"\")}\n      className={cn(\"w-fit max-w-full transition-all\", {\n        \"ml-[50%] -translate-x-1/2\": nodeAlignment === \"center\",\n        \"ml-[100%] -translate-x-full\": nodeAlignment === \"right\",\n      })}\n    >\n      <div\n        ref={containerRef}\n        className=\"group/image-component relative inline-block max-w-full\"\n        onMouseDown={handleImageMouseDown}\n        style={{\n          width: size.width,\n          ...(size.aspectRatio && { aspectRatio: size.aspectRatio }),\n        }}\n      >\n        {showImageLoader && (\n          <div\n            className=\"animate-pulse bg-custom-background-80 rounded-md\"\n            style={{ width: size.width, height: size.height }}\n          />\n        )}\n        <img\n          ref={imageRef}\n          src={displayedImageSrc}\n          onLoad={handleImageLoad}\n          onError={async (e) => {\n            // for old image extension this command doesn't exist or if the image failed to load for the first time\n            if (!extension.options.restoreImage || hasTriedRestoringImageOnce) {\n              setFailedToLoadImage(true);\n              return;\n            }\n\n            try {\n              setHasErroredOnFirstLoad(true);\n              // this is a type error from tiptap, don't remove await until it's fixed\n              if (!imgNodeSrc) {\n                throw new Error(\"No source image to restore from\");\n              }\n              await extension.options.restoreImage?.(imgNodeSrc);\n              if (!imageRef.current) {\n                throw new Error(\"Image reference not found\");\n              }\n              if (!resolvedImageSrc) {\n                throw new Error(\"No resolved image source available\");\n              }\n              if (isTouchDevice) {\n                const refreshedSrc = await extension.options.getImageSource?.(imgNodeSrc);\n                imageRef.current.src = refreshedSrc;\n              } else {\n                imageRef.current.src = resolvedImageSrc;\n              }\n            } catch {\n              // if the image failed to even restore, then show the error state\n              setFailedToLoadImage(true);\n              console.error(\"Error while loading image\", e);\n            } finally {\n              setHasErroredOnFirstLoad(false);\n              setHasTriedRestoringImageOnce(true);\n            }\n          }}\n          width={size.width}\n          className={cn(\"image-component block rounded-md\", {\n            // hide the image while the background calculations of the image loader are in progress (to avoid flickering) and show the loader until then\n            hidden: showImageLoader,\n            \"read-only-image\": !editor.isEditable,\n            \"blur-sm opacity-80 loading-image\": !resolvedImageSrc,\n          })}\n          style={{\n            width: size.width,\n            ...(size.aspectRatio && { aspectRatio: size.aspectRatio }),\n          }}\n        />\n        {showUploadStatus && node.attrs.id && <ImageUploadStatus editor={editor} nodeId={node.attrs.id} />}\n        {showImageToolbar && (\n          <ImageToolbarRoot\n            alignment={nodeAlignment ?? \"left\"}\n            editor={editor}\n            aspectRatio={size.aspectRatio === null ? 1 : size.aspectRatio}\n            downloadSrc={resolvedDownloadSrc}\n            handleAlignmentChange={(alignment) =>\n              updateAttributesSafely({ alignment }, \"Failed to update attributes while changing alignment:\")\n            }\n            height={size.height}\n            isTouchDevice={isTouchDevice}\n            width={size.width}\n            src={resolvedImageSrc}\n          />\n        )}\n        {selected && displayedImageSrc === resolvedImageSrc && (\n          <div className=\"absolute inset-0 size-full bg-custom-primary-500/30 pointer-events-none\" />\n        )}\n        {showImageResizer && (\n          <>\n            <div\n              className={cn(\n                \"absolute inset-0 border-2 border-custom-primary-100 pointer-events-none rounded-md transition-opacity duration-100 ease-in-out\",\n                {\n                  \"opacity-100\": isResizing,\n                  \"opacity-0 group-hover/image-component:opacity-100\": !isResizing,\n                }\n              )}\n            />\n            <div\n              className={cn(\n                \"absolute bottom-0 translate-y-1/2 size-4 rounded-full bg-custom-primary-100 border-2 border-white transition-opacity duration-100 ease-in-out\",\n                {\n                  \"opacity-100 pointer-events-auto\": isResizing,\n                  \"opacity-0 pointer-events-none group-hover/image-component:opacity-100 group-hover/image-component:pointer-events-auto\":\n                    !isResizing,\n                  \"left-0 -translate-x-1/2 cursor-nesw-resize\": nodeAlignment === \"right\",\n                  \"right-0 translate-x-1/2 cursor-nwse-resize\": nodeAlignment !== \"right\",\n                }\n              )}\n              onMouseDown={handleResizeStart}\n              onTouchStart={handleResizeStart}\n            />\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n","export enum EFileError {\n  INVALID_FILE_TYPE = \"INVALID_FILE_TYPE\",\n  FILE_SIZE_TOO_LARGE = \"FILE_SIZE_TOO_LARGE\",\n  NO_FILE_SELECTED = \"NO_FILE_SELECTED\",\n}\n\ntype TArgs = {\n  acceptedMimeTypes: string[];\n  file: File;\n  maxFileSize: number;\n  onError: (error: EFileError, message: string) => void;\n};\n\nexport const isFileValid = (args: TArgs): boolean => {\n  const { acceptedMimeTypes, file, maxFileSize, onError } = args;\n\n  if (!file) {\n    onError(EFileError.NO_FILE_SELECTED, \"No file selected. Please select a file to upload.\");\n    return false;\n  }\n\n  if (!acceptedMimeTypes.includes(file.type)) {\n    onError(EFileError.INVALID_FILE_TYPE, \"Invalid file type.\");\n    return false;\n  }\n\n  if (file.size > maxFileSize) {\n    onError(\n      EFileError.FILE_SIZE_TOO_LARGE,\n      `File size too large. Please select a file smaller than ${maxFileSize / 1024 / 1024}MB.`\n    );\n    return false;\n  }\n\n  return true;\n};\n","import type { Editor } from \"@tiptap/core\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\n// constants\nimport { ACCEPTED_ATTACHMENT_MIME_TYPES, ACCEPTED_IMAGE_MIME_TYPES } from \"@/constants/config\";\n// types\nimport type { TEditorCommands, TExtensions } from \"@/types\";\n\ntype Props = {\n  disabledExtensions?: TExtensions[];\n  flaggedExtensions?: TExtensions[];\n  editor: Editor;\n};\n\nexport const DropHandlerPlugin = (props: Props): Plugin => {\n  const { disabledExtensions, flaggedExtensions, editor } = props;\n\n  return new Plugin({\n    key: new PluginKey(\"drop-handler-plugin\"),\n    props: {\n      handlePaste: (view, event) => {\n        if (\n          editor.isEditable &&\n          event.clipboardData &&\n          event.clipboardData.files &&\n          event.clipboardData.files.length > 0\n        ) {\n          event.preventDefault();\n          const files = Array.from(event.clipboardData.files);\n          const acceptedFiles = files.filter(\n            (f) => ACCEPTED_IMAGE_MIME_TYPES.includes(f.type) || ACCEPTED_ATTACHMENT_MIME_TYPES.includes(f.type)\n          );\n\n          if (acceptedFiles.length) {\n            const pos = view.state.selection.from;\n            insertFilesSafely({\n              disabledExtensions,\n              flaggedExtensions,\n              editor,\n              files: acceptedFiles,\n              initialPos: pos,\n              event: \"drop\",\n            });\n          }\n          return true;\n        }\n        return false;\n      },\n      handleDrop: (view, event, _slice, moved) => {\n        if (\n          editor.isEditable &&\n          !moved &&\n          event.dataTransfer &&\n          event.dataTransfer.files &&\n          event.dataTransfer.files.length > 0\n        ) {\n          event.preventDefault();\n          const files = Array.from(event.dataTransfer.files);\n          const acceptedFiles = files.filter(\n            (f) => ACCEPTED_IMAGE_MIME_TYPES.includes(f.type) || ACCEPTED_ATTACHMENT_MIME_TYPES.includes(f.type)\n          );\n\n          if (acceptedFiles.length) {\n            const coordinates = view.posAtCoords({\n              left: event.clientX,\n              top: event.clientY,\n            });\n\n            if (coordinates) {\n              const pos = coordinates.pos;\n              insertFilesSafely({\n                disabledExtensions,\n                editor,\n                files: acceptedFiles,\n                initialPos: pos,\n                event: \"drop\",\n              });\n            }\n            return true;\n          }\n        }\n        return false;\n      },\n    },\n  });\n};\n\ntype InsertFilesSafelyArgs = {\n  disabledExtensions?: TExtensions[];\n  flaggedExtensions?: TExtensions[];\n  editor: Editor;\n  event: \"insert\" | \"drop\";\n  files: File[];\n  initialPos: number;\n  type?: Extract<TEditorCommands, \"attachment\" | \"image\">;\n};\n\nexport const insertFilesSafely = async (args: InsertFilesSafelyArgs) => {\n  const { disabledExtensions, editor, event, files, initialPos, type } = args;\n  let pos = initialPos;\n\n  for (const file of files) {\n    // safe insertion\n    const docSize = editor.state.doc.content.size;\n    pos = Math.min(pos, docSize);\n\n    let fileType: \"image\" | \"attachment\" | null = null;\n\n    try {\n      if (type) {\n        if ([\"image\", \"attachment\"].includes(type)) fileType = type;\n        else throw new Error(\"Wrong file type passed\");\n      } else {\n        if (ACCEPTED_IMAGE_MIME_TYPES.includes(file.type)) fileType = \"image\";\n        else if (ACCEPTED_ATTACHMENT_MIME_TYPES.includes(file.type)) fileType = \"attachment\";\n      }\n      // insert file depending on the type at the current position\n      if (fileType === \"image\" && !disabledExtensions?.includes(\"image\")) {\n        editor.commands.insertImageComponent({\n          file,\n          pos,\n          event,\n        });\n      } else if (fileType === \"attachment\") {\n      }\n    } catch (error) {\n      console.error(`Error while ${event}ing file:`, error);\n    }\n\n    // Move to the next position\n    pos += 1;\n  }\n};\n","import type { Editor, NodeViewProps } from \"@tiptap/core\";\nimport type { DragEvent } from \"react\";\nimport { useCallback, useEffect, useState } from \"react\";\n// helpers\nimport type { EFileError } from \"@/helpers/file\";\nimport { isFileValid } from \"@/helpers/file\";\n// plugins\nimport { insertFilesSafely } from \"@/plugins/drop\";\n// types\nimport type { TEditorCommands } from \"@/types\";\n\ntype TUploaderArgs = {\n  acceptedMimeTypes: string[];\n  editorCommand: (file: File) => Promise<string | undefined>;\n  handleProgressStatus?: (isUploading: boolean) => void;\n  loadFileFromFileSystem?: (file: string) => void;\n  maxFileSize: number;\n  onInvalidFile: (error: EFileError, file: File, message: string) => void;\n  onUpload: (url: string, file: File) => void;\n};\n\nexport const useUploader = (args: TUploaderArgs) => {\n  const {\n    acceptedMimeTypes,\n    editorCommand,\n    handleProgressStatus,\n    loadFileFromFileSystem,\n    maxFileSize,\n    onInvalidFile,\n    onUpload,\n  } = args;\n  // states\n  const [isUploading, setIsUploading] = useState(false);\n\n  const uploadFile = useCallback(\n    async (file: File) => {\n      handleProgressStatus?.(true);\n      setIsUploading(true);\n      const isValid = isFileValid({\n        acceptedMimeTypes,\n        file,\n        maxFileSize,\n        onError: (error, message) => onInvalidFile(error, file, message),\n      });\n      if (!isValid) {\n        handleProgressStatus?.(false);\n        setIsUploading(false);\n        return;\n      }\n      try {\n        if (loadFileFromFileSystem) {\n          const reader = new FileReader();\n          reader.onload = () => {\n            if (reader.result) {\n              loadFileFromFileSystem(reader.result as string);\n            } else {\n              console.error(\"Failed to read the file: reader.result is null\");\n            }\n          };\n          reader.onerror = () => {\n            console.error(\"Error reading file\");\n          };\n          reader.readAsDataURL(file);\n        }\n        const url = await editorCommand(file);\n\n        if (!url) {\n          throw new Error(\"Something went wrong while uploading the file.\");\n        }\n        onUpload(url, file);\n      } catch {\n        console.error(\"useFileUpload: Error in uploading file\");\n      } finally {\n        handleProgressStatus?.(false);\n        setIsUploading(false);\n      }\n    },\n    [\n      acceptedMimeTypes,\n      editorCommand,\n      handleProgressStatus,\n      loadFileFromFileSystem,\n      maxFileSize,\n      onInvalidFile,\n      onUpload,\n    ]\n  );\n\n  return { isUploading, uploadFile };\n};\n\ntype TDropzoneArgs = {\n  editor: Editor;\n  getPos: NodeViewProps[\"getPos\"];\n  type: Extract<TEditorCommands, \"attachment\" | \"image\">;\n  uploader: (file: File) => Promise<void>;\n};\n\nexport const useDropZone = (args: TDropzoneArgs) => {\n  const { editor, getPos, type, uploader } = args;\n  // states\n  const [isDragging, setIsDragging] = useState<boolean>(false);\n  const [draggedInside, setDraggedInside] = useState<boolean>(false);\n\n  useEffect(() => {\n    const dragStartHandler = () => {\n      setIsDragging(true);\n    };\n\n    const dragEndHandler = () => {\n      setIsDragging(false);\n    };\n\n    document.body.addEventListener(\"dragstart\", dragStartHandler);\n    document.body.addEventListener(\"dragend\", dragEndHandler);\n\n    return () => {\n      document.body.removeEventListener(\"dragstart\", dragStartHandler);\n      document.body.removeEventListener(\"dragend\", dragEndHandler);\n    };\n  }, []);\n\n  const onDrop = useCallback(\n    async (e: DragEvent<HTMLDivElement>) => {\n      e.preventDefault();\n      setDraggedInside(false);\n      const filesList = e.dataTransfer.files;\n      const pos = getPos();\n\n      if (filesList.length === 0 || !editor.isEditable || pos === undefined) {\n        return;\n      }\n\n      await uploadFirstFileAndInsertRemaining({\n        editor,\n        filesList,\n        pos,\n        type,\n        uploader,\n      });\n    },\n    [editor, type, uploader, getPos]\n  );\n  const onDragEnter = useCallback(() => setDraggedInside(true), []);\n  const onDragLeave = useCallback(() => setDraggedInside(false), []);\n\n  return {\n    isDragging,\n    draggedInside,\n    onDragEnter,\n    onDragLeave,\n    onDrop,\n  };\n};\n\ntype TMultipleFileArgs = {\n  editor: Editor;\n  filesList: FileList;\n  pos: number;\n  type: Extract<TEditorCommands, \"attachment\" | \"image\">;\n  uploader: (file: File) => Promise<void>;\n};\n\n// Upload the first file and insert the remaining ones for uploading multiple files\nexport const uploadFirstFileAndInsertRemaining = async (args: TMultipleFileArgs) => {\n  const { editor, filesList, pos, type, uploader } = args;\n  const filesArray = Array.from(filesList);\n  if (filesArray.length === 0) {\n    console.error(\"No files found to upload.\");\n    return;\n  }\n\n  // Upload the first file\n  const firstFile = filesArray[0];\n  uploader(firstFile);\n  // Insert the remaining files\n  const remainingFiles = filesArray.slice(1);\n  if (remainingFiles.length > 0) {\n    const docSize = editor.state.doc.content.size;\n    const posOfNextFileToBeInserted = Math.min(pos + 1, docSize);\n    insertFilesSafely({\n      editor,\n      files: remainingFiles,\n      initialPos: posOfNextFileToBeInserted,\n      event: \"drop\",\n      type,\n    });\n  }\n};\n","import { ImageIcon, RotateCcw } from \"lucide-react\";\nimport type { ChangeEvent } from \"react\";\nimport { useCallback, useEffect, useMemo, useRef } from \"react\";\n// plane imports\nimport { cn } from \"@plane/utils\";\n// constants\nimport { ACCEPTED_IMAGE_MIME_TYPES } from \"@/constants/config\";\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// helpers\nimport type { EFileError } from \"@/helpers/file\";\n// hooks\nimport { useUploader, useDropZone, uploadFirstFileAndInsertRemaining } from \"@/hooks/use-file-upload\";\n// local imports\nimport { ECustomImageStatus } from \"../types\";\nimport { getImageComponentImageFileMap } from \"../utils\";\nimport type { CustomImageNodeViewProps } from \"./node-view\";\n\ntype CustomImageUploaderProps = CustomImageNodeViewProps & {\n  failedToLoadImage: boolean;\n  hasDuplicationFailed: boolean;\n  loadImageFromFileSystem: (file: string) => void;\n  maxFileSize: number;\n  setIsUploaded: (isUploaded: boolean) => void;\n};\n\nexport function CustomImageUploader(props: CustomImageUploaderProps) {\n  const {\n    editor,\n    extension,\n    failedToLoadImage,\n    getPos,\n    loadImageFromFileSystem,\n    maxFileSize,\n    node,\n    selected,\n    setIsUploaded,\n    updateAttributes,\n    hasDuplicationFailed,\n  } = props;\n  // refs\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const hasTriggeredFilePickerRef = useRef(false);\n  const hasTriedUploadingOnMountRef = useRef(false);\n  const { id: imageEntityId } = node.attrs;\n  // derived values\n  const imageComponentImageFileMap = useMemo(() => getImageComponentImageFileMap(editor), [editor]);\n  const isTouchDevice = !!editor.storage.utility.isTouchDevice;\n\n  const onUpload = useCallback(\n    (url: string) => {\n      if (url) {\n        if (!imageEntityId) return;\n        setIsUploaded(true);\n        // Update the node view's src attribute post upload\n        updateAttributes({\n          src: url,\n          status: ECustomImageStatus.UPLOADED,\n        });\n        imageComponentImageFileMap?.delete(imageEntityId);\n\n        const pos = getPos();\n        // get current node\n        const getCurrentSelection = editor.state.selection;\n        const currentNode = editor.state.doc.nodeAt(getCurrentSelection.from);\n\n        // only if the cursor is at the current image component, manipulate\n        // the cursor position\n        if (\n          currentNode &&\n          currentNode.type.name === node.type.name &&\n          currentNode.attrs.src === url &&\n          pos !== undefined\n        ) {\n          // control cursor position after upload\n          const nextNode = editor.state.doc.nodeAt(pos + 1);\n\n          if (nextNode && nextNode.type.name === CORE_EXTENSIONS.PARAGRAPH) {\n            // If there is a paragraph node after the image component, move the focus to the next node\n            editor.commands.setTextSelection(pos + 1);\n          } else {\n            // create a new paragraph after the image component post upload\n            editor.commands.createParagraphNear();\n          }\n        }\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [imageComponentImageFileMap, imageEntityId, updateAttributes, getPos]\n  );\n\n  const uploadImageEditorCommand = useCallback(\n    async (file: File) => {\n      updateAttributes({ status: ECustomImageStatus.UPLOADING });\n      return await extension.options.uploadImage?.(imageEntityId ?? \"\", file);\n    },\n    [extension.options, imageEntityId, updateAttributes]\n  );\n\n  const handleProgressStatus = useCallback(\n    (isUploading: boolean) => {\n      editor.storage.utility.uploadInProgress = isUploading;\n    },\n    [editor]\n  );\n\n  const handleInvalidFile = useCallback((_error: EFileError, _file: File, message: string) => {\n    alert(message);\n  }, []);\n\n  // hooks\n  const { isUploading: isImageBeingUploaded, uploadFile } = useUploader({\n    acceptedMimeTypes: ACCEPTED_IMAGE_MIME_TYPES,\n    editorCommand: uploadImageEditorCommand,\n    handleProgressStatus,\n    loadFileFromFileSystem: loadImageFromFileSystem,\n    maxFileSize,\n    onInvalidFile: handleInvalidFile,\n    onUpload,\n  });\n\n  const { draggedInside, onDrop, onDragEnter, onDragLeave } = useDropZone({\n    editor,\n    getPos,\n    type: \"image\",\n    uploader: uploadFile,\n  });\n\n  // after the image component is mounted we start the upload process based on\n  // it's uploaded\n  useEffect(() => {\n    if (hasTriedUploadingOnMountRef.current) return;\n\n    // the meta data of the image component\n    const meta = imageComponentImageFileMap?.get(imageEntityId ?? \"\");\n    if (meta) {\n      if (meta.event === \"drop\" && \"file\" in meta) {\n        hasTriedUploadingOnMountRef.current = true;\n        uploadFile(meta.file);\n      } else if (meta.event === \"insert\" && fileInputRef.current && !hasTriggeredFilePickerRef.current) {\n        if (meta.hasOpenedFileInputOnce) return;\n        if (!isTouchDevice) {\n          fileInputRef.current.click();\n        }\n        hasTriggeredFilePickerRef.current = true;\n        imageComponentImageFileMap?.set(imageEntityId ?? \"\", { ...meta, hasOpenedFileInputOnce: true });\n      }\n    } else {\n      hasTriedUploadingOnMountRef.current = true;\n    }\n  }, [imageEntityId, isTouchDevice, uploadFile, imageComponentImageFileMap]);\n\n  const onFileChange = useCallback(\n    async (e: ChangeEvent<HTMLInputElement>) => {\n      e.preventDefault();\n      const filesList = e.target.files;\n      const pos = getPos();\n      if (!filesList || pos === undefined) {\n        return;\n      }\n      await uploadFirstFileAndInsertRemaining({\n        editor,\n        filesList,\n        pos,\n        type: \"image\",\n        uploader: uploadFile,\n      });\n    },\n    [uploadFile, editor, getPos]\n  );\n\n  const getDisplayMessage = useCallback(() => {\n    const isUploading = isImageBeingUploaded;\n    if (failedToLoadImage || hasDuplicationFailed) {\n      return \"Error loading image\";\n    }\n\n    if (isUploading) {\n      return \"Uploading...\";\n    }\n\n    if (draggedInside && editor.isEditable) {\n      return \"Drop image here\";\n    }\n\n    return \"Add an image\";\n  }, [draggedInside, editor.isEditable, failedToLoadImage, isImageBeingUploaded, hasDuplicationFailed]);\n\n  const handleRetryClick = useCallback(\n    (e: React.MouseEvent) => {\n      e.stopPropagation();\n      if (hasDuplicationFailed && editor.isEditable) {\n        updateAttributes({ status: ECustomImageStatus.DUPLICATING });\n      }\n    },\n    [hasDuplicationFailed, editor.isEditable, updateAttributes]\n  );\n\n  return (\n    <div\n      className={cn(\n        \"image-upload-component flex items-center justify-start gap-2 py-3 px-2 rounded-lg text-custom-text-300 bg-custom-background-90 border border-dashed border-custom-border-300 transition-all duration-200 ease-in-out cursor-default\",\n        {\n          \"hover:text-custom-text-200 hover:bg-custom-background-80 cursor-pointer\": editor.isEditable,\n          \"bg-custom-background-80 text-custom-text-200\": draggedInside && editor.isEditable,\n          \"text-custom-primary-200 bg-custom-primary-100/10 border-custom-primary-200/10 hover:bg-custom-primary-100/10 hover:text-custom-primary-200\":\n            selected && editor.isEditable,\n          \"text-red-500 cursor-default\": failedToLoadImage || hasDuplicationFailed,\n          \"hover:text-red-500\": (failedToLoadImage || hasDuplicationFailed) && editor.isEditable,\n          \"bg-red-500/10\": (failedToLoadImage || hasDuplicationFailed) && selected,\n          \"hover:bg-red-500/10\": (failedToLoadImage || hasDuplicationFailed) && selected && editor.isEditable,\n        }\n      )}\n      onDrop={onDrop}\n      onDragOver={onDragEnter}\n      onDragLeave={onDragLeave}\n      contentEditable={false}\n      onClick={() => {\n        if (!failedToLoadImage && editor.isEditable && !hasDuplicationFailed) {\n          fileInputRef.current?.click();\n        }\n      }}\n    >\n      <ImageIcon className=\"size-4\" />\n      <div className=\"text-base font-medium flex-1\">{getDisplayMessage()}</div>\n      {hasDuplicationFailed && editor.isEditable && (\n        <button\n          type=\"button\"\n          onClick={handleRetryClick}\n          className={cn(\n            \"flex items-center gap-1 px-2 py-1 text-xs font-medium text-custom-text-300 hover:bg-custom-background-90 hover:text-custom-text-200 rounded-md transition-all duration-200 ease-in-out\",\n            {\n              \"hover:bg-red-500/20\": selected,\n            }\n          )}\n          title=\"Retry duplication\"\n        >\n          <RotateCcw className=\"size-3\" />\n          Retry\n        </button>\n      )}\n      <input\n        className=\"size-0 overflow-hidden\"\n        ref={fileInputRef}\n        hidden\n        type=\"file\"\n        accept={ACCEPTED_IMAGE_MIME_TYPES.join(\",\")}\n        onChange={onFileChange}\n        multiple\n      />\n    </div>\n  );\n}\n","import { NodeViewWrapper } from \"@tiptap/react\";\nimport type { NodeViewProps } from \"@tiptap/react\";\nimport { useEffect, useRef, useState } from \"react\";\n// local imports\nimport type { CustomImageExtensionType, TCustomImageAttributes } from \"../types\";\nimport { ECustomImageStatus } from \"../types\";\nimport { hasImageDuplicationFailed } from \"../utils\";\nimport { CustomImageBlock } from \"./block\";\nimport { CustomImageUploader } from \"./uploader\";\n\nexport type CustomImageNodeViewProps = Omit<NodeViewProps, \"extension\" | \"updateAttributes\"> & {\n  extension: CustomImageExtensionType;\n  node: NodeViewProps[\"node\"] & {\n    attrs: TCustomImageAttributes;\n  };\n  updateAttributes: (attrs: Partial<TCustomImageAttributes>) => void;\n};\n\nexport function CustomImageNodeView(props: CustomImageNodeViewProps) {\n  const { editor, extension, node, updateAttributes } = props;\n  const { src: imgNodeSrc, status } = node.attrs;\n\n  const [isUploaded, setIsUploaded] = useState(!!imgNodeSrc);\n  const [resolvedSrc, setResolvedSrc] = useState<string | undefined>(undefined);\n  const [resolvedDownloadSrc, setResolvedDownloadSrc] = useState<string | undefined>(undefined);\n  const [imageFromFileSystem, setImageFromFileSystem] = useState<string | undefined>(undefined);\n  const [failedToLoadImage, setFailedToLoadImage] = useState(false);\n\n  const [editorContainer, setEditorContainer] = useState<HTMLDivElement | null>(null);\n  const imageComponentRef = useRef<HTMLDivElement>(null);\n  const hasRetriedOnMount = useRef(false);\n  const isDuplicatingRef = useRef(false);\n\n  useEffect(() => {\n    const closestEditorContainer = imageComponentRef.current?.closest(\".editor-container\");\n    if (closestEditorContainer) {\n      setEditorContainer(closestEditorContainer as HTMLDivElement);\n    }\n  }, []);\n\n  // the image is already uploaded if the image-component node has src attribute\n  // and we need to remove the blob from our file system\n  useEffect(() => {\n    if (resolvedSrc || imgNodeSrc) {\n      setIsUploaded(true);\n      setImageFromFileSystem(undefined);\n    } else {\n      setIsUploaded(false);\n    }\n  }, [resolvedSrc, imgNodeSrc]);\n\n  useEffect(() => {\n    if (!imgNodeSrc) {\n      setResolvedSrc(undefined);\n      setResolvedDownloadSrc(undefined);\n      return;\n    }\n\n    setResolvedSrc(undefined);\n    setResolvedDownloadSrc(undefined);\n    setFailedToLoadImage(false);\n\n    const getImageSource = async () => {\n      try {\n        const url = await extension.options.getImageSource?.(imgNodeSrc);\n        setResolvedSrc(url);\n        const downloadUrl = await extension.options.getImageDownloadSource?.(imgNodeSrc);\n        setResolvedDownloadSrc(downloadUrl);\n      } catch (error) {\n        console.error(\"Error fetching image source:\", error);\n        setFailedToLoadImage(true);\n      }\n    };\n    getImageSource();\n  }, [imgNodeSrc, extension.options]);\n\n  useEffect(() => {\n    const handleDuplication = async () => {\n      if (status !== ECustomImageStatus.DUPLICATING || !extension.options.duplicateImage || !imgNodeSrc) {\n        return;\n      }\n\n      // Prevent duplicate calls - check if already duplicating this asset\n      if (isDuplicatingRef.current) {\n        return;\n      }\n\n      isDuplicatingRef.current = true;\n      try {\n        hasRetriedOnMount.current = true;\n\n        const newAssetId = await extension.options.duplicateImage(imgNodeSrc);\n\n        if (!newAssetId) {\n          throw new Error(\"Duplication returned invalid asset ID\");\n        }\n\n        setFailedToLoadImage(false);\n        updateAttributes({ src: newAssetId, status: ECustomImageStatus.UPLOADED });\n      } catch (error: unknown) {\n        console.error(\"Failed to duplicate image:\", error);\n        // Update status to failed\n        updateAttributes({ status: ECustomImageStatus.DUPLICATION_FAILED });\n      } finally {\n        isDuplicatingRef.current = false;\n      }\n    };\n\n    handleDuplication();\n  }, [status, imgNodeSrc, extension.options.duplicateImage, updateAttributes]);\n\n  useEffect(() => {\n    if (hasImageDuplicationFailed(status) && !hasRetriedOnMount.current && imgNodeSrc) {\n      hasRetriedOnMount.current = true;\n      // Add a small delay before retrying to avoid immediate retries\n      updateAttributes({ status: ECustomImageStatus.DUPLICATING });\n    }\n  }, [status, imgNodeSrc, updateAttributes]);\n\n  useEffect(() => {\n    if (status === ECustomImageStatus.UPLOADED) {\n      hasRetriedOnMount.current = false;\n      setFailedToLoadImage(false);\n    }\n  }, [status]);\n\n  const hasDuplicationFailed = hasImageDuplicationFailed(status);\n  const hasValidImageSource = imageFromFileSystem || (isUploaded && resolvedSrc);\n  const shouldShowBlock = hasValidImageSource && !failedToLoadImage && !hasDuplicationFailed;\n\n  return (\n    <NodeViewWrapper>\n      <div className=\"p-0 mx-0 my-2\" data-drag-handle ref={imageComponentRef}>\n        {shouldShowBlock && !hasDuplicationFailed ? (\n          <CustomImageBlock\n            editorContainer={editorContainer}\n            imageFromFileSystem={imageFromFileSystem}\n            setEditorContainer={setEditorContainer}\n            setFailedToLoadImage={setFailedToLoadImage}\n            src={resolvedSrc}\n            downloadSrc={resolvedDownloadSrc}\n            {...props}\n          />\n        ) : (\n          <CustomImageUploader\n            failedToLoadImage={failedToLoadImage}\n            hasDuplicationFailed={hasDuplicationFailed}\n            loadImageFromFileSystem={setImageFromFileSystem}\n            maxFileSize={editor.storage.imageComponent?.maxFileSize}\n            setIsUploaded={setIsUploaded}\n            {...props}\n          />\n        )}\n      </div>\n    </NodeViewWrapper>\n  );\n}\n","import { Image as BaseImageExtension } from \"@tiptap/extension-image\";\n// local imports\nimport type { CustomImageExtensionOptions } from \"../custom-image/types\";\nimport type { ImageExtensionStorage } from \"./extension\";\n\nexport const ImageExtensionConfig = BaseImageExtension.extend<\n  Pick<CustomImageExtensionOptions, \"getImageSource\">,\n  ImageExtensionStorage\n>({\n  addAttributes() {\n    return {\n      ...this.parent?.(),\n      width: {\n        default: \"35%\",\n      },\n      height: {\n        default: null,\n      },\n      aspectRatio: {\n        default: null,\n      },\n      alignment: {\n        default: \"left\",\n      },\n    };\n  },\n});\n","import { ReactNodeViewRenderer } from \"@tiptap/react\";\n// constants\nimport type { CORE_EXTENSIONS } from \"@/constants/extension\";\n// helpers\nimport { insertEmptyParagraphAtNodeBoundaries } from \"@/helpers/insert-empty-paragraph-at-node-boundary\";\n// types\nimport type { TFileHandler } from \"@/types\";\n// local imports\nimport type { CustomImageNodeViewProps } from \"../custom-image/components/node-view\";\nimport { CustomImageNodeView } from \"../custom-image/components/node-view\";\nimport { ImageExtensionConfig } from \"./extension-config\";\n\ndeclare module \"@tiptap/core\" {\n  interface Storage {\n    [CORE_EXTENSIONS.IMAGE]: ImageExtensionStorage;\n  }\n}\n\nexport type ImageExtensionStorage = {\n  deletedImageSet: Map<string, boolean>;\n};\n\ntype Props = {\n  fileHandler: TFileHandler;\n};\n\nexport function ImageExtension(props: Props) {\n  const { fileHandler } = props;\n  // derived values\n  const { getAssetSrc } = fileHandler;\n\n  return ImageExtensionConfig.extend({\n    addOptions() {\n      return {\n        ...this.parent?.(),\n        getImageSource: getAssetSrc,\n      };\n    },\n\n    addKeyboardShortcuts() {\n      return {\n        ArrowDown: insertEmptyParagraphAtNodeBoundaries(\"down\", this.name),\n        ArrowUp: insertEmptyParagraphAtNodeBoundaries(\"up\", this.name),\n      };\n    },\n\n    // storage to keep track of image states Map<src, isDeleted>\n    addStorage() {\n      const maxFileSize = \"validation\" in fileHandler ? fileHandler.validation?.maxFileSize : 0;\n\n      return {\n        deletedImageSet: new Map<string, boolean>(),\n        maxFileSize,\n      };\n    },\n\n    // render custom image node\n    addNodeView() {\n      return ReactNodeViewRenderer((props) => (\n        <CustomImageNodeView {...props} node={props.node as CustomImageNodeViewProps[\"node\"]} />\n      ));\n    },\n  });\n}\n","// plane types\nimport type { TSearchEntities } from \"@plane/types\";\n\nexport enum EMentionComponentAttributeNames {\n  ID = \"id\",\n  ENTITY_IDENTIFIER = \"entity_identifier\",\n  ENTITY_NAME = \"entity_name\",\n}\n\nexport type TMentionComponentAttributes = {\n  [EMentionComponentAttributeNames.ID]: string | null;\n  [EMentionComponentAttributeNames.ENTITY_IDENTIFIER]: string | null;\n  [EMentionComponentAttributeNames.ENTITY_NAME]: TSearchEntities | null;\n};\n","import { mergeAttributes } from \"@tiptap/core\";\nimport type { MentionOptions } from \"@tiptap/extension-mention\";\nimport Mention from \"@tiptap/extension-mention\";\nimport type { MarkdownSerializerState } from \"@tiptap/pm/markdown\";\nimport type { Node as NodeType } from \"@tiptap/pm/model\";\n// types\nimport type { TMentionHandler } from \"@/types\";\n// local types\nimport type { TMentionComponentAttributes } from \"./types\";\nimport { EMentionComponentAttributeNames } from \"./types\";\n\nexport type TMentionExtensionOptions = MentionOptions & {\n  renderComponent: TMentionHandler[\"renderComponent\"];\n  getMentionedEntityDetails: TMentionHandler[\"getMentionedEntityDetails\"];\n};\n\nexport const CustomMentionExtensionConfig = Mention.extend<TMentionExtensionOptions>({\n  addAttributes() {\n    return {\n      [EMentionComponentAttributeNames.ID]: {\n        default: null,\n      },\n      [EMentionComponentAttributeNames.ENTITY_IDENTIFIER]: {\n        default: null,\n      },\n      [EMentionComponentAttributeNames.ENTITY_NAME]: {\n        default: null,\n      },\n    };\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: \"mention-component\",\n      },\n    ];\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\"mention-component\", mergeAttributes(HTMLAttributes)];\n  },\n\n  renderText({ node }) {\n    return getMentionDisplayText(this.options, node);\n  },\n\n  addStorage() {\n    const options = this.options;\n    return {\n      markdown: {\n        serialize(state: MarkdownSerializerState, node: NodeType) {\n          state.write(getMentionDisplayText(options, node));\n        },\n      },\n    };\n  },\n});\n\nfunction getMentionDisplayText(options: TMentionExtensionOptions, node: NodeType): string {\n  const attrs = node.attrs as TMentionComponentAttributes;\n  const mentionEntityId = attrs[EMentionComponentAttributeNames.ENTITY_IDENTIFIER];\n  const mentionEntityDetails = options.getMentionedEntityDetails?.(mentionEntityId ?? \"\");\n  return `@${mentionEntityDetails?.display_name ?? attrs[EMentionComponentAttributeNames.ID] ?? mentionEntityId}`;\n}\n","import { computePosition, flip, shift, autoUpdate } from \"@floating-ui/dom\";\nimport type { Placement, ReferenceElement, Strategy } from \"@floating-ui/dom\";\nimport { posToDOMRect } from \"@tiptap/core\";\nimport type { Editor } from \"@tiptap/core\";\n\nexport type UpdateFloatingUIFloaterPosition = (\n  editor: Editor,\n  element: HTMLElement,\n  options?: {\n    elementStyle?: Partial<CSSStyleDeclaration>;\n    placement?: Placement;\n    strategy?: Strategy;\n  }\n) => {\n  cleanup: () => void;\n};\n\nexport const updateFloatingUIFloaterPosition: UpdateFloatingUIFloaterPosition = (editor, element, options) => {\n  document.body.appendChild(element);\n\n  const virtualElement: ReferenceElement = {\n    getBoundingClientRect: () => posToDOMRect(editor.view, editor.state.selection.from, editor.state.selection.to),\n  };\n\n  const cleanup = autoUpdate(virtualElement, element, () => {\n    computePosition(virtualElement, element, {\n      placement: options?.placement ?? \"bottom-start\",\n      strategy: options?.strategy ?? \"fixed\",\n      middleware: [shift(), flip()],\n    })\n      .then(({ x, y, strategy }) => {\n        Object.assign(element.style, {\n          width: \"max-content\",\n          position: strategy,\n          left: `${x}px`,\n          top: `${y}px`,\n          ...options?.elementStyle,\n        });\n      })\n      .catch((error) => console.error(\"An error occurred while updating floating UI floater position:\", error));\n  });\n\n  return {\n    cleanup,\n  };\n};\n","export type CommandListInstance = {\n  onKeyDown: (props: { event: KeyboardEvent }) => boolean;\n};\n\ntype TArgs = {\n  event: KeyboardEvent;\n  sections: {\n    items: any[];\n  }[];\n  selectedIndex: {\n    section: number;\n    item: number;\n  };\n};\n\nexport const DROPDOWN_NAVIGATION_KEYS = [\"ArrowUp\", \"ArrowDown\", \"Enter\"];\n\nexport const getNextValidIndex = (\n  args: TArgs\n):\n  | {\n      section: number;\n      item: number;\n    }\n  | undefined => {\n  const { event, sections, selectedIndex } = args;\n  const direction = event.key === \"ArrowUp\" ? \"up\" : \"down\";\n  if (!sections.length) return { section: 0, item: 0 };\n  // next available selection\n  let nextSection = selectedIndex.section;\n  let nextItem = selectedIndex.item;\n\n  if (direction === \"up\") {\n    nextItem--;\n    if (nextItem < 0) {\n      // Move to previous section\n      nextSection--;\n      if (nextSection < 0) {\n        // Wrap to last section\n        nextSection = sections?.length - 1;\n      }\n      nextItem = sections?.[nextSection]?.items?.length - 1;\n    }\n  } else {\n    nextItem++;\n    if (nextItem >= sections?.[nextSection]?.items?.length) {\n      // Move to next section\n      nextSection++;\n      if (nextSection >= sections?.length) {\n        // Wrap to first section\n        nextSection = 0;\n      }\n      nextItem = 0;\n    }\n  }\n\n  return { section: nextSection, item: nextItem };\n};\n","import { findParentNode } from \"@tiptap/core\";\nimport type { Editor } from \"@tiptap/core\";\nimport type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\nimport type { EditorState, Selection, Transaction } from \"@tiptap/pm/state\";\nimport { CellSelection, TableMap } from \"@tiptap/pm/tables\";\nimport type { Rect } from \"@tiptap/pm/tables\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n\n/**\n * @description Check if the selection is a cell selection\n * @param {Selection} selection - The selection to check\n * @returns {boolean} True if the selection is a cell selection, false otherwise\n */\nexport const isCellSelection = (selection: Selection): selection is CellSelection => selection instanceof CellSelection;\n\n/**\n * @description Check if a cell is empty\n * @param {ProseMirrorNode | null} cell - The cell to check\n * @returns {boolean} True if the cell is empty, false otherwise\n */\nexport const isCellEmpty = (cell: ProseMirrorNode | null): boolean => {\n  if (!cell || cell.content.size === 0) {\n    return true;\n  }\n\n  // Check if cell has any non-empty content\n  let hasContent = false;\n  cell.content.forEach((node) => {\n    if (node.type.name === CORE_EXTENSIONS.PARAGRAPH) {\n      if (node.content.size > 0) {\n        hasContent = true;\n      }\n    } else if (node.content.size > 0 || node.isText) {\n      hasContent = true;\n    }\n  });\n\n  return !hasContent;\n};\n\nexport type TableNodeLocation = {\n  pos: number;\n  start: number;\n  node: ProseMirrorNode;\n};\n\n/**\n * @description Find the table node location from the selection.\n * @param {Selection} selection - The selection.\n * @returns {TableNodeLocation | undefined} The table node location.\n */\nexport const findTable = (selection: Selection): TableNodeLocation | undefined =>\n  findParentNode((node) => node.type.spec.tableRole === \"table\")(selection);\n\n/**\n * @description Check if the selection has table related changes.\n * @param {Editor} editor - The editor instance.\n * @param {TableNodeLocation | undefined} table - The table node location.\n * @param {EditorState} oldState - The old editor state.\n * @param {EditorState} newState - The new editor state.\n * @param {Transaction} tr - The transaction.\n * @returns {boolean} True if the selection has table related changes, false otherwise.\n */\nexport const haveTableRelatedChanges = (\n  editor: Editor,\n  table: TableNodeLocation | undefined,\n  oldState: EditorState,\n  newState: EditorState,\n  tr: Transaction\n): table is TableNodeLocation =>\n  editor.isEditable && table !== undefined && (tr.docChanged || !newState.selection.eq(oldState.selection));\n\n/**\n * @description Get the selected rect from the cell selection.\n * @param {CellSelection} selection - The cell selection.\n * @param {TableMap} map - The table map.\n * @returns {Rect} The selected rect.\n */\nexport const getSelectedRect = (selection: CellSelection, map: TableMap): Rect => {\n  const start = selection.$anchorCell.start(-1);\n  return map.rectBetween(selection.$anchorCell.pos - start, selection.$headCell.pos - start);\n};\n\n/**\n * @description Get the selected columns from the cell selection.\n * @param {Selection} selection - The selection.\n * @param {TableMap} map - The table map.\n * @returns {number[]} The selected columns.\n */\nexport const getSelectedColumns = (selection: Selection, map: TableMap): number[] => {\n  if (isCellSelection(selection) && selection.isColSelection()) {\n    const selectedRect = getSelectedRect(selection, map);\n    return [...Array(selectedRect.right - selectedRect.left).keys()].map((idx) => idx + selectedRect.left);\n  }\n\n  return [];\n};\n\n/**\n * @description Get the selected rows from the cell selection.\n * @param {Selection} selection - The selection.\n * @param {TableMap} map - The table map.\n * @returns {number[]} The selected rows.\n */\nexport const getSelectedRows = (selection: Selection, map: TableMap): number[] => {\n  if (isCellSelection(selection) && selection.isRowSelection()) {\n    const selectedRect = getSelectedRect(selection, map);\n    return [...Array(selectedRect.bottom - selectedRect.top).keys()].map((idx) => idx + selectedRect.top);\n  }\n\n  return [];\n};\n\n/**\n * @description Check if the rect is selected.\n * @param {Rect} rect - The rect.\n * @param {CellSelection} selection - The cell selection.\n * @returns {boolean} True if the rect is selected, false otherwise.\n */\nexport const isRectSelected = (rect: Rect, selection: CellSelection): boolean => {\n  const map = TableMap.get(selection.$anchorCell.node(-1));\n  const cells = map.cellsInRect(rect);\n  const selectedCells = map.cellsInRect(getSelectedRect(selection, map));\n\n  return cells.every((cell) => selectedCells.includes(cell));\n};\n\n/**\n * @description Check if the column is selected.\n * @param {number} columnIndex - The column index.\n * @param {Selection} selection - The selection.\n * @returns {boolean} True if the column is selected, false otherwise.\n */\nexport const isColumnSelected = (columnIndex: number, selection: Selection): boolean => {\n  if (!isCellSelection(selection)) return false;\n\n  const { height } = TableMap.get(selection.$anchorCell.node(-1));\n  const rect = { left: columnIndex, right: columnIndex + 1, top: 0, bottom: height };\n  return isRectSelected(rect, selection);\n};\n\n/**\n * @description Check if the row is selected.\n * @param {number} rowIndex - The row index.\n * @param {Selection} selection - The selection.\n * @returns {boolean} True if the row is selected, false otherwise.\n */\nexport const isRowSelected = (rowIndex: number, selection: Selection): boolean => {\n  if (isCellSelection(selection)) {\n    const { width } = TableMap.get(selection.$anchorCell.node(-1));\n    const rect = { left: 0, right: width, top: rowIndex, bottom: rowIndex + 1 };\n    return isRectSelected(rect, selection);\n  }\n\n  return false;\n};\n\n/**\n * @description Select the column.\n * @param {TableNodeLocation} table - The table node location.\n * @param {number} index - The column index.\n * @param {Transaction} tr - The transaction.\n * @returns {Transaction} The updated transaction.\n */\nexport const selectColumn = (table: TableNodeLocation, index: number, tr: Transaction): Transaction => {\n  const { map } = TableMap.get(table.node);\n\n  const anchorCell = table.start + map[index];\n  const $anchor = tr.doc.resolve(anchorCell);\n\n  return tr.setSelection(CellSelection.colSelection($anchor));\n};\n\n/**\n * @description Select the row.\n * @param {TableNodeLocation} table - The table node location.\n * @param {number} index - The row index.\n * @param {Transaction} tr - The transaction.\n * @returns {Transaction} The updated transaction.\n */\nexport const selectRow = (table: TableNodeLocation, index: number, tr: Transaction): Transaction => {\n  const { map, width } = TableMap.get(table.node);\n\n  const anchorCell = table.start + map[index * width];\n  const $anchor = tr.doc.resolve(anchorCell);\n\n  return tr.setSelection(CellSelection.rowSelection($anchor));\n};\n\n/**\n * @description Get the position of the cell widget decoration.\n * @param {TableNodeLocation} table - The table node location.\n * @param {TableMap} map - The table map.\n * @param {number} index - The index.\n * @returns {number} The position of the cell widget decoration.\n */\nexport const getTableCellWidgetDecorationPos = (table: TableNodeLocation, map: TableMap, index: number): number =>\n  table.start + map.map[index] + 1;\n\n/**\n * @description Get the height of the table in pixels.\n * @param {TableNodeLocation} table - The table node location.\n * @param {Editor} editor - The editor instance.\n * @returns {number} The height of the table in pixels.\n */\nexport const getTableHeightPx = (table: TableNodeLocation, editor: Editor): number => {\n  const dom = editor.view.domAtPos(table.start);\n  return dom.node.parentElement?.offsetHeight ?? 0;\n};\n\n/**\n * @description Get the width of the table in pixels.\n * @param {TableNodeLocation} table - The table node location.\n * @param {Editor} editor - The editor instance.\n * @returns {number} The width of the table in pixels.\n */\nexport const getTableWidthPx = (table: TableNodeLocation, editor: Editor): number => {\n  const dom = editor.view.domAtPos(table.start);\n  return dom.node.parentElement?.offsetWidth ?? 0;\n};\n","import type { Editor } from \"@tiptap/core\";\nimport { Fragment } from \"@tiptap/pm/model\";\nimport type { Node, Node as ProseMirrorNode } from \"@tiptap/pm/model\";\nimport type { Transaction } from \"@tiptap/pm/state\";\nimport { TableMap } from \"@tiptap/pm/tables\";\nimport type { CellSelection } from \"@tiptap/pm/tables\";\n// extensions\nimport type { TableNodeLocation } from \"@/extensions/table/table/utilities/helpers\";\n\ntype TableRow = (ProseMirrorNode | null)[];\ntype TableRows = TableRow[];\n\n/**\n * Move the selected columns to the specified index.\n * @param {Editor} editor - The editor instance.\n * @param {TableNodeLocation} table - The table node location.\n * @param {CellSelection} selection - The cell selection.\n * @param {number} to - The index to move the columns to.\n * @param {Transaction} tr - The transaction.\n * @returns {Transaction} The updated transaction.\n */\nexport const moveSelectedColumns = (\n  editor: Editor,\n  table: TableNodeLocation,\n  selection: CellSelection,\n  to: number,\n  tr: Transaction\n): Transaction => {\n  const tableMap = TableMap.get(table.node);\n\n  let columnStart = -1;\n  let columnEnd = -1;\n\n  selection.forEachCell((_node, pos) => {\n    const cell = tableMap.findCell(pos - table.pos - 1);\n    for (let i = cell.left; i < cell.right; i++) {\n      columnStart = columnStart >= 0 ? Math.min(cell.left, columnStart) : cell.left;\n      columnEnd = columnEnd >= 0 ? Math.max(cell.right, columnEnd) : cell.right;\n    }\n  });\n\n  if (columnStart === -1 || columnEnd === -1) {\n    console.warn(\"Invalid column selection\");\n    return tr;\n  }\n\n  if (to < 0 || to > tableMap.width || (to >= columnStart && to < columnEnd)) return tr;\n\n  const rows = tableToCells(table);\n  for (const row of rows) {\n    const range = row.splice(columnStart, columnEnd - columnStart);\n    const offset = to > columnStart ? to - (columnEnd - columnStart - 1) : to;\n    row.splice(offset, 0, ...range);\n  }\n\n  tableFromCells(editor, table, rows, tr);\n  return tr;\n};\n\n/**\n * Move the selected rows to the specified index.\n * @param {Editor} editor - The editor instance.\n * @param {TableNodeLocation} table - The table node location.\n * @param {CellSelection} selection - The cell selection.\n * @param {number} to - The index to move the rows to.\n * @param {Transaction} tr - The transaction.\n * @returns {Transaction} The updated transaction.\n */\nexport const moveSelectedRows = (\n  editor: Editor,\n  table: TableNodeLocation,\n  selection: CellSelection,\n  to: number,\n  tr: Transaction\n): Transaction => {\n  const tableMap = TableMap.get(table.node);\n\n  let rowStart = -1;\n  let rowEnd = -1;\n\n  selection.forEachCell((_node, pos) => {\n    const cell = tableMap.findCell(pos - table.pos - 1);\n    for (let i = cell.top; i < cell.bottom; i++) {\n      rowStart = rowStart >= 0 ? Math.min(cell.top, rowStart) : cell.top;\n      rowEnd = rowEnd >= 0 ? Math.max(cell.bottom, rowEnd) : cell.bottom;\n    }\n  });\n\n  if (rowStart === -1 || rowEnd === -1) {\n    console.warn(\"Invalid row selection\");\n    return tr;\n  }\n\n  if (to < 0 || to > tableMap.height || (to >= rowStart && to < rowEnd)) return tr;\n\n  const rows = tableToCells(table);\n  const range = rows.splice(rowStart, rowEnd - rowStart);\n  const offset = to > rowStart ? to - (rowEnd - rowStart - 1) : to;\n  rows.splice(offset, 0, ...range);\n\n  tableFromCells(editor, table, rows, tr);\n  return tr;\n};\n\n/**\n * @description Duplicate the selected rows.\n * @param {TableNodeLocation} table - The table node location.\n * @param {number[]} rowIndices - The indices of the rows to duplicate.\n * @param {Transaction} tr - The transaction.\n * @returns {Transaction} The updated transaction.\n */\nexport const duplicateRows = (table: TableNodeLocation, rowIndices: number[], tr: Transaction): Transaction => {\n  const rows = tableToCells(table);\n\n  const { map, width } = TableMap.get(table.node);\n\n  // Validate row indices\n  const maxRow = rows.length - 1;\n  if (rowIndices.some((idx) => idx < 0 || idx > maxRow)) {\n    console.warn(\"Invalid row indices for duplication\");\n    return tr;\n  }\n\n  const mapStart = tr.mapping.maps.length;\n\n  const lastRowPos = map[rowIndices[rowIndices.length - 1] * width + width - 1];\n  const nextRowStart = lastRowPos + (table.node.nodeAt(lastRowPos)?.nodeSize ?? 0) + 1;\n  const insertPos = tr.mapping.slice(mapStart).map(table.start + nextRowStart);\n\n  for (let i = rowIndices.length - 1; i >= 0; i--) {\n    tr.insert(\n      insertPos,\n      rows[rowIndices[i]].filter((r) => r !== null)\n    );\n  }\n\n  return tr;\n};\n\n/**\n * @description Duplicate the selected columns.\n * @param {TableNodeLocation} table - The table node location.\n * @param {number[]} columnIndices - The indices of the columns to duplicate.\n * @param {Transaction} tr - The transaction.\n * @returns {Transaction} The updated transaction.\n */\nexport const duplicateColumns = (table: TableNodeLocation, columnIndices: number[], tr: Transaction): Transaction => {\n  const rows = tableToCells(table);\n\n  const { map, width, height } = TableMap.get(table.node);\n\n  // Validate column indices\n  if (columnIndices.some((idx) => idx < 0 || idx >= width)) {\n    console.warn(\"Invalid column indices for duplication\");\n    return tr;\n  }\n\n  const mapStart = tr.mapping.maps.length;\n\n  for (let row = 0; row < height; row++) {\n    const lastColumnPos = map[row * width + columnIndices[columnIndices.length - 1]];\n    const nextColumnStart = lastColumnPos + (table.node.nodeAt(lastColumnPos)?.nodeSize ?? 0);\n    const insertPos = tr.mapping.slice(mapStart).map(table.start + nextColumnStart);\n\n    for (let i = columnIndices.length - 1; i >= 0; i--) {\n      const copiedNode = rows[row][columnIndices[i]];\n      if (copiedNode !== null) {\n        tr.insert(insertPos, copiedNode);\n      }\n    }\n  }\n\n  return tr;\n};\n\n/**\n * @description Convert the table to cells.\n * @param {TableNodeLocation} table - The table node location.\n * @returns {TableRows} The table rows.\n */\nconst tableToCells = (table: TableNodeLocation): TableRows => {\n  const { map, width, height } = TableMap.get(table.node);\n\n  const visitedCells = new Set<number>();\n  const rows: TableRows = [];\n  for (let row = 0; row < height; row++) {\n    const cells: (ProseMirrorNode | null)[] = [];\n    for (let col = 0; col < width; col++) {\n      const pos = map[row * width + col];\n      cells.push(!visitedCells.has(pos) ? table.node.nodeAt(pos) : null);\n      visitedCells.add(pos);\n    }\n    rows.push(cells);\n  }\n\n  return rows;\n};\n\n/**\n * @description Convert the cells to a table.\n * @param {Editor} editor - The editor instance.\n * @param {TableNodeLocation} table - The table node location.\n * @param {TableRows} rows - The table rows.\n * @param {Transaction} tr - The transaction.\n */\nconst tableFromCells = (editor: Editor, table: TableNodeLocation, rows: TableRows, tr: Transaction): void => {\n  const schema = editor.schema.nodes;\n  const newRowNodes = rows.map((row) =>\n    schema.tableRow.create(null, row.filter((cell) => cell !== null) as readonly Node[])\n  );\n  const newTableNode = table.node.copy(Fragment.from(newRowNodes));\n  tr.replaceWith(table.pos, table.pos + table.node.nodeSize, newTableNode);\n};\n","export const DROP_MARKER_CLASS = \"table-drop-marker\";\nexport const COL_DRAG_MARKER_CLASS = \"table-col-drag-marker\";\nexport const ROW_DRAG_MARKER_CLASS = \"table-row-drag-marker\";\n\nexport const DROP_MARKER_THICKNESS = 2;\n\nexport const getDropMarker = (tableElement: HTMLElement): HTMLElement | null =>\n  tableElement.querySelector(`.${DROP_MARKER_CLASS}`);\n\nexport const hideDropMarker = (element: HTMLElement): void => {\n  if (!element.classList.contains(\"hidden\")) {\n    element.classList.add(\"hidden\");\n  }\n};\n\nexport const updateColDropMarker = ({\n  element,\n  left,\n  width,\n}: {\n  element: HTMLElement;\n  left: number;\n  width: number;\n}) => {\n  element.style.height = \"100%\";\n  element.style.width = `${width}px`;\n  element.style.top = \"0\";\n  element.style.left = `${left}px`;\n  element.classList.remove(\"hidden\");\n};\n\nexport const updateRowDropMarker = ({\n  element,\n  top,\n  height,\n}: {\n  element: HTMLElement;\n  top: number;\n  height: number;\n}) => {\n  element.style.width = \"100%\";\n  element.style.height = `${height}px`;\n  element.style.left = \"0\";\n  element.style.top = `${top}px`;\n  element.classList.remove(\"hidden\");\n};\n\nexport const getColDragMarker = (tableElement: HTMLElement): HTMLElement | null =>\n  tableElement.querySelector(`.${COL_DRAG_MARKER_CLASS}`);\n\nexport const getRowDragMarker = (tableElement: HTMLElement): HTMLElement | null =>\n  tableElement.querySelector(`.${ROW_DRAG_MARKER_CLASS}`);\n\nexport const hideDragMarker = (element: HTMLElement): void => {\n  if (!element.classList.contains(\"hidden\")) {\n    element.classList.add(\"hidden\");\n  }\n};\n\nexport const updateColDragMarker = ({\n  element,\n  left,\n  width,\n  pseudoColumn,\n}: {\n  element: HTMLElement;\n  left: number;\n  width: number;\n  pseudoColumn: HTMLElement | undefined;\n}) => {\n  element.style.left = `${left}px`;\n  element.style.width = `${width}px`;\n  element.classList.remove(\"hidden\");\n  if (pseudoColumn) {\n    /// clear existing content\n    while (element.firstChild) {\n      element.removeChild(element.firstChild);\n    }\n    // clone and append the pseudo column\n    element.appendChild(pseudoColumn.cloneNode(true));\n  }\n};\n\nexport const updateRowDragMarker = ({\n  element,\n  top,\n  height,\n  pseudoRow,\n}: {\n  element: HTMLElement;\n  top: number;\n  height: number;\n  pseudoRow: HTMLElement | undefined;\n}) => {\n  element.style.top = `${top}px`;\n  element.style.height = `${height}px`;\n  element.classList.remove(\"hidden\");\n  if (pseudoRow) {\n    /// clear existing content\n    while (element.firstChild) {\n      element.removeChild(element.firstChild);\n    }\n    // clone and append the pseudo row\n    element.appendChild(pseudoRow.cloneNode(true));\n  }\n};\n","export enum CORE_EDITOR_META {\n  SKIP_FILE_DELETION = \"skipFileDeletion\",\n  INTENTIONAL_DELETION = \"intentionalDeletion\",\n  ADD_TO_HISTORY = \"addToHistory\",\n}\n","import type { Editor } from \"@tiptap/core\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\nimport { CORE_EDITOR_META } from \"@/constants/meta\";\n\n/**\n * @description Construct a pseudo table element which will act as a parent for column and row drag previews.\n * @returns {HTMLTableElement} The pseudo table.\n */\nexport const constructDragPreviewTable = (): {\n  tableElement: HTMLTableElement;\n  tableBodyElement: HTMLTableSectionElement;\n} => {\n  const tableElement = document.createElement(\"table\");\n  tableElement.classList.add(\"table-drag-preview\");\n  tableElement.classList.add(\"bg-custom-background-100\");\n  tableElement.style.opacity = \"0.9\";\n  const tableBodyElement = document.createElement(\"tbody\");\n  tableElement.appendChild(tableBodyElement);\n\n  return { tableElement, tableBodyElement };\n};\n\n/**\n * @description Clone a table cell element.\n * @param {HTMLElement} cellElement - The cell element to clone.\n * @returns {HTMLElement} The cloned cell element.\n */\nexport const cloneTableCell = (\n  cellElement: HTMLElement\n): {\n  clonedCellElement: HTMLElement;\n} => {\n  const clonedCellElement = cellElement.cloneNode(true) as HTMLElement;\n  clonedCellElement.style.setProperty(\"visibility\", \"visible\", \"important\");\n\n  const widgetElement = clonedCellElement.querySelectorAll(\".ProseMirror-widget\");\n  widgetElement.forEach((widget) => widget.remove());\n\n  return { clonedCellElement };\n};\n\n/**\n * @description This function updates the `hideContent` attribute of the table cells and headers.\n * @param {Editor} editor - The editor instance.\n * @param {boolean} hideContent - Whether to hide the content.\n * @returns {boolean} Whether the content visibility was updated.\n */\nexport const updateCellContentVisibility = (editor: Editor, hideContent: boolean): boolean =>\n  editor\n    .chain()\n    .focus()\n    .setMeta(CORE_EDITOR_META.ADD_TO_HISTORY, false)\n    .updateAttributes(CORE_EXTENSIONS.TABLE_CELL, {\n      hideContent,\n    })\n    .updateAttributes(CORE_EXTENSIONS.TABLE_HEADER, {\n      hideContent,\n    })\n    .run();\n","import { Disclosure } from \"@headlessui/react\";\nimport type { Editor } from \"@tiptap/core\";\nimport { Ban, Palette } from \"lucide-react\";\n// plane imports\nimport { ChevronRightIcon } from \"@plane/propel/icons\";\nimport { cn } from \"@plane/utils\";\n// constants\nimport { COLORS_LIST } from \"@/constants/common\";\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n\n// TODO: implement text color selector\n\ntype Props = {\n  editor: Editor;\n  onSelect: (color: string | null) => void;\n};\n\nconst handleBackgroundColorChange = (editor: Editor, color: string | null) => {\n  editor\n    .chain()\n    .focus()\n    .updateAttributes(CORE_EXTENSIONS.TABLE_CELL, {\n      background: color,\n    })\n    .run();\n};\n\n// const handleTextColorChange = (editor: Editor, color: string | null) => {\n//   editor\n//     .chain()\n//     .focus()\n//     .updateAttributes(CORE_EXTENSIONS.TABLE_CELL, {\n//       textColor: color,\n//     })\n//     .run();\n// };\n\nexport function TableDragHandleDropdownColorSelector(props: Props) {\n  const { editor, onSelect } = props;\n\n  return (\n    <Disclosure defaultOpen>\n      <Disclosure.Button\n        as=\"button\"\n        type=\"button\"\n        className=\"flex items-center justify-between gap-2 w-full rounded px-1 py-1.5 text-xs text-left truncate text-custom-text-200 hover:bg-custom-background-80\"\n      >\n        {({ open }) => (\n          <>\n            <span className=\"flex items-center gap-2\">\n              <Palette className=\"shrink-0 size-3\" />\n              Color\n            </span>\n            <ChevronRightIcon\n              className={cn(\"shrink-0 size-3 transition-transform duration-200\", {\n                \"rotate-90\": open,\n              })}\n            />\n          </>\n        )}\n      </Disclosure.Button>\n      <Disclosure.Panel className=\"p-1 space-y-2 mb-1.5\">\n        {/* <div className=\"space-y-1.5\">\n          <p className=\"text-xs text-custom-text-300 font-semibold\">Text colors</p>\n          <div className=\"flex items-center flex-wrap gap-2\">\n            {COLORS_LIST.map((color) => (\n              <button\n                key={color.key}\n                type=\"button\"\n                className=\"flex-shrink-0 size-6 rounded border-[0.5px] border-custom-border-400 hover:opacity-60 transition-opacity\"\n                style={{\n                  backgroundColor: color.textColor,\n                }}\n                onClick={() => handleTextColorChange(editor, color.textColor)}\n              />\n            ))}\n            <button\n              type=\"button\"\n              className=\"flex-shrink-0 size-6 grid place-items-center rounded text-custom-text-300 border-[0.5px] border-custom-border-400 hover:bg-custom-background-80 transition-colors\"\n              onClick={() => handleTextColorChange(editor, null)}\n            >\n              <Ban className=\"size-4\" />\n            </button>\n          </div>\n        </div> */}\n        <div className=\"space-y-1\">\n          <p className=\"text-xs text-custom-text-300 font-semibold\">Background colors</p>\n          <div className=\"flex items-center flex-wrap gap-2\">\n            {COLORS_LIST.map((color) => (\n              <button\n                key={color.key}\n                type=\"button\"\n                className=\"flex-shrink-0 size-6 rounded border-[0.5px] border-custom-border-400 hover:opacity-60 transition-opacity\"\n                style={{\n                  backgroundColor: color.backgroundColor,\n                }}\n                onClick={() => {\n                  handleBackgroundColorChange(editor, color.backgroundColor);\n                  onSelect(color.backgroundColor);\n                }}\n              />\n            ))}\n            <button\n              type=\"button\"\n              className=\"flex-shrink-0 size-6 grid place-items-center rounded text-custom-text-300 border-[0.5px] border-custom-border-400 hover:bg-custom-background-80 transition-colors\"\n              onClick={() => {\n                handleBackgroundColorChange(editor, null);\n                onSelect(null);\n              }}\n            >\n              <Ban className=\"size-4\" />\n            </button>\n          </div>\n        </div>\n      </Disclosure.Panel>\n    </Disclosure>\n  );\n}\n","import type { Editor } from \"@tiptap/core\";\nimport { TableMap } from \"@tiptap/pm/tables\";\nimport { ArrowLeft, ArrowRight, Copy, ToggleRight, Trash2 } from \"lucide-react\";\nimport type { LucideIcon } from \"lucide-react\";\n// extensions\nimport type { ISvgIcons } from \"@plane/propel/icons\";\nimport { CloseIcon } from \"@plane/propel/icons\";\nimport { findTable, getSelectedColumns } from \"@/extensions/table/table/utilities/helpers\";\n// local imports\nimport { duplicateColumns } from \"../actions\";\nimport { TableDragHandleDropdownColorSelector } from \"../color-selector\";\n\nconst DROPDOWN_ITEMS: {\n  key: string;\n  label: string;\n  icon: LucideIcon | React.FC<ISvgIcons>;\n  action: (editor: Editor) => void;\n}[] = [\n  {\n    key: \"insert-left\",\n    label: \"Insert left\",\n    icon: ArrowLeft,\n    action: (editor) => editor.chain().focus().addColumnBefore().run(),\n  },\n  {\n    key: \"insert-right\",\n    label: \"Insert right\",\n    icon: ArrowRight,\n    action: (editor) => editor.chain().focus().addColumnAfter().run(),\n  },\n  {\n    key: \"duplicate\",\n    label: \"Duplicate\",\n    icon: Copy,\n    action: (editor) => {\n      const table = findTable(editor.state.selection);\n      if (!table) return;\n\n      const tableMap = TableMap.get(table.node);\n      let tr = editor.state.tr;\n      const selectedColumns = getSelectedColumns(editor.state.selection, tableMap);\n      tr = duplicateColumns(table, selectedColumns, tr);\n      editor.view.dispatch(tr);\n    },\n  },\n  {\n    key: \"clear-contents\",\n    label: \"Clear contents\",\n    icon: CloseIcon,\n    action: (editor) => editor.chain().focus().clearSelectedCells().run(),\n  },\n  {\n    key: \"delete\",\n    label: \"Delete\",\n    icon: Trash2,\n    action: (editor) => editor.chain().focus().deleteColumn().run(),\n  },\n];\n\ntype Props = {\n  editor: Editor;\n  onClose: () => void;\n};\n\nexport function ColumnOptionsDropdown(props: Props) {\n  const { editor, onClose } = props;\n\n  return (\n    <>\n      <button\n        type=\"button\"\n        className=\"flex items-center justify-between gap-2 w-full rounded px-1 py-1.5 text-xs text-left truncate text-custom-text-200 hover:bg-custom-background-80\"\n        onClick={(e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          editor.chain().focus().toggleHeaderColumn().run();\n          onClose();\n        }}\n      >\n        <div className=\"flex-grow truncate\">Header column</div>\n        <ToggleRight className=\"shrink-0 size-3\" />\n      </button>\n      <hr className=\"my-2 border-custom-border-200\" />\n      <TableDragHandleDropdownColorSelector editor={editor} onSelect={onClose} />\n      {DROPDOWN_ITEMS.map((item) => (\n        <button\n          key={item.key}\n          type=\"button\"\n          className=\"flex items-center gap-2 w-full rounded px-1 py-1.5 text-xs text-left truncate text-custom-text-200 hover:bg-custom-background-80\"\n          onClick={(e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            item.action(editor);\n            onClose();\n          }}\n        >\n          <item.icon className=\"shrink-0 size-3\" />\n          <div className=\"flex-grow truncate\">{item.label}</div>\n        </button>\n      ))}\n    </>\n  );\n}\n","import type { Editor } from \"@tiptap/core\";\nimport type { Selection } from \"@tiptap/pm/state\";\nimport { TableMap } from \"@tiptap/pm/tables\";\n// extensions\nimport { getSelectedRect, isCellSelection } from \"@/extensions/table/table/utilities/helpers\";\nimport type { TableNodeLocation } from \"@/extensions/table/table/utilities/helpers\";\n// local imports\nimport { cloneTableCell, constructDragPreviewTable, updateCellContentVisibility } from \"../utils\";\n\ntype TableColumn = {\n  left: number;\n  width: number;\n};\n\n/**\n * @description Calculate the index where the dragged column should be dropped.\n * @param {number} col - The column index.\n * @param {TableColumn[]} columns - The columns.\n * @param {number} left - The left position of the dragged column.\n * @returns {number} The index where the dragged column should be dropped.\n */\nexport const calculateColumnDropIndex = (col: number, columns: TableColumn[], left: number): number => {\n  const currentColumnLeft = columns[col].left;\n  const currentColumnRight = currentColumnLeft + columns[col].width;\n\n  const draggedColumnLeft = left;\n  const draggedColumnRight = draggedColumnLeft + columns[col].width;\n\n  const isDraggingToLeft = draggedColumnLeft < currentColumnLeft;\n  const isDraggingToRight = draggedColumnRight > currentColumnRight;\n\n  const isFirstColumn = col === 0;\n  const isLastColumn = col === columns.length - 1;\n\n  if ((isFirstColumn && isDraggingToLeft) || (isLastColumn && isDraggingToRight)) {\n    return col;\n  }\n\n  const firstColumn = columns[0];\n  if (isDraggingToLeft && draggedColumnLeft <= firstColumn.left) {\n    return 0;\n  }\n\n  const lastColumn = columns[columns.length - 1];\n  if (isDraggingToRight && draggedColumnRight >= lastColumn.left + lastColumn.width) {\n    return columns.length - 1;\n  }\n\n  let dropColumnIndex = col;\n  if (isDraggingToRight) {\n    const findHoveredColumn = columns.find((p, index) => {\n      if (index === col) return false;\n      const currentColumnCenter = p.left + p.width / 2;\n      const currentColumnEdge = p.left + p.width;\n      const nextColumn = columns[index + 1] as TableColumn | undefined;\n      const nextColumnCenter = nextColumn ? nextColumn.width / 2 : 0;\n\n      return draggedColumnRight >= currentColumnCenter && draggedColumnRight < currentColumnEdge + nextColumnCenter;\n    });\n    if (findHoveredColumn) {\n      dropColumnIndex = columns.indexOf(findHoveredColumn);\n    }\n  }\n\n  if (isDraggingToLeft) {\n    const findHoveredColumn = columns.find((p, index) => {\n      if (index === col) return false;\n      const currentColumnCenter = p.left + p.width / 2;\n      const prevColumn = columns[index - 1] as TableColumn | undefined;\n      const prevColumnLeft = prevColumn ? prevColumn.left : 0;\n      const prevColumnCenter = prevColumn ? prevColumn.width / 2 : 0;\n\n      return draggedColumnLeft <= currentColumnCenter && draggedColumnLeft > prevColumnLeft + prevColumnCenter;\n    });\n    if (findHoveredColumn) {\n      dropColumnIndex = columns.indexOf(findHoveredColumn);\n    }\n  }\n\n  return dropColumnIndex;\n};\n\n/**\n * @description Get the node information of the columns in the table- their offset left and width.\n * @param {TableNodeLocation} table - The table node location.\n * @param {Editor} editor - The editor instance.\n * @returns {TableColumn[]} The information of the columns in the table.\n */\nexport const getTableColumnNodesInfo = (table: TableNodeLocation, editor: Editor): TableColumn[] => {\n  const result: TableColumn[] = [];\n  let leftPx = 0;\n\n  const tableMap = TableMap.get(table.node);\n  if (!tableMap || tableMap.height === 0 || tableMap.width === 0) {\n    return result;\n  }\n\n  for (let col = 0; col < tableMap.width; col++) {\n    const cellPos = tableMap.map[col];\n    if (cellPos === undefined) continue;\n\n    const dom = editor.view.domAtPos(table.start + cellPos + 1);\n    if (dom.node instanceof HTMLElement) {\n      if (col === 0) {\n        leftPx = dom.node.offsetLeft;\n      }\n      result.push({\n        left: dom.node.offsetLeft - leftPx,\n        width: dom.node.offsetWidth,\n      });\n    }\n  }\n  return result;\n};\n\n/**\n * @description Construct a pseudo column from the selected cells for drag preview.\n * @param {Editor} editor - The editor instance.\n * @param {Selection} selection - The selection.\n * @param {TableNodeLocation} table - The table node location.\n * @returns {HTMLElement | undefined} The pseudo column.\n */\nexport const constructColumnDragPreview = (\n  editor: Editor,\n  selection: Selection,\n  table: TableNodeLocation\n): HTMLElement | undefined => {\n  if (!isCellSelection(selection)) return;\n\n  const tableMap = TableMap.get(table.node);\n  const selectedColRect = getSelectedRect(selection, tableMap);\n  const activeColCells = tableMap.cellsInRect(selectedColRect);\n\n  const { tableElement, tableBodyElement } = constructDragPreviewTable();\n\n  activeColCells.forEach((cellPos) => {\n    const resolvedCellPos = table.start + cellPos + 1;\n    const cellElement = editor.view.domAtPos(resolvedCellPos).node;\n    if (cellElement instanceof HTMLElement) {\n      const { clonedCellElement } = cloneTableCell(cellElement);\n      clonedCellElement.style.height = cellElement.getBoundingClientRect().height + \"px\";\n      const tableRowElement = document.createElement(\"tr\");\n      tableRowElement.appendChild(clonedCellElement);\n      tableBodyElement.appendChild(tableRowElement);\n    }\n  });\n\n  updateCellContentVisibility(editor, true);\n\n  return tableElement;\n};\n","import {\n  shift,\n  flip,\n  useDismiss,\n  useFloating,\n  useInteractions,\n  autoUpdate,\n  useClick,\n  useRole,\n  FloatingOverlay,\n  FloatingPortal,\n} from \"@floating-ui/react\";\nimport type { Editor } from \"@tiptap/core\";\nimport { Ellipsis } from \"lucide-react\";\nimport { useCallback, useEffect, useState } from \"react\";\n// plane imports\nimport { cn } from \"@plane/utils\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// extensions\nimport {\n  findTable,\n  getTableHeightPx,\n  getTableWidthPx,\n  isCellSelection,\n  selectColumn,\n} from \"@/extensions/table/table/utilities/helpers\";\n// local imports\nimport { moveSelectedColumns } from \"../actions\";\nimport {\n  DROP_MARKER_THICKNESS,\n  getColDragMarker,\n  getDropMarker,\n  hideDragMarker,\n  hideDropMarker,\n  updateColDragMarker,\n  updateColDropMarker,\n} from \"../marker-utils\";\nimport { updateCellContentVisibility } from \"../utils\";\nimport { ColumnOptionsDropdown } from \"./dropdown\";\nimport { calculateColumnDropIndex, constructColumnDragPreview, getTableColumnNodesInfo } from \"./utils\";\n\nexport type ColumnDragHandleProps = {\n  col: number;\n  editor: Editor;\n};\n\nexport function ColumnDragHandle(props: ColumnDragHandleProps) {\n  const { col, editor } = props;\n  // states\n  const [isDropdownOpen, setIsDropdownOpen] = useState(false);\n  // floating ui\n  const { refs, floatingStyles, context } = useFloating({\n    placement: \"bottom-start\",\n    middleware: [\n      flip({\n        fallbackPlacements: [\"top-start\", \"bottom-start\", \"top-end\", \"bottom-end\"],\n      }),\n      shift({\n        padding: 8,\n      }),\n    ],\n    open: isDropdownOpen,\n    onOpenChange: (open) => {\n      setIsDropdownOpen(open);\n      if (open) {\n        editor.commands.addActiveDropbarExtension(CORE_EXTENSIONS.TABLE);\n      } else {\n        setTimeout(() => {\n          editor.commands.removeActiveDropbarExtension(CORE_EXTENSIONS.TABLE);\n        }, 0);\n      }\n    },\n    whileElementsMounted: autoUpdate,\n  });\n  const click = useClick(context);\n  const dismiss = useDismiss(context);\n  const role = useRole(context);\n  const { getReferenceProps, getFloatingProps } = useInteractions([dismiss, click, role]);\n\n  useEffect(() => {\n    if (!isDropdownOpen) return;\n    const handleKeyDown = (event: KeyboardEvent) => {\n      context.onOpenChange(false);\n      event.preventDefault();\n      event.stopPropagation();\n    };\n    document.addEventListener(\"keydown\", handleKeyDown);\n    return () => document.removeEventListener(\"keydown\", handleKeyDown);\n  }, [isDropdownOpen, context]);\n\n  const handleMouseDown = useCallback(\n    (e: React.MouseEvent<HTMLButtonElement>) => {\n      e.stopPropagation();\n      e.preventDefault();\n\n      const table = findTable(editor.state.selection);\n      if (!table) return;\n\n      editor.view.dispatch(selectColumn(table, col, editor.state.tr));\n\n      // drag column\n      const tableWidthPx = getTableWidthPx(table, editor);\n      const columns = getTableColumnNodesInfo(table, editor);\n\n      let dropIndex = col;\n      const startLeft = columns[col].left ?? 0;\n      const startX = e.clientX;\n      const tableElement = editor.view.nodeDOM(table.pos);\n\n      const dropMarker = tableElement instanceof HTMLElement ? getDropMarker(tableElement) : null;\n      const dragMarker = tableElement instanceof HTMLElement ? getColDragMarker(tableElement) : null;\n\n      const handleFinish = () => {\n        if (!dropMarker || !dragMarker) return;\n        hideDropMarker(dropMarker);\n        hideDragMarker(dragMarker);\n\n        if (isCellSelection(editor.state.selection)) {\n          updateCellContentVisibility(editor, false);\n        }\n\n        if (col !== dropIndex) {\n          let tr = editor.state.tr;\n          const selection = editor.state.selection;\n          if (isCellSelection(selection)) {\n            const table = findTable(selection);\n            if (table) {\n              tr = moveSelectedColumns(editor, table, selection, dropIndex, tr);\n            }\n          }\n          editor.view.dispatch(tr);\n        }\n        window.removeEventListener(\"mouseup\", handleFinish);\n        window.removeEventListener(\"mousemove\", handleMove);\n      };\n\n      let pseudoColumn: HTMLElement | undefined;\n\n      const handleMove = (moveEvent: MouseEvent) => {\n        if (!dropMarker || !dragMarker) return;\n        const currentLeft = startLeft + moveEvent.clientX - startX;\n        dropIndex = calculateColumnDropIndex(col, columns, currentLeft);\n\n        if (!pseudoColumn) {\n          pseudoColumn = constructColumnDragPreview(editor, editor.state.selection, table);\n          const tableHeightPx = getTableHeightPx(table, editor);\n          if (pseudoColumn) {\n            pseudoColumn.style.height = `${tableHeightPx}px`;\n          }\n        }\n\n        const dragMarkerWidthPx = columns[col].width;\n        const dragMarkerLeftPx = Math.max(0, Math.min(currentLeft, tableWidthPx - dragMarkerWidthPx));\n        const dropMarkerLeftPx =\n          dropIndex <= col ? columns[dropIndex].left : columns[dropIndex].left + columns[dropIndex].width;\n\n        updateColDropMarker({\n          element: dropMarker,\n          left: dropMarkerLeftPx - Math.floor(DROP_MARKER_THICKNESS / 2) - 1,\n          width: DROP_MARKER_THICKNESS,\n        });\n        updateColDragMarker({\n          element: dragMarker,\n          left: dragMarkerLeftPx,\n          width: dragMarkerWidthPx,\n          pseudoColumn,\n        });\n      };\n\n      try {\n        window.addEventListener(\"mouseup\", handleFinish);\n        window.addEventListener(\"mousemove\", handleMove);\n      } catch (error) {\n        console.error(\"Error in ColumnDragHandle:\", error);\n        handleFinish();\n      }\n    },\n    [col, editor]\n  );\n\n  return (\n    <>\n      <div className=\"table-col-handle-container absolute z-20 top-0 left-0 flex justify-center items-center w-full -translate-y-1/2\">\n        <button\n          ref={refs.setReference}\n          {...getReferenceProps()}\n          type=\"button\"\n          onMouseDown={handleMouseDown}\n          className={cn(\n            \"px-1 bg-custom-background-90 border border-custom-border-400 rounded outline-none transition-all duration-200\",\n            {\n              \"!opacity-100 bg-custom-primary-100 border-custom-primary-100\": isDropdownOpen,\n              \"hover:bg-custom-background-80\": !isDropdownOpen,\n            }\n          )}\n        >\n          <Ellipsis className=\"size-4 text-custom-text-100\" />\n        </button>\n      </div>\n      {isDropdownOpen && (\n        <FloatingPortal>\n          {/* Backdrop */}\n          <FloatingOverlay\n            style={{\n              zIndex: 99,\n            }}\n            lockScroll\n          />\n          <div\n            className=\"max-h-[90vh] w-[12rem] overflow-y-auto rounded-md border-[0.5px] border-custom-border-300 bg-custom-background-100 px-2 py-2.5 shadow-custom-shadow-rg\"\n            ref={refs.setFloating}\n            {...getFloatingProps()}\n            style={{\n              ...floatingStyles,\n              zIndex: 100,\n            }}\n          >\n            <ColumnOptionsDropdown editor={editor} onClose={() => context.onOpenChange(false)} />\n          </div>\n        </FloatingPortal>\n      )}\n    </>\n  );\n}\n","import type { Editor } from \"@tiptap/core\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\nimport { TableMap } from \"@tiptap/pm/tables\";\nimport { Decoration, DecorationSet } from \"@tiptap/pm/view\";\nimport { ReactRenderer } from \"@tiptap/react\";\n// extensions\nimport {\n  findTable,\n  getTableCellWidgetDecorationPos,\n  haveTableRelatedChanges,\n} from \"@/extensions/table/table/utilities/helpers\";\n// local imports\nimport type { ColumnDragHandleProps } from \"./drag-handle\";\nimport { ColumnDragHandle } from \"./drag-handle\";\n\ntype TableColumnDragHandlePluginState = {\n  decorations?: DecorationSet;\n  // track table structure to detect changes\n  tableWidth?: number;\n  tableNodePos?: number;\n};\n\nconst TABLE_COLUMN_DRAG_HANDLE_PLUGIN_KEY = new PluginKey(\"tableColumnHandlerDecorationPlugin\");\n\nexport const TableColumnDragHandlePlugin = (editor: Editor): Plugin<TableColumnDragHandlePluginState> =>\n  new Plugin<TableColumnDragHandlePluginState>({\n    key: TABLE_COLUMN_DRAG_HANDLE_PLUGIN_KEY,\n    state: {\n      init: () => ({}),\n      apply(tr, prev, oldState, newState) {\n        const table = findTable(newState.selection);\n        if (!haveTableRelatedChanges(editor, table, oldState, newState, tr)) {\n          return table !== undefined ? prev : {};\n        }\n\n        const tableMap = TableMap.get(table.node);\n\n        // Check if table structure changed (width or position)\n        const tableStructureChanged = prev.tableWidth !== tableMap.width || prev.tableNodePos !== table.pos;\n\n        let isStale = tableStructureChanged;\n\n        // Only do position-based stale check if structure hasn't changed\n        if (!isStale) {\n          const mapped = prev.decorations?.map(tr.mapping, tr.doc);\n          for (let col = 0; col < tableMap.width; col++) {\n            const pos = getTableCellWidgetDecorationPos(table, tableMap, col);\n            if (mapped?.find(pos, pos + 1)?.length !== 1) {\n              isStale = true;\n              break;\n            }\n          }\n        }\n\n        if (!isStale) {\n          const mapped = prev.decorations?.map(tr.mapping, tr.doc);\n          return {\n            decorations: mapped,\n            tableWidth: tableMap.width,\n            tableNodePos: table.pos,\n          };\n        }\n\n        // recreate all decorations\n        const decorations: Decoration[] = [];\n\n        for (let col = 0; col < tableMap.width; col++) {\n          const pos = getTableCellWidgetDecorationPos(table, tableMap, col);\n\n          const dragHandleComponent = new ReactRenderer(ColumnDragHandle, {\n            props: {\n              col,\n              editor,\n            } satisfies ColumnDragHandleProps,\n            editor,\n          });\n\n          decorations.push(Decoration.widget(pos, () => dragHandleComponent.element));\n        }\n\n        return {\n          decorations: DecorationSet.create(newState.doc, decorations),\n          tableWidth: tableMap.width,\n          tableNodePos: table.pos,\n        };\n      },\n    },\n    props: {\n      decorations(state) {\n        return TABLE_COLUMN_DRAG_HANDLE_PLUGIN_KEY.getState(state).decorations;\n      },\n    },\n  });\n","import type { Editor } from \"@tiptap/core\";\nimport { TableMap } from \"@tiptap/pm/tables\";\nimport { ArrowDown, ArrowUp, Copy, ToggleRight, Trash2 } from \"lucide-react\";\nimport type { LucideIcon } from \"lucide-react\";\n// extensions\nimport type { ISvgIcons } from \"@plane/propel/icons\";\nimport { CloseIcon } from \"@plane/propel/icons\";\nimport { findTable, getSelectedRows } from \"@/extensions/table/table/utilities/helpers\";\n// local imports\nimport { duplicateRows } from \"../actions\";\nimport { TableDragHandleDropdownColorSelector } from \"../color-selector\";\n\nconst DROPDOWN_ITEMS: {\n  key: string;\n  label: string;\n  icon: LucideIcon | React.FC<ISvgIcons>;\n  action: (editor: Editor) => void;\n}[] = [\n  {\n    key: \"insert-above\",\n    label: \"Insert above\",\n    icon: ArrowUp,\n    action: (editor) => editor.chain().focus().addRowBefore().run(),\n  },\n  {\n    key: \"insert-below\",\n    label: \"Insert below\",\n    icon: ArrowDown,\n    action: (editor) => editor.chain().focus().addRowAfter().run(),\n  },\n  {\n    key: \"duplicate\",\n    label: \"Duplicate\",\n    icon: Copy,\n    action: (editor) => {\n      const table = findTable(editor.state.selection);\n      if (!table) return;\n\n      const tableMap = TableMap.get(table.node);\n      let tr = editor.state.tr;\n      const selectedRows = getSelectedRows(editor.state.selection, tableMap);\n      tr = duplicateRows(table, selectedRows, tr);\n      editor.view.dispatch(tr);\n    },\n  },\n  {\n    key: \"clear-contents\",\n    label: \"Clear contents\",\n    icon: CloseIcon,\n    action: (editor) => editor.chain().focus().clearSelectedCells().run(),\n  },\n  {\n    key: \"delete\",\n    label: \"Delete\",\n    icon: Trash2,\n    action: (editor) => editor.chain().focus().deleteRow().run(),\n  },\n];\n\ntype Props = {\n  editor: Editor;\n  onClose: () => void;\n};\n\nexport function RowOptionsDropdown(props: Props) {\n  const { editor, onClose } = props;\n\n  return (\n    <>\n      <button\n        type=\"button\"\n        className=\"flex items-center justify-between gap-2 w-full rounded px-1 py-1.5 text-xs text-left truncate text-custom-text-200 hover:bg-custom-background-80\"\n        onClick={(e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          editor.chain().focus().toggleHeaderRow().run();\n          onClose();\n        }}\n      >\n        <div className=\"flex-grow truncate\">Header row</div>\n        <ToggleRight className=\"shrink-0 size-3\" />\n      </button>\n      <hr className=\"my-2 border-custom-border-200\" />\n      <TableDragHandleDropdownColorSelector editor={editor} onSelect={onClose} />\n      {DROPDOWN_ITEMS.map((item) => (\n        <button\n          key={item.key}\n          type=\"button\"\n          className=\"flex items-center gap-2 w-full rounded px-1 py-1.5 text-xs text-left truncate text-custom-text-200 hover:bg-custom-background-80\"\n          onClick={(e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            item.action(editor);\n            onClose();\n          }}\n        >\n          <item.icon className=\"shrink-0 size-3\" />\n          <div className=\"flex-grow truncate\">{item.label}</div>\n        </button>\n      ))}\n    </>\n  );\n}\n","import type { Editor } from \"@tiptap/core\";\nimport type { Selection } from \"@tiptap/pm/state\";\nimport { TableMap } from \"@tiptap/pm/tables\";\n// extensions\nimport { getSelectedRect, isCellSelection } from \"@/extensions/table/table/utilities/helpers\";\nimport type { TableNodeLocation } from \"@/extensions/table/table/utilities/helpers\";\n// local imports\nimport { cloneTableCell, constructDragPreviewTable, updateCellContentVisibility } from \"../utils\";\n\ntype TableRow = {\n  top: number;\n  height: number;\n};\n\n/**\n * @description Calculate the index where the dragged row should be dropped.\n * @param {number} row - The row index.\n * @param {TableRow[]} rows - The rows.\n * @param {number} top - The top position of the dragged row.\n * @returns {number} The index where the dragged row should be dropped.\n */\nexport const calculateRowDropIndex = (row: number, rows: TableRow[], top: number): number => {\n  const currentRowTop = rows[row].top;\n  const currentRowBottom = currentRowTop + rows[row].height;\n\n  const draggedRowTop = top;\n  const draggedRowBottom = draggedRowTop + rows[row].height;\n\n  const isDraggingUp = draggedRowTop < currentRowTop;\n  const isDraggingDown = draggedRowBottom > currentRowBottom;\n\n  const isFirstRow = row === 0;\n  const isLastRow = row === rows.length - 1;\n\n  if ((isFirstRow && isDraggingUp) || (isLastRow && isDraggingDown)) {\n    return row;\n  }\n\n  const firstRow = rows[0];\n  if (isDraggingUp && draggedRowTop <= firstRow.top) {\n    return 0;\n  }\n\n  const lastRow = rows[rows.length - 1];\n  if (isDraggingDown && draggedRowBottom >= lastRow.top + lastRow.height) {\n    return rows.length - 1;\n  }\n\n  let dropRowIndex = row;\n  if (isDraggingDown) {\n    const findHoveredRow = rows.find((p, index) => {\n      if (index === row) return false;\n      const currentRowCenter = p.top + p.height / 2;\n      const currentRowEdge = p.top + p.height;\n      const nextRow = rows[index + 1] as TableRow | undefined;\n      const nextRowCenter = nextRow ? nextRow.height / 2 : 0;\n\n      return draggedRowBottom >= currentRowCenter && draggedRowBottom < currentRowEdge + nextRowCenter;\n    });\n    if (findHoveredRow) {\n      dropRowIndex = rows.indexOf(findHoveredRow);\n    }\n  }\n\n  if (isDraggingUp) {\n    const findHoveredRow = rows.find((p, index) => {\n      if (index === row) return false;\n      const currentRowCenter = p.top + p.height / 2;\n      const prevRow = rows[index - 1] as TableRow | undefined;\n      const prevRowTop = prevRow ? prevRow.top : 0;\n      const prevRowCenter = prevRow ? prevRow.height / 2 : 0;\n\n      return draggedRowTop <= currentRowCenter && draggedRowTop > prevRowTop + prevRowCenter;\n    });\n    if (findHoveredRow) {\n      dropRowIndex = rows.indexOf(findHoveredRow);\n    }\n  }\n\n  return dropRowIndex;\n};\n\n/**\n * @description Get the node information of the rows in the table- their offset top and height.\n * @param {TableNodeLocation} table - The table node location.\n * @param {Editor} editor - The editor instance.\n * @returns {TableRow[]} The information of the rows in the table.\n */\nexport const getTableRowNodesInfo = (table: TableNodeLocation, editor: Editor): TableRow[] => {\n  const result: TableRow[] = [];\n  let topPx = 0;\n\n  const tableMap = TableMap.get(table.node);\n  if (!tableMap || tableMap.height === 0 || tableMap.width === 0) {\n    return result;\n  }\n\n  for (let row = 0; row < tableMap.height; row++) {\n    const cellPos = tableMap.map[row * tableMap.width];\n    if (cellPos === undefined) continue;\n    const dom = editor.view.domAtPos(table.start + cellPos);\n    if (dom.node instanceof HTMLElement) {\n      const heightPx = dom.node.offsetHeight;\n      result.push({\n        top: topPx,\n        height: heightPx,\n      });\n      topPx += heightPx;\n    }\n  }\n  return result;\n};\n\n/**\n * @description Construct a pseudo column from the selected cells for drag preview.\n * @param {Editor} editor - The editor instance.\n * @param {Selection} selection - The selection.\n * @param {TableNodeLocation} table - The table node location.\n * @returns {HTMLElement | undefined} The pseudo column.\n */\nexport const constructRowDragPreview = (\n  editor: Editor,\n  selection: Selection,\n  table: TableNodeLocation\n): HTMLElement | undefined => {\n  if (!isCellSelection(selection)) return;\n\n  const tableMap = TableMap.get(table.node);\n  const selectedRowRect = getSelectedRect(selection, tableMap);\n  const activeRowCells = tableMap.cellsInRect(selectedRowRect);\n\n  const { tableElement, tableBodyElement } = constructDragPreviewTable();\n\n  const tableRowElement = document.createElement(\"tr\");\n  tableBodyElement.appendChild(tableRowElement);\n\n  activeRowCells.forEach((cellPos) => {\n    const resolvedCellPos = table.start + cellPos + 1;\n    const cellElement = editor.view.domAtPos(resolvedCellPos).node;\n    if (cellElement instanceof HTMLElement) {\n      const { clonedCellElement } = cloneTableCell(cellElement);\n      clonedCellElement.style.width = cellElement.getBoundingClientRect().width + \"px\";\n      tableRowElement.appendChild(clonedCellElement);\n    }\n  });\n\n  updateCellContentVisibility(editor, true);\n\n  return tableElement;\n};\n","import {\n  autoUpdate,\n  flip,\n  FloatingOverlay,\n  FloatingPortal,\n  shift,\n  useClick,\n  useDismiss,\n  useFloating,\n  useInteractions,\n  useRole,\n} from \"@floating-ui/react\";\nimport type { Editor } from \"@tiptap/core\";\nimport { Ellipsis } from \"lucide-react\";\nimport { useCallback, useEffect, useState } from \"react\";\n// plane imports\nimport { cn } from \"@plane/utils\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// extensions\nimport {\n  findTable,\n  getTableHeightPx,\n  getTableWidthPx,\n  isCellSelection,\n  selectRow,\n} from \"@/extensions/table/table/utilities/helpers\";\n// local imports\nimport { moveSelectedRows } from \"../actions\";\nimport {\n  DROP_MARKER_THICKNESS,\n  getDropMarker,\n  getRowDragMarker,\n  hideDragMarker,\n  hideDropMarker,\n  updateRowDragMarker,\n  updateRowDropMarker,\n} from \"../marker-utils\";\nimport { updateCellContentVisibility } from \"../utils\";\nimport { RowOptionsDropdown } from \"./dropdown\";\nimport { calculateRowDropIndex, constructRowDragPreview, getTableRowNodesInfo } from \"./utils\";\n\nexport type RowDragHandleProps = {\n  editor: Editor;\n  row: number;\n};\n\nexport function RowDragHandle(props: RowDragHandleProps) {\n  const { editor, row } = props;\n  // states\n  const [isDropdownOpen, setIsDropdownOpen] = useState(false);\n  // floating ui\n  const { refs, floatingStyles, context } = useFloating({\n    placement: \"bottom-start\",\n    middleware: [\n      flip({\n        fallbackPlacements: [\"top-start\", \"bottom-start\", \"top-end\", \"bottom-end\"],\n      }),\n      shift({\n        padding: 8,\n      }),\n    ],\n    open: isDropdownOpen,\n    onOpenChange: (open) => {\n      setIsDropdownOpen(open);\n      if (open) {\n        editor.commands.addActiveDropbarExtension(CORE_EXTENSIONS.TABLE);\n      } else {\n        setTimeout(() => {\n          editor.commands.removeActiveDropbarExtension(CORE_EXTENSIONS.TABLE);\n        }, 0);\n      }\n    },\n    whileElementsMounted: autoUpdate,\n  });\n  const click = useClick(context);\n  const dismiss = useDismiss(context);\n  const role = useRole(context);\n  const { getReferenceProps, getFloatingProps } = useInteractions([dismiss, click, role]);\n\n  useEffect(() => {\n    if (!isDropdownOpen) return;\n    const handleKeyDown = (event: KeyboardEvent) => {\n      context.onOpenChange(false);\n      event.preventDefault();\n      event.stopPropagation();\n    };\n    document.addEventListener(\"keydown\", handleKeyDown);\n    return () => document.removeEventListener(\"keydown\", handleKeyDown);\n  }, [isDropdownOpen, context]);\n\n  const handleMouseDown = useCallback(\n    (e: React.MouseEvent<HTMLButtonElement>) => {\n      e.stopPropagation();\n      e.preventDefault();\n\n      const table = findTable(editor.state.selection);\n      if (!table) return;\n\n      editor.view.dispatch(selectRow(table, row, editor.state.tr));\n\n      // drag row\n      const tableHeightPx = getTableHeightPx(table, editor);\n      const rows = getTableRowNodesInfo(table, editor);\n\n      let dropIndex = row;\n      const startTop = rows[row].top ?? 0;\n      const startY = e.clientY;\n      const tableElement = editor.view.nodeDOM(table.pos);\n\n      const dropMarker = tableElement instanceof HTMLElement ? getDropMarker(tableElement) : null;\n      const dragMarker = tableElement instanceof HTMLElement ? getRowDragMarker(tableElement) : null;\n\n      const handleFinish = (): void => {\n        if (!dropMarker || !dragMarker) return;\n        hideDropMarker(dropMarker);\n        hideDragMarker(dragMarker);\n\n        if (isCellSelection(editor.state.selection)) {\n          updateCellContentVisibility(editor, false);\n        }\n\n        if (row !== dropIndex) {\n          let tr = editor.state.tr;\n          const selection = editor.state.selection;\n          if (isCellSelection(selection)) {\n            const table = findTable(selection);\n            if (table) {\n              tr = moveSelectedRows(editor, table, selection, dropIndex, tr);\n            }\n          }\n          editor.view.dispatch(tr);\n        }\n        window.removeEventListener(\"mouseup\", handleFinish);\n        window.removeEventListener(\"mousemove\", handleMove);\n      };\n\n      let pseudoRow: HTMLElement | undefined;\n\n      const handleMove = (moveEvent: MouseEvent): void => {\n        if (!dropMarker || !dragMarker) return;\n        const cursorTop = startTop + moveEvent.clientY - startY;\n        dropIndex = calculateRowDropIndex(row, rows, cursorTop);\n\n        if (!pseudoRow) {\n          pseudoRow = constructRowDragPreview(editor, editor.state.selection, table);\n          const tableWidthPx = getTableWidthPx(table, editor);\n          if (pseudoRow) {\n            pseudoRow.style.width = `${tableWidthPx}px`;\n          }\n        }\n\n        const dragMarkerHeightPx = rows[row].height;\n        const dragMarkerTopPx = Math.max(0, Math.min(cursorTop, tableHeightPx - dragMarkerHeightPx));\n        const dropMarkerTopPx = dropIndex <= row ? rows[dropIndex].top : rows[dropIndex].top + rows[dropIndex].height;\n\n        updateRowDropMarker({\n          element: dropMarker,\n          top: dropMarkerTopPx - DROP_MARKER_THICKNESS / 2,\n          height: DROP_MARKER_THICKNESS,\n        });\n        updateRowDragMarker({\n          element: dragMarker,\n          top: dragMarkerTopPx,\n          height: dragMarkerHeightPx,\n          pseudoRow,\n        });\n      };\n\n      try {\n        window.addEventListener(\"mouseup\", handleFinish);\n        window.addEventListener(\"mousemove\", handleMove);\n      } catch (error) {\n        console.error(\"Error in RowDragHandle:\", error);\n        handleFinish();\n      }\n    },\n    [editor, row]\n  );\n\n  return (\n    <>\n      <div className=\"table-row-handle-container absolute z-20 top-0 left-0 flex justify-center items-center h-full -translate-x-1/2\">\n        <button\n          ref={refs.setReference}\n          {...getReferenceProps()}\n          type=\"button\"\n          onMouseDown={handleMouseDown}\n          className={cn(\n            \"py-1 bg-custom-background-90 border border-custom-border-400 rounded outline-none transition-all duration-200\",\n            {\n              \"!opacity-100 bg-custom-primary-100 border-custom-primary-100\": isDropdownOpen,\n              \"hover:bg-custom-background-80\": !isDropdownOpen,\n            }\n          )}\n        >\n          <Ellipsis className=\"size-4 text-custom-text-100 rotate-90\" />\n        </button>\n      </div>\n      {isDropdownOpen && (\n        <FloatingPortal>\n          {/* Backdrop */}\n          <FloatingOverlay\n            style={{\n              zIndex: 99,\n            }}\n            lockScroll\n          />\n          <div\n            className=\"max-h-[90vh] w-[12rem] overflow-y-auto rounded-md border-[0.5px] border-custom-border-300 bg-custom-background-100 px-2 py-2.5 shadow-custom-shadow-rg\"\n            ref={refs.setFloating}\n            {...getFloatingProps()}\n            style={{\n              ...floatingStyles,\n              zIndex: 100,\n            }}\n          >\n            <RowOptionsDropdown editor={editor} onClose={() => context.onOpenChange(false)} />\n          </div>\n        </FloatingPortal>\n      )}\n    </>\n  );\n}\n","import type { Editor } from \"@tiptap/core\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\nimport { TableMap } from \"@tiptap/pm/tables\";\nimport { Decoration, DecorationSet } from \"@tiptap/pm/view\";\nimport { ReactRenderer } from \"@tiptap/react\";\n// extensions\nimport {\n  findTable,\n  getTableCellWidgetDecorationPos,\n  haveTableRelatedChanges,\n} from \"@/extensions/table/table/utilities/helpers\";\n// local imports\nimport type { RowDragHandleProps } from \"./drag-handle\";\nimport { RowDragHandle } from \"./drag-handle\";\n\ntype TableRowDragHandlePluginState = {\n  decorations?: DecorationSet;\n  // track table structure to detect changes\n  tableHeight?: number;\n  tableNodePos?: number;\n};\n\nconst TABLE_ROW_DRAG_HANDLE_PLUGIN_KEY = new PluginKey(\"tableRowDragHandlePlugin\");\n\nexport const TableRowDragHandlePlugin = (editor: Editor): Plugin<TableRowDragHandlePluginState> =>\n  new Plugin<TableRowDragHandlePluginState>({\n    key: TABLE_ROW_DRAG_HANDLE_PLUGIN_KEY,\n    state: {\n      init: () => ({}),\n      apply(tr, prev, oldState, newState) {\n        const table = findTable(newState.selection);\n        if (!haveTableRelatedChanges(editor, table, oldState, newState, tr)) {\n          return table !== undefined ? prev : {};\n        }\n\n        const tableMap = TableMap.get(table.node);\n\n        // Check if table structure changed (height or position)\n        const tableStructureChanged = prev.tableHeight !== tableMap.height || prev.tableNodePos !== table.pos;\n\n        let isStale = tableStructureChanged;\n\n        // Only do position-based stale check if structure hasn't changed\n        if (!isStale) {\n          const mapped = prev.decorations?.map(tr.mapping, tr.doc);\n          for (let row = 0; row < tableMap.height; row++) {\n            const pos = getTableCellWidgetDecorationPos(table, tableMap, row * tableMap.width);\n            if (mapped?.find(pos, pos + 1)?.length !== 1) {\n              isStale = true;\n              break;\n            }\n          }\n        }\n\n        if (!isStale) {\n          const mapped = prev.decorations?.map(tr.mapping, tr.doc);\n          return {\n            decorations: mapped,\n            tableHeight: tableMap.height,\n            tableNodePos: table.pos,\n          };\n        }\n\n        // recreate all decorations\n        const decorations: Decoration[] = [];\n\n        for (let row = 0; row < tableMap.height; row++) {\n          const pos = getTableCellWidgetDecorationPos(table, tableMap, row * tableMap.width);\n\n          const dragHandleComponent = new ReactRenderer(RowDragHandle, {\n            props: {\n              editor,\n              row,\n            } satisfies RowDragHandleProps,\n            editor,\n          });\n\n          decorations.push(Decoration.widget(pos, () => dragHandleComponent.element));\n        }\n\n        return {\n          decorations: DecorationSet.create(newState.doc, decorations),\n          tableHeight: tableMap.height,\n          tableNodePos: table.pos,\n        };\n      },\n    },\n    props: {\n      decorations(state) {\n        return TABLE_ROW_DRAG_HANDLE_PLUGIN_KEY.getState(state).decorations;\n      },\n    },\n  });\n","import type { Editor } from \"@tiptap/core\";\nimport type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\nimport { addColumn, removeColumn, addRow, removeRow, TableMap } from \"@tiptap/pm/tables\";\nimport type { TableRect } from \"@tiptap/pm/tables\";\n// local imports\nimport { isCellEmpty } from \"../../table/utilities/helpers\";\n\nconst addSvg = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n<path\n  d=\"M8.5 7.49988V3.49988C8.5 3.22374 8.27614 2.99988 8 2.99988C7.72386 2.99988 7.5 3.22374 7.5 3.49988L7.5 7.49988L3.5 7.49988C3.22386 7.49988 3 7.72374 3 7.99988C3 8.27602 3.22386 8.49988 3.5 8.49988H7.5L7.5 12.4999C7.5 12.776 7.72386 12.9999 8 12.9999C8.27614 12.9999 8.5 12.776 8.5 12.4999L8.5 8.49988L12.5 8.49988C12.7761 8.49988 13 8.27602 13 7.99988C13 7.72374 12.7761 7.49988 12.5 7.49988L8.5 7.49988Z\"\n  fill=\"currentColor\"\n/>\n</svg>`;\n\nexport type TableInfo = {\n  tableElement: HTMLElement;\n  tableNode: ProseMirrorNode;\n  tablePos: number;\n  columnButtonElement?: HTMLElement;\n  rowButtonElement?: HTMLElement;\n  dragMarkerContainerElement?: HTMLElement;\n};\n\nexport const createColumnInsertButton = (editor: Editor, tableInfo: TableInfo): HTMLElement => {\n  const button = document.createElement(\"button\");\n  button.type = \"button\";\n  button.className = \"table-column-insert-button\";\n  button.title = \"Insert columns\";\n  button.ariaLabel = \"Insert columns\";\n\n  const icon = document.createElement(\"span\");\n  icon.innerHTML = addSvg;\n  button.appendChild(icon);\n\n  let mouseDownX = 0;\n  let isDragging = false;\n  let dragStarted = false;\n  let lastActionX = 0;\n  const DRAG_THRESHOLD = 5; // pixels to start drag\n  const ACTION_THRESHOLD = 150; // pixels total distance to trigger action\n\n  const onMouseDown = (e: MouseEvent) => {\n    if (e.button !== 0) return; // Only left mouse button\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    mouseDownX = e.clientX;\n    lastActionX = e.clientX;\n    isDragging = false;\n    dragStarted = false;\n\n    document.addEventListener(\"mousemove\", onMouseMove);\n    document.addEventListener(\"mouseup\", onMouseUp);\n  };\n\n  const onMouseMove = (e: MouseEvent) => {\n    const deltaX = e.clientX - mouseDownX;\n    const distance = Math.abs(deltaX);\n\n    // Start dragging if moved more than threshold\n    if (!isDragging && distance > DRAG_THRESHOLD) {\n      isDragging = true;\n      dragStarted = true;\n\n      // Visual feedback\n      button.classList.add(\"dragging\");\n      document.body.style.userSelect = \"none\";\n    }\n\n    if (isDragging) {\n      const totalDistance = Math.abs(e.clientX - lastActionX);\n\n      // Only trigger action when total distance reaches threshold\n      if (totalDistance >= ACTION_THRESHOLD) {\n        // Determine direction based on current movement relative to last action point\n        const directionFromLastAction = e.clientX - lastActionX;\n\n        // Right direction - add columns\n        if (directionFromLastAction > 0) {\n          insertColumnAfterLast(editor, tableInfo);\n          lastActionX = e.clientX; // Reset action point\n        }\n        // Left direction - delete empty columns\n        else if (directionFromLastAction < 0) {\n          const deleted = removeLastColumn(editor, tableInfo);\n          if (deleted) {\n            lastActionX = e.clientX; // Reset action point\n          }\n        }\n      }\n    }\n  };\n\n  const onMouseUp = () => {\n    document.removeEventListener(\"mousemove\", onMouseMove);\n    document.removeEventListener(\"mouseup\", onMouseUp);\n\n    if (isDragging) {\n      // Clean up drag state\n      button.classList.remove(\"dragging\");\n      document.body.style.cursor = \"\";\n      document.body.style.userSelect = \"\";\n    } else if (!dragStarted) {\n      // Handle as click if no dragging occurred\n      insertColumnAfterLast(editor, tableInfo);\n    }\n\n    isDragging = false;\n    dragStarted = false;\n  };\n\n  button.addEventListener(\"mousedown\", onMouseDown);\n\n  // Prevent context menu and text selection\n  button.addEventListener(\"contextmenu\", (e) => e.preventDefault());\n  button.addEventListener(\"selectstart\", (e) => e.preventDefault());\n\n  return button;\n};\n\nexport const createRowInsertButton = (editor: Editor, tableInfo: TableInfo): HTMLElement => {\n  const button = document.createElement(\"button\");\n  button.type = \"button\";\n  button.className = \"table-row-insert-button\";\n  button.title = \"Insert rows\";\n  button.ariaLabel = \"Insert rows\";\n\n  const icon = document.createElement(\"span\");\n  icon.innerHTML = addSvg;\n  button.appendChild(icon);\n\n  let mouseDownY = 0;\n  let isDragging = false;\n  let dragStarted = false;\n  let lastActionY = 0;\n  const DRAG_THRESHOLD = 5; // pixels to start drag\n  const ACTION_THRESHOLD = 40; // pixels total distance to trigger action\n\n  const onMouseDown = (e: MouseEvent) => {\n    if (e.button !== 0) return; // Only left mouse button\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    mouseDownY = e.clientY;\n    lastActionY = e.clientY;\n    isDragging = false;\n    dragStarted = false;\n\n    document.addEventListener(\"mousemove\", onMouseMove);\n    document.addEventListener(\"mouseup\", onMouseUp);\n  };\n\n  const onMouseMove = (e: MouseEvent) => {\n    const deltaY = e.clientY - mouseDownY;\n    const distance = Math.abs(deltaY);\n\n    // Start dragging if moved more than threshold\n    if (!isDragging && distance > DRAG_THRESHOLD) {\n      isDragging = true;\n      dragStarted = true;\n\n      // Visual feedback\n      button.classList.add(\"dragging\");\n      document.body.style.userSelect = \"none\";\n    }\n\n    if (isDragging) {\n      const totalDistance = Math.abs(e.clientY - lastActionY);\n\n      // Only trigger action when total distance reaches threshold\n      if (totalDistance >= ACTION_THRESHOLD) {\n        // Determine direction based on current movement relative to last action point\n        const directionFromLastAction = e.clientY - lastActionY;\n\n        // Down direction - add rows\n        if (directionFromLastAction > 0) {\n          insertRowAfterLast(editor, tableInfo);\n          lastActionY = e.clientY; // Reset action point\n        }\n        // Up direction - delete empty rows\n        else if (directionFromLastAction < 0) {\n          const deleted = removeLastRow(editor, tableInfo);\n          if (deleted) {\n            lastActionY = e.clientY; // Reset action point\n          }\n        }\n      }\n    }\n  };\n\n  const onMouseUp = () => {\n    document.removeEventListener(\"mousemove\", onMouseMove);\n    document.removeEventListener(\"mouseup\", onMouseUp);\n\n    if (isDragging) {\n      // Clean up drag state\n      button.classList.remove(\"dragging\");\n      document.body.style.cursor = \"\";\n      document.body.style.userSelect = \"\";\n    } else if (!dragStarted) {\n      // Handle as click if no dragging occurred\n      insertRowAfterLast(editor, tableInfo);\n    }\n\n    isDragging = false;\n    dragStarted = false;\n  };\n\n  button.addEventListener(\"mousedown\", onMouseDown);\n\n  // Prevent context menu and text selection\n  button.addEventListener(\"contextmenu\", (e) => e.preventDefault());\n  button.addEventListener(\"selectstart\", (e) => e.preventDefault());\n\n  return button;\n};\n\nexport const findAllTables = (editor: Editor): TableInfo[] => {\n  const tables: TableInfo[] = [];\n  const tableElements = editor.view.dom.querySelectorAll(\"table\");\n\n  tableElements.forEach((tableElement) => {\n    // Find the table's ProseMirror position\n    let tablePos = -1;\n    let tableNode: ProseMirrorNode | null = null;\n\n    // Walk through the document to find matching table nodes\n    editor.state.doc.descendants((node, pos) => {\n      if (node.type.spec.tableRole === \"table\") {\n        const domAtPos = editor.view.domAtPos(pos + 1);\n        let domTable = domAtPos.node;\n\n        // Navigate to find the table element\n        while (domTable && domTable.parentNode && domTable.nodeType !== Node.ELEMENT_NODE) {\n          domTable = domTable.parentNode;\n        }\n\n        while (domTable && domTable.parentNode && (domTable as HTMLElement).tagName !== \"TABLE\") {\n          domTable = domTable.parentNode;\n        }\n\n        if (domTable === tableElement) {\n          tablePos = pos;\n          tableNode = node;\n          return false; // Stop iteration\n        }\n      }\n    });\n\n    if (tablePos !== -1 && tableNode) {\n      tables.push({\n        tableElement,\n        tableNode,\n        tablePos,\n      });\n    }\n  });\n\n  return tables;\n};\n\nconst getCurrentTableInfo = (editor: Editor, tableInfo: TableInfo): TableInfo => {\n  // Refresh table info to get latest state\n  const tables = findAllTables(editor);\n  const updated = tables.find((t) => t.tableElement === tableInfo.tableElement);\n  return updated || tableInfo;\n};\n\n// Column functions\nconst insertColumnAfterLast = (editor: Editor, tableInfo: TableInfo) => {\n  const currentTableInfo = getCurrentTableInfo(editor, tableInfo);\n  const { tableNode, tablePos } = currentTableInfo;\n  const tableMapData = TableMap.get(tableNode);\n  const lastColumnIndex = tableMapData.width;\n\n  const tr = editor.state.tr;\n  const rect: TableRect = {\n    map: tableMapData,\n    tableStart: tablePos,\n    table: tableNode,\n    top: 0,\n    left: 0,\n    bottom: tableMapData.height - 1,\n    right: tableMapData.width - 1,\n  };\n\n  const newTr = addColumn(tr, rect, lastColumnIndex);\n  editor.view.dispatch(newTr);\n};\n\nconst removeLastColumn = (editor: Editor, tableInfo: TableInfo): boolean => {\n  const currentTableInfo = getCurrentTableInfo(editor, tableInfo);\n  const { tableNode, tablePos } = currentTableInfo;\n  const tableMapData = TableMap.get(tableNode);\n\n  // Don't delete if only one column left\n  if (tableMapData.width <= 1) {\n    return false;\n  }\n\n  const lastColumnIndex = tableMapData.width - 1;\n\n  // Check if last column is empty\n  if (!isColumnEmpty(currentTableInfo, lastColumnIndex)) {\n    return false;\n  }\n\n  const tr = editor.state.tr;\n  const rect = {\n    map: tableMapData,\n    tableStart: tablePos,\n    table: tableNode,\n    top: 0,\n    left: 0,\n    bottom: tableMapData.height - 1,\n    right: tableMapData.width - 1,\n  };\n\n  removeColumn(tr, rect, lastColumnIndex);\n  editor.view.dispatch(tr);\n  return true;\n};\n\nconst isColumnEmpty = (tableInfo: TableInfo, columnIndex: number): boolean => {\n  const { tableNode } = tableInfo;\n  const tableMapData = TableMap.get(tableNode);\n\n  // Check each cell in the column\n  for (let row = 0; row < tableMapData.height; row++) {\n    const cellIndex = row * tableMapData.width + columnIndex;\n    const cellPos = tableMapData.map[cellIndex];\n    const cell = tableNode.nodeAt(cellPos);\n\n    if (!isCellEmpty(cell)) {\n      return false;\n    }\n  }\n  return true;\n};\n\n// Row functions\nconst insertRowAfterLast = (editor: Editor, tableInfo: TableInfo) => {\n  const currentTableInfo = getCurrentTableInfo(editor, tableInfo);\n  const { tableNode, tablePos } = currentTableInfo;\n  const tableMapData = TableMap.get(tableNode);\n  const lastRowIndex = tableMapData.height;\n\n  const tr = editor.state.tr;\n  const rect: TableRect = {\n    map: tableMapData,\n    tableStart: tablePos,\n    table: tableNode,\n    top: 0,\n    left: 0,\n    bottom: tableMapData.height - 1,\n    right: tableMapData.width - 1,\n  };\n\n  const newTr = addRow(tr, rect, lastRowIndex);\n  editor.view.dispatch(newTr);\n};\n\nconst removeLastRow = (editor: Editor, tableInfo: TableInfo): boolean => {\n  const currentTableInfo = getCurrentTableInfo(editor, tableInfo);\n  const { tableNode, tablePos } = currentTableInfo;\n  const tableMapData = TableMap.get(tableNode);\n\n  // Don't delete if only one row left\n  if (tableMapData.height <= 1) {\n    return false;\n  }\n\n  const lastRowIndex = tableMapData.height - 1;\n\n  // Check if last row is empty\n  if (!isRowEmpty(currentTableInfo, lastRowIndex)) {\n    return false;\n  }\n\n  const tr = editor.state.tr;\n  const rect = {\n    map: tableMapData,\n    tableStart: tablePos,\n    table: tableNode,\n    top: 0,\n    left: 0,\n    bottom: tableMapData.height - 1,\n    right: tableMapData.width - 1,\n  };\n\n  removeRow(tr, rect, lastRowIndex);\n  editor.view.dispatch(tr);\n  return true;\n};\n\nconst isRowEmpty = (tableInfo: TableInfo, rowIndex: number): boolean => {\n  const { tableNode } = tableInfo;\n  const tableMapData = TableMap.get(tableNode);\n\n  // Check each cell in the row\n  for (let col = 0; col < tableMapData.width; col++) {\n    const cellIndex = rowIndex * tableMapData.width + col;\n    const cellPos = tableMapData.map[cellIndex];\n    const cell = tableNode.nodeAt(cellPos);\n\n    if (!isCellEmpty(cell)) {\n      return false;\n    }\n  }\n  return true;\n};\n","import type { Editor } from \"@tiptap/core\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\n// local imports\nimport { COL_DRAG_MARKER_CLASS, DROP_MARKER_CLASS, ROW_DRAG_MARKER_CLASS } from \"../drag-handles/marker-utils\";\nimport type { TableInfo } from \"./utils\";\nimport { createColumnInsertButton, createRowInsertButton, findAllTables } from \"./utils\";\n\nconst TABLE_INSERT_PLUGIN_KEY = new PluginKey(\"table-insert\");\n\nexport const TableInsertPlugin = (editor: Editor): Plugin => {\n  const tableMap = new Map<HTMLElement, TableInfo>();\n\n  const setupTable = (tableInfo: TableInfo) => {\n    const { tableElement } = tableInfo;\n\n    // Create and add column button if it doesn't exist\n    if (!tableInfo.columnButtonElement) {\n      const columnButton = createColumnInsertButton(editor, tableInfo);\n      tableElement.appendChild(columnButton);\n      tableInfo.columnButtonElement = columnButton;\n    }\n\n    // Create and add row button if it doesn't exist\n    if (!tableInfo.rowButtonElement) {\n      const rowButton = createRowInsertButton(editor, tableInfo);\n      tableElement.appendChild(rowButton);\n      tableInfo.rowButtonElement = rowButton;\n    }\n\n    // Create and add drag marker if it doesn't exist\n    if (!tableInfo.dragMarkerContainerElement) {\n      const dragMarker = createMarkerContainer();\n      tableElement.appendChild(dragMarker);\n      tableInfo.dragMarkerContainerElement = dragMarker;\n    }\n\n    tableMap.set(tableElement, tableInfo);\n  };\n\n  const cleanupTable = (tableElement: HTMLElement) => {\n    const tableInfo = tableMap.get(tableElement);\n    tableInfo?.columnButtonElement?.remove();\n    tableInfo?.rowButtonElement?.remove();\n    tableInfo?.dragMarkerContainerElement?.remove();\n    tableMap.delete(tableElement);\n  };\n\n  const updateAllTables = () => {\n    if (!editor.isEditable) {\n      // Clean up all tables if editor is not editable\n      tableMap.forEach((_, tableElement) => {\n        cleanupTable(tableElement);\n      });\n      return;\n    }\n\n    const currentTables = findAllTables(editor);\n    const currentTableElements = new Set(currentTables.map((t) => t.tableElement));\n\n    // Remove buttons from tables that no longer exist\n    tableMap.forEach((_, tableElement) => {\n      if (!currentTableElements.has(tableElement)) {\n        cleanupTable(tableElement);\n      }\n    });\n\n    // Add buttons to new tables\n    currentTables.forEach((tableInfo) => {\n      if (!tableMap.has(tableInfo.tableElement)) {\n        setupTable(tableInfo);\n      }\n    });\n  };\n\n  return new Plugin({\n    key: TABLE_INSERT_PLUGIN_KEY,\n\n    view() {\n      setTimeout(updateAllTables, 0);\n\n      return {\n        update(view, prevState) {\n          // Update when document changes\n          if (!prevState.doc.eq(view.state.doc)) {\n            updateAllTables();\n          }\n        },\n        destroy() {\n          // Clean up all tables\n          tableMap.forEach((_, tableElement) => {\n            cleanupTable(tableElement);\n          });\n          tableMap.clear();\n        },\n      };\n    },\n  });\n};\n\nconst createMarkerContainer = (): HTMLElement => {\n  const el = document.createElement(\"div\");\n  el.className = \"table-drag-marker-container\";\n  el.contentEditable = \"false\";\n  el.appendChild(createDropMarker());\n  el.appendChild(createColDragMarker());\n  el.appendChild(createRowDragMarker());\n  return el;\n};\n\nconst createDropMarker = (): HTMLElement => {\n  const el = document.createElement(\"div\");\n  el.className = DROP_MARKER_CLASS;\n  return el;\n};\n\nconst createColDragMarker = (): HTMLElement => {\n  const el = document.createElement(\"div\");\n  el.className = `${COL_DRAG_MARKER_CLASS} hidden`;\n\n  return el;\n};\n\nconst createRowDragMarker = (): HTMLElement => {\n  const el = document.createElement(\"div\");\n  el.className = `${ROW_DRAG_MARKER_CLASS} hidden`;\n\n  return el;\n};\n","import type { Editor, NodeViewProps } from \"@tiptap/core\";\nimport type { Node as ProseMirrorNode, ResolvedPos } from \"@tiptap/pm/model\";\nimport { TableMap, updateColumnsOnResize } from \"@tiptap/pm/tables\";\nimport type { Decoration, NodeView } from \"@tiptap/pm/view\";\nimport { h } from \"jsx-dom-cjs\";\n\nexport class TableView implements NodeView {\n  node: ProseMirrorNode;\n  cellMinWidth: number;\n  decorations: readonly Decoration[];\n  editor: Editor;\n  getPos: NodeViewProps[\"getPos\"];\n  hoveredCell: ResolvedPos | null = null;\n  map: TableMap;\n  root: HTMLElement;\n  table: HTMLTableElement;\n  colgroup: HTMLTableColElement;\n  tbody: HTMLElement;\n  controls?: HTMLElement;\n\n  get dom() {\n    return this.root;\n  }\n\n  get contentDOM() {\n    return this.tbody;\n  }\n\n  constructor(\n    node: ProseMirrorNode,\n    cellMinWidth: number,\n    decorations: readonly Decoration[],\n    editor: Editor,\n    getPos: NodeViewProps[\"getPos\"]\n  ) {\n    this.node = node;\n    this.cellMinWidth = cellMinWidth;\n    this.decorations = decorations;\n    this.editor = editor;\n    this.getPos = getPos;\n    this.hoveredCell = null;\n    this.map = TableMap.get(node);\n\n    this.colgroup = h(\n      \"colgroup\",\n      null,\n      Array.from({ length: this.map.width }, () => 1).map(() => h(\"col\"))\n    );\n    this.tbody = h(\"tbody\");\n    this.table = h(\"table\", null, this.colgroup, this.tbody);\n\n    this.root = h(\n      \"div\",\n      {\n        className: \"table-wrapper editor-full-width-block horizontal-scrollbar scrollbar-sm\",\n      },\n      this.table\n    );\n\n    this.render();\n  }\n\n  update(node: ProseMirrorNode, decorations: readonly Decoration[]) {\n    if (node.type !== this.node.type) {\n      return false;\n    }\n\n    this.node = node;\n    this.decorations = [...decorations];\n    this.map = TableMap.get(this.node);\n\n    this.render();\n\n    return true;\n  }\n\n  render() {\n    if (this.colgroup.children.length !== this.map.width) {\n      const cols = Array.from({ length: this.map.width }, () => 1).map(() => h(\"col\"));\n      this.colgroup.replaceChildren(...cols);\n    }\n\n    updateColumnsOnResize(this.node, this.colgroup, this.table, this.cellMinWidth);\n  }\n\n  ignoreMutation() {\n    return true;\n  }\n}\n","import type { Fragment, Node as ProsemirrorNode, NodeType } from \"@tiptap/pm/model\";\n\nexport function createCell(\n  cellType: NodeType,\n  cellContent?: Fragment | ProsemirrorNode | Array<ProsemirrorNode>,\n  attrs?: Record<string, unknown>\n): ProsemirrorNode | null | undefined {\n  if (cellContent) {\n    return cellType.createChecked(attrs, cellContent);\n  }\n\n  return cellType.createAndFill(attrs);\n}\n","import type { NodeType, Schema } from \"@tiptap/pm/model\";\n\nexport function getTableNodeTypes(schema: Schema): { [key: string]: NodeType } {\n  if (schema.cached.tableNodeTypes) {\n    return schema.cached.tableNodeTypes;\n  }\n\n  const roles: { [key: string]: NodeType } = {};\n\n  Object.keys(schema.nodes).forEach((type) => {\n    const nodeType = schema.nodes[type];\n\n    if (nodeType.spec.tableRole) {\n      roles[nodeType.spec.tableRole] = nodeType;\n    }\n  });\n\n  schema.cached.tableNodeTypes = roles;\n\n  return roles;\n}\n","import type { Fragment, Node as ProsemirrorNode, Schema } from \"@tiptap/pm/model\";\n// extensions\nimport { createCell } from \"@/extensions/table/table/utilities/create-cell\";\nimport { getTableNodeTypes } from \"@/extensions/table/table/utilities/get-table-node-types\";\n\ntype Props = {\n  schema: Schema;\n  rowsCount: number;\n  colsCount: number;\n  withHeaderRow: boolean;\n  cellContent?: Fragment | ProsemirrorNode | Array<ProsemirrorNode>;\n  columnWidth: number;\n};\n\nexport const createTable = (props: Props): ProsemirrorNode => {\n  const { schema, rowsCount, colsCount, withHeaderRow, cellContent, columnWidth } = props;\n\n  const types = getTableNodeTypes(schema);\n  const headerCells: ProsemirrorNode[] = [];\n  const cells: ProsemirrorNode[] = [];\n\n  for (let index = 0; index < colsCount; index += 1) {\n    const cell = createCell(types.cell, cellContent, { colwidth: [columnWidth] });\n\n    if (cell) {\n      cells.push(cell);\n    }\n\n    if (withHeaderRow) {\n      const headerCell = createCell(types.header_cell, cellContent, { colwidth: [columnWidth] });\n\n      if (headerCell) {\n        headerCells.push(headerCell);\n      }\n    }\n  }\n\n  const rows: ProsemirrorNode[] = [];\n\n  for (let index = 0; index < rowsCount; index += 1) {\n    rows.push(types.row.createChecked(null, withHeaderRow && index === 0 ? headerCells : cells));\n  }\n\n  return types.table.createChecked(null, rows);\n};\n","import type { Command } from \"@tiptap/core\";\nimport { deleteColumn, deleteTable } from \"@tiptap/pm/tables\";\n// local imports\nimport { isCellSelection } from \"./helpers\";\n\nexport const deleteColumnOrTable: () => Command =\n  () =>\n  ({ state, dispatch }) => {\n    const { selection } = state;\n\n    // Check if we're in a table and have a cell selection\n    if (!isCellSelection(selection)) {\n      return false;\n    }\n\n    // Get the ProseMirrorTable and calculate total columns\n    const tableStart = selection.$anchorCell.start(-1);\n    const selectedTable = state.doc.nodeAt(tableStart - 1);\n\n    if (!selectedTable) return false;\n\n    // Count total columns by examining the first row\n    const firstRow = selectedTable.firstChild;\n    if (!firstRow) return false;\n\n    let totalColumns = 0;\n    for (let i = 0; i < firstRow.childCount; i++) {\n      const cell = firstRow.child(i);\n      totalColumns += cell.attrs.colspan || 1;\n    }\n\n    // If only one column exists, delete the entire ProseMirrorTable\n    if (totalColumns === 1) {\n      return deleteTable(state, dispatch);\n    }\n\n    // Otherwise, proceed with normal column deletion\n    return deleteColumn(state, dispatch);\n  };\n","import { findParentNodeClosestToPos } from \"@tiptap/core\";\nimport type { Editor, KeyboardShortcutCommand } from \"@tiptap/core\";\nimport type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\nimport type { CellSelection } from \"@tiptap/pm/tables\";\nimport { TableMap } from \"@tiptap/pm/tables\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// extensions\nimport { isCellEmpty, isCellSelection } from \"@/extensions/table/table/utilities/helpers\";\n\ntype CellCoord = {\n  row: number;\n  col: number;\n};\n\ntype TableInfo = {\n  node: ProseMirrorNode;\n  pos: number;\n  map: TableMap;\n  totalColumns: number;\n  totalRows: number;\n};\n\nexport const handleDeleteKeyOnTable: KeyboardShortcutCommand = (props) => {\n  const { editor } = props;\n  const { selection } = editor.state;\n\n  try {\n    if (!isCellSelection(selection)) return false;\n\n    const tableInfo = getTableInfo(editor);\n    if (!tableInfo) return false;\n\n    const selectedCellCoords = getSelectedCellCoords(selection, tableInfo);\n    if (selectedCellCoords.length === 0) return false;\n\n    const hasContent = checkCellsHaveContent(selection);\n    if (hasContent) return false;\n\n    const selectionBounds = calculateSelectionBounds(selectedCellCoords);\n    const { totalColumnsInSelection, totalRowsInSelection, minRow, minCol } = selectionBounds;\n\n    // Check if entire rows are selected\n    if (totalColumnsInSelection === tableInfo.totalColumns) {\n      return deleteMultipleRows(editor, totalRowsInSelection, minRow, tableInfo);\n    }\n\n    // Check if entire columns are selected\n    if (totalRowsInSelection === tableInfo.totalRows) {\n      return deleteMultipleColumns(editor, totalColumnsInSelection, minCol, tableInfo);\n    }\n\n    return false;\n  } catch (error) {\n    console.error(\"Error in handleDeleteKeyOnTable\", error);\n    return false;\n  }\n};\n\nconst getTableInfo = (editor: Editor): TableInfo | null => {\n  const table = findParentNodeClosestToPos(\n    editor.state.selection.ranges[0].$from,\n    (node) => node.type.name === CORE_EXTENSIONS.TABLE\n  );\n\n  if (!table) return null;\n\n  const tableMap = TableMap.get(table.node);\n  return {\n    node: table.node,\n    pos: table.pos,\n    map: tableMap,\n    totalColumns: tableMap.width,\n    totalRows: tableMap.height,\n  };\n};\n\nconst getSelectedCellCoords = (selection: CellSelection, tableInfo: TableInfo): CellCoord[] => {\n  const selectedCellCoords: CellCoord[] = [];\n\n  selection.forEachCell((_node, pos) => {\n    const cellStart = pos - tableInfo.pos - 1;\n    const coord = findCellCoordinate(cellStart, tableInfo);\n\n    if (coord) {\n      selectedCellCoords.push(coord);\n    }\n  });\n\n  return selectedCellCoords;\n};\n\nconst findCellCoordinate = (cellStart: number, tableInfo: TableInfo): CellCoord | null => {\n  // Primary method: use indexOf\n  const cellIndex = tableInfo.map.map.indexOf(cellStart);\n\n  if (cellIndex !== -1) {\n    return {\n      row: Math.floor(cellIndex / tableInfo.totalColumns),\n      col: cellIndex % tableInfo.totalColumns,\n    };\n  }\n\n  // Fallback: manual search\n  for (let i = 0; i < tableInfo.map.map.length; i++) {\n    if (tableInfo.map.map[i] === cellStart) {\n      return {\n        row: Math.floor(i / tableInfo.totalColumns),\n        col: i % tableInfo.totalColumns,\n      };\n    }\n  }\n\n  return null;\n};\n\nconst checkCellsHaveContent = (selection: CellSelection): boolean => {\n  let hasContent = false;\n\n  selection.forEachCell((node) => {\n    if (node && !isCellEmpty(node)) {\n      hasContent = true;\n    }\n  });\n\n  return hasContent;\n};\n\nconst calculateSelectionBounds = (selectedCellCoords: CellCoord[]) => {\n  const minRow = Math.min(...selectedCellCoords.map((c) => c.row));\n  const maxRow = Math.max(...selectedCellCoords.map((c) => c.row));\n  const minCol = Math.min(...selectedCellCoords.map((c) => c.col));\n  const maxCol = Math.max(...selectedCellCoords.map((c) => c.col));\n\n  return {\n    minRow,\n    maxRow,\n    minCol,\n    maxCol,\n    totalColumnsInSelection: maxCol - minCol + 1,\n    totalRowsInSelection: maxRow - minRow + 1,\n  };\n};\n\nconst deleteMultipleRows = (\n  editor: Editor,\n  totalRowsInSelection: number,\n  minRow: number,\n  initialTableInfo: TableInfo\n): boolean => {\n  // Position cursor at the first selected row\n  setCursorAtPosition(editor, initialTableInfo, minRow, 0);\n\n  // Delete rows one by one\n  for (let i = 0; i < totalRowsInSelection; i++) {\n    editor.commands.deleteRow();\n\n    // Reposition cursor if there are more rows to delete\n    if (i < totalRowsInSelection - 1) {\n      const updatedTableInfo = getTableInfo(editor);\n      if (updatedTableInfo) {\n        setCursorAtPosition(editor, updatedTableInfo, minRow, 0);\n      }\n    }\n  }\n\n  return true;\n};\n\nconst deleteMultipleColumns = (\n  editor: Editor,\n  totalColumnsInSelection: number,\n  minCol: number,\n  initialTableInfo: TableInfo\n): boolean => {\n  // Position cursor at the first selected column\n  setCursorAtPosition(editor, initialTableInfo, 0, minCol);\n\n  // Delete columns one by one\n  for (let i = 0; i < totalColumnsInSelection; i++) {\n    editor.commands.deleteColumn();\n\n    // Reposition cursor if there are more columns to delete\n    if (i < totalColumnsInSelection - 1) {\n      const updatedTableInfo = getTableInfo(editor);\n      if (updatedTableInfo) {\n        setCursorAtPosition(editor, updatedTableInfo, 0, minCol);\n      }\n    }\n  }\n\n  return true;\n};\n\nconst setCursorAtPosition = (editor: Editor, tableInfo: TableInfo, row: number, col: number): void => {\n  const cellIndex = row * tableInfo.totalColumns + col;\n  const cellPos = tableInfo.pos + tableInfo.map.map[cellIndex] + 1;\n\n  editor.commands.setCellSelection({\n    anchorCell: cellPos,\n    headCell: cellPos,\n  });\n};\n","import type { Command } from \"@tiptap/core\";\nimport { deleteRow, deleteTable } from \"@tiptap/pm/tables\";\n// local imports\nimport { isCellSelection } from \"./helpers\";\n\nexport const deleteRowOrTable: () => Command =\n  () =>\n  ({ state, dispatch }) => {\n    const { selection } = state;\n\n    // Check if we're in a ProseMirrorTable and have a cell selection\n    if (!isCellSelection(selection)) {\n      return false;\n    }\n\n    // Get the ProseMirrorTable and calculate total rows\n    const tableStart = selection.$anchorCell.start(-1);\n    const selectedTable = state.doc.nodeAt(tableStart - 1);\n\n    if (!selectedTable) return false;\n\n    // Count total rows by examining the table's children\n    const totalRows = selectedTable.childCount;\n\n    // If only one row exists, delete the entire ProseMirrorTable\n    if (totalRows === 1) {\n      return deleteTable(state, dispatch);\n    }\n\n    // Otherwise, proceed with normal row deletion\n    return deleteRow(state, dispatch);\n  };\n","import type { KeyboardShortcutCommand } from \"@tiptap/core\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// helpers\nimport { findParentNodeOfType } from \"@/helpers/common\";\n\nexport const insertLineAboveTableAction: KeyboardShortcutCommand = ({ editor }) => {\n  // Check if the current selection or the closest node is a table\n  if (!editor.isActive(CORE_EXTENSIONS.TABLE)) return false;\n\n  try {\n    // Get the current selection\n    const { selection } = editor.state;\n\n    // Find the table node and its position\n    const tableNode = findParentNodeOfType(selection, [CORE_EXTENSIONS.TABLE]);\n    if (!tableNode) return false;\n\n    const tablePos = tableNode.pos;\n\n    // Determine if the selection is in the first row of the table\n    const firstRow = tableNode.node.child(0);\n    const selectionPath = (selection.$anchor as any).path;\n    const selectionInFirstRow = selectionPath.includes(firstRow);\n\n    if (!selectionInFirstRow) return false;\n\n    // Check if the table is at the very start of the document or its parent node\n    if (tablePos === 0) {\n      // The table is at the start, so just insert a paragraph at the current position\n      editor.chain().insertContentAt(tablePos, { type: \"paragraph\" }).run();\n      editor\n        .chain()\n        .setTextSelection(tablePos + 1)\n        .run();\n    } else {\n      // The table is not at the start, check for the node immediately before the table\n      const prevNodePos = tablePos - 1;\n\n      if (prevNodePos <= 0) return false;\n\n      const prevNode = editor.state.doc.nodeAt(prevNodePos - 1);\n\n      if (prevNode && prevNode.type.name === CORE_EXTENSIONS.PARAGRAPH) {\n        // If there's a paragraph before the table, move the cursor to the end of that paragraph\n        const endOfParagraphPos = tablePos - prevNode.nodeSize;\n        editor.chain().setTextSelection(endOfParagraphPos).run();\n      } else {\n        return false;\n      }\n    }\n\n    return true;\n  } catch (e) {\n    console.error(\"failed to insert line above table\", e);\n    return false;\n  }\n};\n","import type { KeyboardShortcutCommand } from \"@tiptap/core\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// helpers\nimport { findParentNodeOfType } from \"@/helpers/common\";\n\nexport const insertLineBelowTableAction: KeyboardShortcutCommand = ({ editor }) => {\n  // Check if the current selection or the closest node is a table\n  if (!editor.isActive(CORE_EXTENSIONS.TABLE)) return false;\n\n  try {\n    // Get the current selection\n    const { selection } = editor.state;\n\n    // Find the table node and its position\n    const tableNode = findParentNodeOfType(selection, [CORE_EXTENSIONS.TABLE]);\n    if (!tableNode) return false;\n\n    const tablePos = tableNode.pos;\n    const table = tableNode.node;\n\n    // Determine if the selection is in the last row of the table\n    const rowCount = table.childCount;\n    const lastRow = table.child(rowCount - 1);\n    const selectionPath = (selection.$anchor as any).path;\n    const selectionInLastRow = selectionPath.includes(lastRow);\n\n    if (!selectionInLastRow) return false;\n\n    // Calculate the position immediately after the table\n    const nextNodePos = tablePos + table.nodeSize;\n\n    // Check for an existing node immediately after the table\n    const nextNode = editor.state.doc.nodeAt(nextNodePos);\n\n    if (nextNode && nextNode.type.name === CORE_EXTENSIONS.PARAGRAPH) {\n      // If the next node is an paragraph, move the cursor there\n      const endOfParagraphPos = nextNodePos + nextNode.nodeSize - 1;\n      editor.chain().setTextSelection(endOfParagraphPos).run();\n    } else if (!nextNode) {\n      // If the next node doesn't exist i.e. we're at the end of the document, create and insert a new empty node there\n      editor.chain().insertContentAt(nextNodePos, { type: CORE_EXTENSIONS.PARAGRAPH }).run();\n      editor\n        .chain()\n        .setTextSelection(nextNodePos + 1)\n        .run();\n    } else {\n      return false;\n    }\n\n    return true;\n  } catch (e) {\n    console.error(\"failed to insert line above table\", e);\n    return false;\n  }\n};\n","import type { ParentConfig } from \"@tiptap/core\";\nimport { callOrReturn, getExtensionField, mergeAttributes, Node } from \"@tiptap/core\";\nimport { TextSelection } from \"@tiptap/pm/state\";\nimport {\n  addColumnAfter,\n  addColumnBefore,\n  addRowAfter,\n  addRowBefore,\n  CellSelection,\n  columnResizing,\n  deleteCellSelection,\n  deleteTable,\n  fixTables,\n  goToNextCell,\n  mergeCells,\n  setCellAttr,\n  splitCell,\n  tableEditing,\n  toggleHeader,\n  toggleHeaderCell,\n} from \"@tiptap/pm/tables\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// local imports\nimport { TableColumnDragHandlePlugin } from \"../plugins/drag-handles/column/plugin\";\nimport { TableRowDragHandlePlugin } from \"../plugins/drag-handles/row/plugin\";\nimport { TableInsertPlugin } from \"../plugins/insert-handlers/plugin\";\nimport { TableView } from \"./table-view\";\nimport { createTable } from \"./utilities/create-table\";\nimport { deleteColumnOrTable } from \"./utilities/delete-column\";\nimport { handleDeleteKeyOnTable } from \"./utilities/delete-key-shortcut\";\nimport { deleteRowOrTable } from \"./utilities/delete-row\";\nimport { insertLineAboveTableAction } from \"./utilities/insert-line-above-table-action\";\nimport { insertLineBelowTableAction } from \"./utilities/insert-line-below-table-action\";\nimport { DEFAULT_COLUMN_WIDTH } from \".\";\n\ntype TableOptions = {\n  HTMLAttributes: Record<string, unknown>;\n  resizable: boolean;\n  handleWidth: number;\n  cellMinWidth: number;\n  lastColumnResizable: boolean;\n  allowTableNodeSelection: boolean;\n};\n\ndeclare module \"@tiptap/core\" {\n  interface Commands<ReturnType> {\n    [CORE_EXTENSIONS.TABLE]: {\n      insertTable: (options?: { rows?: number; cols?: number; withHeaderRow?: boolean }) => ReturnType;\n      addColumnBefore: () => ReturnType;\n      addColumnAfter: () => ReturnType;\n      deleteColumn: () => ReturnType;\n      addRowBefore: () => ReturnType;\n      addRowAfter: () => ReturnType;\n      deleteRow: () => ReturnType;\n      deleteTable: () => ReturnType;\n      mergeCells: () => ReturnType;\n      splitCell: () => ReturnType;\n      toggleHeaderColumn: () => ReturnType;\n      toggleHeaderRow: () => ReturnType;\n      toggleHeaderCell: () => ReturnType;\n      clearSelectedCells: () => ReturnType;\n      mergeOrSplit: () => ReturnType;\n      setCellAttribute: (name: string, value: any) => ReturnType;\n      goToNextCell: () => ReturnType;\n      goToPreviousCell: () => ReturnType;\n      fixTables: () => ReturnType;\n      setCellSelection: (position: { anchorCell: number; headCell?: number }) => ReturnType;\n    };\n  }\n\n  interface NodeConfig<Options, Storage> {\n    tableRole?:\n      | string\n      | ((this: {\n          name: string;\n          options: Options;\n          storage: Storage;\n          parent: ParentConfig<NodeConfig<Options>>[\"tableRole\"];\n        }) => string);\n  }\n}\n\nexport const Table = Node.create<TableOptions>({\n  name: CORE_EXTENSIONS.TABLE,\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n      resizable: true,\n      handleWidth: 5,\n      cellMinWidth: 100,\n      lastColumnResizable: true,\n      allowTableNodeSelection: true,\n    };\n  },\n\n  content: \"tableRow+\",\n\n  tableRole: \"table\",\n\n  isolating: true,\n\n  group: \"block\",\n\n  allowGapCursor: false,\n\n  parseHTML() {\n    return [{ tag: \"table\" }];\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\"table\", mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), [\"tbody\", 0]];\n  },\n\n  addCommands() {\n    return {\n      insertTable:\n        ({ rows = 3, cols = 3, withHeaderRow = false } = {}) =>\n        ({ tr, dispatch, editor }) => {\n          const node = createTable({\n            schema: editor.schema,\n            rowsCount: rows,\n            colsCount: cols,\n            withHeaderRow,\n            columnWidth: DEFAULT_COLUMN_WIDTH,\n          });\n          if (dispatch) {\n            const offset = tr.selection.anchor + 1;\n\n            tr.replaceSelectionWith(node)\n              .scrollIntoView()\n              .setSelection(TextSelection.near(tr.doc.resolve(offset)));\n          }\n\n          return true;\n        },\n      addColumnBefore:\n        () =>\n        ({ state, dispatch }) =>\n          addColumnBefore(state, dispatch),\n      addColumnAfter:\n        () =>\n        ({ state, dispatch }) =>\n          addColumnAfter(state, dispatch),\n      deleteColumn: deleteColumnOrTable,\n      addRowBefore:\n        () =>\n        ({ state, dispatch }) =>\n          addRowBefore(state, dispatch),\n      addRowAfter:\n        () =>\n        ({ state, dispatch }) =>\n          addRowAfter(state, dispatch),\n      deleteRow: deleteRowOrTable,\n      deleteTable:\n        () =>\n        ({ state, dispatch }) =>\n          deleteTable(state, dispatch),\n      mergeCells:\n        () =>\n        ({ state, dispatch }) =>\n          mergeCells(state, dispatch),\n      splitCell:\n        () =>\n        ({ state, dispatch }) =>\n          splitCell(state, dispatch),\n      toggleHeaderColumn:\n        () =>\n        ({ state, dispatch }) =>\n          toggleHeader(\"column\")(state, dispatch),\n      toggleHeaderRow:\n        () =>\n        ({ state, dispatch }) =>\n          toggleHeader(\"row\")(state, dispatch),\n      toggleHeaderCell:\n        () =>\n        ({ state, dispatch }) =>\n          toggleHeaderCell(state, dispatch),\n      clearSelectedCells:\n        () =>\n        ({ state, dispatch }) =>\n          deleteCellSelection(state, dispatch),\n      mergeOrSplit:\n        () =>\n        ({ state, dispatch }) => {\n          if (mergeCells(state, dispatch)) {\n            return true;\n          }\n\n          return splitCell(state, dispatch);\n        },\n      setCellAttribute:\n        (name, value) =>\n        ({ state, dispatch }) =>\n          setCellAttr(name, value)(state, dispatch),\n      goToNextCell:\n        () =>\n        ({ state, dispatch }) =>\n          goToNextCell(1)(state, dispatch),\n      goToPreviousCell:\n        () =>\n        ({ state, dispatch }) =>\n          goToNextCell(-1)(state, dispatch),\n      fixTables:\n        () =>\n        ({ state, dispatch }) => {\n          if (dispatch) {\n            fixTables(state);\n          }\n\n          return true;\n        },\n      setCellSelection:\n        (position) =>\n        ({ tr, dispatch }) => {\n          if (dispatch) {\n            const selection = CellSelection.create(tr.doc, position.anchorCell, position.headCell);\n            tr.setSelection(selection);\n          }\n          return true;\n        },\n    };\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      Tab: () => {\n        if (!this.editor.isActive(CORE_EXTENSIONS.TABLE)) return false;\n\n        if (this.editor.isActive(CORE_EXTENSIONS.LIST_ITEM) || this.editor.isActive(CORE_EXTENSIONS.TASK_ITEM)) {\n          return false;\n        }\n\n        if (this.editor.commands.goToNextCell()) {\n          return true;\n        }\n\n        if (!this.editor.can().addRowAfter()) {\n          return false;\n        }\n\n        return this.editor.chain().addRowAfter().goToNextCell().run();\n      },\n      \"Shift-Tab\": () => {\n        if (!this.editor.isActive(CORE_EXTENSIONS.TABLE)) return false;\n\n        if (this.editor.isActive(CORE_EXTENSIONS.LIST_ITEM) || this.editor.isActive(CORE_EXTENSIONS.TASK_ITEM)) {\n          return false;\n        }\n\n        return this.editor.commands.goToPreviousCell();\n      },\n      Backspace: handleDeleteKeyOnTable,\n      \"Mod-Backspace\": handleDeleteKeyOnTable,\n      Delete: handleDeleteKeyOnTable,\n      \"Mod-Delete\": handleDeleteKeyOnTable,\n      ArrowDown: insertLineBelowTableAction,\n      ArrowUp: insertLineAboveTableAction,\n    };\n  },\n\n  addNodeView() {\n    return ({ editor, node, decorations, getPos }) => {\n      const { cellMinWidth } = this.options;\n\n      return new TableView(node, cellMinWidth, decorations, editor, getPos);\n    };\n  },\n\n  addProseMirrorPlugins() {\n    const isResizable = this.options.resizable && this.editor.isEditable;\n\n    const plugins = [\n      tableEditing({\n        allowTableNodeSelection: this.options.allowTableNodeSelection,\n      }),\n      TableInsertPlugin(this.editor),\n      TableColumnDragHandlePlugin(this.editor),\n      TableRowDragHandlePlugin(this.editor),\n    ];\n\n    if (isResizable) {\n      plugins.unshift(\n        columnResizing({\n          handleWidth: this.options.handleWidth,\n          cellMinWidth: this.options.cellMinWidth,\n          // View: TableView,\n          lastColumnResizable: this.options.lastColumnResizable,\n        })\n      );\n    }\n\n    return plugins;\n  },\n\n  extendNodeSchema(extension) {\n    const context = {\n      name: extension.name,\n      options: extension.options,\n      storage: extension.storage,\n    };\n\n    return {\n      tableRole: callOrReturn(getExtensionField(extension, \"tableRole\", context)),\n    };\n  },\n});\n","export { Table } from \"./table\";\n\nexport const DEFAULT_COLUMN_WIDTH = 150;\n","import type { TableMap } from \"@tiptap/pm/tables\";\n\n/**\n * Calculates the positions of cells adjacent to a given cell in a table\n * @param cellStart - The start position of the current cell in the document\n * @param tableMap - ProseMirror's table mapping structure containing cell positions and dimensions\n * @returns Object with positions of adjacent cells (undefined if cell doesn't exist at table edge)\n */\nconst getAdjacentCellPositions = (\n  cellStart: number,\n  tableMap: TableMap\n): { top?: number; bottom?: number; left?: number; right?: number } => {\n  // Extract table dimensions\n  // width -> number of columns in the table\n  // height -> number of rows in the table\n  const { width, height } = tableMap;\n\n  // Find the index of our cell in the flat tableMap.map array\n  // tableMap.map contains start positions of all cells in row-by-row order\n  const cellIndex = tableMap.map.indexOf(cellStart);\n\n  // Safety check: if cell position not found in table map, return empty object\n  if (cellIndex === -1) return {};\n\n  // Convert flat array index to 2D grid coordinates\n  // row = which row the cell is in (0-based from top)\n  // col = which column the cell is in (0-based from left)\n  const row = Math.floor(cellIndex / width); // Integer division gives row number\n  const col = cellIndex % width; // Remainder gives column number\n\n  return {\n    // Top cell: same column, one row up\n    // Check if we're not in the first row (row > 0) before calculating\n    top: row > 0 ? tableMap.map[(row - 1) * width + col] : undefined,\n\n    // Bottom cell: same column, one row down\n    // Check if we're not in the last row (row < height - 1) before calculating\n    bottom: row < height - 1 ? tableMap.map[(row + 1) * width + col] : undefined,\n\n    // Left cell: same row, one column left\n    // Check if we're not in the first column (col > 0) before calculating\n    left: col > 0 ? tableMap.map[row * width + (col - 1)] : undefined,\n\n    // Right cell: same row, one column right\n    // Check if we're not in the last column (col < width - 1) before calculating\n    right: col < width - 1 ? tableMap.map[row * width + (col + 1)] : undefined,\n  };\n};\n\nexport const getCellBorderClasses = (cellStart: number, selectedCells: number[], tableMap: TableMap): string[] => {\n  const adjacent = getAdjacentCellPositions(cellStart, tableMap);\n  const classes: string[] = [];\n\n  // Add border-right if right cell is not selected or doesn't exist\n  if (adjacent.right === undefined || !selectedCells.includes(adjacent.right)) {\n    classes.push(\"selectedCell-border-right\");\n  }\n\n  // Add border-left if left cell is not selected or doesn't exist\n  if (adjacent.left === undefined || !selectedCells.includes(adjacent.left)) {\n    classes.push(\"selectedCell-border-left\");\n  }\n\n  // Add border-top if top cell is not selected or doesn't exist\n  if (adjacent.top === undefined || !selectedCells.includes(adjacent.top)) {\n    classes.push(\"selectedCell-border-top\");\n  }\n\n  // Add border-bottom if bottom cell is not selected or doesn't exist\n  if (adjacent.bottom === undefined || !selectedCells.includes(adjacent.bottom)) {\n    classes.push(\"selectedCell-border-bottom\");\n  }\n\n  return classes;\n};\n","import { findParentNode } from \"@tiptap/core\";\nimport type { Editor } from \"@tiptap/core\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\nimport { TableMap } from \"@tiptap/pm/tables\";\nimport { Decoration, DecorationSet } from \"@tiptap/pm/view\";\n// local imports\nimport { isCellSelection } from \"../../table/utilities/helpers\";\nimport { getCellBorderClasses } from \"./utils\";\n\ntype TableCellSelectionOutlinePluginState = {\n  decorations?: DecorationSet;\n};\n\nconst TABLE_SELECTION_OUTLINE_PLUGIN_KEY = new PluginKey(\"table-cell-selection-outline\");\n\nexport const TableCellSelectionOutlinePlugin = (editor: Editor): Plugin<TableCellSelectionOutlinePluginState> =>\n  new Plugin<TableCellSelectionOutlinePluginState>({\n    key: TABLE_SELECTION_OUTLINE_PLUGIN_KEY,\n    state: {\n      init: () => ({}),\n      apply(tr, prev, oldState, newState) {\n        if (!editor.isEditable) return {};\n        const table = findParentNode((node) => node.type.spec.tableRole === \"table\")(newState.selection);\n        const hasDocChanged = tr.docChanged || !newState.selection.eq(oldState.selection);\n        if (!table || !hasDocChanged) {\n          return table === undefined ? {} : prev;\n        }\n\n        const { selection } = newState;\n        if (!isCellSelection(selection)) return {};\n\n        const decorations: Decoration[] = [];\n        const tableMap = TableMap.get(table.node);\n        const selectedCells: number[] = [];\n\n        // First, collect all selected cell positions\n        selection.forEachCell((_node, pos) => {\n          const start = pos - table.pos - 1;\n          selectedCells.push(start);\n        });\n\n        // Then, add decorations with appropriate border classes\n        selection.forEachCell((node, pos) => {\n          const start = pos - table.pos - 1;\n          const classes = getCellBorderClasses(start, selectedCells, tableMap);\n\n          decorations.push(Decoration.node(pos, pos + node.nodeSize, { class: classes.join(\" \") }));\n        });\n\n        return {\n          decorations: DecorationSet.create(newState.doc, decorations),\n        };\n      },\n    },\n    props: {\n      decorations(state) {\n        return TABLE_SELECTION_OUTLINE_PLUGIN_KEY.getState(state).decorations;\n      },\n    },\n  });\n","import { mergeAttributes, Node } from \"@tiptap/core\";\nimport { TableMap } from \"@tiptap/pm/tables\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// helpers\nimport { findParentNodeOfType } from \"@/helpers/common\";\n// local imports\nimport { TableCellSelectionOutlinePlugin } from \"./plugins/selection-outline/plugin\";\nimport { DEFAULT_COLUMN_WIDTH } from \"./table\";\nimport { isCellSelection } from \"./table/utilities/helpers\";\n\ntype TableCellOptions = {\n  HTMLAttributes: Record<string, unknown>;\n};\n\nexport const TableCell = Node.create<TableCellOptions>({\n  name: CORE_EXTENSIONS.TABLE_CELL,\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n    };\n  },\n\n  content: \"block+\",\n\n  addAttributes() {\n    return {\n      colspan: {\n        default: 1,\n      },\n      rowspan: {\n        default: 1,\n      },\n      colwidth: {\n        default: [DEFAULT_COLUMN_WIDTH],\n        parseHTML: (element) => {\n          const colwidth = element.getAttribute(\"colwidth\");\n          const value = colwidth ? [parseInt(colwidth, 10)] : null;\n\n          return value;\n        },\n      },\n      background: {\n        default: null,\n      },\n      textColor: {\n        default: null,\n      },\n      hideContent: {\n        default: false,\n      },\n    };\n  },\n\n  tableRole: \"cell\",\n\n  isolating: true,\n\n  addProseMirrorPlugins() {\n    return [TableCellSelectionOutlinePlugin(this.editor)];\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      Backspace: ({ editor }) => {\n        const { state } = editor.view;\n        const { selection } = state;\n\n        if (isCellSelection(selection)) return false;\n\n        // Check if we're at the start of the cell\n        if (selection.from !== selection.to || selection.$head.parentOffset !== 0) return false;\n\n        // Find table and current cell\n        const tableNode = findParentNodeOfType(selection, [CORE_EXTENSIONS.TABLE])?.node;\n        const currentCellInfo = findParentNodeOfType(selection, [\n          CORE_EXTENSIONS.TABLE_CELL,\n          CORE_EXTENSIONS.TABLE_HEADER,\n        ]);\n        const currentCellNode = currentCellInfo?.node;\n        const cellPos = currentCellInfo?.pos;\n        const cellDepth = currentCellInfo?.depth;\n\n        if (!tableNode || !currentCellNode || cellPos === null || cellDepth === null) return false;\n\n        // Check if this is the only cell in the TableMap (1 row, 1 column)\n        const tableMap = TableMap.get(tableNode);\n        const isOnlyCell = tableMap.width === 1 && tableMap.height === 1;\n        if (!isOnlyCell) return false;\n\n        // Cell has content, select the entire cell\n        // Use the position that points to the cell node itself, not its content\n        const cellNodePos = selection.$head.before(cellDepth);\n\n        editor.commands.setCellSelection({\n          anchorCell: cellNodePos,\n          headCell: cellNodePos,\n        });\n        return true;\n      },\n    };\n  },\n\n  parseHTML() {\n    return [{ tag: \"td\" }];\n  },\n\n  renderHTML({ node, HTMLAttributes }) {\n    return [\n      \"td\",\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, {\n        class: node.attrs.hideContent ? \"content-hidden\" : \"\",\n        style: `background-color: ${node.attrs.background}; color: ${node.attrs.textColor};`,\n      }),\n      0,\n    ];\n  },\n});\n","import { mergeAttributes, Node } from \"@tiptap/core\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// local imports\nimport { DEFAULT_COLUMN_WIDTH } from \"./table\";\n\ntype TableHeaderOptions = {\n  HTMLAttributes: Record<string, unknown>;\n};\n\nexport const TableHeader = Node.create<TableHeaderOptions>({\n  name: CORE_EXTENSIONS.TABLE_HEADER,\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n    };\n  },\n\n  content: \"block+\",\n\n  addAttributes() {\n    return {\n      colspan: {\n        default: 1,\n      },\n      rowspan: {\n        default: 1,\n      },\n      colwidth: {\n        default: [DEFAULT_COLUMN_WIDTH],\n        parseHTML: (element) => {\n          const colwidth = element.getAttribute(\"colwidth\");\n          const value = colwidth ? [parseInt(colwidth, 10)] : null;\n\n          return value;\n        },\n      },\n      background: {\n        default: \"none\",\n      },\n      hideContent: {\n        default: false,\n      },\n    };\n  },\n\n  tableRole: \"header_cell\",\n\n  isolating: true,\n\n  parseHTML() {\n    return [{ tag: \"th\" }];\n  },\n\n  renderHTML({ node, HTMLAttributes }) {\n    return [\n      \"th\",\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, {\n        class: node.attrs.hideContent ? \"content-hidden\" : \"\",\n        style: `background-color: ${node.attrs.background};`,\n      }),\n      0,\n    ];\n  },\n});\n","import { mergeAttributes, Node } from \"@tiptap/core\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n\ntype TableRowOptions = {\n  HTMLAttributes: Record<string, unknown>;\n};\n\nexport const TableRow = Node.create<TableRowOptions>({\n  name: CORE_EXTENSIONS.TABLE_ROW,\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n    };\n  },\n\n  addAttributes() {\n    return {\n      background: {\n        default: null,\n      },\n      textColor: {\n        default: null,\n      },\n    };\n  },\n\n  content: \"(tableCell | tableHeader)*\",\n\n  tableRole: \"row\",\n\n  parseHTML() {\n    return [{ tag: \"tr\" }];\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    const style = HTMLAttributes.background\n      ? `background-color: ${HTMLAttributes.background}; color: ${HTMLAttributes.textColor}`\n      : \"\";\n\n    const attributes = mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, { style });\n\n    return [\"tr\", attributes, 0];\n  },\n});\n","import { mergeAttributes, Node } from \"@tiptap/core\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n\nexport const WorkItemEmbedExtensionConfig = Node.create({\n  name: CORE_EXTENSIONS.WORK_ITEM_EMBED,\n  group: \"block\",\n  atom: true,\n  selectable: true,\n  draggable: true,\n\n  addAttributes() {\n    return {\n      entity_identifier: {\n        default: undefined,\n      },\n      project_identifier: {\n        default: undefined,\n      },\n      workspace_identifier: {\n        default: undefined,\n      },\n      id: {\n        default: undefined,\n      },\n      entity_name: {\n        default: undefined,\n      },\n    };\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: \"issue-embed-component\",\n      },\n    ];\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\"issue-embed-component\", mergeAttributes(HTMLAttributes)];\n  },\n});\n","import type { Extensions } from \"@tiptap/core\";\n\nexport const CoreEditorAdditionalExtensionsWithoutProps: Extensions = [];\n","import { Selection } from \"@tiptap/pm/state\";\nimport ts from \"highlight.js/lib/languages/typescript\";\nimport { common, createLowlight } from \"lowlight\";\n// components\nimport { CodeBlockLowlight } from \"./code-block-lowlight\";\n\nconst lowlight = createLowlight(common);\nlowlight.register(\"ts\", ts);\n\nexport const CustomCodeBlockExtensionWithoutProps = CodeBlockLowlight.extend({\n  addKeyboardShortcuts() {\n    return {\n      Tab: ({ editor }) => {\n        try {\n          const { state } = editor;\n          const { selection } = state;\n          const { $from, empty } = selection;\n\n          if (!empty || $from.parent.type !== this.type) {\n            return false;\n          }\n\n          // Use ProseMirror's insertText transaction to insert the tab character\n          const tr = state.tr.insertText(\"\\t\", $from.pos, $from.pos);\n          editor.view.dispatch(tr);\n\n          return true;\n        } catch (error) {\n          console.error(\"Error handling Tab in CustomCodeBlockExtension:\", error);\n          return false;\n        }\n      },\n      ArrowUp: ({ editor }) => {\n        try {\n          const { state } = editor;\n          const { selection } = state;\n          const { $from, empty } = selection;\n\n          if (!empty || $from.parent.type !== this.type) {\n            return false;\n          }\n\n          const isAtStart = $from.parentOffset === 0;\n\n          if (!isAtStart) {\n            return false;\n          }\n\n          // Check if codeBlock is the first node\n          const isFirstNode = $from.depth === 1 && $from.index($from.depth - 1) === 0;\n\n          if (isFirstNode) {\n            // Insert a new paragraph at the start of the document and move the cursor to it\n            return editor.commands.command(({ tr }) => {\n              const node = editor.schema.nodes.paragraph.create();\n              tr.insert(0, node);\n              tr.setSelection(Selection.near(tr.doc.resolve(1)));\n              return true;\n            });\n          }\n\n          return false;\n        } catch (error) {\n          console.error(\"Error handling ArrowUp in CustomCodeBlockExtension:\", error);\n          return false;\n        }\n      },\n      ArrowDown: ({ editor }) => {\n        try {\n          if (!this.options.exitOnArrowDown) {\n            return false;\n          }\n\n          const { state } = editor;\n          const { selection, doc } = state;\n          const { $from, empty } = selection;\n\n          if (!empty || $from.parent.type !== this.type) {\n            return false;\n          }\n\n          const isAtEnd = $from.parentOffset === $from.parent.nodeSize - 2;\n\n          if (!isAtEnd) {\n            return false;\n          }\n\n          const after = $from.after();\n\n          if (after === undefined) {\n            return false;\n          }\n\n          const nodeAfter = doc.nodeAt(after);\n\n          if (nodeAfter) {\n            return editor.commands.command(({ tr }) => {\n              tr.setSelection(Selection.near(doc.resolve(after)));\n              return true;\n            });\n          }\n\n          return editor.commands.exitCode();\n        } catch (error) {\n          console.error(\"Error handling ArrowDown in CustomCodeBlockExtension:\", error);\n          return false;\n        }\n      },\n    };\n  },\n}).configure({\n  lowlight,\n  defaultLanguage: \"plaintext\",\n  exitOnTripleEnter: false,\n});\n","import { Mark, mergeAttributes } from \"@tiptap/core\";\n// constants\nimport { COLORS_LIST } from \"@/constants/common\";\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n\ndeclare module \"@tiptap/core\" {\n  interface Commands<ReturnType> {\n    [CORE_EXTENSIONS.CUSTOM_COLOR]: {\n      /**\n       * Set the text color\n       * @param {string} color The color to set\n       * @example editor.commands.setTextColor('red')\n       */\n      setTextColor: (color: string) => ReturnType;\n\n      /**\n       * Unset the text color\n       * @example editor.commands.unsetTextColor()\n       */\n      unsetTextColor: () => ReturnType;\n      /**\n       * Set the background color\n       * @param {string} backgroundColor The color to set\n       * @example editor.commands.setBackgroundColor('red')\n       */\n      setBackgroundColor: (backgroundColor: string) => ReturnType;\n\n      /**\n       * Unset the background color\n       * @example editor.commands.unsetBackgroundColorColor()\n       */\n      unsetBackgroundColor: () => ReturnType;\n    };\n  }\n}\n\nexport const CustomColorExtension = Mark.create({\n  name: CORE_EXTENSIONS.CUSTOM_COLOR,\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n    };\n  },\n\n  addAttributes() {\n    return {\n      color: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.getAttribute(\"data-text-color\"),\n        renderHTML: (attributes: { color: string }) => {\n          const { color } = attributes;\n          if (!color) {\n            return {};\n          }\n\n          let elementAttributes: Record<string, string> = {\n            \"data-text-color\": color,\n          };\n\n          if (!COLORS_LIST.find((c) => c.key === color)) {\n            elementAttributes = {\n              ...elementAttributes,\n              style: `color: ${color}`,\n            };\n          }\n\n          return elementAttributes;\n        },\n      },\n      backgroundColor: {\n        default: null,\n        parseHTML: (element: HTMLElement) => element.getAttribute(\"data-background-color\"),\n        renderHTML: (attributes: { backgroundColor: string }) => {\n          const { backgroundColor } = attributes;\n          if (!backgroundColor) {\n            return {};\n          }\n\n          let elementAttributes: Record<string, string> = {\n            \"data-background-color\": backgroundColor,\n          };\n\n          if (!COLORS_LIST.find((c) => c.key === backgroundColor)) {\n            elementAttributes = {\n              ...elementAttributes,\n              style: `background-color: ${backgroundColor}`,\n            };\n          }\n\n          return elementAttributes;\n        },\n      },\n    };\n  },\n\n  addStorage() {\n    return {\n      markdown: {\n        serialize: {\n          open: \"\",\n          close: \"\",\n          mixable: true,\n          expelEnclosingWhitespace: true,\n        },\n      },\n    };\n  },\n\n  // @ts-expect-error types are incorrect\n  // TODO: check this and update types\n  parseHTML() {\n    return [\n      {\n        tag: \"span\",\n        getAttrs: (node) => node.getAttribute(\"data-text-color\") && null,\n      },\n      {\n        tag: \"span\",\n        getAttrs: (node) => node.getAttribute(\"data-background-color\") && null,\n      },\n    ];\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\"span\", mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), 0];\n  },\n\n  addCommands() {\n    return {\n      setTextColor:\n        (color: string) =>\n        ({ chain }) =>\n          chain().setMark(this.name, { color }).run(),\n      unsetTextColor:\n        () =>\n        ({ chain }) =>\n          chain().setMark(this.name, { color: null }).run(),\n      setBackgroundColor:\n        (backgroundColor: string) =>\n        ({ chain }) =>\n          chain().setMark(this.name, { backgroundColor }).run(),\n      unsetBackgroundColor:\n        () =>\n        ({ chain }) =>\n          chain().setMark(this.name, { backgroundColor: null }).run(),\n    };\n  },\n});\n","import { mergeAttributes } from \"@tiptap/core\";\nimport { Image as BaseImageExtension } from \"@tiptap/extension-image\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// local imports\nimport { ECustomImageAttributeNames } from \"./types\";\nimport type {\n  CustomImageExtensionOptions,\n  TCustomImageAttributes,\n  CustomImageExtensionType,\n  CustomImageExtensionStorage,\n  InsertImageComponentProps,\n} from \"./types\";\nimport { DEFAULT_CUSTOM_IMAGE_ATTRIBUTES } from \"./utils\";\n\ndeclare module \"@tiptap/core\" {\n  interface Commands<ReturnType> {\n    [CORE_EXTENSIONS.CUSTOM_IMAGE]: {\n      insertImageComponent: ({ file, pos, event }: InsertImageComponentProps) => ReturnType;\n    };\n  }\n  interface Storage {\n    [CORE_EXTENSIONS.CUSTOM_IMAGE]: CustomImageExtensionStorage;\n  }\n}\n\nexport const CustomImageExtensionConfig: CustomImageExtensionType = BaseImageExtension.extend<\n  CustomImageExtensionOptions,\n  CustomImageExtensionStorage\n>({\n  name: CORE_EXTENSIONS.CUSTOM_IMAGE,\n  group: \"block\",\n  atom: true,\n\n  addAttributes() {\n    const attributes = {\n      ...this.parent?.(),\n      ...Object.values(ECustomImageAttributeNames).reduce(\n        (acc, value) => {\n          acc[value] = {\n            default: DEFAULT_CUSTOM_IMAGE_ATTRIBUTES[value],\n          };\n          return acc;\n        },\n        {} as Record<ECustomImageAttributeNames, { default: TCustomImageAttributes[ECustomImageAttributeNames] }>\n      ),\n    };\n\n    return attributes;\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: \"image-component\",\n      },\n    ];\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\"image-component\", mergeAttributes(HTMLAttributes)];\n  },\n});\n","import { escapeForRegEx } from \"@tiptap/core\";\nimport type { Trigger, SuggestionMatch } from \"@tiptap/suggestion\";\n\nexport function customFindSuggestionMatch(config: Trigger): SuggestionMatch | null {\n  const { char, allowSpaces: allowSpacesOption, allowToIncludeChar, allowedPrefixes, startOfLine, $position } = config;\n\n  const allowSpaces = allowSpacesOption && !allowToIncludeChar;\n\n  const escapedChar = escapeForRegEx(char);\n  const suffix = new RegExp(`\\\\s${escapedChar}$`);\n  const prefix = startOfLine ? \"^\" : \"\";\n  const finalEscapedChar = allowToIncludeChar ? \"\" : escapedChar;\n  const regexp = allowSpaces\n    ? new RegExp(`${prefix}${escapedChar}.*?(?=\\\\s${finalEscapedChar}|$)`, \"gm\")\n    : new RegExp(`${prefix}(?:^)?${escapedChar}[^\\\\s${finalEscapedChar}]*`, \"gm\");\n\n  // Instead of just looking at nodeBefore.text, we need to extract text from the current paragraph\n  // to properly handle text with decorators like bold, italic, etc.\n  const currentParagraph = $position.parent;\n  if (!currentParagraph.isTextblock) {\n    return null;\n  }\n\n  // Get the start position of the current paragraph\n  const paragraphStart = $position.start();\n  // Extract text content using textBetween which handles text across different nodes/marks\n  const text = $position.doc.textBetween(paragraphStart, $position.pos, \"\\0\", \"\\0\");\n\n  if (!text) {\n    return null;\n  }\n\n  const textFrom = paragraphStart;\n  const match = Array.from(text.matchAll(regexp)).pop();\n\n  if (!match || match.input === undefined || match.index === undefined) {\n    return null;\n  }\n\n  // JavaScript doesn't have lookbehinds. This hacks a check that first character\n  // is a space or the start of the line\n  const matchPrefix = match.input.slice(Math.max(0, match.index - 1), match.index);\n  const matchPrefixIsAllowed = new RegExp(`^[${allowedPrefixes?.join(\"\")}]?$`).test(matchPrefix);\n\n  if (allowedPrefixes && allowedPrefixes.length > 0 && !matchPrefixIsAllowed) {\n    return null;\n  }\n\n  // The absolute position of the match in the document\n  const from = textFrom + match.index;\n  let to = from + match[0].length;\n\n  // Edge case handling; if spaces are allowed and we're directly in between\n  // two triggers\n  if (allowSpaces && suffix.test(text.slice(to - 1, to + 1))) {\n    match[0] += \" \";\n    to += 1;\n  }\n\n  // If the $position is located within the matched substring, return that range\n  if (from < $position.pos && to >= $position.pos) {\n    return {\n      range: {\n        from,\n        to,\n      },\n      query: match[0].slice(char.length),\n      text: match[0],\n    };\n  }\n\n  return null;\n}\n","import {\n  combineTransactionSteps,\n  escapeForRegEx,\n  findChildrenInRange,\n  getChangedRanges,\n  InputRule,\n  mergeAttributes,\n  Node,\n  nodeInputRule,\n  PasteRule,\n  removeDuplicates,\n} from \"@tiptap/core\";\nimport type { EmojiStorage } from \"@tiptap/extension-emoji\";\nimport { emojis, emojiToShortcode, shortcodeToEmoji } from \"@tiptap/extension-emoji\";\nimport { Fragment } from \"@tiptap/pm/model\";\nimport type { Transaction } from \"@tiptap/pm/state\";\nimport { Plugin, PluginKey, TextSelection } from \"@tiptap/pm/state\";\nimport type { SuggestionOptions } from \"@tiptap/suggestion\";\nimport Suggestion from \"@tiptap/suggestion\";\nimport emojiRegex from \"emoji-regex\";\nimport { isEmojiSupported } from \"is-emoji-supported\";\n// helpers\nimport { customFindSuggestionMatch } from \"@/helpers/find-suggestion-match\";\n\n// Extended storage type to include our custom forceOpen flag\nexport interface ExtendedEmojiStorage extends EmojiStorage {\n  forceOpen: boolean;\n}\n\nexport type EmojiItem = {\n  /**\n   * A unique name of the emoji which will be stored as attribute\n   */\n  name: string;\n  /**\n   * The emoji unicode character\n   */\n  emoji?: string;\n  /**\n   * A list of unique shortcodes that are used by input rules to find the emoji\n   */\n  shortcodes: string[];\n  /**\n   * A list of tags that can help for searching emojis\n   */\n  tags: string[];\n  /**\n   * A name that can help to group emojis\n   */\n  group?: string;\n  /**\n   * A list of unique emoticons\n   */\n  emoticons?: string[];\n  /**\n   * The unicode version the emoji was introduced\n   */\n  version?: number;\n  /**\n   * A fallback image if the current system doesn't support the emoji or for custom emojis\n   */\n  fallbackImage?: string;\n  /**\n   * Store some custom data\n   */\n  [key: string]: unknown;\n};\n\nexport type EmojiOptions = {\n  HTMLAttributes: Record<string, unknown>;\n  emojis: EmojiItem[];\n  enableEmoticons: boolean;\n  forceFallbackImages: boolean;\n  suggestion: Omit<SuggestionOptions, \"editor\">;\n};\n\nexport const EmojiSuggestionPluginKey = new PluginKey(\"emojiSuggestion\");\n\nexport const inputRegex = /:([a-zA-Z0-9_+-]+):$/;\n\nexport const pasteRegex = /:([a-zA-Z0-9_+-]+):/g;\n\nexport const Emoji = Node.create<EmojiOptions, EmojiStorage>({\n  name: \"emoji\",\n\n  inline: true,\n\n  group: \"inline\",\n\n  selectable: false,\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n      // emojis: ,\n      emojis: emojis,\n      enableEmoticons: false,\n      forceFallbackImages: false,\n      suggestion: {\n        char: \":\",\n        pluginKey: EmojiSuggestionPluginKey,\n        command: ({ editor, range, props }) => {\n          // increase range.to by one when the next node is of type \"text\"\n          // and starts with a space character\n          const nodeAfter = editor.view.state.selection.$to.nodeAfter;\n          const overrideSpace = nodeAfter?.text?.startsWith(\" \");\n\n          if (overrideSpace) {\n            range.to += 1;\n          }\n\n          editor\n            .chain()\n            .focus()\n            .command(({ tr, state, dispatch }) => {\n              if (!dispatch) return true;\n\n              const { schema } = state;\n              const emojiNode = schema.nodes[this.name].create(props);\n              const spaceNode = schema.text(\" \");\n\n              const fragment = Fragment.from([emojiNode, spaceNode]);\n\n              tr.replaceWith(range.from, range.to, fragment);\n\n              const newPos = range.from + fragment.size;\n              tr.setSelection(TextSelection.near(tr.doc.resolve(newPos)));\n\n              tr.setStoredMarks(tr.doc.resolve(range.from).marks());\n\n              return true;\n            })\n            .run();\n        },\n        allow: ({ state, range }) => {\n          const $from = state.doc.resolve(range.from);\n          const type = state.schema.nodes[this.name];\n          const allow = !!$from.parent.type.contentMatch.matchType(type);\n\n          return allow;\n        },\n      },\n    };\n  },\n\n  addStorage() {\n    const { emojis } = this.options;\n    const supportMap: Record<number, boolean> = removeDuplicates(emojis.map((item) => item.version))\n      .filter((version) => typeof version === \"number\")\n      .reduce((versions, version) => {\n        const emoji = emojis.find((item) => item.version === version && item.emoji);\n\n        return {\n          ...versions,\n          [version]: emoji ? isEmojiSupported(emoji.emoji as string) : false,\n        };\n      }, {});\n\n    return {\n      emojis: this.options.emojis,\n      isSupported: (emojiItem) => (emojiItem.version ? supportMap[emojiItem.version] : false),\n      forceOpen: false,\n    };\n  },\n\n  addAttributes() {\n    return {\n      name: {\n        default: null,\n        parseHTML: (element) => element.dataset.name,\n        renderHTML: (attributes) => ({\n          \"data-name\": attributes.name,\n        }),\n      },\n    };\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: `span[data-type=\"${this.name}\"]`,\n      },\n    ];\n  },\n\n  renderHTML({ HTMLAttributes, node }) {\n    const emojiItem = shortcodeToEmoji(node.attrs.name, this.options.emojis);\n    const attributes = mergeAttributes(HTMLAttributes, this.options.HTMLAttributes, { \"data-type\": this.name });\n\n    if (!emojiItem) {\n      return [\"span\", attributes, `:${node.attrs.name}:`];\n    }\n\n    const renderFallbackImage = false;\n\n    return [\n      \"span\",\n      attributes,\n      renderFallbackImage\n        ? [\n            \"img\",\n            {\n              src: emojiItem.fallbackImage,\n              draggable: \"false\",\n              loading: \"lazy\",\n              align: \"absmiddle\",\n            },\n          ]\n        : emojiItem.emoji || `:${emojiItem.shortcodes[0]}:`,\n    ];\n  },\n\n  renderText({ node }) {\n    const emojiItem = shortcodeToEmoji(node.attrs.name, this.options.emojis);\n\n    return emojiItem?.emoji || `:${node.attrs.name}:`;\n  },\n\n  addCommands() {\n    return {\n      setEmoji:\n        (shortcode) =>\n        ({ chain }) => {\n          const emojiItem = shortcodeToEmoji(shortcode, this.options.emojis);\n\n          if (!emojiItem) {\n            return false;\n          }\n\n          chain()\n            .insertContent({\n              type: this.name,\n              attrs: {\n                name: emojiItem.name,\n              },\n            })\n            .command(({ tr, state }) => {\n              tr.setStoredMarks(state.doc.resolve(state.selection.to - 1).marks());\n              return true;\n            })\n            .run();\n\n          return true;\n        },\n    };\n  },\n\n  addInputRules() {\n    const inputRules: InputRule[] = [];\n\n    inputRules.push(\n      new InputRule({\n        find: inputRegex,\n        handler: ({ range, match, chain }) => {\n          const name = match[1];\n\n          if (!shortcodeToEmoji(name, this.options.emojis)) {\n            return;\n          }\n\n          chain()\n            .insertContentAt(range, {\n              type: this.name,\n              attrs: {\n                name,\n              },\n            })\n            .command(({ tr, state }) => {\n              tr.setStoredMarks(state.doc.resolve(state.selection.to - 1).marks());\n              return true;\n            })\n            .run();\n        },\n      })\n    );\n\n    if (this.options.enableEmoticons) {\n      // get the list of supported emoticons\n      const emoticons = this.options.emojis\n        .map((item) => item.emoticons)\n        .flat()\n        .filter((item) => item) as string[];\n\n      const emoticonRegex = new RegExp(`(?:^|\\\\s)(${emoticons.map((item) => escapeForRegEx(item)).join(\"|\")}) $`);\n\n      inputRules.push(\n        nodeInputRule({\n          find: emoticonRegex,\n          type: this.type,\n          getAttributes: (match) => {\n            const emoji = this.options.emojis.find((item) => item.emoticons?.includes(match[1]));\n\n            if (!emoji) {\n              return;\n            }\n\n            return {\n              name: emoji.name,\n            };\n          },\n        })\n      );\n    }\n\n    return inputRules;\n  },\n\n  addPasteRules() {\n    return [\n      new PasteRule({\n        find: pasteRegex,\n        handler: ({ range, match, chain }) => {\n          const name = match[1];\n\n          if (!shortcodeToEmoji(name, this.options.emojis)) {\n            return;\n          }\n\n          chain()\n            .insertContentAt(\n              range,\n              {\n                type: this.name,\n                attrs: {\n                  name,\n                },\n              },\n              {\n                updateSelection: false,\n              }\n            )\n            .command(({ tr, state }) => {\n              tr.setStoredMarks(state.doc.resolve(state.selection.to - 1).marks());\n              return true;\n            })\n            .run();\n        },\n      }),\n    ];\n  },\n\n  addProseMirrorPlugins() {\n    const isTouchDevice = !!this.editor.storage.utility.isTouchDevice;\n    if (isTouchDevice) {\n      return [];\n    }\n    return [\n      Suggestion({\n        editor: this.editor,\n        findSuggestionMatch: customFindSuggestionMatch,\n        ...this.options.suggestion,\n      }),\n\n      new Plugin({\n        key: new PluginKey(\"emoji\"),\n        props: {\n          // double click to select emoji doesnt work by default\n          // thats why we simulate this behavior\n          handleDoubleClickOn: (view, pos, node) => {\n            if (node.type !== this.type) {\n              return false;\n            }\n\n            const from = pos;\n            const to = from + node.nodeSize;\n\n            this.editor.commands.setTextSelection({\n              from,\n              to,\n            });\n\n            return true;\n          },\n        },\n\n        // replace text emojis with emoji node on any change\n        appendTransaction: (transactions, oldState, newState) => {\n          const docChanges =\n            transactions.some((transaction) => transaction.docChanged) && !oldState.doc.eq(newState.doc);\n\n          if (!docChanges) {\n            return;\n          }\n\n          const { tr } = newState;\n          const transform = combineTransactionSteps(oldState.doc, transactions as Transaction[]);\n          const changes = getChangedRanges(transform);\n\n          changes.forEach(({ newRange }) => {\n            // We dont want to add emoji inline nodes within code blocks.\n            // Because this would split the code block.\n\n            // This only works if the range of changes is within a code node.\n            // For all other cases (e.g. the whole document is set/pasted and the parent of the range is `doc`)\n            // it doesn't and we have to double check later.\n            if (newState.doc.resolve(newRange.from).parent.type.spec.code) {\n              return;\n            }\n\n            const textNodes = findChildrenInRange(newState.doc, newRange, (node) => node.type.isText);\n\n            textNodes.forEach(({ node, pos }) => {\n              if (!node.text) {\n                return;\n              }\n\n              const matches = [...node.text.matchAll(emojiRegex())];\n\n              matches.forEach((match) => {\n                if (match.index === undefined) {\n                  return;\n                }\n\n                const emoji = match[0];\n                const name = emojiToShortcode(emoji, this.options.emojis);\n\n                if (!name) {\n                  return;\n                }\n\n                const from = tr.mapping.map(pos + match.index);\n\n                // Double check parent node is not a code block.\n                if (newState.doc.resolve(from).parent.type.spec.code) {\n                  return;\n                }\n\n                const to = from + emoji.length;\n                const emojiNode = this.type.create({\n                  name,\n                });\n\n                tr.replaceRangeWith(from, to, emojiNode);\n\n                tr.setStoredMarks(newState.doc.resolve(from).marks());\n              });\n            });\n          });\n\n          if (!tr.steps.length) {\n            return;\n          }\n\n          return tr;\n        },\n      }),\n    ];\n  },\n});\n","import { FloatingOverlay } from \"@floating-ui/react\";\nimport type { SuggestionKeyDownProps, SuggestionProps } from \"@tiptap/suggestion\";\nimport { forwardRef, useCallback, useEffect, useImperativeHandle, useRef, useState } from \"react\";\n// plane imports\nimport { useOutsideClickDetector } from \"@plane/hooks\";\nimport { cn } from \"@plane/utils\";\n\nexport type EmojiItem = {\n  name: string;\n  emoji: string;\n  shortcodes: string[];\n  tags: string[];\n};\n\nexport type EmojiListRef = {\n  onKeyDown: (props: SuggestionKeyDownProps) => boolean;\n};\n\nexport type EmojisListDropdownProps = SuggestionProps<EmojiItem, { name: string }> & {\n  onClose: () => void;\n  forceOpen?: boolean;\n};\n\nexport const EmojisListDropdown = forwardRef(function EmojisListDropdown(\n  props: EmojisListDropdownProps,\n  ref: React.ForwardedRef<EmojiListRef>\n) {\n  const { items, command, query, onClose, forceOpen = false } = props;\n  // states\n  const [selectedIndex, setSelectedIndex] = useState<number>(0);\n  const [isVisible, setIsVisible] = useState(false);\n  // refs\n  const dropdownContainerRef = useRef<HTMLDivElement>(null);\n\n  const selectItem = useCallback(\n    (index: number): void => {\n      const item = items[index];\n      if (item) {\n        command({ name: item.name });\n      }\n    },\n    [command, items]\n  );\n\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent): boolean => {\n      // Allow keyboard navigation if we have items to show\n      if (items.length === 0) {\n        return false;\n      }\n\n      // Don't handle keyboard if modal shouldn't be visible (query empty without forceOpen)\n      if (query.length === 0 && !forceOpen) {\n        return false;\n      }\n\n      if (event.key === \"ArrowUp\") {\n        setSelectedIndex((prev) => (prev + items.length - 1) % items.length);\n        return true;\n      }\n\n      if (event.key === \"ArrowDown\") {\n        setSelectedIndex((prev) => (prev + 1) % items.length);\n        return true;\n      }\n\n      if (event.key === \"Enter\") {\n        selectItem(selectedIndex);\n        return true;\n      }\n\n      return false;\n    },\n    [items.length, query.length, forceOpen, selectItem, selectedIndex]\n  );\n\n  // Show animation\n  useEffect(() => {\n    setIsVisible(false);\n    const timeout = setTimeout(() => setIsVisible(true), 50);\n    return () => clearTimeout(timeout);\n  }, []);\n\n  // Reset selection when items change\n  useEffect(() => setSelectedIndex(0), [items]);\n\n  // Scroll selected item into view\n  useEffect(() => {\n    const container = dropdownContainerRef.current;\n    if (!container) return;\n\n    const item = container.querySelector(`#emoji-item-${selectedIndex}`) as HTMLElement;\n    if (item) {\n      const containerRect = container.getBoundingClientRect();\n      const itemRect = item.getBoundingClientRect();\n\n      if (itemRect.top < containerRect.top || itemRect.bottom > containerRect.bottom) {\n        item.scrollIntoView({ block: \"nearest\" });\n      }\n    }\n  }, [selectedIndex]);\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      onKeyDown: ({ event }: SuggestionKeyDownProps): boolean => handleKeyDown(event),\n    }),\n    [handleKeyDown]\n  );\n\n  useOutsideClickDetector(dropdownContainerRef, onClose);\n\n  if (query.length === 0 && !forceOpen) return null;\n\n  return (\n    <>\n      {/* Backdrop */}\n      <FloatingOverlay\n        style={{\n          zIndex: 99,\n        }}\n        lockScroll\n      />\n      <div\n        ref={dropdownContainerRef}\n        className={cn(\n          \"relative max-h-80 w-[14rem] overflow-y-auto rounded-md border-[0.5px] border-custom-border-300 bg-custom-background-100 px-2 py-2.5 shadow-custom-shadow-rg space-y-2 opacity-0 invisible transition-opacity\",\n          {\n            \"opacity-100 visible\": isVisible,\n          }\n        )}\n        style={{\n          zIndex: 100,\n        }}\n        onClick={(e) => {\n          e.stopPropagation();\n        }}\n        onMouseDown={(e) => {\n          e.stopPropagation();\n        }}\n      >\n        {items.length ? (\n          items.map((item, index) => {\n            const isSelected = index === selectedIndex;\n            const emojiKey = item.shortcodes.join(\" - \");\n\n            return (\n              <button\n                key={emojiKey}\n                id={`emoji-item-${index}`}\n                type=\"button\"\n                className={cn(\n                  \"flex items-center gap-2 w-full rounded px-2 py-1.5 text-sm text-left truncate text-custom-text-200 hover:bg-custom-background-80 transition-colors duration-150\",\n                  {\n                    \"bg-custom-background-80\": isSelected,\n                  }\n                )}\n                onClick={() => selectItem(index)}\n                onMouseEnter={() => setSelectedIndex(index)}\n              >\n                <span className=\"size-5 grid place-items-center flex-shrink-0 text-base\">{item.emoji}</span>\n                <span className=\"flex-grow truncate\">\n                  <span className=\"font-medium\">:{item.name}:</span>\n                </span>\n              </button>\n            );\n          })\n        ) : (\n          <div className=\"text-center text-sm text-custom-text-400 py-2\">No emojis found</div>\n        )}\n      </div>\n    </>\n  );\n});\n\nEmojisListDropdown.displayName = \"EmojisListDropdown\";\n","import type { EmojiOptions, EmojiStorage } from \"@tiptap/extension-emoji\";\nimport { ReactRenderer } from \"@tiptap/react\";\nimport type { Editor } from \"@tiptap/react\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// helpers\nimport { updateFloatingUIFloaterPosition } from \"@/helpers/floating-ui\";\nimport type { CommandListInstance } from \"@/helpers/tippy\";\nimport { DROPDOWN_NAVIGATION_KEYS } from \"@/helpers/tippy\";\n// local imports\nimport { EmojisListDropdown } from \"./components/emojis-list\";\nimport type { EmojisListDropdownProps, EmojiItem } from \"./components/emojis-list\";\nimport type { ExtendedEmojiStorage } from \"./emoji\";\n\nconst DEFAULT_EMOJIS = [\"+1\", \"-1\", \"smile\", \"orange_heart\", \"eyes\"];\n\nexport const emojiSuggestion: EmojiOptions[\"suggestion\"] = {\n  items: ({ editor, query }: { editor: Editor; query: string }): EmojiItem[] => {\n    const { emojis } = editor.storage.emoji as EmojiStorage;\n\n    if (query.trim() === \"\") {\n      const defaultEmojis = DEFAULT_EMOJIS.map((name) =>\n        emojis.find((emoji) => emoji.shortcodes.includes(name) || emoji.name === name)\n      )\n        .filter(Boolean)\n        .slice(0, 5);\n      return defaultEmojis as EmojiItem[];\n    }\n    return emojis\n      .filter(({ shortcodes, tags }) => {\n        const lowerQuery = query.toLowerCase();\n        return (\n          shortcodes.find((shortcode: string) => shortcode.startsWith(lowerQuery)) ||\n          tags.find((tag: string) => tag.startsWith(lowerQuery))\n        );\n      })\n      .slice(0, 5) as EmojiItem[];\n  },\n\n  allowSpaces: false,\n\n  render: () => {\n    let component: ReactRenderer<CommandListInstance, EmojisListDropdownProps> | null = null;\n    let cleanup: () => void = () => {};\n    let editorRef: Editor | null = null;\n\n    const handleClose = (editor?: Editor) => {\n      component?.destroy();\n      component = null;\n      (editor || editorRef)?.commands.removeActiveDropbarExtension(CORE_EXTENSIONS.EMOJI);\n      const emojiStorage = editor?.storage.emoji as ExtendedEmojiStorage;\n      emojiStorage.forceOpen = false;\n      cleanup();\n    };\n\n    return {\n      onStart: (props) => {\n        editorRef = props.editor;\n        const emojiStorage = props.editor.storage.emoji as ExtendedEmojiStorage;\n        const forceOpen = emojiStorage.forceOpen || false;\n        component = new ReactRenderer<CommandListInstance, EmojisListDropdownProps>(EmojisListDropdown, {\n          props: {\n            ...props,\n            onClose: () => handleClose(props.editor),\n            forceOpen,\n          } satisfies EmojisListDropdownProps,\n          editor: props.editor,\n          className: \"fixed z-[100]\",\n        });\n        if (!props.clientRect) return;\n        props.editor.commands.addActiveDropbarExtension(CORE_EXTENSIONS.EMOJI);\n        const element = component.element as HTMLElement;\n        cleanup = updateFloatingUIFloaterPosition(props.editor, element).cleanup;\n      },\n\n      onUpdate: (props) => {\n        if (!component || !component.element) return;\n        const emojiStorage = props.editor.storage.emoji as ExtendedEmojiStorage;\n        const forceOpen = emojiStorage.forceOpen || false;\n        component.updateProps({ ...props, forceOpen });\n        if (!props.clientRect) return;\n        cleanup();\n        cleanup = updateFloatingUIFloaterPosition(props.editor, component.element as HTMLElement).cleanup;\n      },\n      onKeyDown: ({ event }) => {\n        if ([...DROPDOWN_NAVIGATION_KEYS, \"Escape\"].includes(event.key)) {\n          event.preventDefault();\n          event.stopPropagation();\n        }\n\n        if (event.key === \"Escape\") {\n          handleClose();\n          return true;\n        }\n\n        return component?.ref?.onKeyDown({ event }) ?? false;\n      },\n\n      onExit: ({ editor }) => {\n        component?.element.remove();\n        handleClose(editor);\n      },\n    };\n  },\n};\n","// local imports\nimport { gitHubEmojis, shortcodeToEmoji } from \"@tiptap/extension-emoji\";\nimport type { MarkdownSerializerState } from \"@tiptap/pm/markdown\";\nimport type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\nimport { Emoji } from \"./emoji\";\nimport { emojiSuggestion } from \"./suggestion\";\n\nexport const EmojiExtension = Emoji.extend({\n  addStorage() {\n    const extensionOptions = this.options;\n\n    return {\n      ...this.parent?.(),\n      markdown: {\n        serialize(state: MarkdownSerializerState, node: ProseMirrorNode) {\n          const emojiItem = shortcodeToEmoji(node.attrs.name, extensionOptions.emojis);\n          if (emojiItem?.emoji) {\n            state.write(emojiItem?.emoji);\n          } else {\n            state.write(`:${node.attrs.name}:`);\n          }\n        },\n      },\n    };\n  },\n}).configure({\n  // Filter out emojis without emoji value and remove fallbackImage property to prevent CDN calls\n\n  emojis: gitHubEmojis.filter((item) => item.emoji).map(({ fallbackImage, ...emoji }) => emoji),\n  suggestion: emojiSuggestion,\n  enableEmoticons: true,\n});\n","import { isNodeSelection, mergeAttributes, Node, nodeInputRule } from \"@tiptap/core\";\nimport { NodeSelection, TextSelection } from \"@tiptap/pm/state\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n\ntype HorizontalRuleOptions = {\n  HTMLAttributes: Record<string, unknown>;\n};\n\ndeclare module \"@tiptap/core\" {\n  interface Commands<ReturnType> {\n    [CORE_EXTENSIONS.HORIZONTAL_RULE]: {\n      /**\n       * Add a horizontal rule\n       */\n      setHorizontalRule: () => ReturnType;\n    };\n  }\n}\n\nexport const CustomHorizontalRule = Node.create<HorizontalRuleOptions>({\n  name: CORE_EXTENSIONS.HORIZONTAL_RULE,\n  group: \"block\",\n\n  addOptions() {\n    return {\n      HTMLAttributes: {\n        class: \"py-4 border-custom-border-400\",\n      },\n    };\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: `div[data-type=\"${this.name}\"]`,\n      },\n      { tag: \"hr\" },\n    ];\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      \"div\",\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, {\n        \"data-type\": this.name,\n      }),\n      [\"div\", {}],\n    ];\n  },\n\n  addCommands() {\n    return {\n      setHorizontalRule:\n        () =>\n        ({ chain, state }) => {\n          const { selection } = state;\n          const { $from: $originFrom, $to: $originTo } = selection;\n\n          const currentChain = chain();\n\n          if ($originFrom.parentOffset === 0) {\n            currentChain.insertContentAt(\n              {\n                from: Math.max($originFrom.pos - 1, 0),\n                to: $originTo.pos,\n              },\n              {\n                type: this.name,\n              }\n            );\n          } else if (isNodeSelection(selection)) {\n            currentChain.insertContentAt($originTo.pos, {\n              type: this.name,\n            });\n          } else {\n            currentChain.insertContent({ type: this.name });\n          }\n\n          return (\n            currentChain\n              // set cursor after horizontal rule\n              .command(({ tr, dispatch }) => {\n                if (dispatch) {\n                  const { $to } = tr.selection;\n                  const posAfter = $to.end();\n\n                  if ($to.nodeAfter) {\n                    if ($to.nodeAfter.isTextblock) {\n                      tr.setSelection(TextSelection.create(tr.doc, $to.pos + 1));\n                    } else if ($to.nodeAfter.isBlock) {\n                      tr.setSelection(NodeSelection.create(tr.doc, $to.pos));\n                    } else {\n                      tr.setSelection(TextSelection.create(tr.doc, $to.pos));\n                    }\n                  } else {\n                    // add node after horizontal rule if its the end of the document\n                    const node = $to.parent.type.contentMatch.defaultType?.create();\n\n                    if (node) {\n                      tr.insert(posAfter, node);\n                      tr.setSelection(TextSelection.create(tr.doc, posAfter + 1));\n                    }\n                  }\n\n                  tr.scrollIntoView();\n                }\n\n                return true;\n              })\n              .run()\n          );\n        },\n    };\n  },\n\n  addInputRules() {\n    return [\n      nodeInputRule({\n        find: /^(?:---|-|___\\s|\\*\\*\\*\\s)$/,\n        type: this.type,\n      }),\n    ];\n  },\n});\n","import Blockquote from \"@tiptap/extension-blockquote\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n\nexport const CustomQuoteExtension = Blockquote.extend({\n  addKeyboardShortcuts() {\n    return {\n      Enter: () => {\n        try {\n          const { $from, $to, $head } = this.editor.state.selection;\n          const parent = $head.node(-1);\n\n          if (!parent) return false;\n\n          if (parent.type.name !== CORE_EXTENSIONS.BLOCKQUOTE) {\n            return false;\n          }\n          if ($from.pos !== $to.pos) return false;\n          // if ($head.parentOffset < $head.parent.content.size) return false;\n\n          // this.editor.commands.insertContentAt(parent.ne);\n          this.editor.chain().splitBlock().lift(this.name).run();\n\n          return true;\n        } catch (error) {\n          console.error(\"Error handling Enter in blockquote:\", error);\n          return false;\n        }\n      },\n    };\n  },\n});\n","import StarterKit from \"@tiptap/starter-kit\";\n\ntype TArgs = {\n  enableHistory: boolean;\n};\n\nexport const CustomStarterKitExtension = (args: TArgs) => {\n  const { enableHistory } = args;\n\n  return StarterKit.configure({\n    bulletList: {\n      HTMLAttributes: {\n        class: \"list-disc pl-7 space-y-[--list-spacing-y]\",\n      },\n    },\n    orderedList: {\n      HTMLAttributes: {\n        class: \"list-decimal pl-7 space-y-[--list-spacing-y]\",\n      },\n    },\n    listItem: {\n      HTMLAttributes: {\n        class: \"not-prose space-y-2\",\n      },\n    },\n    code: false,\n    codeBlock: false,\n    horizontalRule: false,\n    blockquote: false,\n    paragraph: {\n      HTMLAttributes: {\n        class: \"editor-paragraph-block\",\n      },\n    },\n    heading: {\n      HTMLAttributes: {\n        class: \"editor-heading-block\",\n      },\n    },\n    dropcursor: {\n      class:\n        \"text-custom-text-300 transition-all motion-reduce:transition-none motion-reduce:hover:transform-none duration-200 ease-[cubic-bezier(0.165, 0.84, 0.44, 1)]\",\n    },\n    ...(enableHistory ? {} : { history: false }),\n  });\n};\n","import TextAlign from \"@tiptap/extension-text-align\";\n\nexport type TTextAlign = \"left\" | \"center\" | \"right\";\n\nexport const CustomTextAlignExtension = TextAlign.configure({\n  alignments: [\"left\", \"center\", \"right\"],\n  types: [\"heading\", \"paragraph\"],\n});\n","import TaskItem from \"@tiptap/extension-task-item\";\nimport TaskList from \"@tiptap/extension-task-list\";\nimport { TextStyle } from \"@tiptap/extension-text-style\";\nimport { Underline } from \"@tiptap/extension-underline\";\n// plane editor imports\nimport { CoreEditorAdditionalExtensionsWithoutProps } from \"@/plane-editor/extensions/core/without-props\";\n// extensions\nimport { CustomCalloutExtensionConfig } from \"./callout/extension-config\";\nimport { CustomCodeBlockExtensionWithoutProps } from \"./code/without-props\";\nimport { CustomCodeInlineExtension } from \"./code-inline\";\nimport { CustomColorExtension } from \"./custom-color\";\nimport { CustomImageExtensionConfig } from \"./custom-image/extension-config\";\nimport { CustomLinkExtension } from \"./custom-link\";\nimport { EmojiExtension } from \"./emoji/extension\";\nimport { CustomHorizontalRule } from \"./horizontal-rule\";\nimport { ImageExtensionConfig } from \"./image\";\nimport { CustomMentionExtensionConfig } from \"./mentions/extension-config\";\nimport { CustomQuoteExtension } from \"./quote\";\nimport { CustomStarterKitExtension } from \"./starter-kit\";\nimport { TableHeader, TableCell, TableRow, Table } from \"./table\";\nimport { CustomTextAlignExtension } from \"./text-align\";\nimport { WorkItemEmbedExtensionConfig } from \"./work-item-embed/extension-config\";\n\nexport const CoreEditorExtensionsWithoutProps = [\n  CustomStarterKitExtension({\n    enableHistory: true,\n  }),\n  EmojiExtension,\n  CustomQuoteExtension,\n  CustomHorizontalRule,\n  CustomLinkExtension,\n  ImageExtensionConfig,\n  CustomImageExtensionConfig,\n  Underline,\n  TextStyle,\n  TaskList.configure({\n    HTMLAttributes: {\n      class: \"not-prose pl-2 space-y-2\",\n    },\n  }),\n  TaskItem.configure({\n    HTMLAttributes: {\n      class: \"flex\",\n    },\n    nested: true,\n  }),\n  CustomCodeInlineExtension,\n  CustomCodeBlockExtensionWithoutProps,\n  Table,\n  TableHeader,\n  TableCell,\n  TableRow,\n  CustomMentionExtensionConfig,\n  CustomTextAlignExtension,\n  CustomCalloutExtensionConfig,\n  CustomColorExtension,\n  ...CoreEditorAdditionalExtensionsWithoutProps,\n];\n\nexport const DocumentEditorExtensionsWithoutProps = [WorkItemEmbedExtensionConfig];\n","import type { AnyExtension, Extensions } from \"@tiptap/core\";\nimport Document from \"@tiptap/extension-document\";\nimport Heading from \"@tiptap/extension-heading\";\nimport Text from \"@tiptap/extension-text\";\n\nexport const TitleExtensions: Extensions = [\n  Document.extend({\n    content: \"heading\",\n  }),\n  Heading.configure({\n    levels: [1],\n  }) as AnyExtension,\n  Text,\n];\n","import { Buffer } from \"buffer\";\nimport type { Extensions } from \"@tiptap/core\";\nimport { getSchema } from \"@tiptap/core\";\nimport { generateHTML, generateJSON } from \"@tiptap/html\";\nimport { prosemirrorJSONToYDoc, yXmlFragmentToProseMirrorRootNode } from \"y-prosemirror\";\nimport * as Y from \"yjs\";\n// extensions\nimport type { TDocumentPayload } from \"@plane/types\";\nimport {\n  CoreEditorExtensionsWithoutProps,\n  DocumentEditorExtensionsWithoutProps,\n} from \"@/extensions/core-without-props\";\nimport { TitleExtensions } from \"@/extensions/title-extension\";\nimport { sanitizeHTML } from \"@plane/utils\";\n\n// editor extension configs\nconst RICH_TEXT_EDITOR_EXTENSIONS = CoreEditorExtensionsWithoutProps;\nconst DOCUMENT_EDITOR_EXTENSIONS = [...CoreEditorExtensionsWithoutProps, ...DocumentEditorExtensionsWithoutProps];\nexport const TITLE_EDITOR_EXTENSIONS: Extensions = TitleExtensions;\n// editor schemas\nconst richTextEditorSchema = getSchema(RICH_TEXT_EDITOR_EXTENSIONS);\nconst documentEditorSchema = getSchema(DOCUMENT_EDITOR_EXTENSIONS);\n\n/**\n * @description apply updates to a doc and return the updated doc in binary format\n * @param {Uint8Array} document\n * @param {Uint8Array} updates\n * @returns {Uint8Array}\n */\nexport const applyUpdates = (document: Uint8Array, updates?: Uint8Array): Uint8Array => {\n  const yDoc = new Y.Doc();\n  Y.applyUpdate(yDoc, document);\n  if (updates) {\n    Y.applyUpdate(yDoc, updates);\n  }\n\n  const encodedDoc = Y.encodeStateAsUpdate(yDoc);\n  return encodedDoc;\n};\n\n/**\n * @description this function encodes binary data to base64 string\n * @param {Uint8Array} document\n * @returns {string}\n */\nexport const convertBinaryDataToBase64String = (document: Uint8Array): string =>\n  Buffer.from(document).toString(\"base64\");\n\n/**\n * @description this function decodes base64 string to binary data\n * @param {string} document\n * @returns {Buffer<ArrayBuffer>}\n */\nexport const convertBase64StringToBinaryData = (document: string): Buffer<ArrayBuffer> =>\n  Buffer.from(document, \"base64\");\n\n/**\n * @description this function generates the binary equivalent of html content for the rich text editor\n * @param {string} descriptionHTML\n * @returns {Uint8Array}\n */\nexport const getBinaryDataFromRichTextEditorHTMLString = (descriptionHTML: string): Uint8Array => {\n  // convert HTML to JSON\n  const contentJSON = generateJSON(descriptionHTML ?? \"<p></p>\", RICH_TEXT_EDITOR_EXTENSIONS);\n  // convert JSON to Y.Doc format\n  const transformedData = prosemirrorJSONToYDoc(richTextEditorSchema, contentJSON, \"default\");\n  // convert Y.Doc to Uint8Array format\n  const encodedData = Y.encodeStateAsUpdate(transformedData);\n  return encodedData;\n};\n\n/**\n * @description this function generates the binary equivalent of html content for the document editor\n * @param {string} descriptionHTML\n * @returns {Uint8Array}\n */\nexport const getBinaryDataFromDocumentEditorHTMLString = (descriptionHTML: string): Uint8Array => {\n  // convert HTML to JSON\n  const contentJSON = generateJSON(descriptionHTML ?? \"<p></p>\", DOCUMENT_EDITOR_EXTENSIONS);\n  // convert JSON to Y.Doc format\n  const transformedData = prosemirrorJSONToYDoc(documentEditorSchema, contentJSON, \"default\");\n  // convert Y.Doc to Uint8Array format\n  const encodedData = Y.encodeStateAsUpdate(transformedData);\n  return encodedData;\n};\n\n/**\n * @description this function generates all document formats for the provided binary data for the rich text editor\n * @param {Uint8Array} description\n * @returns\n */\nexport const getAllDocumentFormatsFromRichTextEditorBinaryData = (\n  description: Uint8Array\n): {\n  contentBinaryEncoded: string;\n  contentJSON: object;\n  contentHTML: string;\n} => {\n  // encode binary description data\n  const base64Data = convertBinaryDataToBase64String(description);\n  const yDoc = new Y.Doc();\n  Y.applyUpdate(yDoc, description);\n  // convert to JSON\n  const type = yDoc.getXmlFragment(\"default\");\n  const contentJSON = yXmlFragmentToProseMirrorRootNode(type, richTextEditorSchema).toJSON();\n  // convert to HTML\n  const contentHTML = generateHTML(contentJSON, RICH_TEXT_EDITOR_EXTENSIONS);\n\n  return {\n    contentBinaryEncoded: base64Data,\n    contentJSON,\n    contentHTML,\n  };\n};\n\n/**\n * @description this function generates all document formats for the provided binary data for the document editor\n * @param {Uint8Array} description\n * @returns\n */\nexport const getAllDocumentFormatsFromDocumentEditorBinaryData = (\n  description: Uint8Array,\n  updateTitle: boolean\n): {\n  contentBinaryEncoded: string;\n  contentJSON: object;\n  contentHTML: string;\n  titleHTML?: string;\n} => {\n  // encode binary description data\n  const base64Data = convertBinaryDataToBase64String(description);\n  const yDoc = new Y.Doc();\n  Y.applyUpdate(yDoc, description);\n  // convert to JSON\n  const type = yDoc.getXmlFragment(\"default\");\n  const contentJSON = yXmlFragmentToProseMirrorRootNode(type, documentEditorSchema).toJSON();\n  // convert to HTML\n  const contentHTML = generateHTML(contentJSON, DOCUMENT_EDITOR_EXTENSIONS);\n\n  if (updateTitle) {\n    const title = yDoc.getXmlFragment(\"title\");\n    const titleJSON = yXmlFragmentToProseMirrorRootNode(title, documentEditorSchema).toJSON();\n    const titleHTML = extractTextFromHTML(generateHTML(titleJSON, DOCUMENT_EDITOR_EXTENSIONS));\n\n    return {\n      contentBinaryEncoded: base64Data,\n      contentJSON,\n      contentHTML,\n      titleHTML,\n    };\n  } else {\n    return {\n      contentBinaryEncoded: base64Data,\n      contentJSON,\n      contentHTML,\n    };\n  }\n};\n\ntype TConvertHTMLDocumentToAllFormatsArgs = {\n  document_html: string;\n  variant: \"rich\" | \"document\";\n};\n\n/**\n * @description Converts HTML content to all supported document formats (JSON, HTML, and binary)\n * @param {TConvertHTMLDocumentToAllFormatsArgs} args - Arguments containing HTML content and variant type\n * @param {string} args.document_html - The HTML content to convert\n * @param {\"rich\" | \"document\"} args.variant - The type of editor variant to use for conversion\n * @returns {TDocumentPayload} Object containing the document in all supported formats\n * @throws {Error} If an invalid variant is provided\n */\nexport const convertHTMLDocumentToAllFormats = (args: TConvertHTMLDocumentToAllFormatsArgs): TDocumentPayload => {\n  const { document_html, variant } = args;\n\n  let allFormats: TDocumentPayload;\n\n  if (variant === \"rich\") {\n    // Convert HTML to binary format for rich text editor\n    const contentBinary = getBinaryDataFromRichTextEditorHTMLString(document_html);\n    // Generate all document formats from the binary data\n    const { contentBinaryEncoded, contentHTML, contentJSON } =\n      getAllDocumentFormatsFromRichTextEditorBinaryData(contentBinary);\n    allFormats = {\n      description: contentJSON,\n      description_html: contentHTML,\n      description_binary: contentBinaryEncoded,\n    };\n  } else if (variant === \"document\") {\n    // Convert HTML to binary format for document editor\n    const contentBinary = getBinaryDataFromDocumentEditorHTMLString(document_html);\n    // Generate all document formats from the binary data\n    const { contentBinaryEncoded, contentHTML, contentJSON } = getAllDocumentFormatsFromDocumentEditorBinaryData(\n      contentBinary,\n      false\n    );\n    allFormats = {\n      description: contentJSON,\n      description_html: contentHTML,\n      description_binary: contentBinaryEncoded,\n    };\n  } else {\n    throw new Error(`Invalid variant provided: ${variant}`);\n  }\n\n  return allFormats;\n};\n\nexport const extractTextFromHTML = (html: string): string => {\n  // Use sanitizeHTML to safely extract text and remove all HTML tags\n  // This is more secure than regex as it handles edge cases and prevents injection\n  // Note: sanitizeHTML trims whitespace, which is acceptable for title extraction\n  return sanitizeHTML(html) || \"\";\n};\n","import type { DocumentCollaborativeEvents } from \"@/constants/document-collaborative-events\";\n\n// Base type for all action payloads\nexport type BaseActionPayload = {\n  user_id?: string;\n};\n\n// Generic type for creating specific payloads\nexport type CreatePayload<T = Record<string, never>> = BaseActionPayload & T;\n\nexport type TDocumentEventEmitter = {\n  on: (event: string, callback: (message: { payload: TDocumentEventsClient }) => void) => void;\n  off: (event: string, callback: (message: { payload: TDocumentEventsClient }) => void) => void;\n};\n\nexport type TDocumentEventKey = keyof typeof DocumentCollaborativeEvents;\nexport type TDocumentEventsClient = (typeof DocumentCollaborativeEvents)[TDocumentEventKey][\"client\"];\nexport type TDocumentEventsServer = (typeof DocumentCollaborativeEvents)[TDocumentEventKey][\"server\"];\n\n// In this version, our union of all events (the client names) is:\nexport type TAllEventTypes = TDocumentEventsClient;\n\n// Create a mapping from each client event to its payload type using key remapping.\nexport type EventToPayloadMap = {\n  [K in keyof typeof DocumentCollaborativeEvents as (typeof DocumentCollaborativeEvents)[K][\"client\"]]: (typeof DocumentCollaborativeEvents)[K][\"payloadType\"];\n};\n\n// Common fields for every realtime event\nexport type CommonRealtimeFields = {\n  affectedPages: {\n    currentPage: string;\n    parentPage: string | null;\n    descendantPages: string[];\n  };\n  workspace_slug: string;\n  project_id?: string;\n  teamspace_id?: string;\n  user_id: string;\n  timestamp: string;\n};\n\n// Helper function to create a realtime event in a typesafe way.\nexport function createRealtimeEvent<T extends keyof EventToPayloadMap>(\n  opts: ApiServerPayload<T>\n): CommonRealtimeFields & BroadcastedEvent<T> {\n  return {\n    affectedPages: {\n      currentPage: opts.page_id || \"\",\n      parentPage: opts.parent_id || null,\n      descendantPages: opts.descendants_ids || [],\n    },\n    workspace_slug: opts.workspace_slug,\n    project_id: opts.project_id || \"\",\n    teamspace_id: opts.teamspace_id || \"\",\n    user_id: opts.user_id,\n    timestamp: new Date().toISOString(),\n    action: opts.action,\n    data: opts.data,\n  };\n}\n\nexport type ApiServerPayload<T extends keyof EventToPayloadMap> = {\n  action: T;\n  descendants_ids: string[];\n  page_id?: string;\n  parent_id?: string;\n  data: EventToPayloadMap[T];\n  project_id?: string;\n  teamspace_id?: string;\n  workspace_slug: string;\n  user_id: string;\n};\n\n// Create a discriminated union for broadcast payloads.\n// For every key in EventToPayloadMap, we make a union member with the common fields.\nexport type BroadcastPayloadUnion = {\n  [K in keyof EventToPayloadMap]: ApiServerPayload<K>;\n}[keyof EventToPayloadMap];\n\nexport type BroadcastedEventUnion = {\n  [K in keyof EventToPayloadMap]: BroadcastedEvent<K>;\n}[keyof EventToPayloadMap];\n\nexport type BroadcastedEvent<T extends keyof EventToPayloadMap = keyof EventToPayloadMap> = CommonRealtimeFields & {\n  action: T;\n  data: EventToPayloadMap[T];\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,MAAaA,yBAAyC;CACpD,UAAU;CACV,WAAW;CACX,aAAa;CACb,YAAY;CACb;AAED,MAAa,4BAA4B;CAAC;CAAc;CAAa;CAAa;CAAc;CAAY;AAE5G,MAAa,iCAAiC;CAC5C;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACA;CACD;;;;AC7DD,IAAYC,gEAAL;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGF,MAAa,mBAAmB;CAE9BA,kBAAgB;CAChBA,kBAAgB;CAChBA,kBAAgB;CAChBA,kBAAgB;CAChBA,kBAAgB;CAGhBA,kBAAgB;CAChBA,kBAAgB;CAChBA,kBAAgB;CAChBA,kBAAgB;CAChBA,kBAAgB;CAGhBA,kBAAgB;CAGhBA,kBAAgB;CAChBA,kBAAgB;CAChBA,kBAAgB;CAChBA,kBAAgB;CACjB;;;;ACzDD,MAAa,uBAAuB,EAAE,UAAU,eAAe,yBAC7D,GACE,qEACA;CACE,mCAAmC,CAAC;CACpC,yCAAyC;CAC1C,EACD,mBACD;AAGH,MAAa,wBACX,WACA,aAKU;CACV,IAAI,QAAQ,UAAU,QAAQ;AAC9B,QAAO,QAAQ,GAAG;EAChB,MAAM,OAAO,UAAU,QAAQ,KAAK,MAAM;AAC1C,MAAI,SAAS,SAAS,KAAK,KAAK,KAAK,CACnC,QAAO;GACL;GACA,KAAK,UAAU,QAAQ,MAAM,MAAM,GAAG;GACtC;GAC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"}