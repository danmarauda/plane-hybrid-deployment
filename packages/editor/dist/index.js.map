{"version":3,"file":"index.js","names":["state: CollaborationState","logoValue: TLogoProps","newLogoValue: Partial<TCalloutBlockAttributes>","newLogoValueToStoreInLocalStorage: TLogoProps","isParentNodeCallout: Predicate","currentNode: Node | null","targetDepth: number | null","listDescendants: Array<{ node: Node; pos: number }>","MentionsListDropdown","uuidv4","component: ReactRenderer<CommandListInstance, MentionsListDropdownProps> | null","cleanup: () => void","editorRef: Editor | null","props","imageOptions: InsertImageComponentProps","extensionRegistry: TDocumentEditorAdditionalExtensionsRegistry[]","extensionRegistry","SLASH_COMMAND_SECTIONS: TSlashCommandSection[]","internalAdditionalOptions: TSlashCommandAdditionalOption[]","SlashCommandsMenu","component: ReactRenderer<CommandListInstance, SlashCommandsMenuProps> | null","cleanup: () => void","editorRef: Editor | null","rules: InputRule[]","props","uuidv4","dragSourceElement: Element | null","syncHandler: (() => void) | null","tr","allNodesInDoc: Array<{ node: ProseMirrorNode; pos: number }>","list: ProseMirrorNode[]","Fragment","uuidv4","Underline","Table","headings: IMarking[]","ranges: Array<number>","joinable: number[]","nodePosAtDOM","nodePosAtDOMForBlockQuotes","scrollAnimationFrame: number | null","isDraggedOutsideWindow: \"top\" | \"bottom\" | boolean","dragHandleElement: HTMLElement | null","view","droppedNode: Node | null","Fragment","result: Node[]","aiHandleElement: HTMLButtonElement | null","view","nodeSelection","editorSideMenu: HTMLDivElement | null","NODE_FILE_MAP: NodeFileMapType","CORE_EXTENSIONS","newFileSources: {\n        [nodeType: string]: Set<string> | undefined;\n      }","removedFiles: TFileNode[]","ADDITIONAL_ASSETS_META_DATA_RECORD: Partial<Record<ADDITIONAL_EXTENSIONS, TAssetMetaDataRecord>>","CORE_ASSETS_META_DATA_RECORD: Partial<\n  Record<CORE_EXTENSIONS | ADDITIONAL_EXTENSIONS, TAssetMetaDataRecord>\n>","CORE_EXTENSIONS","oldFileSources: {\n        [key: string]: Set<string> | undefined;\n      }","addedFiles: TFileNode[]","CORE_EXTENSIONS","asset","items: EditorMenuItem<TEditorCommands>[]","textAlignmentOptions: {\n    itemKey: TEditorCommands;\n    renderKey: string;\n    icon: LucideIcon;\n    command: () => void;\n    isActive: () => boolean;\n  }[]","editorState: EditorStateType","editor","bubbleMenuProps: EditorBubbleMenuProps","MENU_ITEMS: BlockMenuOption[]","item","itemKey","args","nodesArray: string[]","document","imageComponentHandler: AssetDuplicationHandler","uuidv4","assetDuplicationHandlers: Record<string, AssetDuplicationHandler>","useEditor","useTiptapEditor","editor","editor","useEditor","CollaborativeDocumentEditorInner: React.FC<ICollaborativeDocumentEditorProps>","CollaborativeDocumentEditor: React.FC<ICollaborativeDocumentEditorProps>","useEditor","additionalExtensions: Extensions","DocumentEditorWithRef","EditorContentWrapper: FC<Props>","useEditor","LiteTextEditorWithRef","extensionRegistry: TRichTextEditorAdditionalExtensionsRegistry[]","RichTextEditorWithRef","editor","EditorContainer: FC<Props>","scrollToNode","pos: number | null"],"sources":["../src/core/hooks/use-yjs-setup.ts","../src/core/contexts/collaboration-context.tsx","../src/core/extensions/callout/color-selector.tsx","../src/core/extensions/callout/logo-selector.tsx","../src/core/extensions/callout/block.tsx","../src/core/extensions/callout/extension.tsx","../src/core/extensions/code/code-block-node-view.tsx","../src/core/extensions/code/index.tsx","../src/core/extensions/custom-list-keymap/list-helpers.ts","../src/core/extensions/custom-list-keymap/list-keymap.ts","../src/core/extensions/mentions/mention-node-view.tsx","../src/core/extensions/mentions/mentions-list-dropdown.tsx","../src/core/extensions/mentions/utils.ts","../src/core/extensions/mentions/extension.tsx","../src/core/extensions/code/utils/replace-code-block-with-text.ts","../src/core/helpers/editor-commands.ts","../src/ce/extensions/core/extensions.ts","../src/ce/extensions/document-extensions.tsx","../src/ce/extensions/slash-commands.tsx","../src/core/extensions/slash-commands/command-items-list.tsx","../src/core/extensions/slash-commands/command-menu-item.tsx","../src/core/extensions/slash-commands/command-menu.tsx","../src/core/extensions/slash-commands/root.tsx","../src/core/extensions/typography/inputRules.ts","../src/core/extensions/typography/index.ts","../src/core/extensions/enter-key.ts","../src/core/extensions/custom-image/extension.tsx","../src/core/extensions/placeholder.ts","../src/ce/constants/extensions.ts","../src/core/extensions/unique-id/utils.ts","../src/core/extensions/unique-id/plugin.ts","../src/core/extensions/unique-id/extension.ts","../src/core/extensions/extensions.ts","../src/core/extensions/headings-list.ts","../src/core/extensions/keymap.ts","../src/core/plugins/drag-handle.ts","../src/core/plugins/ai-handle.ts","../src/core/extensions/side-menu.ts","../src/core/helpers/image-helpers.ts","../src/ce/constants/utility.ts","../src/core/plugins/file/delete.ts","../src/ce/constants/assets.ts","../src/core/helpers/assets.ts","../src/core/plugins/file/restore.ts","../src/core/plugins/file/root.ts","../src/core/plugins/markdown-clipboard.ts","../src/core/extensions/utility.ts","../src/core/components/menus/floating-menu/root.tsx","../src/core/components/menus/floating-menu/use-floating-menu.ts","../src/core/components/menus/menu-items.ts","../src/core/components/menus/bubble-menu/color-selector.tsx","../src/core/components/menus/bubble-menu/node-selector.tsx","../src/core/components/menus/bubble-menu/alignment-selector.tsx","../src/core/components/menus/bubble-menu/link-selector.tsx","../src/core/components/menus/bubble-menu/root.tsx","../src/core/components/menus/block-menu-options.tsx","../src/core/components/menus/block-menu.tsx","../src/core/helpers/insert-content-at-cursor-position.ts","../src/core/helpers/scroll-to-node.ts","../src/core/helpers/editor-ref.ts","../src/ce/helpers/asset-duplication.ts","../src/core/helpers/paste-asset.ts","../src/core/props.ts","../src/core/hooks/use-editor.ts","../src/core/hooks/use-editor-navigation.ts","../src/core/hooks/use-title-editor.ts","../src/core/hooks/use-collaborative-editor.ts","../src/core/components/editors/document/collaborative-editor.tsx","../src/core/components/editors/document/editor.tsx","../src/core/components/editors/document/loader.tsx","../src/core/components/editors/document/page-renderer.tsx","../src/core/components/editors/editor-content.tsx","../src/core/components/editors/editor-wrapper.tsx","../src/core/components/editors/lite-text/editor.tsx","../src/ce/extensions/rich-text-extensions.tsx","../src/core/components/editors/rich-text/editor.tsx","../src/core/components/links/link-edit-view.tsx","../src/core/components/links/link-preview.tsx","../src/core/components/links/link-view.tsx","../src/core/components/editors/link-view-container.tsx","../src/ce/components/link-container.tsx","../src/core/plugins/highlight.ts","../src/core/components/editors/editor-container.tsx","../src/core/extensions/trailing-node.ts"],"sourcesContent":["import { HocuspocusProvider } from \"@hocuspocus/provider\";\n// react\nimport { useCallback, useEffect, useRef, useState } from \"react\";\n// indexeddb\nimport { IndexeddbPersistence } from \"y-indexeddb\";\n// yjs\nimport type * as Y from \"yjs\";\n// types\nimport type { CollaborationState, CollabStage, CollaborationError } from \"@/types/collaboration\";\n\n// Helper to check if a close code indicates a forced close\nconst isForcedCloseCode = (code: number | undefined): boolean => {\n  if (!code) return false;\n  // All custom close codes (4000-4003) are treated as forced closes\n  return code >= 4000 && code <= 4003;\n};\n\ntype UseYjsSetupArgs = {\n  docId: string;\n  serverUrl: string;\n  authToken: string;\n  onStateChange?: (state: CollaborationState) => void;\n  options?: {\n    maxConnectionAttempts?: number;\n  };\n};\n\nconst DEFAULT_MAX_RETRIES = 3;\n\nexport const useYjsSetup = ({ docId, serverUrl, authToken, onStateChange }: UseYjsSetupArgs) => {\n  // Current collaboration stage\n  const [stage, setStage] = useState<CollabStage>({ kind: \"initial\" });\n\n  // Cache readiness state\n  const [hasCachedContent, setHasCachedContent] = useState(false);\n  const [isCacheReady, setIsCacheReady] = useState(false);\n\n  // Provider and Y.Doc in state (nullable until effect runs)\n  const [yjsSession, setYjsSession] = useState<{ provider: HocuspocusProvider; ydoc: Y.Doc } | null>(null);\n\n  // Use refs for values that need to be mutated from callbacks\n  const retryCountRef = useRef(0);\n  const forcedCloseSignalRef = useRef(false);\n  const isDisposedRef = useRef(false);\n  const stageRef = useRef<CollabStage>({ kind: \"initial\" });\n  const lastReconnectTimeRef = useRef(0);\n\n  // Create/destroy provider in effect (not during render)\n  useEffect(() => {\n    // Reset refs when creating new provider (e.g., document switch)\n    retryCountRef.current = 0;\n    isDisposedRef.current = false;\n    forcedCloseSignalRef.current = false;\n    stageRef.current = { kind: \"initial\" };\n\n    const provider = new HocuspocusProvider({\n      name: docId,\n      token: authToken,\n      url: serverUrl,\n      onAuthenticationFailed: () => {\n        if (isDisposedRef.current) return;\n        const error: CollaborationError = { type: \"auth-failed\", message: \"Authentication failed\" };\n        const newStage = { kind: \"disconnected\" as const, error };\n        stageRef.current = newStage;\n        setStage(newStage);\n      },\n      onConnect: () => {\n        if (isDisposedRef.current) {\n          provider?.disconnect();\n          return;\n        }\n        retryCountRef.current = 0;\n        // After successful connection, transition to awaiting-sync (onSynced will move to synced)\n        const newStage = { kind: \"awaiting-sync\" as const };\n        stageRef.current = newStage;\n        setStage(newStage);\n      },\n      onStatus: ({ status: providerStatus }) => {\n        if (isDisposedRef.current) return;\n        if (providerStatus === \"connecting\") {\n          // Derive whether this is initial connect or reconnection from retry count\n          const isReconnecting = retryCountRef.current > 0;\n          setStage(isReconnecting ? { kind: \"reconnecting\", attempt: retryCountRef.current } : { kind: \"connecting\" });\n        } else if (providerStatus === \"disconnected\") {\n          // Do not transition here; let handleClose decide the final stage\n        } else if (providerStatus === \"connected\") {\n          // Connection succeeded, move to awaiting-sync\n          const newStage = { kind: \"awaiting-sync\" as const };\n          stageRef.current = newStage;\n          setStage(newStage);\n        }\n      },\n      onSynced: () => {\n        if (isDisposedRef.current) return;\n        retryCountRef.current = 0;\n        // Document sync complete\n        const newStage = { kind: \"synced\" as const };\n        stageRef.current = newStage;\n        setStage(newStage);\n      },\n    });\n\n    const pauseProvider = () => {\n      const wsProvider = provider.configuration.websocketProvider;\n      if (wsProvider) {\n        try {\n          wsProvider.shouldConnect = false;\n          wsProvider.disconnect();\n        } catch (error) {\n          console.error(`Error pausing websocketProvider:`, error);\n        }\n      }\n    };\n\n    const permanentlyStopProvider = () => {\n      isDisposedRef.current = true;\n\n      const wsProvider = provider.configuration.websocketProvider;\n      if (wsProvider) {\n        try {\n          wsProvider.shouldConnect = false;\n          wsProvider.disconnect();\n          wsProvider.destroy();\n        } catch (error) {\n          console.error(`Error tearing down websocketProvider:`, error);\n        }\n      }\n      try {\n        provider.destroy();\n      } catch (error) {\n        console.error(`Error destroying provider:`, error);\n      }\n    };\n\n    const handleClose = (closeEvent: { event?: { code?: number; reason?: string } }) => {\n      if (isDisposedRef.current) return;\n\n      const closeCode = closeEvent.event?.code;\n      const wsProvider = provider.configuration.websocketProvider;\n      const shouldConnect = wsProvider.shouldConnect;\n      const isForcedClose = isForcedCloseCode(closeCode) || forcedCloseSignalRef.current || shouldConnect === false;\n\n      if (isForcedClose) {\n        // Determine if this is a manual disconnect or a permanent error\n        const isManualDisconnect = shouldConnect === false;\n\n        const error: CollaborationError = {\n          type: \"forced-close\",\n          code: closeCode || 0,\n          message: isManualDisconnect ? \"Manually disconnected\" : \"Server forced connection close\",\n        };\n        const newStage = { kind: \"disconnected\" as const, error };\n        stageRef.current = newStage;\n        setStage(newStage);\n\n        retryCountRef.current = 0;\n        forcedCloseSignalRef.current = false;\n\n        // Only pause if it's a real forced close (not manual disconnect)\n        // Manual disconnect leaves it as is (shouldConnect=false already set if manual)\n        if (!isManualDisconnect) {\n          pauseProvider();\n        }\n      } else {\n        // Transient connection loss: attempt reconnection\n        retryCountRef.current++;\n\n        if (retryCountRef.current >= DEFAULT_MAX_RETRIES) {\n          // Exceeded max retry attempts\n          const error: CollaborationError = {\n            type: \"max-retries\",\n            message: `Failed to connect after ${DEFAULT_MAX_RETRIES} attempts`,\n          };\n          const newStage = { kind: \"disconnected\" as const, error };\n          stageRef.current = newStage;\n          setStage(newStage);\n\n          pauseProvider();\n        } else {\n          // Still have retries left, move to reconnecting\n          const newStage = { kind: \"reconnecting\" as const, attempt: retryCountRef.current };\n          stageRef.current = newStage;\n          setStage(newStage);\n        }\n      }\n    };\n\n    provider.on(\"close\", handleClose);\n\n    setYjsSession({ provider, ydoc: provider.document as Y.Doc });\n\n    // Handle page visibility changes (sleep/wake, tab switching)\n    const handleVisibilityChange = (event?: Event) => {\n      if (isDisposedRef.current) return;\n\n      const isVisible = document.visibilityState === \"visible\";\n      const isFocus = event?.type === \"focus\";\n\n      if (isVisible || isFocus) {\n        // Throttle reconnection attempts to avoid double-firing (visibility + focus)\n        const now = Date.now();\n        if (now - lastReconnectTimeRef.current < 1000) {\n          return;\n        }\n\n        const wsProvider = provider.configuration.websocketProvider;\n        if (!wsProvider) return;\n\n        const ws = wsProvider.webSocket;\n        const isStale = ws?.readyState === WebSocket.CLOSED || ws?.readyState === WebSocket.CLOSING;\n\n        // If disconnected or stale, re-enable reconnection and force reconnect\n        if (isStale || stageRef.current.kind === \"disconnected\") {\n          lastReconnectTimeRef.current = now;\n\n          // Re-enable connection on tab focus (even if manually disconnected before sleep)\n          wsProvider.shouldConnect = true;\n\n          // Reset retry count for fresh reconnection attempt\n          retryCountRef.current = 0;\n\n          // Move to connecting state\n          const newStage = { kind: \"connecting\" as const };\n          stageRef.current = newStage;\n          setStage(newStage);\n\n          wsProvider.disconnect();\n          wsProvider.connect();\n        }\n      }\n    };\n\n    // Handle online/offline events\n    const handleOnline = () => {\n      if (isDisposedRef.current) return;\n\n      const wsProvider = provider.configuration.websocketProvider;\n      if (wsProvider) {\n        wsProvider.shouldConnect = true;\n        wsProvider.disconnect();\n        wsProvider.connect();\n      }\n    };\n\n    document.addEventListener(\"visibilitychange\", handleVisibilityChange);\n    window.addEventListener(\"focus\", handleVisibilityChange);\n    window.addEventListener(\"online\", handleOnline);\n\n    return () => {\n      try {\n        provider.off(\"close\", handleClose);\n      } catch (error) {\n        console.error(`Error unregistering close handler:`, error);\n      }\n\n      document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\n      window.removeEventListener(\"focus\", handleVisibilityChange);\n      window.removeEventListener(\"online\", handleOnline);\n\n      permanentlyStopProvider();\n    };\n  }, [docId, serverUrl, authToken]);\n\n  // IndexedDB persistence lifecycle\n  useEffect(() => {\n    if (!yjsSession) return;\n\n    const idbPersistence = new IndexeddbPersistence(docId, yjsSession.provider.document);\n\n    const onIdbSynced = () => {\n      const yFragment = idbPersistence.doc.getXmlFragment(\"default\");\n      const docLength = yFragment?.length ?? 0;\n      setIsCacheReady(true);\n      setHasCachedContent(docLength > 0);\n    };\n\n    idbPersistence.on(\"synced\", onIdbSynced);\n\n    return () => {\n      idbPersistence.off(\"synced\", onIdbSynced);\n      try {\n        idbPersistence.destroy();\n      } catch (error) {\n        console.error(`Error destroying local provider:`, error);\n      }\n    };\n  }, [docId, yjsSession]);\n\n  // Observe Y.Doc content changes to update hasCachedContent (catches fallback scenario)\n  useEffect(() => {\n    if (!yjsSession || !isCacheReady) return;\n\n    const fragment = yjsSession.ydoc.getXmlFragment(\"default\");\n    let lastHasContent = false;\n\n    const updateCachedContentFlag = () => {\n      const len = fragment?.length ?? 0;\n      const hasContent = len > 0;\n\n      // Only update state if the boolean value actually changed\n      if (hasContent !== lastHasContent) {\n        lastHasContent = hasContent;\n        setHasCachedContent(hasContent);\n      }\n    };\n    // Initial check (handles fallback content loaded before this effect runs)\n    updateCachedContentFlag();\n\n    // Use observeDeep to catch nested changes (keystrokes modify Y.XmlText inside Y.XmlElement)\n    fragment.observeDeep(updateCachedContentFlag);\n\n    return () => {\n      try {\n        fragment.unobserveDeep(updateCachedContentFlag);\n      } catch (error) {\n        console.error(\"Error unobserving fragment:\", error);\n      }\n    };\n  }, [yjsSession, isCacheReady]);\n\n  // Notify state changes callback (use ref to avoid dependency on handler)\n  const stateChangeCallbackRef = useRef(onStateChange);\n  stateChangeCallbackRef.current = onStateChange;\n\n  useEffect(() => {\n    if (!stateChangeCallbackRef.current) return;\n\n    const isServerSynced = stage.kind === \"synced\";\n    const isServerDisconnected = stage.kind === \"disconnected\";\n\n    const state: CollaborationState = {\n      stage,\n      isServerSynced,\n      isServerDisconnected,\n    };\n\n    stateChangeCallbackRef.current(state);\n  }, [stage]);\n\n  // Derived values for convenience\n  const isServerSynced = stage.kind === \"synced\";\n  const isServerDisconnected = stage.kind === \"disconnected\";\n  const isDocReady = isServerSynced || isServerDisconnected || (isCacheReady && hasCachedContent);\n\n  const signalForcedClose = useCallback((value: boolean) => {\n    forcedCloseSignalRef.current = value;\n  }, []);\n\n  // Don't return anything until provider is ready - guarantees non-null provider\n  if (!yjsSession) {\n    return null;\n  }\n\n  return {\n    provider: yjsSession.provider,\n    ydoc: yjsSession.ydoc,\n    state: {\n      stage,\n      hasCachedContent,\n      isCacheReady,\n      isServerSynced,\n      isServerDisconnected,\n      isDocReady,\n    },\n    actions: {\n      signalForcedClose,\n    },\n  };\n};\n","import React, { createContext, useContext } from \"react\";\n// hooks\nimport { useYjsSetup } from \"@/hooks/use-yjs-setup\";\n\nexport type TCollabValue = NonNullable<ReturnType<typeof useYjsSetup>>;\n\nconst CollabContext = createContext<TCollabValue | null>(null);\n\ntype CollabProviderProps = Parameters<typeof useYjsSetup>[0] & {\n  fallback?: React.ReactNode;\n  children: React.ReactNode;\n};\n\nexport function CollaborationProvider({ fallback = null, children, ...args }: CollabProviderProps) {\n  const setup = useYjsSetup(args);\n\n  // Only wait for provider setup, not content ready\n  // Consumers can check state.isDocReady to gate content rendering\n  if (!setup) {\n    return <>{fallback}</>;\n  }\n\n  return <CollabContext.Provider value={setup}>{children}</CollabContext.Provider>;\n}\n\nexport function useCollaboration(): TCollabValue {\n  const ctx = useContext(CollabContext);\n  if (!ctx) {\n    throw new Error(\"useCollaboration must be used inside <CollaborationProvider>\");\n  }\n  return ctx; // guaranteed non-null\n}\n","import { Ban } from \"lucide-react\";\nimport { ChevronDownIcon } from \"@plane/propel/icons\";\n// plane utils\nimport { cn } from \"@plane/utils\";\n// constants\nimport { COLORS_LIST } from \"@/constants/common\";\n\ntype Props = {\n  disabled: boolean;\n  isOpen: boolean;\n  onSelect: (color: string | null) => void;\n  toggleDropdown: () => void;\n};\n\nexport function CalloutBlockColorSelector(props: Props) {\n  const { disabled, isOpen, onSelect, toggleDropdown } = props;\n\n  const handleColorSelect = (val: string | null) => {\n    onSelect(val);\n    toggleDropdown();\n  };\n\n  return (\n    <div\n      className={cn(\"opacity-0 pointer-events-none absolute top-2 right-2 z-10 transition-opacity\", {\n        \"group-hover/callout-node:opacity-100 group-hover/callout-node:pointer-events-auto\": !disabled,\n        \"opacity-100 pointer-events-auto\": isOpen,\n      })}\n      contentEditable={false}\n    >\n      <div className=\"relative\">\n        <button\n          type=\"button\"\n          onClick={(e) => {\n            toggleDropdown();\n            e.stopPropagation();\n          }}\n          className={cn(\n            \"flex items-center gap-1 h-full whitespace-nowrap py-1 px-2.5 text-sm font-medium text-custom-text-300 hover:bg-white/10 active:bg-custom-background-80 rounded transition-colors\",\n            {\n              \"bg-white/10\": isOpen,\n            }\n          )}\n          disabled={disabled}\n        >\n          <span>Color</span>\n          <ChevronDownIcon className=\"flex-shrink-0 size-3\" />\n        </button>\n        {isOpen && (\n          <section className=\"absolute top-full right-0 z-10 mt-1 rounded-md border-[0.5px] border-custom-border-300 bg-custom-background-100 p-2 shadow-custom-shadow-rg animate-in fade-in slide-in-from-top-1\">\n            <div className=\"flex items-center gap-2\">\n              {COLORS_LIST.map((color) => (\n                <button\n                  key={color.key}\n                  type=\"button\"\n                  className=\"flex-shrink-0 size-6 rounded border-[0.5px] border-custom-border-400 hover:opacity-60 transition-opacity\"\n                  style={{\n                    backgroundColor: color.backgroundColor,\n                  }}\n                  onClick={() => handleColorSelect(color.key)}\n                />\n              ))}\n              <button\n                type=\"button\"\n                className=\"flex-shrink-0 size-6 grid place-items-center rounded text-custom-text-300 border-[0.5px] border-custom-border-400 hover:bg-custom-background-80 transition-colors\"\n                onClick={() => handleColorSelect(null)}\n              >\n                <Ban className=\"size-4\" />\n              </button>\n            </div>\n          </section>\n        )}\n      </div>\n    </div>\n  );\n}\n","// plane imports\nimport { EmojiPicker, EmojiIconPickerTypes, Logo } from \"@plane/propel/emoji-icon-picker\";\nimport type { TLogoProps } from \"@plane/types\";\nimport { cn } from \"@plane/utils\";\n// types\nimport type { TCalloutBlockAttributes } from \"./types\";\n// utils\nimport { DEFAULT_CALLOUT_BLOCK_ATTRIBUTES, updateStoredLogo } from \"./utils\";\n\ntype Props = {\n  blockAttributes: TCalloutBlockAttributes;\n  disabled: boolean;\n  handleOpen: (val: boolean) => void;\n  isOpen: boolean;\n  updateAttributes: (attrs: Partial<TCalloutBlockAttributes>) => void;\n};\n\nexport function CalloutBlockLogoSelector(props: Props) {\n  const { blockAttributes, disabled, handleOpen, isOpen, updateAttributes } = props;\n\n  const logoValue: TLogoProps = {\n    in_use: blockAttributes[\"data-logo-in-use\"],\n    icon: {\n      color: blockAttributes[\"data-icon-color\"],\n      name: blockAttributes[\"data-icon-name\"],\n    },\n    emoji: {\n      value: blockAttributes[\"data-emoji-unicode\"]?.toString(),\n      url: blockAttributes[\"data-emoji-url\"],\n    },\n  };\n\n  return (\n    <div contentEditable={false}>\n      <EmojiPicker\n        closeOnSelect={false}\n        isOpen={isOpen}\n        handleToggle={handleOpen}\n        className=\"flex-shrink-0 grid place-items-center\"\n        buttonClassName={cn(\"flex-shrink-0 size-8 grid place-items-center rounded-lg\", {\n          \"hover:bg-white/10\": !disabled,\n        })}\n        label={<Logo logo={logoValue} size={18} type=\"lucide\" />}\n        onChange={(val) => {\n          // construct the new logo value based on the type of value\n          let newLogoValue: Partial<TCalloutBlockAttributes> = {};\n          let newLogoValueToStoreInLocalStorage: TLogoProps = {\n            in_use: \"emoji\",\n            emoji: {\n              value: DEFAULT_CALLOUT_BLOCK_ATTRIBUTES[\"data-emoji-unicode\"],\n              url: DEFAULT_CALLOUT_BLOCK_ATTRIBUTES[\"data-emoji-url\"],\n            },\n          };\n          if (val.type === \"emoji\") {\n            // val.value is now a string in decimal format (e.g. \"128512\")\n            const emojiValue = val.value;\n            newLogoValue = {\n              \"data-emoji-unicode\": emojiValue,\n              \"data-emoji-url\": undefined,\n            };\n            newLogoValueToStoreInLocalStorage = {\n              in_use: \"emoji\",\n              emoji: {\n                value: emojiValue,\n                url: undefined,\n              },\n            };\n          } else if (val.type === \"icon\") {\n            const iconValue = val.value as { name: string; color: string };\n            newLogoValue = {\n              \"data-icon-name\": iconValue.name,\n              \"data-icon-color\": iconValue.color,\n            };\n            newLogoValueToStoreInLocalStorage = {\n              in_use: \"icon\",\n              icon: {\n                name: iconValue.name,\n                color: iconValue.color,\n              },\n            };\n          }\n          // update node attributes\n          updateAttributes({\n            \"data-logo-in-use\": val.type,\n            ...newLogoValue,\n          });\n          // update stored logo in local storage\n          updateStoredLogo(newLogoValueToStoreInLocalStorage);\n          handleOpen(false);\n        }}\n        defaultIconColor={logoValue?.in_use && logoValue.in_use === \"icon\" ? logoValue?.icon?.color : undefined}\n        defaultOpen={logoValue.in_use === \"emoji\" ? EmojiIconPickerTypes.EMOJI : EmojiIconPickerTypes.ICON}\n        disabled={disabled}\n        searchDisabled\n      />\n    </div>\n  );\n}\n","import type { NodeViewProps } from \"@tiptap/react\";\nimport { NodeViewContent, NodeViewWrapper } from \"@tiptap/react\";\nimport React, { useState } from \"react\";\n// constants\nimport { COLORS_LIST } from \"@/constants/common\";\n// local components\nimport { CalloutBlockColorSelector } from \"./color-selector\";\nimport { CalloutBlockLogoSelector } from \"./logo-selector\";\n// types\nimport type { TCalloutBlockAttributes } from \"./types\";\nimport { ECalloutAttributeNames } from \"./types\";\n// utils\nimport { updateStoredBackgroundColor } from \"./utils\";\n\nexport type CustomCalloutNodeViewProps = NodeViewProps & {\n  node: NodeViewProps[\"node\"] & {\n    attrs: TCalloutBlockAttributes;\n  };\n  updateAttributes: (attrs: Partial<TCalloutBlockAttributes>) => void;\n};\n\nexport function CustomCalloutBlock(props: CustomCalloutNodeViewProps) {\n  const { editor, node, updateAttributes } = props;\n  // states\n  const [isEmojiPickerOpen, setIsEmojiPickerOpen] = useState(false);\n  const [isColorPickerOpen, setIsColorPickerOpen] = useState(false);\n  // derived values\n  const activeBackgroundColor = COLORS_LIST.find((c) => node.attrs[\"data-background\"] === c.key)?.backgroundColor;\n\n  return (\n    <NodeViewWrapper\n      className=\"editor-callout-component group/callout-node relative bg-custom-background-90 rounded-lg text-custom-text-100 p-4 my-2 flex items-start gap-4 transition-colors duration-500 break-words\"\n      style={{\n        backgroundColor: activeBackgroundColor,\n      }}\n    >\n      <CalloutBlockLogoSelector\n        blockAttributes={node.attrs}\n        disabled={!editor.isEditable}\n        isOpen={isEmojiPickerOpen}\n        handleOpen={(val) => setIsEmojiPickerOpen(val)}\n        updateAttributes={updateAttributes}\n      />\n      <CalloutBlockColorSelector\n        disabled={!editor.isEditable}\n        isOpen={isColorPickerOpen}\n        toggleDropdown={() => setIsColorPickerOpen((prev) => !prev)}\n        onSelect={(val) => {\n          updateAttributes({\n            [ECalloutAttributeNames.BACKGROUND]: val,\n          });\n          updateStoredBackgroundColor(val);\n        }}\n      />\n      <NodeViewContent as=\"div\" className=\"w-full break-words\" />\n    </NodeViewWrapper>\n  );\n}\n","import { findParentNodeClosestToPos, ReactNodeViewRenderer } from \"@tiptap/react\";\nimport type { Predicate } from \"@tiptap/react\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// helpers\nimport { insertEmptyParagraphAtNodeBoundaries } from \"@/helpers/insert-empty-paragraph-at-node-boundary\";\n// local imports\nimport { CustomCalloutBlock } from \"./block\";\nimport type { CustomCalloutNodeViewProps } from \"./block\";\nimport { CustomCalloutExtensionConfig } from \"./extension-config\";\nimport type { CustomCalloutExtensionOptions, CustomCalloutExtensionStorage } from \"./types\";\nimport { getStoredBackgroundColor, getStoredLogo } from \"./utils\";\n\nexport const CustomCalloutExtension = CustomCalloutExtensionConfig.extend<\n  CustomCalloutExtensionOptions,\n  CustomCalloutExtensionStorage\n>({\n  selectable: true,\n  draggable: true,\n\n  addCommands() {\n    return {\n      insertCallout:\n        () =>\n        ({ commands }) => {\n          // get stored logo values and background color from the local storage\n          const storedLogoValues = getStoredLogo();\n          const storedBackgroundValue = getStoredBackgroundColor();\n\n          return commands.insertContent({\n            type: this.name,\n            content: [\n              {\n                type: CORE_EXTENSIONS.PARAGRAPH,\n              },\n            ],\n            attrs: {\n              ...storedLogoValues,\n              \"data-background\": storedBackgroundValue,\n            },\n          });\n        },\n    };\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      Backspace: ({ editor }) => {\n        const { $from, empty } = editor.state.selection;\n        try {\n          const isParentNodeCallout: Predicate = (node) => node.type === this.type;\n          const parentNodeDetails = findParentNodeClosestToPos($from, isParentNodeCallout);\n          // Check if selection is empty and at the beginning of the callout\n          if (empty && parentNodeDetails) {\n            const isCursorAtCalloutBeginning = $from.pos === parentNodeDetails.start + 1;\n            if (parentNodeDetails.node.content.size > 2 && isCursorAtCalloutBeginning) {\n              editor.commands.setTextSelection(parentNodeDetails.pos - 1);\n              return true;\n            }\n          }\n        } catch (error) {\n          console.error(\"Error in performing backspace action on callout\", error);\n        }\n        return false; // Allow the default behavior if conditions are not met\n      },\n      ArrowDown: insertEmptyParagraphAtNodeBoundaries(\"down\", this.name),\n      ArrowUp: insertEmptyParagraphAtNodeBoundaries(\"up\", this.name),\n    };\n  },\n\n  addNodeView() {\n    return ReactNodeViewRenderer((props) => (\n      <CustomCalloutBlock {...props} node={props.node as CustomCalloutNodeViewProps[\"node\"]} />\n    ));\n  },\n});\n","import type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\nimport { NodeViewWrapper, NodeViewContent } from \"@tiptap/react\";\nimport ts from \"highlight.js/lib/languages/typescript\";\nimport { common, createLowlight } from \"lowlight\";\nimport { CopyIcon, CheckIcon } from \"lucide-react\";\nimport { useState } from \"react\";\n// ui\nimport { Tooltip } from \"@plane/ui\";\n// plane utils\nimport { cn } from \"@plane/utils\";\n\n// we just have ts support for now\nconst lowlight = createLowlight(common);\nlowlight.register(\"ts\", ts);\n\ntype Props = {\n  node: ProseMirrorNode;\n};\n\nexport function CodeBlockComponent({ node }: Props) {\n  const [copied, setCopied] = useState(false);\n\n  const copyToClipboard = async (e: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n    try {\n      await navigator.clipboard.writeText(node.textContent);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 1000);\n    } catch {\n      setCopied(false);\n    }\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  return (\n    <NodeViewWrapper className=\"code-block relative group/code\">\n      <Tooltip tooltipContent=\"Copy code\">\n        <button\n          type=\"button\"\n          className={cn(\n            \"group/button hidden group-hover/code:flex items-center justify-center absolute top-2 right-2 z-10 size-8 rounded-md bg-custom-background-80 border border-custom-border-200 transition duration-150 ease-in-out backdrop-blur-sm\",\n            {\n              \"bg-green-500/30 hover:bg-green-500/30 active:bg-green-500/30\": copied,\n            }\n          )}\n          onClick={copyToClipboard}\n        >\n          {copied ? (\n            <CheckIcon className=\"h-3 w-3 text-green-500\" strokeWidth={3} />\n          ) : (\n            <CopyIcon className=\"h-3 w-3 text-custom-text-300 group-hover/button:text-custom-text-100\" />\n          )}\n        </button>\n      </Tooltip>\n\n      <pre className=\"bg-custom-background-90 text-custom-text-100 rounded-lg p-4 my-2\">\n        <NodeViewContent as=\"code\" className=\"whitespace-pre-wrap\" />\n      </pre>\n    </NodeViewWrapper>\n  );\n}\n","import { Selection } from \"@tiptap/pm/state\";\nimport { ReactNodeViewRenderer } from \"@tiptap/react\";\nimport ts from \"highlight.js/lib/languages/typescript\";\nimport { common, createLowlight } from \"lowlight\";\n// components\nimport { CodeBlockLowlight } from \"./code-block-lowlight\";\nimport { CodeBlockComponent } from \"./code-block-node-view\";\n\nconst lowlight = createLowlight(common);\nlowlight.register(\"ts\", ts);\n\nexport const CustomCodeBlockExtension = CodeBlockLowlight.extend({\n  addNodeView() {\n    return ReactNodeViewRenderer(CodeBlockComponent);\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      Tab: ({ editor }) => {\n        try {\n          const { state } = editor;\n          const { selection } = state;\n          const { $from, empty } = selection;\n\n          if (!empty || $from.parent.type !== this.type) {\n            return false;\n          }\n\n          // Use ProseMirror's insertText transaction to insert the tab character\n          const tr = state.tr.insertText(\"\\t\", $from.pos, $from.pos);\n          editor.view.dispatch(tr);\n\n          return true;\n        } catch (error) {\n          console.error(\"Error handling Tab in CustomCodeBlockExtension:\", error);\n          return false;\n        }\n      },\n      ArrowUp: ({ editor }) => {\n        try {\n          const { state } = editor;\n          const { selection } = state;\n          const { $from, empty } = selection;\n\n          if (!empty || $from.parent.type !== this.type) {\n            return false;\n          }\n\n          const isAtStart = $from.parentOffset === 0;\n\n          if (!isAtStart) {\n            return false;\n          }\n\n          // Check if codeBlock is the first node\n          const isFirstNode = $from.depth === 1 && $from.index($from.depth - 1) === 0;\n\n          if (isFirstNode) {\n            // Insert a new paragraph at the start of the document and move the cursor to it\n            return editor.commands.command(({ tr }) => {\n              const node = editor.schema.nodes.paragraph.create();\n              tr.insert(0, node);\n              tr.setSelection(Selection.near(tr.doc.resolve(1)));\n              return true;\n            });\n          }\n\n          return false;\n        } catch (error) {\n          console.error(\"Error handling ArrowUp in CustomCodeBlockExtension:\", error);\n          return false;\n        }\n      },\n      ArrowDown: ({ editor }) => {\n        try {\n          if (!this.options.exitOnArrowDown) {\n            return false;\n          }\n\n          const { state } = editor;\n          const { selection, doc } = state;\n          const { $from, empty } = selection;\n\n          if (!empty || $from.parent.type !== this.type) {\n            return false;\n          }\n\n          const isAtEnd = $from.parentOffset === $from.parent.nodeSize - 2;\n\n          if (!isAtEnd) {\n            return false;\n          }\n\n          const after = $from.after();\n\n          if (after === undefined) {\n            return false;\n          }\n\n          const nodeAfter = doc.nodeAt(after);\n\n          if (nodeAfter) {\n            return editor.commands.command(({ tr }) => {\n              tr.setSelection(Selection.near(doc.resolve(after)));\n              return true;\n            });\n          }\n\n          return editor.commands.exitCode();\n        } catch (error) {\n          console.error(\"Error handling ArrowDown in CustomCodeBlockExtension:\", error);\n          return false;\n        }\n      },\n    };\n  },\n}).configure({\n  lowlight,\n  defaultLanguage: \"plaintext\",\n  exitOnTripleEnter: false,\n  HTMLAttributes: {\n    class: \"\",\n  },\n});\n","import type { Editor } from \"@tiptap/core\";\nimport { getNodeType, getNodeAtPosition, isAtEndOfNode, isAtStartOfNode, isNodeActive } from \"@tiptap/core\";\nimport type { Node, NodeType } from \"@tiptap/pm/model\";\nimport type { EditorState } from \"@tiptap/pm/state\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n\nconst findListItemPos = (typeOrName: string | NodeType, state: EditorState) => {\n  const { $from } = state.selection;\n  const nodeType = getNodeType(typeOrName, state.schema);\n\n  let currentNode: Node | null = null;\n  let currentDepth = $from.depth;\n  let currentPos = $from.pos;\n  let targetDepth: number | null = null;\n\n  while (currentDepth > 0 && targetDepth === null) {\n    currentNode = $from.node(currentDepth);\n\n    if (currentNode.type === nodeType) {\n      targetDepth = currentDepth;\n    } else {\n      currentDepth -= 1;\n      currentPos -= 1;\n    }\n  }\n\n  if (targetDepth === null) {\n    return null;\n  }\n\n  return { $pos: state.doc.resolve(currentPos), depth: targetDepth };\n};\n\nconst nextListIsDeeper = (typeOrName: string, state: EditorState) => {\n  const listDepth = getNextListDepth(typeOrName, state);\n  const listItemPos = findListItemPos(typeOrName, state);\n\n  if (!listItemPos || !listDepth) {\n    return false;\n  }\n\n  if (listDepth > listItemPos.depth) {\n    return true;\n  }\n\n  return false;\n};\n\nconst getNextListDepth = (typeOrName: string, state: EditorState) => {\n  const listItemPos = findListItemPos(typeOrName, state);\n\n  if (!listItemPos) {\n    return false;\n  }\n\n  const [, depth] = getNodeAtPosition(state, typeOrName, listItemPos.$pos.pos + 4);\n\n  return depth;\n};\n\nconst getPrevListDepth = (typeOrName: string, state: EditorState) => {\n  const listItemPos = findListItemPos(typeOrName, state);\n\n  if (!listItemPos) {\n    return false;\n  }\n\n  let depth = 0;\n  const pos = listItemPos.$pos;\n\n  // Adjust the position to ensure we're within the list item, especially for edge cases\n  const resolvedPos = state.doc.resolve(Math.max(pos.pos - 1, 0));\n\n  // Traverse up the document structure from the adjusted position\n  for (let d = resolvedPos.depth; d > 0; d--) {\n    const node = resolvedPos.node(d);\n    if (\n      [CORE_EXTENSIONS.BULLET_LIST, CORE_EXTENSIONS.ORDERED_LIST, CORE_EXTENSIONS.TASK_LIST].includes(\n        node.type.name as CORE_EXTENSIONS\n      )\n    ) {\n      // Increment depth for each list ancestor found\n      depth++;\n    }\n  }\n\n  // Subtract 1 from the calculated depth to get the parent list's depth\n  // This adjustment is necessary because the depth calculation includes the current list\n  // By subtracting 1, we aim to get the depth of the parent list, which helps in identifying if the current list is a sublist\n  depth = depth > 0 ? depth - 1 : 0;\n\n  // Double the depth value to get results as 2, 4, 6, 8, etc.\n  depth = depth * 2;\n\n  return depth;\n};\n\nexport const handleBackspace = (editor: Editor, name: string, parentListTypes: string[]) => {\n  // this is required to still handle the undo handling\n  if (editor.commands.undoInputRule()) {\n    return true;\n  }\n  // Check if a node range is selected, and if so, fall back to default backspace functionality\n  const { from, to } = editor.state.selection;\n  if (from !== to) {\n    // A range is selected, not just a cursor position; fall back to default behavior\n    return false; // Let the editor handle backspace by default\n  }\n\n  // if the current item is NOT inside a list item &\n  // the previous item is a list (orderedList or bulletList)\n  // move the cursor into the list and delete the current item\n  if (!isNodeActive(editor.state, name) && hasListBefore(editor.state, name, parentListTypes)) {\n    const { $anchor } = editor.state.selection;\n\n    const $listPos = editor.state.doc.resolve($anchor.before() - 1);\n\n    const listDescendants: Array<{ node: Node; pos: number }> = [];\n\n    $listPos.node().descendants((node, pos) => {\n      if (node.type.name === name) {\n        listDescendants.push({ node, pos });\n      }\n    });\n\n    const lastItem = listDescendants.at(-1);\n\n    if (!lastItem) {\n      return false;\n    }\n\n    const $lastItemPos = editor.state.doc.resolve($listPos.start() + lastItem.pos + 1);\n\n    // Check if positions are within the valid range\n    const startPos = $anchor.start() - 1;\n    const endPos = $anchor.end() + 1;\n    if (startPos < 0 || endPos > editor.state.doc.content.size) {\n      return false; // Invalid position, abort operation\n    }\n\n    return editor.chain().cut({ from: startPos, to: endPos }, $lastItemPos.end()).joinForward().run();\n  }\n\n  // if the cursor is not inside the current node type\n  // do nothing and proceed\n  if (!isNodeActive(editor.state, name)) {\n    return false;\n  }\n\n  // if the cursor is not at the start of a node\n  // do nothing and proceed\n  if (!isAtStartOfNode(editor.state)) {\n    return false;\n  }\n\n  // is the paragraph node inside of the current list item (maybe with a hard break)\n  const isParaSibling = isCurrentParagraphASibling(editor.state);\n  const isCurrentListItemSublist = prevListIsHigher(name, editor.state);\n  const listItemPos = findListItemPos(name, editor.state);\n  const nextListItemIsSibling = nextListIsSibling(name, editor.state);\n\n  if (!listItemPos) {\n    return false;\n  }\n\n  const currentNode = listItemPos.$pos.node(listItemPos.depth);\n  const currentListItemHasSubList = listItemHasSubList(name, editor.state, currentNode);\n\n  if (currentListItemHasSubList && isCurrentListItemSublist && isParaSibling) {\n    return false;\n  }\n\n  if (currentListItemHasSubList && isCurrentListItemSublist) {\n    editor.chain().liftListItem(name).run();\n    return editor.commands.joinItemBackward();\n  }\n\n  if (isCurrentListItemSublist && nextListItemIsSibling) {\n    return false;\n  }\n\n  if (isCurrentListItemSublist) {\n    return false;\n  }\n\n  if (currentListItemHasSubList) {\n    return false;\n  }\n\n  if (hasListItemBefore(name, editor.state)) {\n    return editor.chain().liftListItem(name).run();\n  }\n\n  if (!currentListItemHasSubList) {\n    return false;\n  }\n\n  // otherwise in the end, a backspace should\n  // always just lift the list item if\n  // joining / merging is not possible\n  return editor.chain().liftListItem(name).run();\n};\n\nexport const handleDelete = (editor: Editor, name: string) => {\n  // if the cursor is not inside the current node type\n  // do nothing and proceed\n  if (!isNodeActive(editor.state, name)) {\n    return false;\n  }\n\n  // if the cursor is not at the end of a node\n  // do nothing and proceed\n  if (!isAtEndOfNode(editor.state, name)) {\n    return false;\n  }\n\n  // check if the next node is a list with a deeper depth\n  if (nextListIsDeeper(name, editor.state)) {\n    return editor\n      .chain()\n      .focus(editor.state.selection.from + 4)\n      .lift(name)\n      .joinBackward()\n      .run();\n  }\n\n  if (nextListIsHigher(name, editor.state)) {\n    return editor.chain().joinForward().joinBackward().run();\n  }\n\n  return editor.commands.joinItemForward();\n};\n\nconst hasListBefore = (editorState: EditorState, name: string, parentListTypes: string[]) => {\n  const { $anchor } = editorState.selection;\n\n  const previousNodePos = Math.max(0, $anchor.pos - 2);\n\n  const previousNode = editorState.doc.resolve(previousNodePos).node();\n\n  if (!previousNode || !parentListTypes.includes(previousNode.type.name)) {\n    return false;\n  }\n\n  return true;\n};\n\nconst prevListIsHigher = (typeOrName: string, state: EditorState) => {\n  const listDepth = getPrevListDepth(typeOrName, state);\n  const listItemPos = findListItemPos(typeOrName, state);\n\n  if (!listItemPos || !listDepth) {\n    return false;\n  }\n\n  if (listDepth < listItemPos.depth) {\n    return true;\n  }\n\n  return false;\n};\n\nconst nextListIsSibling = (typeOrName: string, state: EditorState) => {\n  const listDepth = getNextListDepth(typeOrName, state);\n  const listItemPos = findListItemPos(typeOrName, state);\n\n  if (!listItemPos || !listDepth) {\n    return false;\n  }\n\n  if (listDepth === listItemPos.depth) {\n    return true;\n  }\n\n  return false;\n};\n\nexport const nextListIsHigher = (typeOrName: string, state: EditorState) => {\n  const listDepth = getNextListDepth(typeOrName, state);\n  const listItemPos = findListItemPos(typeOrName, state);\n\n  if (!listItemPos || !listDepth) {\n    return false;\n  }\n\n  if (listDepth < listItemPos.depth) {\n    return true;\n  }\n\n  return false;\n};\n\nconst listItemHasSubList = (typeOrName: string, state: EditorState, node?: Node) => {\n  if (!node) {\n    return false;\n  }\n\n  const nodeType = getNodeType(typeOrName, state.schema);\n\n  let hasSubList = false;\n\n  node.descendants((child) => {\n    if (child.type === nodeType) {\n      hasSubList = true;\n    }\n  });\n\n  return hasSubList;\n};\n\nconst isCurrentParagraphASibling = (state: EditorState): boolean => {\n  const { $from } = state.selection;\n  const listItemNode = $from.node(-1); // Get the parent node of the current selection, assuming it's a list item.\n  const currentParagraphNode = $from.parent; // Get the current node where the selection is.\n\n  // Ensure we're in a paragraph and the parent is a list item.\n  if (\n    currentParagraphNode.type.name === CORE_EXTENSIONS.PARAGRAPH &&\n    [CORE_EXTENSIONS.LIST_ITEM, CORE_EXTENSIONS.TASK_ITEM].includes(listItemNode.type.name as CORE_EXTENSIONS)\n  ) {\n    let paragraphNodesCount = 0;\n    listItemNode.forEach((child) => {\n      if (child.type.name === CORE_EXTENSIONS.PARAGRAPH) {\n        paragraphNodesCount++;\n      }\n    });\n\n    // If there are more than one paragraph nodes, the current paragraph is a sibling.\n    return paragraphNodesCount > 1;\n  }\n\n  return false;\n};\n\nexport function isCursorInSubList(editor: Editor) {\n  const { selection } = editor.state;\n  const { $from } = selection;\n\n  // Check if the current node is a list item\n  const listItem = editor.schema.nodes.listItem;\n  const taskItem = editor.schema.nodes.taskItem;\n\n  // Traverse up the document tree from the current position\n  for (let depth = $from.depth; depth > 0; depth--) {\n    const node = $from.node(depth);\n    if (node.type === listItem || node.type === taskItem) {\n      // If the parent of the list item is also a list, it's a sub-list\n      const parent = $from.node(depth - 1);\n      if (\n        parent &&\n        (parent.type === editor.schema.nodes.bulletList ||\n          parent.type === editor.schema.nodes.orderedList ||\n          parent.type === editor.schema.nodes.taskList)\n      ) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n}\n\nconst hasListItemBefore = (typeOrName: string, state: EditorState): boolean => {\n  const { $anchor } = state.selection;\n\n  const $targetPos = state.doc.resolve($anchor.pos - 2);\n\n  if ($targetPos.index() === 0) {\n    return false;\n  }\n\n  if ($targetPos.nodeBefore?.type.name !== typeOrName) {\n    return false;\n  }\n\n  return true;\n};\n","import { Extension } from \"@tiptap/core\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// extensions\nimport { handleBackspace, handleDelete } from \"@/extensions/custom-list-keymap/list-helpers\";\n\nexport type ListKeymapOptions = {\n  listTypes: Array<{\n    itemName: string;\n    wrapperNames: string[];\n  }>;\n};\n\nexport const ListKeymap = ({ tabIndex }: { tabIndex?: number }) =>\n  Extension.create<ListKeymapOptions>({\n    name: \"listKeymap\",\n\n    addOptions() {\n      return {\n        listTypes: [\n          {\n            itemName: \"listItem\",\n            wrapperNames: [\"bulletList\", \"orderedList\"],\n          },\n          {\n            itemName: \"taskItem\",\n            wrapperNames: [\"taskList\"],\n          },\n        ],\n      };\n    },\n\n    addKeyboardShortcuts() {\n      return {\n        Tab: () => {\n          if (this.editor.isActive(CORE_EXTENSIONS.LIST_ITEM) || this.editor.isActive(CORE_EXTENSIONS.TASK_ITEM)) {\n            if (this.editor.commands.sinkListItem(CORE_EXTENSIONS.LIST_ITEM)) {\n              return true;\n            } else if (this.editor.commands.sinkListItem(CORE_EXTENSIONS.TASK_ITEM)) {\n              return true;\n            }\n            return true;\n          }\n          // if tabIndex is set, we don't want to handle Tab key\n          if (tabIndex !== undefined && tabIndex !== null) {\n            return false;\n          }\n          return true;\n        },\n        \"Shift-Tab\": () => {\n          if (this.editor.commands.liftListItem(CORE_EXTENSIONS.LIST_ITEM)) {\n            return true;\n          } else if (this.editor.commands.liftListItem(CORE_EXTENSIONS.TASK_ITEM)) {\n            return true;\n          }\n          // if tabIndex is set, we don't want to handle Tab key\n          if (tabIndex !== undefined && tabIndex !== null) {\n            return false;\n          }\n          return true;\n        },\n        Delete: ({ editor }) => {\n          try {\n            let handled = false;\n\n            this.options.listTypes.forEach(({ itemName }) => {\n              if (editor.state.schema.nodes[itemName] === undefined) {\n                return;\n              }\n\n              if (handleDelete(editor, itemName)) {\n                handled = true;\n              }\n            });\n\n            return handled;\n          } catch (e) {\n            console.log(\"Error in handling Delete:\", e);\n            return false;\n          }\n        },\n        \"Mod-Delete\": ({ editor }) => {\n          let handled = false;\n\n          this.options.listTypes.forEach(({ itemName }) => {\n            if (editor.state.schema.nodes[itemName] === undefined) {\n              return;\n            }\n\n            if (handleDelete(editor, itemName)) {\n              handled = true;\n            }\n          });\n\n          return handled;\n        },\n        Backspace: ({ editor }) => {\n          try {\n            let handled = false;\n\n            this.options.listTypes.forEach(({ itemName, wrapperNames }) => {\n              if (editor.state.schema.nodes[itemName] === undefined) {\n                return;\n              }\n\n              if (handleBackspace(editor, itemName, wrapperNames)) {\n                handled = true;\n              }\n            });\n\n            return handled;\n          } catch (e) {\n            console.log(\"Error in handling Backspace:\", e);\n            return false;\n          }\n        },\n        \"Mod-Backspace\": ({ editor }) => {\n          let handled = false;\n\n          this.options.listTypes.forEach(({ itemName, wrapperNames }) => {\n            if (editor.state.schema.nodes[itemName] === undefined) {\n              return;\n            }\n\n            if (handleBackspace(editor, itemName, wrapperNames)) {\n              handled = true;\n            }\n          });\n\n          return handled;\n        },\n      };\n    },\n  });\n","import type { NodeViewProps } from \"@tiptap/react\";\nimport { NodeViewWrapper } from \"@tiptap/react\";\n// extension config\nimport type { TMentionExtensionOptions } from \"./extension-config\";\n// extension types\nimport type { TMentionComponentAttributes } from \"./types\";\nimport { EMentionComponentAttributeNames } from \"./types\";\n\nexport type MentionNodeViewProps = NodeViewProps & {\n  node: NodeViewProps[\"node\"] & {\n    attrs: TMentionComponentAttributes;\n  };\n};\n\nexport function MentionNodeView(props: MentionNodeViewProps) {\n  const {\n    extension,\n    node: { attrs },\n  } = props;\n\n  return (\n    <NodeViewWrapper className=\"mention-component inline w-fit\">\n      {(extension.options as TMentionExtensionOptions).renderComponent({\n        entity_identifier: attrs[EMentionComponentAttributeNames.ENTITY_IDENTIFIER] ?? \"\",\n        entity_name: attrs[EMentionComponentAttributeNames.ENTITY_NAME] ?? \"user_mention\",\n      })}\n    </NodeViewWrapper>\n  );\n}\n","import { FloatingOverlay } from \"@floating-ui/react\";\nimport type { SuggestionProps } from \"@tiptap/suggestion\";\nimport { forwardRef, useCallback, useEffect, useImperativeHandle, useLayoutEffect, useRef, useState } from \"react\";\nimport { v4 as uuidv4 } from \"uuid\";\n// plane utils\nimport { useOutsideClickDetector } from \"@plane/hooks\";\nimport { cn } from \"@plane/utils\";\n// helpers\nimport { DROPDOWN_NAVIGATION_KEYS, getNextValidIndex } from \"@/helpers/tippy\";\n// types\nimport type { TMentionHandler, TMentionSection, TMentionSuggestion } from \"@/types\";\n\nexport type MentionsListDropdownProps = SuggestionProps<TMentionSection, TMentionSuggestion> &\n  Pick<TMentionHandler, \"searchCallback\"> & {\n    onClose: () => void;\n  };\n\nexport const MentionsListDropdown = forwardRef(function MentionsListDropdown(props: MentionsListDropdownProps, ref) {\n  const { command, query, searchCallback, onClose } = props;\n  // states\n  const [sections, setSections] = useState<TMentionSection[]>([]);\n  const [selectedIndex, setSelectedIndex] = useState({\n    section: 0,\n    item: 0,\n  });\n  const [isLoading, setIsLoading] = useState(false);\n  // refs\n  const dropdownContainer = useRef<HTMLDivElement>(null);\n\n  const selectItem = useCallback(\n    (sectionIndex: number, itemIndex: number) => {\n      try {\n        const item = sections?.[sectionIndex]?.items?.[itemIndex];\n        const transactionId = uuidv4();\n        if (item) {\n          command({\n            ...item,\n            id: transactionId,\n          });\n        }\n      } catch (error) {\n        console.error(\"Error selecting mention item:\", error);\n      }\n    },\n    [command, sections]\n  );\n\n  useImperativeHandle(ref, () => ({\n    onKeyDown: ({ event }: { event: KeyboardEvent }) => {\n      if (!DROPDOWN_NAVIGATION_KEYS.includes(event.key)) return false;\n\n      if (event.key === \"Enter\") {\n        selectItem(selectedIndex.section, selectedIndex.item);\n        return true;\n      }\n\n      const newIndex = getNextValidIndex({\n        event,\n        sections,\n        selectedIndex,\n      });\n      if (newIndex) {\n        setSelectedIndex(newIndex);\n      }\n\n      return true;\n    },\n  }));\n\n  // initialize the select index to 0 by default\n  useEffect(() => {\n    setSelectedIndex({\n      section: 0,\n      item: 0,\n    });\n  }, [sections]);\n\n  // fetch mention sections based on query\n  useEffect(() => {\n    const fetchSuggestions = async () => {\n      setIsLoading(true);\n      try {\n        const sectionsResponse = await searchCallback?.(query);\n        if (sectionsResponse) {\n          setSections(sectionsResponse);\n        }\n      } catch (error) {\n        console.error(\"Failed to fetch suggestions:\", error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    fetchSuggestions();\n  }, [query, searchCallback]);\n\n  // scroll to the dropdown item when navigating via keyboard\n  useLayoutEffect(() => {\n    const container = dropdownContainer?.current;\n    if (!container) return;\n\n    const item = container.querySelector(`#mention-item-${selectedIndex.section}-${selectedIndex.item}`) as HTMLElement;\n    if (item) {\n      const containerRect = container.getBoundingClientRect();\n      const itemRect = item.getBoundingClientRect();\n\n      const isItemInView = itemRect.top >= containerRect.top && itemRect.bottom <= containerRect.bottom;\n\n      if (!isItemInView) {\n        item.scrollIntoView({ block: \"nearest\" });\n      }\n    }\n  }, [selectedIndex]);\n\n  useOutsideClickDetector(dropdownContainer, onClose);\n\n  return (\n    <>\n      {/* Backdrop */}\n      <FloatingOverlay\n        style={{\n          zIndex: 99,\n        }}\n        lockScroll\n      />\n      <div\n        ref={dropdownContainer}\n        className=\"relative max-h-80 w-[14rem] overflow-y-auto rounded-md border-[0.5px] border-custom-border-300 bg-custom-background-100 px-2 py-2.5 shadow-custom-shadow-rg space-y-2\"\n        style={{\n          zIndex: 100,\n        }}\n        onClick={(e) => {\n          e.stopPropagation();\n        }}\n        onMouseDown={(e) => {\n          e.stopPropagation();\n        }}\n      >\n        {isLoading ? (\n          <div className=\"text-center text-sm text-custom-text-400\">Loading...</div>\n        ) : sections.length ? (\n          sections.map((section, sectionIndex) => (\n            <div key={section.key} className=\"space-y-2\">\n              {section.title && <h6 className=\"text-xs font-semibold text-custom-text-300\">{section.title}</h6>}\n              {section.items.map((item, itemIndex) => {\n                const isSelected = sectionIndex === selectedIndex.section && itemIndex === selectedIndex.item;\n\n                return (\n                  <button\n                    key={item.id}\n                    id={`mention-item-${sectionIndex}-${itemIndex}`}\n                    type=\"button\"\n                    className={cn(\n                      \"flex items-center gap-2 w-full rounded px-1 py-1.5 text-xs text-left truncate text-custom-text-200\",\n                      {\n                        \"bg-custom-background-80\": isSelected,\n                      }\n                    )}\n                    onClick={(e) => {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      selectItem(sectionIndex, itemIndex);\n                    }}\n                    onMouseEnter={() =>\n                      setSelectedIndex({\n                        section: sectionIndex,\n                        item: itemIndex,\n                      })\n                    }\n                  >\n                    <span className=\"size-5 grid place-items-center flex-shrink-0\">{item.icon}</span>\n                    {item.subTitle && (\n                      <h5 className=\"whitespace-nowrap text-xs text-custom-text-300 flex-shrink-0\">{item.subTitle}</h5>\n                    )}\n                    <p className=\"flex-grow truncate\">{item.title}</p>\n                  </button>\n                );\n              })}\n            </div>\n          ))\n        ) : (\n          <div className=\"text-center text-sm text-custom-text-400\">No results</div>\n        )}\n      </div>\n    </>\n  );\n});\n\nMentionsListDropdown.displayName = \"MentionsListDropdown\";\n","import { ReactRenderer } from \"@tiptap/react\";\nimport type { Editor } from \"@tiptap/react\";\nimport type { SuggestionOptions } from \"@tiptap/suggestion\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// helpers\nimport { updateFloatingUIFloaterPosition } from \"@/helpers/floating-ui\";\nimport type { CommandListInstance } from \"@/helpers/tippy\";\nimport { DROPDOWN_NAVIGATION_KEYS } from \"@/helpers/tippy\";\n// types\nimport type { TMentionHandler } from \"@/types\";\n// local components\nimport type { MentionsListDropdownProps } from \"./mentions-list-dropdown\";\nimport { MentionsListDropdown } from \"./mentions-list-dropdown\";\n\nexport const renderMentionsDropdown =\n  (args: Pick<TMentionHandler, \"searchCallback\">): SuggestionOptions[\"render\"] =>\n  () => {\n    const { searchCallback } = args;\n    let component: ReactRenderer<CommandListInstance, MentionsListDropdownProps> | null = null;\n    let cleanup: () => void = () => {};\n    let editorRef: Editor | null = null;\n\n    const handleClose = (editor?: Editor) => {\n      component?.destroy();\n      component = null;\n      (editor || editorRef)?.commands.removeActiveDropbarExtension(CORE_EXTENSIONS.MENTION);\n      cleanup();\n    };\n\n    return {\n      onStart: (props) => {\n        if (!searchCallback) return;\n        editorRef = props.editor;\n        component = new ReactRenderer<CommandListInstance, MentionsListDropdownProps>(MentionsListDropdown, {\n          props: {\n            ...props,\n            searchCallback,\n            onClose: () => handleClose(props.editor),\n          } satisfies MentionsListDropdownProps,\n          editor: props.editor,\n          className: \"fixed z-[100]\",\n        });\n        if (!props.clientRect) return;\n        props.editor.commands.addActiveDropbarExtension(CORE_EXTENSIONS.MENTION);\n        const element = component.element as HTMLElement;\n        cleanup = updateFloatingUIFloaterPosition(props.editor, element).cleanup;\n      },\n      onUpdate: (props) => {\n        if (!component || !component.element) return;\n        component.updateProps(props);\n        if (!props.clientRect) return;\n        cleanup();\n        cleanup = updateFloatingUIFloaterPosition(props.editor, component.element as HTMLElement).cleanup;\n      },\n      onKeyDown: ({ event }) => {\n        if ([...DROPDOWN_NAVIGATION_KEYS, \"Escape\"].includes(event.key)) {\n          event.preventDefault();\n          event.stopPropagation();\n        }\n\n        if (event.key === \"Escape\") {\n          handleClose();\n          return true;\n        }\n\n        return component?.ref?.onKeyDown({ event }) ?? false;\n      },\n      onExit: ({ editor }) => {\n        component?.element.remove();\n        handleClose(editor);\n      },\n    };\n  };\n","import { ReactNodeViewRenderer } from \"@tiptap/react\";\n// types\nimport type { TMentionHandler } from \"@/types\";\n// extension config\nimport { CustomMentionExtensionConfig } from \"./extension-config\";\n// node view\nimport type { MentionNodeViewProps } from \"./mention-node-view\";\nimport { MentionNodeView } from \"./mention-node-view\";\n// utils\nimport { renderMentionsDropdown } from \"./utils\";\n\nexport function CustomMentionExtension(props: TMentionHandler) {\n  const { searchCallback, renderComponent, getMentionedEntityDetails } = props;\n  return CustomMentionExtensionConfig.extend({\n    addOptions(this) {\n      return {\n        ...this.parent?.(),\n        renderComponent,\n        getMentionedEntityDetails,\n      };\n    },\n\n    addNodeView() {\n      return ReactNodeViewRenderer((props) => (\n        <MentionNodeView {...props} node={props.node as MentionNodeViewProps[\"node\"]} />\n      ));\n    },\n  }).configure({\n    suggestion: {\n      render: renderMentionsDropdown({\n        searchCallback,\n      }),\n      allowSpaces: true,\n    },\n  });\n}\n","import type { Editor } from \"@tiptap/core\";\nimport { findParentNode } from \"@tiptap/core\";\n\ntype ReplaceCodeBlockParams = {\n  editor: Editor;\n  from: number;\n  to: number;\n  textContent: string;\n  cursorPosInsideCodeblock: number;\n};\n\nexport function replaceCodeWithText(editor: Editor): void {\n  try {\n    const { from, to } = editor.state.selection;\n    const cursorPosInsideCodeblock = from;\n    let replaced = false;\n\n    editor.state.doc.nodesBetween(from, to, (node, pos) => {\n      if (node.type === editor.state.schema.nodes.codeBlock) {\n        const startPos = pos;\n        const endPos = pos + node.nodeSize;\n        const textContent = node.textContent;\n\n        if (textContent.length === 0) {\n          editor.chain().focus().toggleCodeBlock().run();\n        } else {\n          transformCodeBlockToParagraphs({\n            editor,\n            from: startPos,\n            to: endPos,\n            textContent,\n            cursorPosInsideCodeblock,\n          });\n        }\n\n        replaced = true;\n        return false;\n      }\n    });\n\n    if (!replaced) {\n      console.log(\"No code block to replace.\");\n    }\n  } catch (error) {\n    console.error(\"An error occurred while replacing code block content:\", error);\n  }\n}\n\nfunction transformCodeBlockToParagraphs({\n  editor,\n  from,\n  to,\n  textContent,\n  cursorPosInsideCodeblock,\n}: ReplaceCodeBlockParams): void {\n  const { schema } = editor.state;\n  const { paragraph } = schema.nodes;\n  const docSize = editor.state.doc.content.size;\n\n  if (from < 0 || to > docSize || from > to) {\n    console.error(\"Invalid range for replacement: \", from, to, \"in a document of size\", docSize);\n    return;\n  }\n\n  // Split the textContent by new lines to handle each line as a separate paragraph for Windows (\\r\\n) and Unix (\\n)\n  const lines = textContent.split(/\\r?\\n/);\n  const tr = editor.state.tr;\n  let insertPos = from;\n\n  // Remove the code block first\n  tr.delete(from, to);\n\n  // For each line, create a paragraph node and insert it\n  lines.forEach((line) => {\n    // if the line is empty, create a paragraph node with no content\n    const paragraphNode = line.length === 0 ? paragraph.create({}) : paragraph.create({}, schema.text(line));\n    tr.insert(insertPos, paragraphNode);\n    insertPos += paragraphNode.nodeSize;\n  });\n\n  // Now persist the focus to the converted paragraph\n  const parentNodeOffset = findParentNode((node) => node.type === schema.nodes.codeBlock)(editor.state.selection)?.pos;\n\n  if (parentNodeOffset === undefined) throw new Error(\"Invalid code block offset\");\n\n  const lineNumber = getLineNumber(textContent, cursorPosInsideCodeblock, parentNodeOffset);\n  const cursorPosOutsideCodeblock = cursorPosInsideCodeblock + (lineNumber - 1);\n\n  editor.view.dispatch(tr);\n  editor.chain().focus(cursorPosOutsideCodeblock).run();\n}\n\n/**\n * Calculates the line number where the cursor is located inside the code block.\n * Assumes the indexing of the content inside the code block is like ProseMirror's indexing.\n *\n * @param {string} textContent - The content of the code block.\n * @param {number} cursorPosition - The absolute cursor position in the document.\n * @param {number} codeBlockNodePos - The starting position of the code block node in the document.\n * @returns {number} The 1-based line number where the cursor is located.\n */\nfunction getLineNumber(textContent: string, cursorPosition: number, codeBlockNodePos: number): number {\n  // Split the text content into lines, handling both Unix and Windows newlines\n  const lines = textContent.split(/\\r?\\n/);\n  const cursorPosInsideCodeblockRelative = cursorPosition - codeBlockNodePos;\n\n  let startPosition = 0;\n  let lineNumber = 0;\n\n  for (let i = 0; i < lines.length; i++) {\n    // Calculate the end position of the current line\n    const endPosition = startPosition + lines[i].length + 1; // +1 for the newline character\n\n    // Check if the cursor position is within the current line\n    if (cursorPosInsideCodeblockRelative >= startPosition && cursorPosInsideCodeblockRelative <= endPosition) {\n      lineNumber = i + 1; // Line numbers are 1-based\n      break;\n    }\n\n    // Update the start position for the next line\n    startPosition = endPosition;\n  }\n\n  return lineNumber;\n}\n","import type { Editor, Range } from \"@tiptap/core\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// extensions\nimport { replaceCodeWithText } from \"@/extensions/code/utils/replace-code-block-with-text\";\nimport type { InsertImageComponentProps } from \"@/extensions/custom-image/types\";\n// helpers\nimport type { ExtendedEmojiStorage } from \"@/extensions/emoji/emoji\";\nimport { findTableAncestor } from \"@/helpers/common\";\n\nexport const setText = (editor: Editor, range?: Range) => {\n  if (range) editor.chain().focus().deleteRange(range).setNode(CORE_EXTENSIONS.PARAGRAPH).run();\n  else editor.chain().focus().setNode(CORE_EXTENSIONS.PARAGRAPH).run();\n};\n\nexport const toggleHeading = (editor: Editor, level: 1 | 2 | 3 | 4 | 5 | 6, range?: Range) => {\n  if (range) editor.chain().focus().deleteRange(range).setNode(CORE_EXTENSIONS.HEADING, { level }).run();\n  else editor.chain().focus().toggleHeading({ level }).run();\n};\n\nexport const toggleBold = (editor: Editor, range?: Range) => {\n  if (range) editor.chain().focus().deleteRange(range).toggleBold().run();\n  else editor.chain().focus().toggleBold().run();\n};\n\nexport const toggleItalic = (editor: Editor, range?: Range) => {\n  if (range) editor.chain().focus().deleteRange(range).toggleItalic().run();\n  else editor.chain().focus().toggleItalic().run();\n};\n\nexport const toggleUnderline = (editor: Editor, range?: Range) => {\n  if (range) editor.chain().focus().deleteRange(range).toggleUnderline().run();\n  else editor.chain().focus().toggleUnderline().run();\n};\n\nexport const toggleCodeBlock = (editor: Editor, range?: Range) => {\n  try {\n    // if it's a code block, replace it with the code with paragraphs\n    if (editor.isActive(CORE_EXTENSIONS.CODE_BLOCK)) {\n      replaceCodeWithText(editor);\n      return;\n    }\n\n    const { from, to } = range || editor.state.selection;\n    const text = editor.state.doc.textBetween(from, to, \"\\n\");\n    const isMultiline = text.includes(\"\\n\");\n\n    // if the selection is not a range i.e. empty, then simply convert it into a codeBlock\n    if (editor.state.selection.empty) {\n      editor.chain().focus().toggleCodeBlock().run();\n    } else if (isMultiline) {\n      // if the selection is multiline, then also replace the text content with\n      // a codeBlock\n      editor.chain().focus().deleteRange({ from, to }).insertContentAt(from, `\\`\\`\\`\\n${text}\\n\\`\\`\\``).run();\n    } else {\n      // if the selection is single line, then simply convert it into inline\n      // code\n      editor.chain().focus().toggleCode().run();\n    }\n  } catch (error) {\n    console.error(\"An error occurred while toggling code block:\", error);\n  }\n};\n\nexport const toggleOrderedList = (editor: Editor, range?: Range) => {\n  if (range) editor.chain().focus().deleteRange(range).toggleOrderedList().run();\n  else editor.chain().focus().toggleOrderedList().run();\n};\n\nexport const toggleBulletList = (editor: Editor, range?: Range) => {\n  if (range) editor.chain().focus().deleteRange(range).toggleBulletList().run();\n  else editor.chain().focus().toggleBulletList().run();\n};\n\nexport const toggleTaskList = (editor: Editor, range?: Range) => {\n  if (range) editor.chain().focus().deleteRange(range).toggleTaskList().run();\n  else editor.chain().focus().toggleTaskList().run();\n};\n\nexport const toggleStrike = (editor: Editor, range?: Range) => {\n  if (range) editor.chain().focus().deleteRange(range).toggleStrike().run();\n  else editor.chain().focus().toggleStrike().run();\n};\n\nexport const toggleBlockquote = (editor: Editor, range?: Range) => {\n  if (range) editor.chain().focus().deleteRange(range).toggleBlockquote().run();\n  else editor.chain().focus().toggleBlockquote().run();\n};\n\nexport const insertTableCommand = (editor: Editor, range?: Range) => {\n  if (typeof window !== \"undefined\") {\n    const selection = window.getSelection();\n    if (selection) {\n      if (selection.rangeCount !== 0) {\n        const range = selection.getRangeAt(0);\n        if (findTableAncestor(range.startContainer)) {\n          return;\n        }\n      }\n    }\n  }\n  if (range) editor.chain().focus().deleteRange(range).clearNodes().insertTable({ rows: 3, cols: 3 }).run();\n  else editor.chain().focus().clearNodes().insertTable({ rows: 3, cols: 3 }).run();\n};\n\nexport const insertImage = ({\n  editor,\n  event,\n  pos,\n  file,\n  range,\n}: {\n  editor: Editor;\n  event: \"insert\" | \"drop\";\n  pos?: number | null;\n  file?: File;\n  range?: Range;\n}) => {\n  if (range) editor.chain().focus().deleteRange(range).run();\n\n  const imageOptions: InsertImageComponentProps = { event };\n  if (pos) imageOptions.pos = pos;\n  if (file) imageOptions.file = file;\n  return editor?.chain().focus().insertImageComponent(imageOptions).run();\n};\n\nexport const unsetLinkEditor = (editor: Editor) => {\n  editor.chain().focus().unsetLink().run();\n};\n\nexport const setLinkEditor = (editor: Editor, url: string, text?: string) => {\n  const { selection } = editor.state;\n  const previousSelection = { from: selection.from, to: selection.to };\n  if (text) {\n    editor\n      .chain()\n      .focus()\n      .deleteRange({ from: selection.from, to: selection.to })\n      .insertContentAt(previousSelection.from, text)\n      .run();\n    // Extracting the new selection start point.\n    const previousFrom = previousSelection.from;\n\n    editor.commands.setTextSelection({ from: previousFrom, to: previousFrom + text.length });\n  }\n  editor.chain().focus().setLink({ href: url }).run();\n};\n\nexport const toggleTextColor = (color: string | undefined, editor: Editor, range?: Range) => {\n  if (color) {\n    if (range) editor.chain().focus().deleteRange(range).setTextColor(color).run();\n    else editor.chain().focus().setTextColor(color).run();\n  } else {\n    if (range) editor.chain().focus().deleteRange(range).unsetTextColor().run();\n    else editor.chain().focus().unsetTextColor().run();\n  }\n};\n\nexport const toggleBackgroundColor = (color: string | undefined, editor: Editor, range?: Range) => {\n  if (color) {\n    if (range) {\n      editor.chain().focus().deleteRange(range).setBackgroundColor(color).run();\n    } else {\n      editor.chain().focus().setBackgroundColor(color).run();\n    }\n  } else {\n    if (range) {\n      editor.chain().focus().deleteRange(range).unsetBackgroundColor().run();\n    } else {\n      editor.chain().focus().unsetBackgroundColor().run();\n    }\n  }\n};\n\nexport const setTextAlign = (alignment: string, editor: Editor) => {\n  editor.chain().focus().setTextAlign(alignment).run();\n};\n\nexport const insertHorizontalRule = (editor: Editor, range?: Range) => {\n  if (range) editor.chain().focus().deleteRange(range).setHorizontalRule().run();\n  else editor.chain().focus().setHorizontalRule().run();\n};\n\nexport const insertCallout = (editor: Editor, range?: Range) => {\n  if (range) editor.chain().focus().deleteRange(range).insertCallout().run();\n  else editor.chain().focus().insertCallout().run();\n};\n\nexport const openEmojiPicker = (editor: Editor, range?: Range) => {\n  if (range) editor.chain().focus().deleteRange(range).run();\n  const emojiStorage = editor.storage.emoji as ExtendedEmojiStorage;\n  emojiStorage.forceOpen = true;\n  editor.chain().focus().insertContent(\":\").run();\n};\n","import type { Extensions } from \"@tiptap/core\";\n// types\nimport type { IEditorProps } from \"@/types\";\n\nexport type TCoreAdditionalExtensionsProps = Pick<\n  IEditorProps,\n  \"disabledExtensions\" | \"flaggedExtensions\" | \"fileHandler\" | \"extendedEditorProps\"\n>;\n\nexport const CoreEditorAdditionalExtensions = (props: TCoreAdditionalExtensionsProps): Extensions => {\n  const {} = props;\n  return [];\n};\n","import type { HocuspocusProvider } from \"@hocuspocus/provider\";\nimport type { AnyExtension } from \"@tiptap/core\";\nimport { SlashCommands } from \"@/extensions\";\n// types\nimport type { IEditorProps, TExtensions, TUserDetails } from \"@/types\";\n\nexport type TDocumentEditorAdditionalExtensionsProps = Pick<\n  IEditorProps,\n  \"disabledExtensions\" | \"flaggedExtensions\" | \"fileHandler\" | \"extendedEditorProps\"\n> & {\n  isEditable: boolean;\n  provider?: HocuspocusProvider;\n  userDetails: TUserDetails;\n};\n\nexport type TDocumentEditorAdditionalExtensionsRegistry = {\n  isEnabled: (disabledExtensions: TExtensions[], flaggedExtensions: TExtensions[]) => boolean;\n  getExtension: (props: TDocumentEditorAdditionalExtensionsProps) => AnyExtension;\n};\n\nconst extensionRegistry: TDocumentEditorAdditionalExtensionsRegistry[] = [\n  {\n    isEnabled: (disabledExtensions) => !disabledExtensions.includes(\"slash-commands\"),\n    getExtension: ({ disabledExtensions, flaggedExtensions }) =>\n      SlashCommands({ disabledExtensions, flaggedExtensions }),\n  },\n];\n\nexport function DocumentEditorAdditionalExtensions(props: TDocumentEditorAdditionalExtensionsProps) {\n  const { disabledExtensions, flaggedExtensions } = props;\n\n  const documentExtensions = extensionRegistry\n    .filter((config) => config.isEnabled(disabledExtensions, flaggedExtensions))\n    .map((config) => config.getExtension(props));\n\n  return documentExtensions;\n}\n","// extensions\nimport type { TSlashCommandAdditionalOption } from \"@/extensions\";\n// types\nimport type { IEditorProps } from \"@/types\";\n\ntype Props = Pick<IEditorProps, \"disabledExtensions\" | \"flaggedExtensions\">;\n\nexport const coreEditorAdditionalSlashCommandOptions = (props: Props): TSlashCommandAdditionalOption[] => {\n  const {} = props;\n  const options: TSlashCommandAdditionalOption[] = [];\n  return options;\n};\n","import {\n  ALargeSmall,\n  CaseSensitive,\n  Code2,\n  Heading1,\n  Heading2,\n  Heading3,\n  Heading4,\n  Heading5,\n  Heading6,\n  ImageIcon,\n  List,\n  ListOrdered,\n  ListTodo,\n  MessageSquareText,\n  MinusSquare,\n  Smile,\n  Table,\n  TextQuote,\n} from \"lucide-react\";\n// constants\nimport { COLORS_LIST } from \"@/constants/common\";\n// helpers\nimport {\n  insertTableCommand,\n  toggleBlockquote,\n  toggleBulletList,\n  toggleOrderedList,\n  toggleTaskList,\n  toggleHeading,\n  toggleTextColor,\n  toggleBackgroundColor,\n  insertImage,\n  insertCallout,\n  setText,\n  openEmojiPicker,\n} from \"@/helpers/editor-commands\";\n// plane editor extensions\nimport { coreEditorAdditionalSlashCommandOptions } from \"@/plane-editor/extensions\";\n// types\nimport type { CommandProps, ISlashCommandItem, TSlashCommandSectionKeys } from \"@/types\";\n// local types\nimport type { TExtensionProps, TSlashCommandAdditionalOption } from \"./root\";\n\nexport type TSlashCommandSection = {\n  key: TSlashCommandSectionKeys;\n  title?: string;\n  items: ISlashCommandItem[];\n};\n\nexport const getSlashCommandFilteredSections =\n  (args: TExtensionProps) =>\n  ({ query }: { query: string }): TSlashCommandSection[] => {\n    const { additionalOptions: externalAdditionalOptions, disabledExtensions, flaggedExtensions } = args;\n    const SLASH_COMMAND_SECTIONS: TSlashCommandSection[] = [\n      {\n        key: \"general\",\n        items: [\n          {\n            commandKey: \"text\",\n            key: \"text\",\n            title: \"Text\",\n            description: \"Just start typing with plain text.\",\n            searchTerms: [\"p\", \"paragraph\"],\n            icon: <CaseSensitive className=\"size-3.5\" />,\n            command: ({ editor, range }) => setText(editor, range),\n          },\n          {\n            commandKey: \"h1\",\n            key: \"h1\",\n            title: \"Heading 1\",\n            description: \"Big section heading.\",\n            searchTerms: [\"title\", \"big\", \"large\"],\n            icon: <Heading1 className=\"size-3.5\" />,\n            command: ({ editor, range }) => toggleHeading(editor, 1, range),\n          },\n          {\n            commandKey: \"h2\",\n            key: \"h2\",\n            title: \"Heading 2\",\n            description: \"Medium section heading.\",\n            searchTerms: [\"subtitle\", \"medium\"],\n            icon: <Heading2 className=\"size-3.5\" />,\n            command: ({ editor, range }) => toggleHeading(editor, 2, range),\n          },\n          {\n            commandKey: \"h3\",\n            key: \"h3\",\n            title: \"Heading 3\",\n            description: \"Small section heading.\",\n            searchTerms: [\"subtitle\", \"small\"],\n            icon: <Heading3 className=\"size-3.5\" />,\n            command: ({ editor, range }) => toggleHeading(editor, 3, range),\n          },\n          {\n            commandKey: \"h4\",\n            key: \"h4\",\n            title: \"Heading 4\",\n            description: \"Small section heading.\",\n            searchTerms: [\"subtitle\", \"small\"],\n            icon: <Heading4 className=\"size-3.5\" />,\n            command: ({ editor, range }) => toggleHeading(editor, 4, range),\n          },\n          {\n            commandKey: \"h5\",\n            key: \"h5\",\n            title: \"Heading 5\",\n            description: \"Small section heading.\",\n            searchTerms: [\"subtitle\", \"small\"],\n            icon: <Heading5 className=\"size-3.5\" />,\n            command: ({ editor, range }) => toggleHeading(editor, 5, range),\n          },\n          {\n            commandKey: \"h6\",\n            key: \"h6\",\n            title: \"Heading 6\",\n            description: \"Small section heading.\",\n            searchTerms: [\"subtitle\", \"small\"],\n            icon: <Heading6 className=\"size-3.5\" />,\n            command: ({ editor, range }) => toggleHeading(editor, 6, range),\n          },\n\n          {\n            commandKey: \"numbered-list\",\n            key: \"numbered-list\",\n            title: \"Numbered list\",\n            description: \"Create a numbered list.\",\n            searchTerms: [\"ordered\"],\n            icon: <ListOrdered className=\"size-3.5\" />,\n            command: ({ editor, range }) => toggleOrderedList(editor, range),\n          },\n          {\n            commandKey: \"bulleted-list\",\n            key: \"bulleted-list\",\n            title: \"Bulleted list\",\n            description: \"Create a bulleted list.\",\n            searchTerms: [\"unordered\", \"point\"],\n            icon: <List className=\"size-3.5\" />,\n            command: ({ editor, range }) => toggleBulletList(editor, range),\n          },\n          {\n            commandKey: \"to-do-list\",\n            key: \"to-do-list\",\n            title: \"To-do list\",\n            description: \"Create a to-do list.\",\n            searchTerms: [\"todo\", \"task\", \"list\", \"check\", \"checkbox\"],\n            icon: <ListTodo className=\"size-3.5\" />,\n            command: ({ editor, range }) => toggleTaskList(editor, range),\n          },\n          {\n            commandKey: \"table\",\n            key: \"table\",\n            title: \"Table\",\n            description: \"Create a table\",\n            searchTerms: [\"table\", \"cell\", \"db\", \"data\", \"tabular\"],\n            icon: <Table className=\"size-3.5\" />,\n            command: ({ editor, range }) => insertTableCommand(editor, range),\n          },\n          {\n            commandKey: \"quote\",\n            key: \"quote\",\n            title: \"Quote\",\n            description: \"Capture a quote.\",\n            searchTerms: [\"blockquote\"],\n            icon: <TextQuote className=\"size-3.5\" />,\n            command: ({ editor, range }) => toggleBlockquote(editor, range),\n          },\n          {\n            commandKey: \"code\",\n            key: \"code\",\n            title: \"Code\",\n            description: \"Capture a code snippet.\",\n            searchTerms: [\"codeblock\"],\n            icon: <Code2 className=\"size-3.5\" />,\n            command: ({ editor, range }) => editor.chain().focus().deleteRange(range).toggleCodeBlock().run(),\n          },\n          {\n            commandKey: \"callout\",\n            key: \"callout\",\n            title: \"Callout\",\n            icon: <MessageSquareText className=\"size-3.5\" />,\n            description: \"Insert callout\",\n            searchTerms: [\"callout\", \"comment\", \"message\", \"info\", \"alert\"],\n            command: ({ editor, range }: CommandProps) => insertCallout(editor, range),\n          },\n          {\n            commandKey: \"divider\",\n            key: \"divider\",\n            title: \"Divider\",\n            description: \"Visually divide blocks.\",\n            searchTerms: [\"line\", \"divider\", \"horizontal\", \"rule\", \"separate\"],\n            icon: <MinusSquare className=\"size-3.5\" />,\n            command: ({ editor, range }) => editor.chain().focus().deleteRange(range).setHorizontalRule().run(),\n          },\n          {\n            commandKey: \"emoji\",\n            key: \"emoji\",\n            title: \"Emoji\",\n            description: \"Insert an emoji\",\n            searchTerms: [\"emoji\", \"icons\", \"reaction\", \"emoticon\", \"emotags\"],\n            icon: <Smile className=\"size-3.5\" />,\n            command: ({ editor, range }) => {\n              openEmojiPicker(editor, range);\n            },\n          },\n        ],\n      },\n      {\n        key: \"text-colors\",\n        title: \"Colors\",\n        items: [\n          {\n            commandKey: \"text-color\",\n            key: \"text-color-default\",\n            title: \"Default\",\n            description: \"Change text color\",\n            searchTerms: [\"color\", \"text\", \"default\"],\n            icon: (\n              <ALargeSmall\n                className=\"size-3.5\"\n                style={{\n                  color: \"rgba(var(--color-text-100))\",\n                }}\n              />\n            ),\n            command: ({ editor, range }) => toggleTextColor(undefined, editor, range),\n          },\n          ...COLORS_LIST.map(\n            (color) =>\n              ({\n                commandKey: \"text-color\",\n                key: `text-color-${color.key}`,\n                title: color.label,\n                description: \"Change text color\",\n                searchTerms: [\"color\", \"text\", color.label],\n\n                icon: (\n                  <ALargeSmall\n                    className=\"size-3.5\"\n                    style={{\n                      color: color.textColor,\n                    }}\n                  />\n                ),\n\n                command: ({ editor, range }) => toggleTextColor(color.key, editor, range),\n              }) as ISlashCommandItem\n          ),\n        ],\n      },\n      {\n        key: \"background-colors\",\n        title: \"Background colors\",\n        items: [\n          {\n            commandKey: \"background-color\",\n            key: \"background-color-default\",\n            title: \"Default background\",\n            description: \"Change background color\",\n            searchTerms: [\"color\", \"bg\", \"background\", \"default\"],\n            icon: <ALargeSmall className=\"size-3.5\" />,\n            iconContainerStyle: {\n              borderRadius: \"4px\",\n              backgroundColor: \"rgba(var(--color-background-100))\",\n              border: \"1px solid rgba(var(--color-border-300))\",\n            },\n            command: ({ editor, range }) => toggleTextColor(undefined, editor, range),\n          },\n          ...COLORS_LIST.map(\n            (color) =>\n              ({\n                commandKey: \"background-color\",\n                key: `background-color-${color.key}`,\n                title: color.label,\n                description: \"Change background color\",\n                searchTerms: [\"color\", \"bg\", \"background\", color.label],\n                icon: <ALargeSmall className=\"size-3.5\" />,\n\n                iconContainerStyle: {\n                  borderRadius: \"4px\",\n                  backgroundColor: color.backgroundColor,\n                },\n\n                command: ({ editor, range }) => toggleBackgroundColor(color.key, editor, range),\n              }) as ISlashCommandItem\n          ),\n        ],\n      },\n    ];\n\n    const internalAdditionalOptions: TSlashCommandAdditionalOption[] = [];\n    if (!disabledExtensions?.includes(\"image\")) {\n      internalAdditionalOptions.push({\n        commandKey: \"image\",\n        key: \"image\",\n        title: \"Image\",\n        icon: <ImageIcon className=\"size-3.5\" />,\n        description: \"Insert an image\",\n        searchTerms: [\"img\", \"photo\", \"picture\", \"media\", \"upload\"],\n        command: ({ editor, range }: CommandProps) => insertImage({ editor, event: \"insert\", range }),\n        section: \"general\",\n        pushAfter: \"code\",\n      });\n    }\n\n    [\n      ...internalAdditionalOptions,\n      ...(externalAdditionalOptions ?? []),\n      ...coreEditorAdditionalSlashCommandOptions({\n        disabledExtensions,\n        flaggedExtensions,\n      }),\n    ]?.forEach((item) => {\n      const sectionToPushTo = SLASH_COMMAND_SECTIONS.find((s) => s.key === item.section) ?? SLASH_COMMAND_SECTIONS[0];\n      const itemIndexToPushAfter = sectionToPushTo.items.findIndex((i) => i.commandKey === item.pushAfter);\n      if (itemIndexToPushAfter !== -1) {\n        sectionToPushTo.items.splice(itemIndexToPushAfter + 1, 0, item);\n      } else {\n        sectionToPushTo.items.push(item);\n      }\n    });\n\n    const filteredSlashSections = SLASH_COMMAND_SECTIONS.map((section) => ({\n      ...section,\n      items: section.items.filter((item) => {\n        if (typeof query !== \"string\") return;\n\n        const lowercaseQuery = query.toLowerCase();\n        return (\n          item.title.toLowerCase().includes(lowercaseQuery) ||\n          item.description.toLowerCase().includes(lowercaseQuery) ||\n          item.searchTerms.some((t) => t.includes(lowercaseQuery))\n        );\n      }),\n    }));\n\n    return filteredSlashSections.filter((s) => s.items.length !== 0);\n  };\n","// plane utils\nimport { cn } from \"@plane/utils\";\n// types\nimport type { ISlashCommandItem } from \"@/types\";\n\ntype Props = {\n  isSelected: boolean;\n  item: ISlashCommandItem;\n  itemIndex: number;\n  onClick: (e: React.MouseEvent<HTMLButtonElement, MouseEvent>) => void;\n  onMouseEnter: () => void;\n  sectionIndex: number;\n  query?: string;\n};\n\n// Utility to highlight matched text in a string\nconst highlightMatch = (text: string, query: string): React.ReactNode => {\n  if (!query || query.trim() === \"\") return text;\n\n  const queryLower = query.toLowerCase().trim();\n  const textLower = text.toLowerCase();\n\n  // Check for direct substring match\n  const index = textLower.indexOf(queryLower);\n  if (index >= 0) {\n    const before = text.substring(0, index);\n    const match = text.substring(index, index + queryLower.length);\n    const after = text.substring(index + queryLower.length);\n\n    return (\n      <>\n        {before}\n        <span className=\"font-medium text-custom-text-100\">{match}</span>\n        {after}\n      </>\n    );\n  }\n\n  // Otherwise just return the text\n  return text;\n};\n\nexport function CommandMenuItem(props: Props) {\n  const { isSelected, item, itemIndex, onClick, onMouseEnter, sectionIndex, query } = props;\n\n  return (\n    <button\n      type=\"button\"\n      id={`item-${sectionIndex}-${itemIndex}`}\n      className={cn(\n        \"flex items-center gap-2 w-full rounded px-1 py-1.5 text-sm text-left truncate text-custom-text-200\",\n        {\n          \"bg-custom-background-80\": isSelected,\n        }\n      )}\n      onClick={onClick}\n      onMouseEnter={onMouseEnter}\n    >\n      <span className=\"size-5 grid place-items-center flex-shrink-0\" style={item.iconContainerStyle}>\n        {item.icon}\n      </span>\n      <p className=\"flex-grow truncate\">{query ? highlightMatch(item.title, query) : item.title}</p>\n      {item.badge}\n    </button>\n  );\n}\n","import { FloatingOverlay } from \"@floating-ui/react\";\nimport type { SuggestionProps } from \"@tiptap/suggestion\";\nimport { forwardRef, useCallback, useEffect, useImperativeHandle, useLayoutEffect, useRef, useState } from \"react\";\n// plane imports\nimport { useOutsideClickDetector } from \"@plane/hooks\";\n// helpers\nimport { DROPDOWN_NAVIGATION_KEYS, getNextValidIndex } from \"@/helpers/tippy\";\n// types\nimport type { ISlashCommandItem } from \"@/types\";\n// components\nimport type { TSlashCommandSection } from \"./command-items-list\";\nimport { CommandMenuItem } from \"./command-menu-item\";\n\nexport type SlashCommandsMenuProps = SuggestionProps<TSlashCommandSection, ISlashCommandItem> & {\n  onClose: () => void;\n};\n\nexport const SlashCommandsMenu = forwardRef(function SlashCommandsMenu(props: SlashCommandsMenuProps, ref) {\n  const { items: sections, command, query, onClose } = props;\n  // states\n  const [selectedIndex, setSelectedIndex] = useState({\n    section: 0,\n    item: 0,\n  });\n  // refs\n  const commandListContainer = useRef<HTMLDivElement>(null);\n\n  const selectItem = useCallback(\n    (sectionIndex: number, itemIndex: number) => {\n      const item = sections[sectionIndex]?.items?.[itemIndex];\n      if (item) command(item);\n    },\n    [command, sections]\n  );\n  // handle arrow key navigation\n  useEffect(() => {\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (DROPDOWN_NAVIGATION_KEYS.includes(e.key)) {\n        e.preventDefault();\n        const currentSection = selectedIndex.section;\n        const currentItem = selectedIndex.item;\n        let nextSection = currentSection;\n        let nextItem = currentItem;\n\n        if (e.key === \"ArrowUp\") {\n          nextItem = currentItem - 1;\n          if (nextItem < 0) {\n            nextSection = currentSection - 1;\n            if (nextSection < 0) nextSection = sections.length - 1;\n            nextItem = sections[nextSection]?.items?.length - 1;\n          }\n        }\n        if (e.key === \"ArrowDown\") {\n          nextItem = currentItem + 1;\n          if (nextItem >= sections[currentSection]?.items?.length) {\n            nextSection = currentSection + 1;\n            if (nextSection >= sections.length) nextSection = 0;\n            nextItem = 0;\n          }\n        }\n        if (e.key === \"Enter\") {\n          selectItem(currentSection, currentItem);\n        }\n        setSelectedIndex({\n          section: nextSection,\n          item: nextItem,\n        });\n      }\n    };\n    document.addEventListener(\"keydown\", onKeyDown);\n    return () => {\n      document.removeEventListener(\"keydown\", onKeyDown);\n    };\n  }, [sections, selectedIndex, setSelectedIndex, selectItem]);\n  // initialize the select index to 0 by default\n  useEffect(() => {\n    setSelectedIndex({\n      section: 0,\n      item: 0,\n    });\n  }, [sections]);\n  // scroll to the dropdown item when navigating via keyboard\n  useLayoutEffect(() => {\n    const container = commandListContainer?.current;\n    if (!container) return;\n\n    const item = container.querySelector(`#item-${selectedIndex.section}-${selectedIndex.item}`) as HTMLElement;\n\n    // use scroll into view to bring the item in view if it is not in view\n    item?.scrollIntoView({ block: \"nearest\" });\n  }, [sections, selectedIndex]);\n\n  useImperativeHandle(ref, () => ({\n    onKeyDown: ({ event }: { event: KeyboardEvent }) => {\n      if (!DROPDOWN_NAVIGATION_KEYS.includes(event.key)) return false;\n\n      if (event.key === \"Enter\") {\n        selectItem(selectedIndex.section, selectedIndex.item);\n        return true;\n      }\n\n      const newIndex = getNextValidIndex({\n        event,\n        sections,\n        selectedIndex,\n      });\n\n      if (newIndex) {\n        setSelectedIndex(newIndex);\n      }\n\n      return true;\n    },\n  }));\n\n  useOutsideClickDetector(commandListContainer, onClose);\n\n  const areSearchResultsEmpty = sections.map((s) => s.items?.length).reduce((acc, curr) => acc + curr, 0) === 0;\n\n  if (areSearchResultsEmpty) return null;\n\n  return (\n    <>\n      {/* Backdrop */}\n      <FloatingOverlay\n        style={{\n          zIndex: 99,\n        }}\n        lockScroll\n      />\n      <div\n        id=\"slash-command\"\n        ref={commandListContainer}\n        className=\"relative max-h-80 min-w-[12rem] overflow-y-auto rounded-md border-[0.5px] border-custom-border-300 bg-custom-background-100 px-2 py-2.5 shadow-custom-shadow-rg space-y-2\"\n        style={{\n          zIndex: 100,\n        }}\n        onClick={(e) => {\n          e.stopPropagation();\n        }}\n        onMouseDown={(e) => {\n          e.stopPropagation();\n        }}\n      >\n        {sections.map((section, sectionIndex) => (\n          <div key={section.key} className=\"space-y-2\">\n            {section.title && <h6 className=\"text-xs font-semibold text-custom-text-300\">{section.title}</h6>}\n            <div>\n              {section.items?.map((item, itemIndex) => (\n                <CommandMenuItem\n                  key={item.key}\n                  isSelected={sectionIndex === selectedIndex.section && itemIndex === selectedIndex.item}\n                  item={item}\n                  itemIndex={itemIndex}\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    selectItem(sectionIndex, itemIndex);\n                  }}\n                  onMouseEnter={() =>\n                    setSelectedIndex({\n                      section: sectionIndex,\n                      item: itemIndex,\n                    })\n                  }\n                  sectionIndex={sectionIndex}\n                  query={query}\n                />\n              ))}\n            </div>\n          </div>\n        ))}\n      </div>\n    </>\n  );\n});\n\nSlashCommandsMenu.displayName = \"SlashCommandsMenu\";\n","import { Extension } from \"@tiptap/core\";\nimport type { Editor } from \"@tiptap/core\";\nimport { ReactRenderer } from \"@tiptap/react\";\nimport Suggestion from \"@tiptap/suggestion\";\nimport type { SuggestionOptions } from \"@tiptap/suggestion\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// helpers\nimport { updateFloatingUIFloaterPosition } from \"@/helpers/floating-ui\";\nimport type { CommandListInstance } from \"@/helpers/tippy\";\nimport { DROPDOWN_NAVIGATION_KEYS } from \"@/helpers/tippy\";\n// types\nimport type { IEditorProps, ISlashCommandItem, TEditorCommands, TSlashCommandSectionKeys } from \"@/types\";\n// components\nimport { getSlashCommandFilteredSections } from \"./command-items-list\";\nimport type { SlashCommandsMenuProps } from \"./command-menu\";\nimport { SlashCommandsMenu } from \"./command-menu\";\n\nexport type SlashCommandOptions = {\n  suggestion: Omit<SuggestionOptions, \"editor\">;\n};\n\nexport type TSlashCommandAdditionalOption = ISlashCommandItem & {\n  section: TSlashCommandSectionKeys;\n  pushAfter: TEditorCommands;\n};\n\nconst Command = Extension.create<SlashCommandOptions>({\n  name: CORE_EXTENSIONS.SLASH_COMMANDS,\n  addOptions() {\n    return {\n      suggestion: {\n        char: \"/\",\n        command: ({ editor, range, props }) => {\n          props.command({ editor, range });\n        },\n        allow({ editor }: { editor: Editor }) {\n          const { selection } = editor.state;\n          const parentNode = selection.$from.node(selection.$from.depth);\n          const blockType = parentNode.type.name;\n\n          if (blockType === CORE_EXTENSIONS.CODE_BLOCK) {\n            return false;\n          }\n\n          return true;\n        },\n      },\n    };\n  },\n  addProseMirrorPlugins() {\n    return [\n      Suggestion({\n        editor: this.editor,\n        render: () => {\n          let component: ReactRenderer<CommandListInstance, SlashCommandsMenuProps> | null = null;\n          let cleanup: () => void = () => {};\n          let editorRef: Editor | null = null;\n\n          const handleClose = (editor?: Editor) => {\n            component?.destroy();\n            component = null;\n            (editor || editorRef)?.commands.removeActiveDropbarExtension(CORE_EXTENSIONS.SLASH_COMMANDS);\n            cleanup();\n          };\n\n          return {\n            onStart: (props) => {\n              editorRef = props.editor;\n              // React renderer component, which wraps the actual dropdown component\n              component = new ReactRenderer<CommandListInstance, SlashCommandsMenuProps>(SlashCommandsMenu, {\n                props: {\n                  ...props,\n                  onClose: () => handleClose(props.editor),\n                } satisfies SlashCommandsMenuProps,\n                editor: props.editor,\n                className: \"fixed z-[100]\",\n              });\n              if (!props.clientRect) return;\n              props.editor.commands.addActiveDropbarExtension(CORE_EXTENSIONS.SLASH_COMMANDS);\n              const element = component.element as HTMLElement;\n              cleanup = updateFloatingUIFloaterPosition(props.editor, element).cleanup;\n            },\n\n            onUpdate: (props) => {\n              if (!component || !component.element) return;\n              component.updateProps(props);\n              if (!props.clientRect) return;\n              const element = component.element as HTMLElement;\n              cleanup();\n              cleanup = updateFloatingUIFloaterPosition(props.editor, element).cleanup;\n            },\n\n            onKeyDown: ({ event }) => {\n              if ([...DROPDOWN_NAVIGATION_KEYS, \"Escape\"].includes(event.key)) {\n                event.preventDefault();\n                event.stopPropagation();\n              }\n\n              if (event.key === \"Escape\") {\n                handleClose(this.editor);\n                return true;\n              }\n\n              return component?.ref?.onKeyDown({ event }) ?? false;\n            },\n\n            onExit: ({ editor }) => {\n              component?.element.remove();\n              handleClose(editor);\n            },\n          };\n        },\n        ...this.options.suggestion,\n      }),\n    ];\n  },\n});\n\nexport type TExtensionProps = Pick<IEditorProps, \"disabledExtensions\" | \"flaggedExtensions\"> & {\n  additionalOptions?: TSlashCommandAdditionalOption[];\n};\n\nexport function SlashCommands(props: TExtensionProps) {\n  return Command.configure({\n    suggestion: {\n      items: getSlashCommandFilteredSections(props),\n    },\n  });\n}\n","import { textInputRule } from \"@tiptap/core\";\n\nexport type TypographyOptions = {\n  emDash: false | string;\n  ellipsis: false | string;\n  leftArrow: false | string;\n  rightArrow: false | string;\n  copyright: false | string;\n  trademark: false | string;\n  servicemark: false | string;\n  registeredTrademark: false | string;\n  oneHalf: false | string;\n  plusMinus: false | string;\n  notEqual: false | string;\n  laquo: false | string;\n  raquo: false | string;\n  multiplication: false | string;\n  superscriptTwo: false | string;\n  superscriptThree: false | string;\n  oneQuarter: false | string;\n  threeQuarters: false | string;\n  impliesArrowRight: false | string;\n};\n\nexport const emDash = (override?: string) =>\n  textInputRule({\n    find: /--$/,\n    replace: override ?? \"\",\n  });\n\nexport const impliesArrowRight = (override?: string) =>\n  textInputRule({\n    find: /=>$/,\n    replace: override ?? \"\",\n  });\n\nexport const leftArrow = (override?: string) =>\n  textInputRule({\n    find: /<-$/,\n    replace: override ?? \"\",\n  });\n\nexport const rightArrow = (override?: string) =>\n  textInputRule({\n    find: /->$/,\n    replace: override ?? \"\",\n  });\n\nexport const ellipsis = (override?: string) =>\n  textInputRule({\n    find: /\\.\\.\\.$/,\n    replace: override ?? \"\",\n  });\n\nexport const copyright = (override?: string) =>\n  textInputRule({\n    find: /\\(c\\)$/,\n    replace: override ?? \"\",\n  });\n\nexport const trademark = (override?: string) =>\n  textInputRule({\n    find: /\\(tm\\)$/,\n    replace: override ?? \"\",\n  });\n\nexport const servicemark = (override?: string) =>\n  textInputRule({\n    find: /\\(sm\\)$/,\n    replace: override ?? \"\",\n  });\n\nexport const registeredTrademark = (override?: string) =>\n  textInputRule({\n    find: /\\(r\\)$/,\n    replace: override ?? \"\",\n  });\n\nexport const oneHalf = (override?: string) =>\n  textInputRule({\n    find: /(?:^|\\s)(1\\/2)\\s$/,\n    replace: override ?? \"\",\n  });\n\nexport const plusMinus = (override?: string) =>\n  textInputRule({\n    find: /\\+\\/-$/,\n    replace: override ?? \"\",\n  });\n\nexport const notEqual = (override?: string) =>\n  textInputRule({\n    find: /!=$/,\n    replace: override ?? \"\",\n  });\n\nexport const laquo = (override?: string) =>\n  textInputRule({\n    find: /<<$/,\n    replace: override ?? \"\",\n  });\n\nexport const raquo = (override?: string) =>\n  textInputRule({\n    find: />>$/,\n    replace: override ?? \"\",\n  });\n\nexport const multiplication = (override?: string) =>\n  textInputRule({\n    find: /\\d+\\s?([*x])\\s?\\d+$/,\n    replace: override ?? \"\",\n  });\n\nexport const superscriptTwo = (override?: string) =>\n  textInputRule({\n    find: /\\^2$/,\n    replace: override ?? \"\",\n  });\n\nexport const superscriptThree = (override?: string) =>\n  textInputRule({\n    find: /\\^3$/,\n    replace: override ?? \"\",\n  });\n\nexport const oneQuarter = (override?: string) =>\n  textInputRule({\n    find: /(?:^|\\s)(1\\/4)\\s$/,\n    replace: override ?? \"\",\n  });\n\nexport const threeQuarters = (override?: string) =>\n  textInputRule({\n    find: /(?:^|\\s)(3\\/4)\\s$/,\n    replace: override ?? \"\",\n  });\n","import type { InputRule } from \"@tiptap/core\";\nimport { Extension } from \"@tiptap/core\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\nimport type { TypographyOptions } from \"./inputRules\";\nimport {\n  emDash,\n  ellipsis,\n  leftArrow,\n  rightArrow,\n  copyright,\n  trademark,\n  servicemark,\n  registeredTrademark,\n  oneHalf,\n  plusMinus,\n  notEqual,\n  laquo,\n  raquo,\n  multiplication,\n  superscriptTwo,\n  superscriptThree,\n  oneQuarter,\n  threeQuarters,\n  impliesArrowRight,\n} from \"./inputRules\";\n\nexport const CustomTypographyExtension = Extension.create<TypographyOptions>({\n  name: CORE_EXTENSIONS.TYPOGRAPHY,\n\n  addInputRules() {\n    const rules: InputRule[] = [];\n\n    if (this.options.emDash !== false) {\n      rules.push(emDash(this.options.emDash));\n    }\n\n    if (this.options.impliesArrowRight !== false) {\n      rules.push(impliesArrowRight(this.options.impliesArrowRight));\n    }\n\n    if (this.options.ellipsis !== false) {\n      rules.push(ellipsis(this.options.ellipsis));\n    }\n\n    if (this.options.leftArrow !== false) {\n      rules.push(leftArrow(this.options.leftArrow));\n    }\n\n    if (this.options.rightArrow !== false) {\n      rules.push(rightArrow(this.options.rightArrow));\n    }\n\n    if (this.options.copyright !== false) {\n      rules.push(copyright(this.options.copyright));\n    }\n\n    if (this.options.trademark !== false) {\n      rules.push(trademark(this.options.trademark));\n    }\n\n    if (this.options.servicemark !== false) {\n      rules.push(servicemark(this.options.servicemark));\n    }\n\n    if (this.options.registeredTrademark !== false) {\n      rules.push(registeredTrademark(this.options.registeredTrademark));\n    }\n\n    if (this.options.oneHalf !== false) {\n      rules.push(oneHalf(this.options.oneHalf));\n    }\n\n    if (this.options.plusMinus !== false) {\n      rules.push(plusMinus(this.options.plusMinus));\n    }\n\n    if (this.options.notEqual !== false) {\n      rules.push(notEqual(this.options.notEqual));\n    }\n\n    if (this.options.laquo !== false) {\n      rules.push(laquo(this.options.laquo));\n    }\n\n    if (this.options.raquo !== false) {\n      rules.push(raquo(this.options.raquo));\n    }\n\n    if (this.options.multiplication !== false) {\n      rules.push(multiplication(this.options.multiplication));\n    }\n\n    if (this.options.superscriptTwo !== false) {\n      rules.push(superscriptTwo(this.options.superscriptTwo));\n    }\n\n    if (this.options.superscriptThree !== false) {\n      rules.push(superscriptThree(this.options.superscriptThree));\n    }\n\n    if (this.options.oneQuarter !== false) {\n      rules.push(oneQuarter(this.options.oneQuarter));\n    }\n\n    if (this.options.threeQuarters !== false) {\n      rules.push(threeQuarters(this.options.threeQuarters));\n    }\n\n    return rules;\n  },\n});\n","import { Extension } from \"@tiptap/core\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n\nexport const EnterKeyExtension = (onEnterKeyPress?: () => void) =>\n  Extension.create({\n    name: CORE_EXTENSIONS.ENTER_KEY,\n\n    addKeyboardShortcuts(this) {\n      return {\n        Enter: () => {\n          const { activeDropbarExtensions } = this.editor.storage.utility;\n\n          if (activeDropbarExtensions.length === 0) {\n            onEnterKeyPress?.();\n            return true;\n          }\n\n          return false;\n        },\n        \"Shift-Enter\": ({ editor }) =>\n          editor.commands.first(({ commands }) => [\n            () => commands.newlineInCode(),\n            () => commands.splitListItem(CORE_EXTENSIONS.LIST_ITEM),\n            () => commands.splitListItem(CORE_EXTENSIONS.TASK_ITEM),\n            () => commands.createParagraphNear(),\n            () => commands.liftEmptyBlock(),\n            () => commands.splitBlock(),\n          ]),\n      };\n    },\n  });\n","import { ReactNodeViewRenderer } from \"@tiptap/react\";\nimport { v4 as uuidv4 } from \"uuid\";\n// constants\nimport { ACCEPTED_IMAGE_MIME_TYPES } from \"@/constants/config\";\n// helpers\nimport { isFileValid } from \"@/helpers/file\";\nimport { insertEmptyParagraphAtNodeBoundaries } from \"@/helpers/insert-empty-paragraph-at-node-boundary\";\n// types\nimport type { TFileHandler } from \"@/types\";\n// local imports\nimport type { CustomImageNodeViewProps } from \"./components/node-view\";\nimport { CustomImageNodeView } from \"./components/node-view\";\nimport { CustomImageExtensionConfig } from \"./extension-config\";\nimport type { CustomImageExtensionOptions, CustomImageExtensionStorage } from \"./types\";\nimport { ECustomImageAttributeNames, ECustomImageStatus } from \"./types\";\nimport { getImageComponentImageFileMap } from \"./utils\";\n\ntype Props = {\n  fileHandler: TFileHandler;\n  isEditable: boolean;\n};\n\nexport function CustomImageExtension(props: Props) {\n  const { fileHandler, isEditable } = props;\n  // derived values\n  const { getAssetSrc, getAssetDownloadSrc, restore: restoreImageFn } = fileHandler;\n\n  return CustomImageExtensionConfig.extend<CustomImageExtensionOptions, CustomImageExtensionStorage>({\n    selectable: isEditable,\n    draggable: isEditable,\n\n    addOptions() {\n      const upload = \"upload\" in fileHandler ? fileHandler.upload : undefined;\n      const duplicate = \"duplicate\" in fileHandler ? fileHandler.duplicate : undefined;\n      return {\n        ...this.parent?.(),\n        getImageDownloadSource: getAssetDownloadSrc,\n        getImageSource: getAssetSrc,\n        restoreImage: restoreImageFn,\n        uploadImage: upload,\n        duplicateImage: duplicate,\n      };\n    },\n\n    addStorage() {\n      const maxFileSize = \"validation\" in fileHandler ? fileHandler.validation?.maxFileSize : 0;\n\n      return {\n        fileMap: new Map(),\n        deletedImageSet: new Map<string, boolean>(),\n        maxFileSize,\n        // escape markdown for images\n        markdown: {\n          serialize() {},\n        },\n      };\n    },\n\n    addCommands() {\n      return {\n        insertImageComponent:\n          (props) =>\n          ({ commands }) => {\n            // Early return if there's an invalid file being dropped\n            if (\n              props?.file &&\n              !isFileValid({\n                acceptedMimeTypes: ACCEPTED_IMAGE_MIME_TYPES,\n                file: props.file,\n                maxFileSize: this.storage.maxFileSize,\n                onError: (_error, message) => alert(message),\n              })\n            ) {\n              return false;\n            }\n\n            // generate a unique id for the image to keep track of dropped\n            // files' file data\n            const fileId = uuidv4();\n\n            const imageComponentImageFileMap = getImageComponentImageFileMap(this.editor);\n\n            if (imageComponentImageFileMap) {\n              if (props?.event === \"drop\" && props.file) {\n                imageComponentImageFileMap.set(fileId, {\n                  file: props.file,\n                  event: props.event,\n                });\n              } else if (props.event === \"insert\") {\n                imageComponentImageFileMap.set(fileId, {\n                  event: props.event,\n                  hasOpenedFileInputOnce: false,\n                });\n              }\n            }\n\n            const attributes = {\n              [ECustomImageAttributeNames.ID]: fileId,\n              [ECustomImageAttributeNames.STATUS]: ECustomImageStatus.PENDING,\n            };\n\n            if (props.pos) {\n              return commands.insertContentAt(props.pos, {\n                type: this.name,\n                attrs: attributes,\n              });\n            }\n            return commands.insertContent({\n              type: this.name,\n              attrs: attributes,\n            });\n          },\n      };\n    },\n\n    addKeyboardShortcuts() {\n      return {\n        ArrowDown: insertEmptyParagraphAtNodeBoundaries(\"down\", this.name),\n        ArrowUp: insertEmptyParagraphAtNodeBoundaries(\"up\", this.name),\n      };\n    },\n    addNodeView() {\n      return ReactNodeViewRenderer((props) => (\n        <CustomImageNodeView {...props} node={props.node as CustomImageNodeViewProps[\"node\"]} />\n      ));\n    },\n  });\n}\n","import { Placeholder } from \"@tiptap/extension-placeholder\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// types\nimport type { IEditorProps } from \"@/types\";\n\ntype TArgs = {\n  placeholder: IEditorProps[\"placeholder\"];\n  showPlaceholderOnEmpty: IEditorProps[\"showPlaceholderOnEmpty\"];\n};\n\nexport const CustomPlaceholderExtension = (args: TArgs) => {\n  const { placeholder, showPlaceholderOnEmpty = false } = args;\n\n  return Placeholder.configure({\n    placeholder: ({ editor, node }) => {\n      if (!editor.isEditable) return \"\";\n\n      if (node.type.name === CORE_EXTENSIONS.HEADING) return `Heading ${node.attrs.level}`;\n\n      const isUploadInProgress = editor.storage.utility?.uploadInProgress;\n\n      if (isUploadInProgress) return \"\";\n\n      const shouldHidePlaceholder =\n        editor.isActive(CORE_EXTENSIONS.TABLE) ||\n        editor.isActive(CORE_EXTENSIONS.CODE_BLOCK) ||\n        editor.isActive(CORE_EXTENSIONS.IMAGE) ||\n        editor.isActive(CORE_EXTENSIONS.CUSTOM_IMAGE);\n\n      if (shouldHidePlaceholder) return \"\";\n\n      if (showPlaceholderOnEmpty) {\n        const isDocumentEmpty = editor.state.doc.textContent.length === 0;\n        if (!isDocumentEmpty) {\n          return \"\";\n        }\n      }\n\n      if (placeholder) {\n        if (typeof placeholder === \"string\") return placeholder;\n        else return placeholder(editor.isFocused, editor.getHTML());\n      }\n\n      return \"Press '/' for commands...\";\n    },\n    includeChildren: true,\n  });\n};\n","export enum ADDITIONAL_EXTENSIONS {}\n\nexport const ADDITIONAL_BLOCK_NODE_TYPES = [];\n","import { findChildren } from \"@tiptap/core\";\nimport type { EditorView } from \"@tiptap/pm/view\";\n// types\nimport type { UniqueIDOptions } from \"./extension\";\n\n/**\n * Utility function to create IDs for nodes that don't have them\n */\nexport const createIdsForView = (view: EditorView, options: UniqueIDOptions) => {\n  const { state } = view;\n  const { tr, doc } = state;\n  const { types, attributeName, generateUniqueID } = options;\n\n  // size > 2 means more than just the default empty paragraph\n  const hasContent = doc.content.size > 2;\n  if (!hasContent) {\n    return;\n  }\n\n  const nodesWithoutId = findChildren(\n    doc,\n    (node) => types.includes(node.type.name) && node.attrs[attributeName] === null\n  );\n\n  nodesWithoutId.forEach(({ node, pos }) => {\n    tr.setNodeMarkup(pos, undefined, {\n      ...node.attrs,\n      [attributeName]: generateUniqueID({ node, pos }),\n    });\n  });\n\n  tr.setMeta(\"addToHistory\", false);\n  tr.setMeta(\"uniqueIdOnlyChange\", true);\n\n  view.dispatch(tr);\n};\n","import { combineTransactionSteps, findChildrenInRange, findDuplicates, getChangedRanges } from \"@tiptap/core\";\nimport { Fragment, Slice } from \"@tiptap/pm/model\";\nimport type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\nimport type { Transaction } from \"@tiptap/pm/state\";\n// types\nimport type { UniqueIDOptions } from \"./extension\";\n// utils\nimport { createIdsForView } from \"./utils\";\n\nexport const createUniqueIDPlugin = (options: UniqueIDOptions) => {\n  let dragSourceElement: Element | null = null;\n  let transformPasted = false;\n  let syncHandler: (() => void) | null = null;\n\n  return new Plugin({\n    key: new PluginKey(\"uniqueID\"),\n    appendTransaction: (transactions, oldState, newState) => {\n      const hasDocChanges =\n        transactions.some((transaction) => transaction.docChanged) && !oldState.doc.eq(newState.doc);\n      const filterTransactions =\n        options.filterTransaction && transactions.some((tr) => !options.filterTransaction?.(tr));\n\n      const isCollabTransaction = transactions.find((tr) => tr.getMeta(\"y-sync$\"));\n\n      if (isCollabTransaction) {\n        return;\n      }\n\n      if (!hasDocChanges || filterTransactions) {\n        return;\n      }\n\n      const { tr } = newState;\n\n      const { types, attributeName, generateUniqueID } = options;\n      const transform = combineTransactionSteps(oldState.doc, transactions as Transaction[]);\n\n      const { mapping } = transform;\n\n      // get changed ranges based on the old state\n      const changes = getChangedRanges(transform);\n\n      // Get all IDs from the entire document to check for duplicates globally\n      const allNodesInDoc: Array<{ node: ProseMirrorNode; pos: number }> = [];\n      newState.doc.descendants((node, pos) => {\n        if (types.includes(node.type.name)) {\n          allNodesInDoc.push({ node, pos });\n        }\n      });\n      const allIds = allNodesInDoc.map(({ node }) => node.attrs[attributeName]).filter((id) => id !== null);\n      const duplicatedIds = findDuplicates(allIds);\n\n      changes.forEach(({ newRange }) => {\n        const newNodes = findChildrenInRange(newState.doc, newRange, (node) => types.includes(node.type.name));\n\n        newNodes.forEach(({ node, pos }) => {\n          // instead of checking `node.attrs[attributeName]` directly\n          // we look at the current state of the node within `tr.doc`.\n          // this helps to prevent adding new ids to the same node\n          // if the node changed multiple times within one transaction\n          const id = tr.doc.nodeAt(pos)?.attrs[attributeName];\n\n          if (id === null) {\n            tr.setNodeMarkup(pos, undefined, {\n              ...node.attrs,\n              [attributeName]: generateUniqueID({ node, pos }),\n            });\n\n            return;\n          }\n\n          // check if the node doesn't exist in the old state\n          const { deleted } = mapping.invert().mapResult(pos);\n\n          // If this is a new node (didn't exist in old state) and its ID is duplicated in the entire document\n          const newNode = deleted && duplicatedIds.includes(id);\n\n          if (newNode) {\n            tr.setNodeMarkup(pos, undefined, {\n              ...node.attrs,\n              [attributeName]: generateUniqueID({ node, pos }),\n            });\n          }\n        });\n      });\n\n      if (!tr.steps.length) {\n        return;\n      }\n\n      // `tr.setNodeMarkup` resets the stored marks\n      // so we'll restore them if they exist\n      tr.setStoredMarks(newState.tr.storedMarks);\n\n      // Don't add ID generation to undo history\n      // since its causing issue with undo feature we are commmeting it out for now\n      // tr.setMeta(\"addToHistory\", false);\n\n      return tr;\n    },\n\n    // we register a global drag handler to track the current drag source element\n    view(view) {\n      const handleDragstart = (event: DragEvent) => {\n        dragSourceElement = view.dom.parentElement?.contains(event.target as Element) ? view.dom.parentElement : null;\n      };\n\n      window.addEventListener(\"dragstart\", handleDragstart);\n\n      // Handle provider sync listener for creating IDs when collaboration provider syncs\n      const provider = options.provider;\n      if (provider && !provider.isSynced) {\n        syncHandler = () => {\n          createIdsForView(view, options);\n\n          // Clean up the listener after it runs\n          if (provider && syncHandler) {\n            provider.off(\"synced\", syncHandler);\n            syncHandler = null;\n          }\n        };\n\n        provider.on(\"synced\", syncHandler);\n      }\n\n      return {\n        destroy() {\n          window.removeEventListener(\"dragstart\", handleDragstart);\n\n          // Clean up provider sync listener if it exists\n          if (provider && syncHandler) {\n            provider.off(\"synced\", syncHandler);\n            syncHandler = null;\n          }\n        },\n      };\n    },\n\n    props: {\n      // `handleDOMEvents` is called before `transformPasted`\n      // so we can do some checks before\n      handleDOMEvents: {\n        // only create new ids for dropped content\n        // or dropped content while holding `alt`\n        // or content is dragged from another editor\n        drop: (view, event) => {\n          if (dragSourceElement !== view.dom.parentElement || event.dataTransfer?.effectAllowed === \"copy\") {\n            dragSourceElement = null;\n            transformPasted = true;\n          }\n\n          return false;\n        },\n        // always create new ids on pasted content\n        paste: () => {\n          transformPasted = true;\n\n          return false;\n        },\n      },\n\n      // we'll remove ids for every pasted node\n      // so we can create a new one within `appendTransaction`\n      transformPasted: (slice) => {\n        if (!transformPasted) {\n          return slice;\n        }\n\n        const { types, attributeName } = options;\n        const removeId = (fragment: Fragment): Fragment => {\n          const list: ProseMirrorNode[] = [];\n\n          fragment.forEach((node) => {\n            // don't touch text nodes\n            if (node.isText) {\n              list.push(node);\n\n              return;\n            }\n\n            // check for any other child nodes\n            if (!types.includes(node.type.name)) {\n              list.push(node.copy(removeId(node.content)));\n\n              return;\n            }\n\n            // remove id\n            const nodeWithoutId = node.type.create(\n              {\n                ...node.attrs,\n                [attributeName]: null,\n              },\n              removeId(node.content),\n              node.marks\n            );\n\n            list.push(nodeWithoutId);\n          });\n\n          return Fragment.from(list);\n        };\n\n        // reset check\n        transformPasted = false;\n\n        return new Slice(removeId(slice.content), slice.openStart, slice.openEnd);\n      },\n    },\n  });\n};\n","import type { HocuspocusProvider } from \"@hocuspocus/provider\";\nimport { Extension } from \"@tiptap/core\";\nimport type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\nimport type { Transaction } from \"@tiptap/pm/state\";\nimport { v4 as uuidv4 } from \"uuid\";\n// constants\nimport { CORE_EXTENSIONS, BLOCK_NODE_TYPES } from \"@/constants/extension\";\nimport { ADDITIONAL_BLOCK_NODE_TYPES } from \"@/plane-editor/constants/extensions\";\nimport { createUniqueIDPlugin } from \"./plugin\";\nimport { createIdsForView } from \"./utils\";\n// plane imports\n\nconst COMBINED_BLOCK_NODE_TYPES = [...BLOCK_NODE_TYPES, ...ADDITIONAL_BLOCK_NODE_TYPES];\nexport type UniqueIDGenerationContext = {\n  node: ProseMirrorNode;\n  pos: number;\n};\nexport const UniqueIDAttribute = \"id\";\nexport const generateUniqueID = () => uuidv4();\n\nexport interface UniqueIDOptions {\n  /**\n   * The name of the attribute to add the unique ID to.\n   * @default \"id\"\n   */\n  attributeName: string;\n  /**\n   * The types of nodes to add unique IDs to.\n   * @default []\n   */\n  types: string[];\n  /**\n   * The function that generates the unique ID. By default, a UUID v4 is\n   * generated. However, you can provide your own function to generate the\n   * unique ID based on the node type and the position.\n   */\n  generateUniqueID: (ctx: UniqueIDGenerationContext) => string;\n  /**\n   * Ignore some mutations, for example applied from other users through the collaboration plugin.\n   *\n   * @default null\n   */\n  filterTransaction: ((transaction: Transaction) => boolean) | null;\n  /**\n   * Whether to update the document by adding unique IDs to the nodes. Set this\n   * property to `false` if the document is in `readonly` mode, is immutable, or\n   * you don't want it to be modified.\n   *\n   * @default true\n   */\n  updateDocument: boolean;\n  /**\n   * The provider to use for the unique ID generation.\n   * @default null\n   */\n  provider: HocuspocusProvider | undefined;\n}\n\nexport const UniqueID = Extension.create<UniqueIDOptions>({\n  name: CORE_EXTENSIONS.UNIQUE_ID,\n\n  // we'll set a very high priority to make sure this runs first\n  // and is compatible with `appendTransaction` hooks of other extensions\n  priority: 10000,\n\n  addOptions() {\n    return {\n      attributeName: \"id\",\n      types: COMBINED_BLOCK_NODE_TYPES,\n      generateUniqueID: () => uuidv4(),\n      filterTransaction: null,\n      updateDocument: true,\n      provider: undefined,\n    };\n  },\n\n  addGlobalAttributes() {\n    return [\n      {\n        types: this.options.types,\n        attributes: {\n          [this.options.attributeName]: {\n            default: null,\n            parseHTML: (element) => element.getAttribute(`data-${this.options.attributeName}`),\n            renderHTML: (attributes) => {\n              if (!attributes[this.options.attributeName]) {\n                return {};\n              }\n\n              return {\n                [`data-${this.options.attributeName}`]: attributes[this.options.attributeName],\n              };\n            },\n          },\n        },\n      },\n    ];\n  },\n\n  // check initial content for missing ids\n  onCreate() {\n    if (!this.editor.isEditable) {\n      this.options.updateDocument = false;\n    }\n\n    if (!this.options.updateDocument) {\n      return;\n    }\n\n    const provider = this.options.provider;\n\n    /**\n     * We need to handle collaboration a bit different here\n     * because we can't automatically add IDs when the provider is not yet synced\n     * otherwise we end up with empty paragraphs\n     */\n    if (provider) {\n      // Check if provider is already synced\n      if (provider.isSynced) {\n        createIdsForView(this.editor.view, this.options);\n      }\n      // If not synced, the listener will be registered in the plugin\n      // and handled there with proper cleanup\n    } else {\n      createIdsForView(this.editor.view, this.options);\n    }\n  },\n\n  addProseMirrorPlugins() {\n    if (!this.options.updateDocument) {\n      return [];\n    }\n\n    return [createUniqueIDPlugin(this.options)];\n  },\n});\n","import type { HocuspocusProvider } from \"@hocuspocus/provider\";\nimport type { Extensions } from \"@tiptap/core\";\nimport { CharacterCount } from \"@tiptap/extension-character-count\";\nimport TaskItem from \"@tiptap/extension-task-item\";\nimport TaskList from \"@tiptap/extension-task-list\";\nimport { TextStyle } from \"@tiptap/extension-text-style\";\nimport { Underline } from \"@tiptap/extension-underline\";\nimport { Markdown } from \"tiptap-markdown\";\n// extensions\nimport {\n  CustomCalloutExtension,\n  CustomCodeBlockExtension,\n  CustomCodeInlineExtension,\n  CustomColorExtension,\n  CustomHorizontalRule,\n  CustomKeymap,\n  CustomLinkExtension,\n  CustomMentionExtension,\n  CustomQuoteExtension,\n  CustomTextAlignExtension,\n  CustomTypographyExtension,\n  ImageExtension,\n  ListKeymap,\n  Table,\n  TableCell,\n  TableHeader,\n  TableRow,\n  UtilityExtension,\n} from \"@/extensions\";\n// plane editor extensions\nimport { CoreEditorAdditionalExtensions } from \"@/plane-editor/extensions\";\n// types\nimport type { IEditorProps } from \"@/types\";\n// local imports\nimport { CustomImageExtension } from \"./custom-image/extension\";\nimport { EmojiExtension } from \"./emoji/extension\";\nimport { CustomPlaceholderExtension } from \"./placeholder\";\nimport { CustomStarterKitExtension } from \"./starter-kit\";\nimport { UniqueID } from \"./unique-id/extension\";\n\ntype TArguments = Pick<\n  IEditorProps,\n  | \"disabledExtensions\"\n  | \"flaggedExtensions\"\n  | \"fileHandler\"\n  | \"getEditorMetaData\"\n  | \"isTouchDevice\"\n  | \"mentionHandler\"\n  | \"placeholder\"\n  | \"showPlaceholderOnEmpty\"\n  | \"tabIndex\"\n  | \"extendedEditorProps\"\n> & {\n  enableHistory: boolean;\n  editable: boolean;\n  provider: HocuspocusProvider | undefined;\n};\n\nexport const CoreEditorExtensions = (args: TArguments): Extensions => {\n  const {\n    disabledExtensions,\n    enableHistory,\n    fileHandler,\n    flaggedExtensions,\n    getEditorMetaData,\n    isTouchDevice = false,\n    mentionHandler,\n    placeholder,\n    showPlaceholderOnEmpty,\n    tabIndex,\n    editable,\n    extendedEditorProps,\n    provider,\n  } = args;\n\n  const extensions = [\n    CustomStarterKitExtension({\n      enableHistory,\n    }),\n    EmojiExtension,\n    CustomQuoteExtension,\n    CustomHorizontalRule,\n    CustomKeymap,\n    ListKeymap({ tabIndex }),\n    CustomLinkExtension,\n    CustomTypographyExtension,\n    Underline,\n    TextStyle,\n    TaskList.configure({\n      HTMLAttributes: {\n        class: \"not-prose pl-2 space-y-2\",\n      },\n    }),\n    TaskItem.configure({\n      HTMLAttributes: {\n        class: \"relative\",\n      },\n      nested: true,\n    }),\n    CustomCodeBlockExtension,\n    CustomCodeInlineExtension,\n    Markdown.configure({\n      html: true,\n      transformCopiedText: false,\n      transformPastedText: true,\n      breaks: true,\n    }),\n    Table,\n    TableHeader,\n    TableCell,\n    TableRow,\n    CustomMentionExtension(mentionHandler),\n    CustomPlaceholderExtension({ placeholder, showPlaceholderOnEmpty }),\n    CharacterCount,\n    CustomColorExtension,\n    CustomTextAlignExtension,\n    CustomCalloutExtension,\n    UtilityExtension({\n      disabledExtensions,\n      flaggedExtensions,\n      fileHandler,\n      getEditorMetaData,\n      isEditable: editable,\n      isTouchDevice,\n    }),\n    ...CoreEditorAdditionalExtensions({\n      disabledExtensions,\n      flaggedExtensions,\n      fileHandler,\n      extendedEditorProps,\n    }),\n    UniqueID.configure({\n      provider,\n    }),\n  ];\n\n  if (!disabledExtensions.includes(\"image\")) {\n    extensions.push(\n      ImageExtension({\n        fileHandler,\n      }),\n      CustomImageExtension({\n        fileHandler,\n        isEditable: editable,\n      })\n    );\n  }\n\n  return extensions;\n};\n","import { Extension } from \"@tiptap/core\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// types\nimport type { IMarking } from \"@/types\";\n\nexport type HeadingExtensionStorage = {\n  headings: IMarking[];\n};\n\ndeclare module \"@tiptap/core\" {\n  interface Storage {\n    [CORE_EXTENSIONS.HEADINGS_LIST]: HeadingExtensionStorage;\n  }\n}\n\nexport const HeadingListExtension = Extension.create<unknown, HeadingExtensionStorage>({\n  name: CORE_EXTENSIONS.HEADINGS_LIST,\n\n  addStorage() {\n    return {\n      headings: [] as IMarking[],\n    };\n  },\n\n  addProseMirrorPlugins() {\n    const plugin = new Plugin({\n      key: new PluginKey(\"heading-list\"),\n      appendTransaction: (_, __, newState) => {\n        const headings: IMarking[] = [];\n        let h1Sequence = 0;\n        let h2Sequence = 0;\n        let h3Sequence = 0;\n\n        newState.doc.descendants((node) => {\n          if (node.type.name === \"heading\") {\n            const level = node.attrs.level;\n            const text = node.textContent;\n\n            headings.push({\n              type: \"heading\",\n              level: level,\n              text: text,\n              sequence: level === 1 ? ++h1Sequence : level === 2 ? ++h2Sequence : ++h3Sequence,\n            });\n          }\n        });\n\n        this.storage.headings = headings;\n\n        this.editor.emit(\"update\", {\n          editor: this.editor,\n          transaction: newState.tr,\n        });\n\n        return null;\n      },\n    });\n\n    return [plugin];\n  },\n\n  getHeadings() {\n    return this.storage.headings;\n  },\n});\n","import { Extension } from \"@tiptap/core\";\nimport type { NodeType } from \"@tiptap/pm/model\";\nimport type { Transaction } from \"@tiptap/pm/state\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\nimport { canJoin } from \"@tiptap/pm/transform\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n\ndeclare module \"@tiptap/core\" {\n  interface Commands<ReturnType> {\n    customKeymap: {\n      /**\n       * Select text between node boundaries\n       */\n      selectTextWithinNodeBoundaries: () => ReturnType;\n    };\n  }\n}\n\nfunction autoJoin(tr: Transaction, newTr: Transaction, nodeTypes: NodeType[]) {\n  // Find all ranges where we might want to join.\n  const ranges: Array<number> = [];\n  for (let i = 0; i < tr.mapping.maps.length; i++) {\n    const map = tr.mapping.maps[i];\n    for (let j = 0; j < ranges.length; j++) ranges[j] = map.map(ranges[j]);\n    map.forEach((_s, _e, from, to) => ranges.push(from, to));\n  }\n\n  // Figure out which joinable points exist inside those ranges,\n  // by checking all node boundaries in their parent nodes.\n  const joinable: number[] = [];\n  for (let i = 0; i < ranges.length; i += 2) {\n    const from = ranges[i],\n      to = ranges[i + 1];\n    const $from = tr.doc.resolve(from),\n      depth = $from.sharedDepth(to),\n      parent = $from.node(depth);\n    for (let index = $from.indexAfter(depth), pos = $from.after(depth + 1); pos <= to; ++index) {\n      const after = parent.maybeChild(index);\n      if (!after) break;\n      if (index && joinable.indexOf(pos) == -1) {\n        const before = parent.child(index - 1);\n        if (before.type == after.type && nodeTypes.includes(before.type)) joinable.push(pos);\n      }\n      pos += after.nodeSize;\n    }\n  }\n\n  let joined = false;\n\n  // Join the joinable points\n  joinable.sort((a, b) => a - b);\n  for (let i = joinable.length - 1; i >= 0; i--) {\n    if (canJoin(tr.doc, joinable[i])) {\n      newTr.join(joinable[i]);\n      joined = true;\n    }\n  }\n\n  return joined;\n}\n\nexport const CustomKeymap = Extension.create({\n  name: \"customKeymap\",\n\n  addCommands() {\n    return {\n      selectTextWithinNodeBoundaries:\n        () =>\n        ({ editor, commands }) => {\n          const { state } = editor;\n          const { tr } = state;\n          const startNodePos = tr.selection.$from.start();\n          const endNodePos = tr.selection.$to.end();\n          return commands.setTextSelection({\n            from: startNodePos,\n            to: endNodePos,\n          });\n        },\n    };\n  },\n\n  addProseMirrorPlugins() {\n    return [\n      new Plugin({\n        key: new PluginKey(\"ordered-list-merging\"),\n        appendTransaction(transactions, oldState, newState) {\n          // Create a new transaction.\n          const newTr = newState.tr;\n\n          const joinableNodes = [\n            newState.schema.nodes[CORE_EXTENSIONS.ORDERED_LIST],\n            newState.schema.nodes[CORE_EXTENSIONS.TASK_LIST],\n            newState.schema.nodes[CORE_EXTENSIONS.BULLET_LIST],\n          ];\n\n          let joined = false;\n          for (const transaction of transactions) {\n            const anotherJoin = autoJoin(transaction, newTr, joinableNodes);\n            joined = anotherJoin || joined;\n          }\n          if (joined) {\n            return newTr;\n          }\n        },\n      }),\n    ];\n  },\n  addKeyboardShortcuts() {\n    return {\n      \"Mod-a\": ({ editor }) => {\n        const { state } = editor;\n        const { tr } = state;\n        const startSelectionPos = tr.selection.from;\n        const endSelectionPos = tr.selection.to;\n        const startNodePos = tr.selection.$from.start();\n        const endNodePos = tr.selection.$to.end();\n        const isCurrentTextSelectionNotExtendedToNodeBoundaries =\n          startSelectionPos > startNodePos || endSelectionPos < endNodePos;\n\n        if (isCurrentTextSelectionNotExtendedToNodeBoundaries) {\n          // First press: select text within node boundaries\n          editor.chain().selectTextWithinNodeBoundaries().run();\n          return true;\n        } else {\n          editor.commands.selectAll();\n          return true;\n        }\n      },\n    };\n  },\n});\n","import type { Node, Schema } from \"@tiptap/pm/model\";\nimport { Fragment, Slice } from \"@tiptap/pm/model\";\nimport { NodeSelection } from \"@tiptap/pm/state\";\nimport type { EditorView } from \"@tiptap/pm/view\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// extensions\nimport type { SideMenuHandleOptions, SideMenuPluginProps } from \"@/extensions\";\n\nconst verticalEllipsisIcon =\n  '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-ellipsis-vertical\"><circle cx=\"12\" cy=\"12\" r=\"1\"/><circle cx=\"12\" cy=\"5\" r=\"1\"/><circle cx=\"12\" cy=\"19\" r=\"1\"/></svg>';\n\nconst generalSelectors = [\n  \"li\",\n  \"p.editor-paragraph-block:not(:first-child)\",\n  \".code-block\",\n  \"blockquote\",\n  \"h1.editor-heading-block, h2.editor-heading-block, h3.editor-heading-block, h4.editor-heading-block, h5.editor-heading-block, h6.editor-heading-block\",\n  \"[data-type=horizontalRule]\",\n  \"table:not(.table-drag-preview)\",\n  \".issue-embed\",\n  \".image-component\",\n  \".image-upload-component\",\n  \".editor-callout-component\",\n  \".editor-embed-component\",\n  \".editor-drawio-component\",\n].join(\", \");\n\nconst maxScrollSpeed = 20;\nconst acceleration = 0.5;\n\nconst scrollParentCache = new WeakMap();\n\nfunction easeOutQuadAnimation(t: number) {\n  return t * (2 - t);\n}\n\nconst createDragHandleElement = (): HTMLElement => {\n  const dragHandleElement = document.createElement(\"button\");\n  dragHandleElement.type = \"button\";\n  dragHandleElement.id = \"drag-handle\";\n  dragHandleElement.draggable = true;\n  dragHandleElement.dataset.dragHandle = \"\";\n  dragHandleElement.classList.value =\n    \"hidden sm:flex items-center size-5 aspect-square rounded-sm cursor-grab outline-none hover:bg-custom-background-80 active:bg-custom-background-80 active:cursor-grabbing transition-[background-color,_opacity] duration-200 ease-linear\";\n\n  const iconElement1 = document.createElement(\"span\");\n  iconElement1.classList.value = \"pointer-events-none text-custom-text-300\";\n  iconElement1.innerHTML = verticalEllipsisIcon;\n  const iconElement2 = document.createElement(\"span\");\n  iconElement2.classList.value = \"pointer-events-none text-custom-text-300 -ml-2.5\";\n  iconElement2.innerHTML = verticalEllipsisIcon;\n\n  dragHandleElement.appendChild(iconElement1);\n  dragHandleElement.appendChild(iconElement2);\n\n  return dragHandleElement;\n};\n\nconst isScrollable = (node: HTMLElement | SVGElement) => {\n  if (!(node instanceof HTMLElement || node instanceof SVGElement)) {\n    return false;\n  }\n  const style = getComputedStyle(node);\n  return [\"overflow\", \"overflow-y\"].some((propertyName) => {\n    const value = style.getPropertyValue(propertyName);\n    return value === \"auto\" || value === \"scroll\";\n  });\n};\n\nexport const getScrollParent = (node: HTMLElement | SVGElement) => {\n  if (scrollParentCache.has(node)) {\n    return scrollParentCache.get(node);\n  }\n\n  let currentParent = node.parentElement;\n\n  while (currentParent) {\n    if (isScrollable(currentParent)) {\n      scrollParentCache.set(node, currentParent);\n      return currentParent;\n    }\n    currentParent = currentParent.parentElement;\n  }\n\n  const result = document.scrollingElement || document.documentElement;\n  scrollParentCache.set(node, result);\n  return result;\n};\n\nexport const nodeDOMAtCoords = (coords: { x: number; y: number }) => {\n  const elements = document.elementsFromPoint(coords.x, coords.y);\n\n  for (const elem of elements) {\n    // Check for table wrapper first\n    if (elem.matches(\"table:not(.table-drag-preview)\")) {\n      return elem;\n    }\n\n    if (elem.matches(\"p:first-child\") && elem.parentElement?.matches(\".ProseMirror\")) {\n      return elem;\n    }\n\n    // Skip table cells\n    if (elem.closest(\"table\")) {\n      continue;\n    }\n\n    // Skip elements inside .editor-embed-component\n    if (elem.closest(\".editor-embed-component\") && !elem.matches(\".editor-embed-component\")) {\n      continue;\n    }\n\n    // apply general selector\n    if (elem.matches(generalSelectors)) {\n      return elem;\n    }\n  }\n  return null;\n};\n\nconst nodePosAtDOM = (node: Element, view: EditorView, options: SideMenuPluginProps) => {\n  const boundingRect = node.getBoundingClientRect();\n\n  return view.posAtCoords({\n    left: boundingRect.left + 50 + options.dragHandleWidth,\n    top: boundingRect.top + 1,\n  })?.inside;\n};\n\nconst nodePosAtDOMForBlockQuotes = (node: Element, view: EditorView) => {\n  const boundingRect = node.getBoundingClientRect();\n\n  return view.posAtCoords({\n    left: boundingRect.left + 1,\n    top: boundingRect.top + 1,\n  })?.inside;\n};\n\nexport const DragHandlePlugin = (options: SideMenuPluginProps): SideMenuHandleOptions => {\n  let listType = \"\";\n  let isDragging = false;\n  let lastClientY = 0;\n  let scrollAnimationFrame: number | null = null;\n  let isDraggedOutsideWindow: \"top\" | \"bottom\" | boolean = false;\n  let isMouseInsideWhileDragging = false;\n  let currentScrollSpeed = 0;\n  let dragHandleElement: HTMLElement | null = null;\n\n  function scroll() {\n    if (!isDragging) {\n      currentScrollSpeed = 0;\n      return;\n    }\n\n    const scrollableParent = getScrollParent(dragHandleElement!);\n    if (!scrollableParent) return;\n\n    const scrollRegionUp = options.scrollThreshold.up;\n    const scrollRegionDown = window.innerHeight - options.scrollThreshold.down;\n\n    let targetScrollAmount = 0;\n\n    if (isDraggedOutsideWindow === \"top\") {\n      targetScrollAmount = -maxScrollSpeed * 5;\n    } else if (isDraggedOutsideWindow === \"bottom\") {\n      targetScrollAmount = maxScrollSpeed * 5;\n    } else if (lastClientY < scrollRegionUp) {\n      const ratio = easeOutQuadAnimation((scrollRegionUp - lastClientY) / options.scrollThreshold.up);\n      targetScrollAmount = -maxScrollSpeed * ratio;\n    } else if (lastClientY > scrollRegionDown) {\n      const ratio = easeOutQuadAnimation((lastClientY - scrollRegionDown) / options.scrollThreshold.down);\n      targetScrollAmount = maxScrollSpeed * ratio;\n    }\n\n    currentScrollSpeed += (targetScrollAmount - currentScrollSpeed) * acceleration;\n\n    if (Math.abs(currentScrollSpeed) > 0.1) {\n      scrollableParent.scrollBy({ top: currentScrollSpeed });\n    }\n\n    scrollAnimationFrame = requestAnimationFrame(scroll) as unknown as null;\n  }\n\n  const handleClick = (event: MouseEvent, view: EditorView) => {\n    handleNodeSelection(event, view, false, options);\n  };\n\n  const handleDragStart = (event: DragEvent, view: EditorView) => {\n    const { listType: listTypeFromDragStart } = handleNodeSelection(event, view, true, options) ?? {};\n    if (listTypeFromDragStart) {\n      listType = listTypeFromDragStart;\n    }\n    isDragging = true;\n    lastClientY = event.clientY;\n    scroll();\n  };\n\n  const handleDragEnd = <TEvent extends DragEvent | FocusEvent>(event: TEvent, view?: EditorView) => {\n    event.preventDefault();\n    isDragging = false;\n    isMouseInsideWhileDragging = false;\n    if (scrollAnimationFrame) {\n      cancelAnimationFrame(scrollAnimationFrame);\n      scrollAnimationFrame = null;\n    }\n\n    view?.dom.classList.remove(\"dragging\");\n  };\n\n  // drag handle view actions\n  const showDragHandle = () => dragHandleElement?.classList.remove(\"drag-handle-hidden\");\n  const hideDragHandle = () => {\n    if (!dragHandleElement?.classList.contains(\"drag-handle-hidden\"))\n      dragHandleElement?.classList.add(\"drag-handle-hidden\");\n  };\n\n  const view = (view: EditorView, sideMenu: HTMLDivElement | null) => {\n    dragHandleElement = createDragHandleElement();\n    dragHandleElement.addEventListener(\"dragstart\", (e) => handleDragStart(e, view));\n    dragHandleElement.addEventListener(\"dragend\", (e) => handleDragEnd(e, view));\n    dragHandleElement.addEventListener(\"click\", (e) => handleClick(e, view));\n    dragHandleElement.addEventListener(\"contextmenu\", (e) => handleClick(e, view));\n\n    const dragOverHandler = (e: DragEvent) => {\n      e.preventDefault();\n      if (isDragging) {\n        lastClientY = e.clientY;\n      }\n    };\n\n    const mouseMoveHandler = (e: MouseEvent) => {\n      if (isMouseInsideWhileDragging) {\n        handleDragEnd(e, view);\n      }\n    };\n\n    const dragLeaveHandler = (e: DragEvent) => {\n      if (e.clientY <= 0 || e.clientX <= 0 || e.clientX >= window.innerWidth || e.clientY >= window.innerHeight) {\n        isMouseInsideWhileDragging = true;\n\n        const windowMiddleY = window.innerHeight / 2;\n\n        if (lastClientY < windowMiddleY) {\n          isDraggedOutsideWindow = \"top\";\n        } else {\n          isDraggedOutsideWindow = \"bottom\";\n        }\n      }\n    };\n\n    const dragEnterHandler = () => {\n      isDraggedOutsideWindow = false;\n    };\n\n    window.addEventListener(\"dragleave\", dragLeaveHandler);\n    window.addEventListener(\"dragenter\", dragEnterHandler);\n\n    document.addEventListener(\"dragover\", dragOverHandler);\n    document.addEventListener(\"mousemove\", mouseMoveHandler);\n\n    hideDragHandle();\n\n    sideMenu?.appendChild(dragHandleElement);\n\n    return {\n      destroy: () => {\n        dragHandleElement?.remove?.();\n        dragHandleElement = null;\n        isDragging = false;\n        if (scrollAnimationFrame) {\n          cancelAnimationFrame(scrollAnimationFrame);\n          scrollAnimationFrame = null;\n        }\n        window.removeEventListener(\"dragleave\", dragLeaveHandler);\n        window.removeEventListener(\"dragenter\", dragEnterHandler);\n        document.removeEventListener(\"dragover\", dragOverHandler);\n        document.removeEventListener(\"mousemove\", mouseMoveHandler);\n      },\n    };\n  };\n  const domEvents = {\n    mousemove: () => showDragHandle(),\n    dragenter: (view: EditorView) => {\n      view.dom.classList.add(\"dragging\");\n      hideDragHandle();\n    },\n    drop: (view: EditorView, event: DragEvent) => {\n      view.dom.classList.remove(\"dragging\");\n      hideDragHandle();\n      let droppedNode: Node | null = null;\n      const dropPos = view.posAtCoords({\n        left: event.clientX,\n        top: event.clientY,\n      });\n\n      if (!dropPos) return;\n\n      if (view.state.selection instanceof NodeSelection) {\n        droppedNode = view.state.selection.node;\n      }\n\n      if (!droppedNode) return;\n\n      const resolvedPos = view.state.doc.resolve(dropPos.pos);\n      let isDroppedInsideList = false;\n      let dropDepth = 0;\n\n      // Traverse up the document tree to find if we're inside a list item\n      for (let i = resolvedPos.depth; i > 0; i--) {\n        if (resolvedPos.node(i).type.name === CORE_EXTENSIONS.LIST_ITEM) {\n          isDroppedInsideList = true;\n          dropDepth = i;\n          break;\n        }\n      }\n\n      // Handle nested list items and task items\n      if (droppedNode.type.name === CORE_EXTENSIONS.LIST_ITEM) {\n        let slice = view.state.selection.content();\n        let newFragment = slice.content;\n\n        // If dropping outside a list or at a different depth, adjust the structure\n        if (!isDroppedInsideList || dropDepth !== resolvedPos.depth) {\n          // Flatten the structure if needed\n          newFragment = flattenListStructure(newFragment, view.state.schema);\n        }\n\n        // Wrap in appropriate list type if dropped outside a list\n        if (!isDroppedInsideList) {\n          const listNodeType =\n            listType === \"OL\" ? view.state.schema.nodes.orderedList : view.state.schema.nodes.bulletList;\n          newFragment = Fragment.from(listNodeType.create(null, newFragment));\n        }\n\n        slice = new Slice(newFragment, slice.openStart, slice.openEnd);\n        view.dragging = { slice, move: event.ctrlKey };\n      }\n    },\n    dragend: (view: EditorView) => {\n      view.dom.classList.remove(\"dragging\");\n    },\n  };\n\n  return {\n    view,\n    domEvents,\n  };\n};\n\n// Helper function to flatten nested list structure\nfunction flattenListStructure(fragment: Fragment, schema: Schema): Fragment {\n  const result: Node[] = [];\n  fragment.forEach((node) => {\n    if (node.type === schema.nodes.listItem || node.type === schema.nodes.taskItem) {\n      result.push(node);\n      if (\n        node.content.firstChild &&\n        (node.content.firstChild.type === schema.nodes.bulletList ||\n          node.content.firstChild.type === schema.nodes.orderedList)\n      ) {\n        const subList = node.content.firstChild;\n        const flattened = flattenListStructure(subList.content, schema);\n        flattened.forEach((subNode) => result.push(subNode));\n      }\n    }\n  });\n  return Fragment.from(result);\n}\n\nconst handleNodeSelection = (\n  event: MouseEvent | DragEvent,\n  view: EditorView,\n  isDragStart: boolean,\n  options: SideMenuPluginProps\n) => {\n  let listType = \"\";\n  view.focus();\n\n  const node = nodeDOMAtCoords({\n    x: event.clientX + 50 + options.dragHandleWidth,\n    y: event.clientY,\n  });\n\n  if (!(node instanceof Element)) return;\n\n  let draggedNodePos = nodePosAtDOM(node, view, options);\n  if (draggedNodePos == null || draggedNodePos < 0) return;\n\n  if (node.matches(\"table\")) {\n    draggedNodePos = draggedNodePos - 2;\n  } else if (node.matches(\"blockquote\")) {\n    draggedNodePos = nodePosAtDOMForBlockQuotes(node, view);\n    if (draggedNodePos === null || draggedNodePos === undefined) return;\n  } else {\n    // Resolve the position to get the parent node\n    const $pos = view.state.doc.resolve(draggedNodePos);\n\n    // If it's a nested list item or task item, move up to the item level\n    if (\n      [CORE_EXTENSIONS.LIST_ITEM, CORE_EXTENSIONS.TASK_ITEM].includes($pos.parent.type.name as CORE_EXTENSIONS) &&\n      $pos.depth > 1\n    ) {\n      draggedNodePos = $pos.before($pos.depth);\n    }\n  }\n\n  const docSize = view.state.doc.content.size;\n  draggedNodePos = Math.max(0, Math.min(draggedNodePos, docSize));\n\n  // Use NodeSelection to select the node at the calculated position\n  const nodeSelection = NodeSelection.create(view.state.doc, draggedNodePos);\n\n  // Dispatch the transaction to update the selection\n  view.dispatch(view.state.tr.setSelection(nodeSelection));\n\n  if (isDragStart) {\n    // Additional logic for drag start\n    if (event instanceof DragEvent && !event.dataTransfer) return;\n\n    if (\n      [CORE_EXTENSIONS.LIST_ITEM, CORE_EXTENSIONS.TASK_ITEM].includes(nodeSelection.node.type.name as CORE_EXTENSIONS)\n    ) {\n      listType = node.closest(\"ol, ul\")?.tagName || \"\";\n    }\n\n    const slice = view.state.selection.content();\n    const { dom, text } = view.serializeForClipboard(slice);\n\n    if (event instanceof DragEvent && event.dataTransfer) {\n      event.dataTransfer.clearData();\n      event.dataTransfer.setData(\"text/html\", dom.innerHTML);\n      event.dataTransfer.setData(\"text/plain\", text);\n      event.dataTransfer.effectAllowed = \"copyMove\";\n      event.dataTransfer.setDragImage(node, 0, 0);\n    }\n\n    view.dragging = { slice, move: event.ctrlKey };\n  }\n\n  return { listType };\n};\n","import { NodeSelection } from \"@tiptap/pm/state\";\nimport type { EditorView } from \"@tiptap/pm/view\";\n// extensions\nimport type { SideMenuHandleOptions, SideMenuPluginProps } from \"@/extensions\";\n// plugins\nimport { nodeDOMAtCoords } from \"@/plugins/drag-handle\";\n\nconst sparklesIcon =\n  '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-sparkles\"><path d=\"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z\"/><path d=\"M20 3v4\"/><path d=\"M22 5h-4\"/><path d=\"M4 17v2\"/><path d=\"M5 18H3\"/></svg>';\n\nconst nodePosAtDOM = (node: Element, view: EditorView, options: SideMenuPluginProps) => {\n  const boundingRect = node.getBoundingClientRect();\n\n  return view.posAtCoords({\n    left: boundingRect.left + 50 + options.dragHandleWidth,\n    top: boundingRect.top + 1,\n  })?.inside;\n};\n\nconst nodePosAtDOMForBlockQuotes = (node: Element, view: EditorView) => {\n  const boundingRect = node.getBoundingClientRect();\n\n  return view.posAtCoords({\n    left: boundingRect.left + 1,\n    top: boundingRect.top + 1,\n  })?.inside;\n};\n\nconst calcNodePos = (pos: number, view: EditorView, node: Element) => {\n  const maxPos = view.state.doc.content.size;\n  const safePos = Math.max(0, Math.min(pos, maxPos));\n  const $pos = view.state.doc.resolve(safePos);\n\n  if ($pos.depth > 1) {\n    if (node.matches(\"ul li, ol li\")) {\n      // only for nested lists\n      const newPos = $pos.before($pos.depth);\n      return Math.max(0, Math.min(newPos, maxPos));\n    }\n  }\n\n  return safePos;\n};\n\nexport const AIHandlePlugin = (options: SideMenuPluginProps): SideMenuHandleOptions => {\n  let aiHandleElement: HTMLButtonElement | null = null;\n\n  const handleClick = (event: MouseEvent, view: EditorView) => {\n    view.focus();\n\n    const node = nodeDOMAtCoords({\n      x: event.clientX + 50 + options.dragHandleWidth,\n      y: event.clientY,\n    });\n\n    if (!(node instanceof Element)) return;\n\n    if (node.matches(\"blockquote\")) {\n      let nodePosForBlockQuotes = nodePosAtDOMForBlockQuotes(node, view);\n      if (nodePosForBlockQuotes === null || nodePosForBlockQuotes === undefined) return;\n\n      const docSize = view.state.doc.content.size;\n      nodePosForBlockQuotes = Math.max(0, Math.min(nodePosForBlockQuotes, docSize));\n\n      if (nodePosForBlockQuotes >= 0 && nodePosForBlockQuotes <= docSize) {\n        // TODO FIX ERROR\n        const nodeSelection = NodeSelection.create(view.state.doc, nodePosForBlockQuotes);\n        view.dispatch(view.state.tr.setSelection(nodeSelection));\n      }\n      return;\n    }\n\n    let nodePos = nodePosAtDOM(node, view, options);\n\n    if (nodePos === null || nodePos === undefined) return;\n\n    // Adjust the nodePos to point to the start of the node, ensuring NodeSelection can be applied\n    nodePos = calcNodePos(nodePos, view, node);\n\n    // TODO FIX ERROR\n    // Use NodeSelection to select the node at the calculated position\n    const nodeSelection = NodeSelection.create(view.state.doc, nodePos);\n\n    // Dispatch the transaction to update the selection\n    view.dispatch(view.state.tr.setSelection(nodeSelection));\n  };\n\n  const view = (view: EditorView, sideMenu: HTMLDivElement | null) => {\n    // create handle element\n    const className =\n      \"grid place-items-center font-medium size-5 aspect-square text-xs text-custom-text-300 hover:bg-custom-background-80 rounded-sm opacity-100 !outline-none z-[5] transition-[background-color,_opacity] duration-200 ease-linear\";\n    aiHandleElement = document.createElement(\"button\");\n    aiHandleElement.type = \"button\";\n    aiHandleElement.id = \"ai-handle\";\n    aiHandleElement.classList.value = className;\n    const iconElement = document.createElement(\"span\");\n    iconElement.classList.value = \"pointer-events-none\";\n    iconElement.innerHTML = sparklesIcon;\n    aiHandleElement.appendChild(iconElement);\n    // bind events\n    aiHandleElement.addEventListener(\"click\", (e) => handleClick(e, view));\n\n    sideMenu?.appendChild(aiHandleElement);\n\n    return {\n      // destroy the handle element on un-initialize\n      destroy: () => {\n        aiHandleElement?.remove();\n        aiHandleElement = null;\n      },\n    };\n  };\n\n  const domEvents = {};\n\n  return {\n    view,\n    domEvents,\n  };\n};\n","import { Extension } from \"@tiptap/core\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\nimport type { EditorView } from \"@tiptap/pm/view\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// plugins\nimport { AIHandlePlugin } from \"@/plugins/ai-handle\";\nimport { DragHandlePlugin, nodeDOMAtCoords } from \"@/plugins/drag-handle\";\n\ntype Props = {\n  aiEnabled: boolean;\n  dragDropEnabled: boolean;\n};\n\nexport type SideMenuPluginProps = {\n  dragHandleWidth: number;\n  handlesConfig: {\n    ai: boolean;\n    dragDrop: boolean;\n  };\n  scrollThreshold: {\n    up: number;\n    down: number;\n  };\n};\n\nexport type SideMenuHandleOptions = {\n  view: (view: EditorView, sideMenu: HTMLDivElement | null) => void;\n  domEvents?: {\n    [key: string]: (...args: any) => void;\n  };\n};\n\nexport const SideMenuExtension = (props: Props) => {\n  const { aiEnabled, dragDropEnabled } = props;\n\n  return Extension.create({\n    name: CORE_EXTENSIONS.SIDE_MENU,\n    addProseMirrorPlugins() {\n      return [\n        SideMenu({\n          dragHandleWidth: 24,\n          handlesConfig: {\n            ai: aiEnabled,\n            dragDrop: dragDropEnabled,\n          },\n          scrollThreshold: { up: 200, down: 150 },\n        }),\n      ];\n    },\n  });\n};\n\nconst absoluteRect = (node: Element) => {\n  const data = node.getBoundingClientRect();\n\n  return {\n    top: data.top,\n    left: data.left,\n    width: data.width,\n  };\n};\n\nconst SideMenu = (options: SideMenuPluginProps) => {\n  const { handlesConfig } = options;\n  const editorSideMenu: HTMLDivElement | null = document.createElement(\"div\");\n  editorSideMenu.id = \"editor-side-menu\";\n  // side menu view actions\n  const hideSideMenu = () => {\n    if (!editorSideMenu?.classList.contains(\"side-menu-hidden\")) editorSideMenu?.classList.add(\"side-menu-hidden\");\n  };\n  const showSideMenu = () => editorSideMenu?.classList.remove(\"side-menu-hidden\");\n  // side menu elements\n  const { view: dragHandleView, domEvents: dragHandleDOMEvents } = DragHandlePlugin(options);\n  const { view: aiHandleView, domEvents: aiHandleDOMEvents } = AIHandlePlugin(options);\n\n  return new Plugin({\n    key: new PluginKey(\"sideMenu\"),\n    view: (view) => {\n      hideSideMenu();\n      view?.dom.parentElement?.appendChild(editorSideMenu);\n      // side menu elements' initialization\n      if (handlesConfig.ai && !editorSideMenu.querySelector(\"#ai-handle\")) {\n        aiHandleView(view, editorSideMenu);\n      }\n\n      if (handlesConfig.dragDrop && !editorSideMenu.querySelector(\"#drag-handle\")) {\n        dragHandleView(view, editorSideMenu);\n      }\n\n      return {\n        destroy: () => hideSideMenu(),\n      };\n    },\n    props: {\n      handleDOMEvents: {\n        mousemove: (view, event) => {\n          if (!view.editable) return;\n\n          const node = nodeDOMAtCoords({\n            x: event.clientX + 50 + options.dragHandleWidth,\n            y: event.clientY,\n          });\n\n          if (!(node instanceof Element) || node.matches(\"ul, ol\")) {\n            hideSideMenu();\n            return;\n          }\n\n          const compStyle = window.getComputedStyle(node);\n          const lineHeight = parseInt(compStyle.lineHeight, 10);\n          const paddingTop = parseInt(compStyle.paddingTop, 10);\n\n          const rect = absoluteRect(node);\n\n          rect.top += (lineHeight - 20) / 2;\n          rect.top += paddingTop;\n\n          if (handlesConfig.ai) {\n            rect.left -= 20;\n          }\n\n          if (node.parentElement?.parentElement?.matches(\"td\") || node.parentElement?.parentElement?.matches(\"th\")) {\n            if (node.matches(\"ul:not([data-type=taskList]) li, ol li\")) {\n              rect.left -= 5;\n            }\n          } else {\n            // Li markers\n            if (node.matches(\"ul:not([data-type=taskList]) li, ol li\")) {\n              rect.left -= 18;\n            }\n          }\n\n          if (node.matches(\"table\")) {\n            rect.top += 8;\n            rect.left -= 8;\n          }\n\n          rect.width = options.dragHandleWidth;\n\n          if (!editorSideMenu) return;\n\n          editorSideMenu.style.left = `${rect.left - rect.width}px`;\n          editorSideMenu.style.top = `${rect.top}px`;\n          showSideMenu();\n          if (handlesConfig.dragDrop) {\n            dragHandleDOMEvents?.mousemove();\n          }\n          if (handlesConfig.ai) {\n            aiHandleDOMEvents?.mousemove?.();\n          }\n        },\n        // keydown: () => hideSideMenu(),\n        mousewheel: () => hideSideMenu(),\n        dragenter: (view) => {\n          if (handlesConfig.dragDrop) {\n            dragHandleDOMEvents?.dragenter?.(view);\n          }\n        },\n        drop: (view, event) => {\n          if (handlesConfig.dragDrop) {\n            dragHandleDOMEvents?.drop?.(view, event);\n          }\n        },\n        dragend: (view) => {\n          if (handlesConfig.dragDrop) {\n            dragHandleDOMEvents?.dragend?.(view);\n          }\n        },\n      },\n    },\n  });\n};\n","import type { Editor } from \"@tiptap/core\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// types\nimport type { TFileHandler } from \"@/types\";\n\n/**\n * Finds all public image nodes in the document and restores them using the provided restore function\n *\n * Never remove this onCreate hook, it's a hack to restore old public\n * images, since they don't give error if they've been deleted as they are\n * rendered directly from image source instead of going through the\n * apiserver\n */\nexport const restorePublicImages = (editor: Editor, restoreImageFn: TFileHandler[\"restore\"]) => {\n  const imageSources = new Set<string>();\n  editor.state.doc.descendants((node) => {\n    if ([CORE_EXTENSIONS.IMAGE, CORE_EXTENSIONS.CUSTOM_IMAGE].includes(node.type.name as CORE_EXTENSIONS)) {\n      if (!node.attrs.src?.startsWith(\"http\")) return;\n\n      imageSources.add(node.attrs.src);\n    }\n  });\n\n  imageSources.forEach(async (src) => {\n    try {\n      await restoreImageFn(src);\n    } catch (error) {\n      console.error(\"Error restoring image: \", error);\n    }\n  });\n};\n","// plane imports\nimport type { ADDITIONAL_EXTENSIONS } from \"@plane/utils\";\nimport { CORE_EXTENSIONS } from \"@plane/utils\";\n// plane editor imports\nimport type { ExtensionFileSetStorageKey } from \"@/plane-editor/types/storage\";\n\nexport type NodeFileMapType = Partial<\n  Record<\n    CORE_EXTENSIONS | ADDITIONAL_EXTENSIONS,\n    {\n      fileSetName: ExtensionFileSetStorageKey;\n    }\n  >\n>;\n\nexport const NODE_FILE_MAP: NodeFileMapType = {\n  [CORE_EXTENSIONS.IMAGE]: {\n    fileSetName: \"deletedImageSet\",\n  },\n  [CORE_EXTENSIONS.CUSTOM_IMAGE]: {\n    fileSetName: \"deletedImageSet\",\n  },\n};\n","import type { Editor } from \"@tiptap/core\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\nimport type { EditorState, Transaction } from \"@tiptap/pm/state\";\n// constants\nimport { CORE_EDITOR_META } from \"@/constants/meta\";\n// plane editor imports\nimport { NODE_FILE_MAP } from \"@/plane-editor/constants/utility\";\n// types\nimport type { TFileHandler } from \"@/types\";\n// local imports\nimport type { NodeFileMapType } from \"../../../ce/constants/utility\";\nimport type { TFileNode } from \"./types\";\n\nconst DELETE_PLUGIN_KEY = new PluginKey(\"delete-utility\");\n\nexport const TrackFileDeletionPlugin = (editor: Editor, deleteHandler: TFileHandler[\"delete\"]): Plugin =>\n  new Plugin({\n    key: DELETE_PLUGIN_KEY,\n    appendTransaction: (transactions: readonly Transaction[], oldState: EditorState, newState: EditorState) => {\n      const newFileSources: {\n        [nodeType: string]: Set<string> | undefined;\n      } = {};\n      if (!transactions.some((tr) => tr.docChanged)) return null;\n      if (transactions.some((tr) => tr.getMeta(CORE_EDITOR_META.SKIP_FILE_DELETION))) return null;\n\n      newState.doc.descendants((node) => {\n        const nodeType = node.type.name as keyof NodeFileMapType;\n        const nodeFileSetDetails = NODE_FILE_MAP[nodeType];\n        if (nodeFileSetDetails) {\n          if (newFileSources[nodeType]) {\n            newFileSources[nodeType].add(node.attrs.src);\n          } else {\n            newFileSources[nodeType] = new Set([node.attrs.src]);\n          }\n        }\n      });\n\n      const removedFiles: TFileNode[] = [];\n\n      // iterate through all the nodes in the old state\n      oldState.doc.descendants((node) => {\n        const nodeType = node.type.name as keyof NodeFileMapType;\n        const isAValidNode = NODE_FILE_MAP[nodeType];\n        // if the node doesn't match, then return as no point in checking\n        if (!isAValidNode) return;\n        // Check if the node has been deleted or replaced\n        if (!newFileSources[nodeType]?.has(node.attrs.src)) {\n          removedFiles.push(node as TFileNode);\n        }\n      });\n\n      removedFiles.forEach(async (node) => {\n        const nodeType = node.type.name as keyof NodeFileMapType;\n        const src = node.attrs.src;\n        const nodeFileSetDetails = NODE_FILE_MAP[nodeType];\n        if (!nodeFileSetDetails || !src) return;\n        try {\n          editor.storage[nodeType]?.[nodeFileSetDetails.fileSetName]?.set(src, true);\n          // update assets list storage value\n          editor.commands.updateAssetsList?.({\n            idToRemove: node.attrs.id,\n          });\n          await deleteHandler(src);\n        } catch (error) {\n          console.error(\"Error deleting file via delete utility plugin:\", error);\n        }\n      });\n\n      return null;\n    },\n  });\n","// helpers\nimport type { TAssetMetaDataRecord } from \"@/helpers/assets\";\n// local imports\nimport type { ADDITIONAL_EXTENSIONS } from \"./extensions\";\n\nexport const ADDITIONAL_ASSETS_META_DATA_RECORD: Partial<Record<ADDITIONAL_EXTENSIONS, TAssetMetaDataRecord>> = {};\n","import type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\n// plane imports\nimport type { ADDITIONAL_EXTENSIONS } from \"@plane/utils\";\nimport { CORE_EXTENSIONS } from \"@plane/utils\";\n// extensions\nimport { getImageBlockId } from \"@/extensions/custom-image/utils\";\n// plane editor imports\nimport { ADDITIONAL_ASSETS_META_DATA_RECORD } from \"@/plane-editor/constants/assets\";\n// types\nimport type { TEditorAsset } from \"@/types\";\n\nexport type TAssetMetaDataRecord = (attrs: ProseMirrorNode[\"attrs\"]) => TEditorAsset | undefined;\n\nexport const CORE_ASSETS_META_DATA_RECORD: Partial<\n  Record<CORE_EXTENSIONS | ADDITIONAL_EXTENSIONS, TAssetMetaDataRecord>\n> = {\n  [CORE_EXTENSIONS.IMAGE]: (attrs) => {\n    if (!attrs?.src) return;\n    return {\n      href: `#${getImageBlockId(attrs?.id ?? \"\")}`,\n      id: attrs?.id,\n      name: `image-${attrs?.id}`,\n      size: 0,\n      src: attrs?.src,\n      type: CORE_EXTENSIONS.IMAGE,\n    };\n  },\n  [CORE_EXTENSIONS.CUSTOM_IMAGE]: (attrs) => {\n    if (!attrs?.src) return;\n    return {\n      href: `#${getImageBlockId(attrs?.id ?? \"\")}`,\n      id: attrs?.id,\n      name: `image-${attrs?.id}`,\n      size: 0,\n      src: attrs?.src,\n      type: CORE_EXTENSIONS.CUSTOM_IMAGE,\n    };\n  },\n  ...ADDITIONAL_ASSETS_META_DATA_RECORD,\n};\n","import type { Editor } from \"@tiptap/core\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\nimport type { EditorState, Transaction } from \"@tiptap/pm/state\";\n// plane imports\nimport { CORE_EXTENSIONS } from \"@plane/utils\";\n// helpers\nimport { CORE_ASSETS_META_DATA_RECORD } from \"@/helpers/assets\";\n// plane editor imports\nimport { NODE_FILE_MAP } from \"@/plane-editor/constants/utility\";\n// types\nimport type { TFileHandler } from \"@/types\";\n// local imports\nimport type { NodeFileMapType } from \"../../../ce/constants/utility\";\nimport type { TFileNode } from \"./types\";\n\nconst RESTORE_PLUGIN_KEY = new PluginKey(\"restore-utility\");\n\nexport const TrackFileRestorationPlugin = (editor: Editor, restoreHandler: TFileHandler[\"restore\"]): Plugin =>\n  new Plugin({\n    key: RESTORE_PLUGIN_KEY,\n    appendTransaction: (transactions: readonly Transaction[], oldState: EditorState, newState: EditorState) => {\n      if (!transactions.some((tr) => tr.docChanged)) return null;\n\n      const oldFileSources: {\n        [key: string]: Set<string> | undefined;\n      } = {};\n      oldState.doc.descendants((node) => {\n        const nodeType = node.type.name as keyof NodeFileMapType;\n        const nodeFileSetDetails = NODE_FILE_MAP[nodeType];\n        if (nodeFileSetDetails) {\n          if (oldFileSources[nodeType]) {\n            oldFileSources[nodeType].add(node.attrs.src);\n          } else {\n            oldFileSources[nodeType] = new Set([node.attrs.src]);\n          }\n        }\n      });\n\n      transactions.forEach(() => {\n        const addedFiles: TFileNode[] = [];\n\n        newState.doc.descendants((node, pos) => {\n          const nodeType = node.type.name as keyof NodeFileMapType;\n          const isAValidNode = NODE_FILE_MAP[nodeType];\n          // if the node doesn't match, then return as no point in checking\n          if (!isAValidNode) return;\n          if (pos < 0 || pos > newState.doc.content.size) return;\n          if (oldFileSources[nodeType]?.has(node.attrs.src)) return;\n          // update assets list storage value\n          const assetMetaData = CORE_ASSETS_META_DATA_RECORD[nodeType]?.(node.attrs);\n          if (assetMetaData) {\n            editor.commands.updateAssetsList?.({\n              asset: assetMetaData,\n            });\n          }\n          // if the src is just a id (private bucket), then we don't need to handle restore from here but\n          // only while it fails to load\n          if (nodeType === CORE_EXTENSIONS.CUSTOM_IMAGE && !node.attrs.src?.startsWith(\"http\")) return;\n          addedFiles.push(node as TFileNode);\n        });\n\n        addedFiles.forEach(async (node) => {\n          const nodeType = node.type.name as keyof NodeFileMapType;\n          const src = node.attrs.src;\n          const nodeFileSetDetails = NODE_FILE_MAP[nodeType];\n          if (!nodeFileSetDetails) return;\n          const extensionFileSetStorage = editor.storage[nodeType]?.[nodeFileSetDetails.fileSetName];\n          const wasDeleted = extensionFileSetStorage?.get(src);\n          if (!nodeFileSetDetails || !src) return;\n          if (wasDeleted === undefined) {\n            extensionFileSetStorage?.set(src, false);\n          } else if (wasDeleted === true) {\n            try {\n              await restoreHandler(src);\n              extensionFileSetStorage?.set(src, false);\n            } catch (error) {\n              console.error(\"Error restoring file via restore utility plugin:\", error);\n            }\n          }\n        });\n      });\n      return null;\n    },\n  });\n","import type { Editor } from \"@tiptap/core\";\nimport type { Plugin } from \"@tiptap/pm/state\";\n// types\nimport type { TFileHandler } from \"@/types\";\n// local imports\nimport { TrackFileDeletionPlugin } from \"./delete\";\nimport { TrackFileRestorationPlugin } from \"./restore\";\n\ntype TArgs = {\n  editor: Editor;\n  fileHandler: TFileHandler;\n  isEditable: boolean;\n};\n\nexport const FilePlugins = (args: TArgs): Plugin[] => {\n  const { editor, fileHandler, isEditable } = args;\n\n  return [\n    ...(isEditable && \"delete\" in fileHandler ? [TrackFileDeletionPlugin(editor, fileHandler.delete)] : []),\n    TrackFileRestorationPlugin(editor, fileHandler.restore),\n  ];\n};\n","import type { Editor } from \"@tiptap/core\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\n// plane imports\nimport { convertHTMLToMarkdown } from \"@plane/utils\";\nimport type { TCustomComponentsMetaData } from \"@plane/utils\";\n\ntype TArgs = {\n  editor: Editor;\n  getEditorMetaData: (htmlContent: string) => TCustomComponentsMetaData;\n};\n\nexport const MarkdownClipboardPlugin = (args: TArgs): Plugin => {\n  const { editor, getEditorMetaData } = args;\n\n  return new Plugin({\n    key: new PluginKey(\"markdownClipboard\"),\n    props: {\n      handleDOMEvents: {\n        copy: (view, event) => {\n          try {\n            event.preventDefault();\n            event.clipboardData?.clearData();\n            // editor meta data\n            const editorHTML = editor.getHTML();\n            const metaData = getEditorMetaData(editorHTML);\n            // meta data from selection\n            const clipboardHTML = view.serializeForClipboard(view.state.selection.content()).dom.innerHTML;\n            // convert to markdown\n            const markdown = convertHTMLToMarkdown({\n              description_html: clipboardHTML,\n              metaData,\n            });\n            event.clipboardData?.setData(\"text/plain\", markdown);\n            event.clipboardData?.setData(\"text/html\", clipboardHTML);\n            event.clipboardData?.setData(\"text/plane-editor-html\", clipboardHTML);\n            return true;\n          } catch (error) {\n            console.error(\"Failed to copy markdown content to clipboard:\", error);\n            return false;\n          }\n        },\n      },\n    },\n  });\n};\n","import { Extension } from \"@tiptap/core\";\nimport codemark from \"prosemirror-codemark\";\n// helpers\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\nimport { restorePublicImages } from \"@/helpers/image-helpers\";\n// plugins\nimport type { TAdditionalActiveDropbarExtensions } from \"@/plane-editor/types/utils\";\nimport { DropHandlerPlugin } from \"@/plugins/drop\";\nimport { FilePlugins } from \"@/plugins/file/root\";\nimport { MarkdownClipboardPlugin } from \"@/plugins/markdown-clipboard\";\nimport type { IEditorProps, TEditorAsset, TFileHandler } from \"@/types\";\n\ntype TActiveDropbarExtensions =\n  | CORE_EXTENSIONS.MENTION\n  | CORE_EXTENSIONS.EMOJI\n  | CORE_EXTENSIONS.SLASH_COMMANDS\n  | CORE_EXTENSIONS.TABLE\n  | \"bubble-menu\"\n  | CORE_EXTENSIONS.SIDE_MENU\n  | TAdditionalActiveDropbarExtensions;\n\ndeclare module \"@tiptap/core\" {\n  interface Commands {\n    [CORE_EXTENSIONS.UTILITY]: {\n      updateAssetsUploadStatus: (updatedStatus: TFileHandler[\"assetsUploadStatus\"]) => () => void;\n      updateAssetsList: (\n        args:\n          | {\n              asset: TEditorAsset;\n            }\n          | {\n              idToRemove: string;\n            }\n      ) => () => void;\n      addActiveDropbarExtension: (extension: TActiveDropbarExtensions) => () => void;\n      removeActiveDropbarExtension: (extension: TActiveDropbarExtensions) => () => void;\n    };\n  }\n  interface Storage {\n    [CORE_EXTENSIONS.UTILITY]: UtilityExtensionStorage;\n  }\n}\n\nexport type UtilityExtensionStorage = {\n  assetsList: TEditorAsset[];\n  assetsUploadStatus: TFileHandler[\"assetsUploadStatus\"];\n  uploadInProgress: boolean;\n  activeDropbarExtensions: TActiveDropbarExtensions[];\n  isTouchDevice: boolean;\n};\n\ntype Props = Pick<IEditorProps, \"disabledExtensions\" | \"flaggedExtensions\" | \"getEditorMetaData\"> & {\n  fileHandler: TFileHandler;\n  isEditable: boolean;\n  isTouchDevice: boolean;\n};\n\nexport const UtilityExtension = (props: Props) => {\n  const { disabledExtensions, flaggedExtensions, fileHandler, getEditorMetaData, isEditable, isTouchDevice } = props;\n  const { restore } = fileHandler;\n\n  return Extension.create<Record<string, unknown>, UtilityExtensionStorage>({\n    name: CORE_EXTENSIONS.UTILITY,\n    priority: 1000,\n\n    addProseMirrorPlugins() {\n      return [\n        ...FilePlugins({\n          editor: this.editor,\n          isEditable,\n          fileHandler,\n        }),\n        ...codemark({ markType: this.editor.schema.marks.code }),\n        MarkdownClipboardPlugin({\n          editor: this.editor,\n          getEditorMetaData,\n        }),\n        DropHandlerPlugin({\n          disabledExtensions,\n          flaggedExtensions,\n          editor: this.editor,\n        }),\n      ];\n    },\n\n    onCreate() {\n      restorePublicImages(this.editor, restore);\n    },\n\n    addStorage() {\n      return {\n        assetsList: [],\n        assetsUploadStatus: isEditable && \"assetsUploadStatus\" in fileHandler ? fileHandler.assetsUploadStatus : {},\n        uploadInProgress: false,\n        activeDropbarExtensions: [],\n        isTouchDevice,\n      };\n    },\n\n    addCommands() {\n      return {\n        updateAssetsUploadStatus: (updatedStatus) => () => {\n          this.storage.assetsUploadStatus = updatedStatus;\n        },\n        updateAssetsList: (args) => () => {\n          const uniqueAssets = new Set(this.storage.assetsList);\n          if (\"asset\" in args) {\n            const alreadyExists = this.storage.assetsList.find((asset) => asset.id === args.asset.id);\n            if (!alreadyExists) {\n              uniqueAssets.add(args.asset);\n            }\n          } else if (\"idToRemove\" in args) {\n            const asset = this.storage.assetsList.find((asset) => asset.id === args.idToRemove);\n            if (asset) {\n              uniqueAssets.delete(asset);\n            }\n          }\n          this.storage.assetsList = Array.from(uniqueAssets);\n        },\n        addActiveDropbarExtension: (extension) => () => {\n          const index = this.storage.activeDropbarExtensions.indexOf(extension);\n          if (index === -1) {\n            this.storage.activeDropbarExtensions.push(extension);\n          }\n        },\n        removeActiveDropbarExtension: (extension) => () => {\n          const index = this.storage.activeDropbarExtensions.indexOf(extension);\n          if (index !== -1) {\n            this.storage.activeDropbarExtensions.splice(index, 1);\n          }\n        },\n      };\n    },\n  });\n};\n","import { FloatingOverlay, FloatingPortal } from \"@floating-ui/react\";\nimport type { UseInteractionsReturn, UseFloatingReturn } from \"@floating-ui/react\";\n\ntype Props = {\n  children: React.ReactNode;\n  classNames?: {\n    buttonContainer?: string;\n    button?: string;\n  };\n  getFloatingProps: UseInteractionsReturn[\"getFloatingProps\"];\n  getReferenceProps: UseInteractionsReturn[\"getReferenceProps\"];\n  menuButton: React.ReactNode;\n  onClick?: (e: React.MouseEvent<HTMLButtonElement>) => void;\n  options: UseFloatingReturn;\n};\n\nexport function FloatingMenuRoot(props: Props) {\n  const { children, classNames, getFloatingProps, getReferenceProps, menuButton, onClick, options } = props;\n  // derived values\n  const { refs, floatingStyles, context } = options;\n\n  return (\n    <>\n      <div className={classNames?.buttonContainer}>\n        <button\n          ref={refs.setReference}\n          {...getReferenceProps()}\n          type=\"button\"\n          className={classNames?.button}\n          onClick={(e) => {\n            context.onOpenChange(!context.open);\n            onClick?.(e);\n          }}\n        >\n          {menuButton}\n        </button>\n      </div>\n      {context.open && (\n        <FloatingPortal>\n          {/* Backdrop */}\n          <FloatingOverlay\n            style={{\n              zIndex: 99,\n            }}\n            lockScroll\n          />\n          <div\n            ref={refs.setFloating}\n            {...getFloatingProps()}\n            style={{\n              ...floatingStyles,\n              zIndex: 100,\n            }}\n          >\n            {children}\n          </div>\n        </FloatingPortal>\n      )}\n    </>\n  );\n}\n","import {\n  shift,\n  flip,\n  useDismiss,\n  useFloating,\n  useInteractions,\n  autoUpdate,\n  useClick,\n  useRole,\n} from \"@floating-ui/react\";\nimport type { UseInteractionsReturn, UseFloatingReturn } from \"@floating-ui/react\";\nimport { useState } from \"react\";\n\ntype TArgs = {\n  handleOpenChange?: (open: boolean) => void;\n};\n\ntype TReturn = {\n  options: UseFloatingReturn;\n  getReferenceProps: UseInteractionsReturn[\"getReferenceProps\"];\n  getFloatingProps: UseInteractionsReturn[\"getFloatingProps\"];\n};\n\nexport const useFloatingMenu = (args: TArgs): TReturn => {\n  const { handleOpenChange } = args;\n  // states\n  const [isDropdownOpen, setIsDropdownOpen] = useState(false);\n  // floating ui\n  const options = useFloating({\n    placement: \"bottom-start\",\n    middleware: [\n      flip({\n        fallbackPlacements: [\"top-start\", \"bottom-start\", \"top-end\", \"bottom-end\"],\n      }),\n      shift({\n        padding: 8,\n      }),\n    ],\n    open: isDropdownOpen,\n    onOpenChange: (open) => {\n      setIsDropdownOpen(open);\n      handleOpenChange?.(open);\n    },\n    whileElementsMounted: autoUpdate,\n  });\n  const { context } = options;\n  const click = useClick(context);\n  const dismiss = useDismiss(context);\n  const role = useRole(context);\n  const { getReferenceProps, getFloatingProps } = useInteractions([dismiss, click, role]);\n\n  return {\n    options,\n    getReferenceProps,\n    getFloatingProps,\n  };\n};\n","import type { Editor } from \"@tiptap/react\";\nimport {\n  BoldIcon,\n  Heading1,\n  CheckSquare,\n  Heading2,\n  Heading3,\n  TextQuote,\n  ImageIcon,\n  TableIcon,\n  ListIcon,\n  ListOrderedIcon,\n  ItalicIcon,\n  UnderlineIcon,\n  StrikethroughIcon,\n  CodeIcon,\n  Heading4,\n  Heading5,\n  Heading6,\n  CaseSensitive,\n  MinusSquare,\n  Palette,\n  AlignCenter,\n  LinkIcon,\n} from \"lucide-react\";\nimport type { LucideIcon } from \"lucide-react\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// helpers\nimport {\n  insertHorizontalRule,\n  insertImage,\n  insertTableCommand,\n  setLinkEditor,\n  setText,\n  setTextAlign,\n  toggleBackgroundColor,\n  toggleBlockquote,\n  toggleBold,\n  toggleBulletList,\n  toggleCodeBlock,\n  toggleHeading,\n  toggleItalic,\n  toggleOrderedList,\n  toggleStrike,\n  toggleTaskList,\n  toggleTextColor,\n  toggleUnderline,\n  unsetLinkEditor,\n} from \"@/helpers/editor-commands\";\n// types\nimport type { TCommandWithProps, TEditorCommands } from \"@/types\";\n\ntype isActiveFunction<T extends TEditorCommands> = (params?: TCommandWithProps<T>) => boolean;\ntype commandFunction<T extends TEditorCommands> = (params?: TCommandWithProps<T>) => void;\n\nexport type EditorMenuItem<T extends TEditorCommands> = {\n  key: T;\n  name: string;\n  command: commandFunction<T>;\n  icon: LucideIcon;\n  isActive: isActiveFunction<T>;\n};\n\nexport const TextItem = (editor: Editor): EditorMenuItem<\"text\"> => ({\n  key: \"text\",\n  name: \"Text\",\n  isActive: () => editor.isActive(CORE_EXTENSIONS.PARAGRAPH),\n  command: () => setText(editor),\n  icon: CaseSensitive,\n});\n\ntype SupportedHeadingLevels = Extract<TEditorCommands, \"h1\" | \"h2\" | \"h3\" | \"h4\" | \"h5\" | \"h6\">;\n\nconst HeadingItem = <T extends SupportedHeadingLevels>(\n  editor: Editor,\n  level: 1 | 2 | 3 | 4 | 5 | 6,\n  key: T,\n  name: string,\n  icon: LucideIcon\n): EditorMenuItem<T> => ({\n  key,\n  name,\n  isActive: () => editor.isActive(CORE_EXTENSIONS.HEADING, { level }),\n  command: () => toggleHeading(editor, level),\n  icon,\n});\n\nexport const HeadingOneItem = (editor: Editor): EditorMenuItem<\"h1\"> =>\n  HeadingItem(editor, 1, \"h1\", \"Heading 1\", Heading1);\n\nexport const HeadingTwoItem = (editor: Editor): EditorMenuItem<\"h2\"> =>\n  HeadingItem(editor, 2, \"h2\", \"Heading 2\", Heading2);\n\nexport const HeadingThreeItem = (editor: Editor): EditorMenuItem<\"h3\"> =>\n  HeadingItem(editor, 3, \"h3\", \"Heading 3\", Heading3);\n\nexport const HeadingFourItem = (editor: Editor): EditorMenuItem<\"h4\"> =>\n  HeadingItem(editor, 4, \"h4\", \"Heading 4\", Heading4);\n\nexport const HeadingFiveItem = (editor: Editor): EditorMenuItem<\"h5\"> =>\n  HeadingItem(editor, 5, \"h5\", \"Heading 5\", Heading5);\n\nexport const HeadingSixItem = (editor: Editor): EditorMenuItem<\"h6\"> =>\n  HeadingItem(editor, 6, \"h6\", \"Heading 6\", Heading6);\n\nexport const BoldItem = (editor: Editor): EditorMenuItem<\"bold\"> => ({\n  key: \"bold\",\n  name: \"Bold\",\n  isActive: () => editor?.isActive(CORE_EXTENSIONS.BOLD),\n  command: () => toggleBold(editor),\n  icon: BoldIcon,\n});\n\nexport const ItalicItem = (editor: Editor): EditorMenuItem<\"italic\"> => ({\n  key: \"italic\",\n  name: \"Italic\",\n  isActive: () => editor?.isActive(CORE_EXTENSIONS.ITALIC),\n  command: () => toggleItalic(editor),\n  icon: ItalicIcon,\n});\n\nexport const UnderLineItem = (editor: Editor): EditorMenuItem<\"underline\"> => ({\n  key: \"underline\",\n  name: \"Underline\",\n  isActive: () => editor?.isActive(CORE_EXTENSIONS.UNDERLINE),\n  command: () => toggleUnderline(editor),\n  icon: UnderlineIcon,\n});\n\nexport const StrikeThroughItem = (editor: Editor): EditorMenuItem<\"strikethrough\"> => ({\n  key: \"strikethrough\",\n  name: \"Strikethrough\",\n  isActive: () => editor?.isActive(CORE_EXTENSIONS.STRIKETHROUGH),\n  command: () => toggleStrike(editor),\n  icon: StrikethroughIcon,\n});\n\nexport const BulletListItem = (editor: Editor): EditorMenuItem<\"bulleted-list\"> => ({\n  key: \"bulleted-list\",\n  name: \"Bulleted list\",\n  isActive: () => editor?.isActive(CORE_EXTENSIONS.BULLET_LIST),\n  command: () => toggleBulletList(editor),\n  icon: ListIcon,\n});\n\nexport const NumberedListItem = (editor: Editor): EditorMenuItem<\"numbered-list\"> => ({\n  key: \"numbered-list\",\n  name: \"Numbered list\",\n  isActive: () => editor?.isActive(CORE_EXTENSIONS.ORDERED_LIST),\n  command: () => toggleOrderedList(editor),\n  icon: ListOrderedIcon,\n});\n\nexport const TodoListItem = (editor: Editor): EditorMenuItem<\"to-do-list\"> => ({\n  key: \"to-do-list\",\n  name: \"To-do list\",\n  isActive: () => editor.isActive(CORE_EXTENSIONS.TASK_ITEM),\n  command: () => toggleTaskList(editor),\n  icon: CheckSquare,\n});\n\nexport const QuoteItem = (editor: Editor): EditorMenuItem<\"quote\"> => ({\n  key: \"quote\",\n  name: \"Quote\",\n  isActive: () => editor?.isActive(CORE_EXTENSIONS.BLOCKQUOTE),\n  command: () => toggleBlockquote(editor),\n  icon: TextQuote,\n});\n\nexport const CodeItem = (editor: Editor): EditorMenuItem<\"code\"> => ({\n  key: \"code\",\n  name: \"Code\",\n  isActive: () => editor?.isActive(CORE_EXTENSIONS.CODE_INLINE) || editor?.isActive(CORE_EXTENSIONS.CODE_BLOCK),\n  command: () => toggleCodeBlock(editor),\n  icon: CodeIcon,\n});\n\nexport const TableItem = (editor: Editor): EditorMenuItem<\"table\"> => ({\n  key: \"table\",\n  name: \"Table\",\n  isActive: () => editor?.isActive(CORE_EXTENSIONS.TABLE),\n  command: () => insertTableCommand(editor),\n  icon: TableIcon,\n});\n\nexport const ImageItem = (editor: Editor): EditorMenuItem<\"image\"> => ({\n  key: \"image\",\n  name: \"Image\",\n  isActive: () => editor?.isActive(CORE_EXTENSIONS.IMAGE) || editor?.isActive(CORE_EXTENSIONS.CUSTOM_IMAGE),\n  command: () => insertImage({ editor, event: \"insert\", pos: editor.state.selection.from }),\n  icon: ImageIcon,\n});\n\nexport const HorizontalRuleItem = (editor: Editor): EditorMenuItem<\"divider\"> =>\n  ({\n    key: \"divider\",\n    name: \"Divider\",\n    isActive: () => editor?.isActive(CORE_EXTENSIONS.HORIZONTAL_RULE),\n    command: () => insertHorizontalRule(editor),\n    icon: MinusSquare,\n  }) as const;\n\nexport const LinkItem = (editor: Editor): EditorMenuItem<\"link\"> =>\n  ({\n    key: \"link\",\n    name: \"Link\",\n    isActive: () => editor?.isActive(\"link\"),\n\n    command: (props) => {\n      if (!props) return;\n      if (props.url) setLinkEditor(editor, props.url, props.text);\n      else unsetLinkEditor(editor);\n    },\n\n    icon: LinkIcon,\n  }) as const;\n\nexport const TextColorItem = (editor: Editor): EditorMenuItem<\"text-color\"> => ({\n  key: \"text-color\",\n  name: \"Color\",\n  isActive: (props) => editor.isActive(CORE_EXTENSIONS.CUSTOM_COLOR, { color: props?.color }),\n  command: (props) => {\n    if (!props) return;\n    toggleTextColor(props.color, editor);\n  },\n  icon: Palette,\n});\n\nexport const BackgroundColorItem = (editor: Editor): EditorMenuItem<\"background-color\"> => ({\n  key: \"background-color\",\n  name: \"Background color\",\n  isActive: (props) => editor.isActive(CORE_EXTENSIONS.CUSTOM_COLOR, { backgroundColor: props?.color }),\n  command: (props) => {\n    if (!props) return;\n    toggleBackgroundColor(props.color, editor);\n  },\n  icon: Palette,\n});\n\nexport const TextAlignItem = (editor: Editor): EditorMenuItem<\"text-align\"> => ({\n  key: \"text-align\",\n  name: \"Text align\",\n  isActive: (props) => editor.isActive({ textAlign: props?.alignment }),\n  command: (props) => {\n    if (!props) return;\n    setTextAlign(props.alignment, editor);\n  },\n  icon: AlignCenter,\n});\n\nexport const getEditorMenuItems = (editor: Editor | null): EditorMenuItem<TEditorCommands>[] => {\n  if (!editor) return [];\n\n  return [\n    TextItem(editor),\n    HeadingOneItem(editor),\n    HeadingTwoItem(editor),\n    HeadingThreeItem(editor),\n    HeadingFourItem(editor),\n    HeadingFiveItem(editor),\n    HeadingSixItem(editor),\n    BoldItem(editor),\n    ItalicItem(editor),\n    UnderLineItem(editor),\n    StrikeThroughItem(editor),\n    BulletListItem(editor),\n    TodoListItem(editor),\n    CodeItem(editor),\n    NumberedListItem(editor),\n    QuoteItem(editor),\n    TableItem(editor),\n    ImageItem(editor),\n    HorizontalRuleItem(editor),\n    LinkItem(editor),\n    TextColorItem(editor),\n    BackgroundColorItem(editor),\n    TextAlignItem(editor),\n  ] as EditorMenuItem<TEditorCommands>[];\n};\n","import type { Editor } from \"@tiptap/react\";\nimport { ALargeSmall, Ban } from \"lucide-react\";\nimport { useMemo } from \"react\";\nimport type { FC } from \"react\";\n// plane utils\nimport { cn } from \"@plane/utils\";\n// constants\nimport { COLORS_LIST } from \"@/constants/common\";\n// local imports\nimport { FloatingMenuRoot } from \"../floating-menu/root\";\nimport { useFloatingMenu } from \"../floating-menu/use-floating-menu\";\nimport { BackgroundColorItem, TextColorItem } from \"../menu-items\";\nimport type { EditorStateType } from \"./root\";\n\ntype Props = {\n  editor: Editor;\n  editorState: EditorStateType;\n};\n\nexport function BubbleMenuColorSelector(props: Props) {\n  const { editor, editorState } = props;\n  // floating ui\n  const { options, getReferenceProps, getFloatingProps } = useFloatingMenu({});\n\n  const activeTextColor = useMemo(() => editorState.color, [editorState.color]);\n  const activeBackgroundColor = useMemo(() => editorState.backgroundColor, [editorState.backgroundColor]);\n\n  return (\n    <FloatingMenuRoot\n      classNames={{\n        buttonContainer: \"h-full\",\n        button:\n          \"flex items-center gap-1 h-full whitespace-nowrap px-3 text-sm font-medium text-custom-text-300 hover:bg-custom-background-80 active:bg-custom-background-80 rounded transition-colors\",\n      }}\n      menuButton={\n        <>\n          <span>Color</span>\n          <span\n            className={cn(\n              \"flex-shrink-0 size-6 grid place-items-center rounded border-[0.5px] border-custom-border-300\",\n              {\n                \"bg-custom-background-100\": !activeBackgroundColor,\n              }\n            )}\n            style={{\n              backgroundColor: activeBackgroundColor ? activeBackgroundColor.backgroundColor : \"transparent\",\n            }}\n          >\n            <ALargeSmall\n              className={cn(\"size-3.5\", {\n                \"text-custom-text-100\": !activeTextColor,\n              })}\n              style={{\n                color: activeTextColor ? activeTextColor.textColor : \"inherit\",\n              }}\n            />\n          </span>\n        </>\n      }\n      options={options}\n      getFloatingProps={getFloatingProps}\n      getReferenceProps={getReferenceProps}\n    >\n      <section className=\"mt-1 rounded-md border-[0.5px] border-custom-border-300 bg-custom-background-100 p-2 space-y-2 shadow-custom-shadow-rg\">\n        <div className=\"space-y-1.5\">\n          <p className=\"text-xs text-custom-text-300 font-semibold\">Text colors</p>\n          <div className=\"flex items-center gap-2\">\n            {COLORS_LIST.map((color) => (\n              <button\n                key={color.key}\n                type=\"button\"\n                className=\"flex-shrink-0 size-6 rounded border-[0.5px] border-custom-border-400 hover:opacity-60 transition-opacity\"\n                style={{\n                  backgroundColor: color.textColor,\n                }}\n                onClick={() => TextColorItem(editor).command({ color: color.key })}\n              />\n            ))}\n            <button\n              type=\"button\"\n              className=\"flex-shrink-0 size-6 grid place-items-center rounded text-custom-text-300 border-[0.5px] border-custom-border-400 hover:bg-custom-background-80 transition-colors\"\n              onClick={() => TextColorItem(editor).command({ color: undefined })}\n            >\n              <Ban className=\"size-4\" />\n            </button>\n          </div>\n        </div>\n        <div className=\"space-y-1.5\">\n          <p className=\"text-xs text-custom-text-300 font-semibold\">Background colors</p>\n          <div className=\"flex items-center gap-2\">\n            {COLORS_LIST.map((color) => (\n              <button\n                key={color.key}\n                type=\"button\"\n                className=\"flex-shrink-0 size-6 rounded border-[0.5px] border-custom-border-400 hover:opacity-60 transition-opacity\"\n                style={{\n                  backgroundColor: color.backgroundColor,\n                }}\n                onClick={() => BackgroundColorItem(editor).command({ color: color.key })}\n              />\n            ))}\n            <button\n              type=\"button\"\n              className=\"flex-shrink-0 size-6 grid place-items-center rounded text-custom-text-300 border-[0.5px] border-custom-border-400 hover:bg-custom-background-80 transition-colors\"\n              onClick={() => BackgroundColorItem(editor).command({ color: undefined })}\n            >\n              <Ban className=\"size-4\" />\n            </button>\n          </div>\n        </div>\n      </section>\n    </FloatingMenuRoot>\n  );\n}\n","import type { Editor } from \"@tiptap/react\";\nimport { Check } from \"lucide-react\";\nimport type { FC } from \"react\";\nimport { ChevronDownIcon } from \"@plane/propel/icons\";\n// plane utils\nimport { cn } from \"@plane/utils\";\n// components\nimport type { EditorMenuItem } from \"@/components/menus\";\nimport {\n  BulletListItem,\n  HeadingOneItem,\n  HeadingThreeItem,\n  HeadingTwoItem,\n  NumberedListItem,\n  QuoteItem,\n  CodeItem,\n  TodoListItem,\n  TextItem,\n  HeadingFourItem,\n  HeadingFiveItem,\n  HeadingSixItem,\n} from \"@/components/menus\";\n// types\nimport type { TEditorCommands } from \"@/types\";\n// local imports\nimport { FloatingMenuRoot } from \"../floating-menu/root\";\nimport { useFloatingMenu } from \"../floating-menu/use-floating-menu\";\n\ntype Props = {\n  editor: Editor;\n};\n\nexport function BubbleMenuNodeSelector(props: Props) {\n  const { editor } = props;\n  // floating ui\n  const { options, getReferenceProps, getFloatingProps } = useFloatingMenu({});\n  const { context } = options;\n  const items: EditorMenuItem<TEditorCommands>[] = [\n    TextItem(editor),\n    HeadingOneItem(editor),\n    HeadingTwoItem(editor),\n    HeadingThreeItem(editor),\n    HeadingFourItem(editor),\n    HeadingFiveItem(editor),\n    HeadingSixItem(editor),\n    BulletListItem(editor),\n    NumberedListItem(editor),\n    TodoListItem(editor),\n    QuoteItem(editor),\n    CodeItem(editor),\n  ] as EditorMenuItem<TEditorCommands>[];\n\n  const activeItem = items.filter((item) => item.isActive()).pop() ?? {\n    name: \"Multiple\",\n  };\n\n  return (\n    <FloatingMenuRoot\n      classNames={{\n        buttonContainer: \"h-full\",\n        button: cn(\n          \"h-full flex items-center gap-1 px-3 text-sm font-medium text-custom-text-300 hover:bg-custom-background-80 active:bg-custom-background-80 rounded whitespace-nowrap transition-colors\",\n          {\n            \"bg-custom-background-80\": context.open,\n          }\n        ),\n      }}\n      menuButton={\n        <>\n          <span>{activeItem?.name}</span>\n          <ChevronDownIcon className=\"shrink-0 size-3\" />\n        </>\n      }\n      options={options}\n      getFloatingProps={getFloatingProps}\n      getReferenceProps={getReferenceProps}\n    >\n      <section className=\"w-48 max-h-[90vh] mt-1 flex flex-col overflow-y-scroll rounded-md border-[0.5px] border-custom-border-300 bg-custom-background-100 px-2 py-2.5 shadow-custom-shadow-rg\">\n        {items.map((item) => (\n          <button\n            key={item.name}\n            type=\"button\"\n            onClick={(e) => {\n              item.command();\n              context.onOpenChange(false);\n              e.stopPropagation();\n            }}\n            className={cn(\n              \"flex items-center justify-between rounded px-1 py-1.5 text-sm text-custom-text-200 hover:bg-custom-background-80\",\n              {\n                \"bg-custom-background-80\": activeItem.name === item.name,\n              }\n            )}\n          >\n            <div className=\"flex items-center space-x-2\">\n              <item.icon className=\"size-3 flex-shrink-0\" />\n              <span>{item.name}</span>\n            </div>\n            {activeItem.name === item.name && <Check className=\"size-3 text-custom-text-300 flex-shrink-0\" />}\n          </button>\n        ))}\n      </section>\n    </FloatingMenuRoot>\n  );\n}\n","import type { Editor } from \"@tiptap/core\";\nimport type { LucideIcon } from \"lucide-react\";\nimport { AlignCenter, AlignLeft, AlignRight } from \"lucide-react\";\n// plane utils\nimport { cn } from \"@plane/utils\";\n// components\nimport { TextAlignItem } from \"@/components/menus\";\n// types\nimport type { TEditorCommands } from \"@/types\";\nimport type { EditorStateType } from \"./root\";\n\ntype Props = {\n  editor: Editor;\n  editorState: EditorStateType;\n};\n\nexport function TextAlignmentSelector(props: Props) {\n  const { editor, editorState } = props;\n  const menuItem = TextAlignItem(editor);\n\n  const textAlignmentOptions: {\n    itemKey: TEditorCommands;\n    renderKey: string;\n    icon: LucideIcon;\n    command: () => void;\n    isActive: () => boolean;\n  }[] = [\n    {\n      itemKey: \"text-align\",\n      renderKey: \"text-align-left\",\n      icon: AlignLeft,\n      command: () =>\n        menuItem.command({\n          alignment: \"left\",\n        }),\n      isActive: () => editorState.left,\n    },\n    {\n      itemKey: \"text-align\",\n      renderKey: \"text-align-center\",\n      icon: AlignCenter,\n      command: () =>\n        menuItem.command({\n          alignment: \"center\",\n        }),\n      isActive: () => editorState.center,\n    },\n    {\n      itemKey: \"text-align\",\n      renderKey: \"text-align-right\",\n      icon: AlignRight,\n      command: () =>\n        menuItem.command({\n          alignment: \"right\",\n        }),\n      isActive: () => editorState.right,\n    },\n  ];\n  if (editorState.code) return null;\n\n  return (\n    <div className=\"flex gap-0.5 px-2\">\n      {textAlignmentOptions.map((item) => (\n        <button\n          key={item.renderKey}\n          type=\"button\"\n          onClick={(e) => {\n            e.stopPropagation();\n            item.command();\n          }}\n          className={cn(\n            \"size-7 grid place-items-center rounded text-custom-text-300 hover:bg-custom-background-80 active:bg-custom-background-80 transition-colors\",\n            {\n              \"bg-custom-background-80 text-custom-text-100\": item.isActive(),\n            }\n          )}\n        >\n          <item.icon className=\"size-4\" />\n        </button>\n      ))}\n    </div>\n  );\n}\n","import type { Editor } from \"@tiptap/core\";\nimport { Check, Link, Trash2 } from \"lucide-react\";\nimport type { FC } from \"react\";\nimport { useCallback, useRef, useState } from \"react\";\n// plane imports\nimport { cn } from \"@plane/utils\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// helpers\nimport { isValidHttpUrl } from \"@/helpers/common\";\nimport { setLinkEditor, unsetLinkEditor } from \"@/helpers/editor-commands\";\nimport { FloatingMenuRoot } from \"../floating-menu/root\";\nimport { useFloatingMenu } from \"../floating-menu/use-floating-menu\";\n\ntype Props = {\n  editor: Editor;\n};\n\nexport function BubbleMenuLinkSelector(props: Props) {\n  const { editor } = props;\n  // states\n  const [error, setError] = useState(false);\n  // floating ui\n  const { options, getReferenceProps, getFloatingProps } = useFloatingMenu({});\n  const { context } = options;\n  // refs\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const handleLinkSubmit = useCallback(() => {\n    const input = inputRef.current;\n    if (!input) return;\n    const url = input.value;\n    if (!url) return;\n    const { isValid, url: validatedUrl } = isValidHttpUrl(url);\n    if (isValid) {\n      setLinkEditor(editor, validatedUrl);\n      context.onOpenChange(false);\n      setError(false);\n    } else {\n      setError(true);\n    }\n  }, [editor, inputRef, context]);\n\n  return (\n    <FloatingMenuRoot\n      classNames={{\n        buttonContainer: \"h-full\",\n        button: cn(\n          \"h-full flex items-center gap-1 px-3 text-sm font-medium text-custom-text-300 hover:bg-custom-background-80 active:bg-custom-background-80 rounded whitespace-nowrap transition-colors\",\n          {\n            \"bg-custom-background-80\": context.open,\n            \"text-custom-text-100\": editor.isActive(CORE_EXTENSIONS.CUSTOM_LINK),\n          }\n        ),\n      }}\n      getFloatingProps={getFloatingProps}\n      getReferenceProps={getReferenceProps}\n      menuButton={\n        <>\n          Link\n          <Link className=\"shrink-0 size-3\" />\n        </>\n      }\n      options={options}\n    >\n      <div className=\"w-60 mt-1 rounded-md bg-custom-background-100 shadow-custom-shadow-rg\">\n        <div\n          className={cn(\"flex rounded  border-[0.5px] border-custom-border-300 transition-colors\", {\n            \"border-red-500\": error,\n          })}\n        >\n          <input\n            ref={inputRef}\n            type=\"url\"\n            placeholder=\"Enter or paste a link\"\n            onClick={(e) => e.stopPropagation()}\n            className=\"flex-1 border-r-[0.5px] border-custom-border-300 bg-custom-background-100 py-2 px-1.5 text-xs outline-none placeholder:text-custom-text-400 rounded\"\n            defaultValue={editor.getAttributes(\"link\").href || \"\"}\n            onKeyDown={(e) => {\n              setError(false);\n              if (e.key === \"Enter\") {\n                e.preventDefault();\n                handleLinkSubmit();\n              }\n            }}\n            onFocus={() => setError(false)}\n            autoFocus\n          />\n          {editor.getAttributes(\"link\").href ? (\n            <button\n              type=\"button\"\n              className=\"grid place-items-center rounded-sm p-1 text-red-500 hover:bg-red-500/20 transition-all\"\n              onClick={(e) => {\n                unsetLinkEditor(editor);\n                e.stopPropagation();\n                context.onOpenChange(false);\n              }}\n            >\n              <Trash2 className=\"size-4\" />\n            </button>\n          ) : (\n            <button\n              type=\"button\"\n              className=\"h-full aspect-square grid place-items-center p-1 rounded-sm text-custom-text-300 hover:bg-custom-background-80 transition-all\"\n              onClick={(e) => {\n                e.stopPropagation();\n                handleLinkSubmit();\n              }}\n            >\n              <Check className=\"size-4\" />\n            </button>\n          )}\n        </div>\n        {error && (\n          <p className=\"text-xs text-red-500 my-1 px-2 pointer-events-none animate-in fade-in slide-in-from-top-0\">\n            Please enter a valid URL\n          </p>\n        )}\n      </div>\n    </FloatingMenuRoot>\n  );\n}\n","import { isNodeSelection } from \"@tiptap/core\";\nimport type { Editor } from \"@tiptap/core\";\nimport { BubbleMenu, useEditorState } from \"@tiptap/react\";\nimport type { BubbleMenuProps } from \"@tiptap/react\";\nimport type { FC } from \"react\";\nimport { useEffect, useState, useRef } from \"react\";\n// plane utils\nimport { cn } from \"@plane/utils\";\n// components\nimport type { EditorMenuItem } from \"@/components/menus\";\nimport {\n  BackgroundColorItem,\n  BoldItem,\n  BubbleMenuColorSelector,\n  BubbleMenuNodeSelector,\n  CodeItem,\n  ItalicItem,\n  StrikeThroughItem,\n  TextAlignItem,\n  TextColorItem,\n  UnderLineItem,\n} from \"@/components/menus\";\n// constants\nimport { COLORS_LIST } from \"@/constants/common\";\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// extensions\nimport { isCellSelection } from \"@/extensions/table/table/utilities/helpers\";\n// types\nimport type { IEditorPropsExtended, TEditorCommands, TExtensions } from \"@/types\";\n// local imports\nimport { TextAlignmentSelector } from \"./alignment-selector\";\nimport { BubbleMenuLinkSelector } from \"./link-selector\";\n\ntype EditorBubbleMenuProps = Omit<BubbleMenuProps, \"children\">;\n\nexport type EditorStateType = {\n  code: boolean;\n  bold: boolean;\n  italic: boolean;\n  underline: boolean;\n  strikethrough: boolean;\n  left: boolean;\n  right: boolean;\n  center: boolean;\n  color:\n    | {\n        key: string;\n        label: string;\n        textColor: string;\n        backgroundColor: string;\n      }\n    | undefined;\n  backgroundColor:\n    | {\n        key: string;\n        label: string;\n        textColor: string;\n        backgroundColor: string;\n      }\n    | undefined;\n};\n\ntype Props = {\n  disabledExtensions: TExtensions[];\n  editor: Editor;\n  extendedEditorProps: IEditorPropsExtended;\n  flaggedExtensions: TExtensions[];\n};\n\nexport function EditorBubbleMenu(props: Props) {\n  const { editor } = props;\n  // states\n  const [isSelecting, setIsSelecting] = useState(false);\n  // refs\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  const formattingItems = {\n    code: CodeItem(editor),\n    bold: BoldItem(editor),\n    italic: ItalicItem(editor),\n    underline: UnderLineItem(editor),\n    strikethrough: StrikeThroughItem(editor),\n    \"text-align\": TextAlignItem(editor),\n  } satisfies {\n    [K in TEditorCommands]?: EditorMenuItem<K>;\n  };\n\n  const editorState: EditorStateType = useEditorState({\n    editor,\n    selector: ({ editor }) => ({\n      code: formattingItems.code.isActive(),\n      bold: formattingItems.bold.isActive(),\n      italic: formattingItems.italic.isActive(),\n      underline: formattingItems.underline.isActive(),\n      strikethrough: formattingItems.strikethrough.isActive(),\n      left: formattingItems[\"text-align\"].isActive({ alignment: \"left\" }),\n      right: formattingItems[\"text-align\"].isActive({ alignment: \"right\" }),\n      center: formattingItems[\"text-align\"].isActive({ alignment: \"center\" }),\n      color: COLORS_LIST.find((c) => TextColorItem(editor).isActive({ color: c.key })),\n      backgroundColor: COLORS_LIST.find((c) => BackgroundColorItem(editor).isActive({ color: c.key })),\n    }),\n  });\n\n  const basicFormattingOptions = editorState.code\n    ? [formattingItems.code]\n    : [formattingItems.bold, formattingItems.italic, formattingItems.underline, formattingItems.strikethrough];\n\n  const bubbleMenuProps: EditorBubbleMenuProps = {\n    editor,\n    shouldShow: ({ state, editor }) => {\n      const { selection } = state;\n      const { empty } = selection;\n\n      if (\n        empty ||\n        !editor.isEditable ||\n        editor.isActive(CORE_EXTENSIONS.IMAGE) ||\n        editor.isActive(CORE_EXTENSIONS.CUSTOM_IMAGE) ||\n        isNodeSelection(selection) ||\n        isCellSelection(selection) ||\n        isSelecting\n      ) {\n        return false;\n      }\n      return true;\n    },\n    tippyOptions: {\n      moveTransition: \"transform 0.15s ease-out\",\n      duration: [300, 0],\n      zIndex: 9,\n      onShow: () => {\n        if (editor.storage.link) {\n          editor.storage.link.isBubbleMenuOpen = true;\n        }\n        editor.commands.addActiveDropbarExtension(\"bubble-menu\");\n      },\n      onHide: () => {\n        if (editor.storage.link) {\n          editor.storage.link.isBubbleMenuOpen = false;\n        }\n        setTimeout(() => {\n          editor.commands.removeActiveDropbarExtension(\"bubble-menu\");\n        }, 0);\n      },\n      onHidden: () => {\n        if (editor.storage.link) {\n          editor.storage.link.isBubbleMenuOpen = false;\n        }\n        setTimeout(() => {\n          editor.commands.removeActiveDropbarExtension(\"bubble-menu\");\n        }, 0);\n      },\n    },\n  };\n\n  useEffect(() => {\n    function handleMouseDown(e: MouseEvent) {\n      if (menuRef.current?.contains(e.target as Node)) return;\n\n      function handleMouseMove() {\n        if (!editor.state.selection.empty) {\n          setIsSelecting(true);\n          document.removeEventListener(\"mousemove\", handleMouseMove);\n        }\n      }\n\n      function handleMouseUp() {\n        setIsSelecting(false);\n        document.removeEventListener(\"mousemove\", handleMouseMove);\n        document.removeEventListener(\"mouseup\", handleMouseUp);\n      }\n\n      document.addEventListener(\"mousemove\", handleMouseMove);\n      document.addEventListener(\"mouseup\", handleMouseUp);\n    }\n\n    document.addEventListener(\"mousedown\", handleMouseDown);\n\n    return () => {\n      document.removeEventListener(\"mousedown\", handleMouseDown);\n    };\n  }, [editor]);\n\n  return (\n    <BubbleMenu {...bubbleMenuProps}>\n      {!isSelecting && (\n        <div\n          ref={menuRef}\n          className=\"flex py-2 divide-x divide-custom-border-200 rounded-lg border border-custom-border-200 bg-custom-background-100 shadow-custom-shadow-rg overflow-x-scroll horizontal-scrollbar scrollbar-xs\"\n        >\n          <div className=\"px-2\">\n            <BubbleMenuNodeSelector editor={editor} />\n          </div>\n          {!editorState.code && (\n            <div className=\"px-2\">\n              <BubbleMenuLinkSelector editor={editor} />\n            </div>\n          )}\n          {!editorState.code && (\n            <div className=\"px-2\">\n              <BubbleMenuColorSelector editor={editor} editorState={editorState} />\n            </div>\n          )}\n          <div className=\"flex gap-0.5 px-2\">\n            {basicFormattingOptions.map((item) => (\n              <button\n                key={item.key}\n                type=\"button\"\n                onClick={(e) => {\n                  item.command();\n                  e.stopPropagation();\n                }}\n                className={cn(\n                  \"size-7 grid place-items-center rounded text-custom-text-300 hover:bg-custom-background-80 active:bg-custom-background-80 transition-colors\",\n                  {\n                    \"bg-custom-background-80 text-custom-text-100\": editorState[item.key],\n                  }\n                )}\n              >\n                <item.icon className=\"size-4\" />\n              </button>\n            ))}\n          </div>\n          <TextAlignmentSelector editor={editor} editorState={editorState} />\n        </div>\n      )}\n    </BubbleMenu>\n  );\n}\n","import type { Node as ProseMirrorNode } from \"@tiptap/pm/model\";\nimport { TableMap } from \"@tiptap/pm/tables\";\nimport type { Editor } from \"@tiptap/react\";\nimport { MoveHorizontal } from \"lucide-react\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// types\nimport type { BlockMenuOption } from \"./block-menu\";\n\nconst findSelectedTable = (editor: Editor): { tableNode: ProseMirrorNode | null; tablePos: number } => {\n  const { state } = editor;\n  const selectedNode = state.selection.content().content.firstChild;\n\n  if (selectedNode?.type.name === CORE_EXTENSIONS.TABLE) {\n    return {\n      tableNode: selectedNode,\n      tablePos: state.selection.from,\n    };\n  }\n\n  return { tableNode: null, tablePos: -1 };\n};\n\nconst setTableToFullWidth = (editor: Editor): void => {\n  try {\n    const { state, view } = editor;\n\n    // Find the selected table\n    const { tableNode, tablePos } = findSelectedTable(editor);\n    if (!tableNode) return;\n\n    // Get content width from CSS variable\n    const editorContainer = view.dom.closest(\".editor-container\");\n    if (!editorContainer) return;\n\n    const contentWidthVar = getComputedStyle(editorContainer).getPropertyValue(\"--editor-content-width\").trim();\n    if (!contentWidthVar) return;\n\n    const contentWidth = parseInt(contentWidthVar);\n    if (isNaN(contentWidth) || contentWidth <= 0) return;\n\n    // Calculate equal width for each column\n    const map = TableMap.get(tableNode);\n    const equalWidth = Math.floor(contentWidth / map.width);\n\n    // Update all cell widths\n    const tr = state.tr;\n    const tableStart = tablePos + 1;\n    const updatedCells = new Set<number>();\n\n    for (let row = 0; row < map.height; row++) {\n      for (let col = 0; col < map.width; col++) {\n        const cellIndex = row * map.width + col;\n        const cellPos = map.map[cellIndex];\n\n        // Skip if cell already updated (for merged cells)\n        if (updatedCells.has(cellPos)) continue;\n\n        const cell = state.doc.nodeAt(tableStart + cellPos);\n        if (!cell) continue;\n\n        // Handle colspan for merged cells\n        const colspan = cell.attrs.colspan || 1;\n        tr.setNodeMarkup(tableStart + cellPos, null, {\n          ...cell.attrs,\n          colwidth: Array(colspan).fill(equalWidth),\n        });\n\n        updatedCells.add(cellPos);\n      }\n    }\n\n    view.dispatch(tr);\n  } catch (error) {\n    console.error(\"Error setting table to full width:\", error);\n  }\n};\n\nexport const getNodeOptions = (editor: Editor): BlockMenuOption[] => [\n  {\n    icon: MoveHorizontal,\n    key: \"table-full-width\",\n    label: \"Fit to width\",\n    isDisabled: !editor.isActive(CORE_EXTENSIONS.TABLE),\n    onClick: () => setTableToFullWidth(editor),\n  },\n];\n","import {\n  useFloating,\n  autoUpdate,\n  offset,\n  flip,\n  shift,\n  useDismiss,\n  useInteractions,\n  FloatingPortal,\n} from \"@floating-ui/react\";\nimport type { Editor } from \"@tiptap/react\";\nimport type { LucideIcon } from \"lucide-react\";\nimport { Copy, Trash2 } from \"lucide-react\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport type { ISvgIcons } from \"@plane/propel/icons\";\nimport { cn } from \"@plane/utils\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// types\nimport type { IEditorProps } from \"@/types\";\n// components\nimport { getNodeOptions } from \"./block-menu-options\";\n\ntype Props = {\n  disabledExtensions?: IEditorProps[\"disabledExtensions\"];\n  editor: Editor;\n  flaggedExtensions?: IEditorProps[\"flaggedExtensions\"];\n  workItemIdentifier?: IEditorProps[\"workItemIdentifier\"];\n};\nexport type BlockMenuOption = {\n  icon: LucideIcon | React.FC<ISvgIcons>;\n  key: string;\n  label: string;\n  onClick: (e: React.MouseEvent) => void;\n  isDisabled?: boolean;\n};\n\nexport function BlockMenu(props: Props) {\n  const { editor, workItemIdentifier } = props;\n  const [isOpen, setIsOpen] = useState(false);\n  const [isAnimatedIn, setIsAnimatedIn] = useState(false);\n  const menuRef = useRef<HTMLDivElement | null>(null);\n  const virtualReferenceRef = useRef<{ getBoundingClientRect: () => DOMRect }>({\n    getBoundingClientRect: () => new DOMRect(),\n  });\n\n  // Set up Floating UI with virtual reference element\n  const { refs, floatingStyles, context } = useFloating({\n    open: isOpen,\n    onOpenChange: setIsOpen,\n    middleware: [offset({ crossAxis: -10 }), flip(), shift()],\n    whileElementsMounted: autoUpdate,\n    placement: \"left-start\",\n  });\n\n  const dismiss = useDismiss(context);\n  const { getFloatingProps } = useInteractions([dismiss]);\n\n  const openBlockMenu = useCallback(() => {\n    if (!isOpen) {\n      setIsOpen(true);\n      editor.commands.addActiveDropbarExtension(CORE_EXTENSIONS.SIDE_MENU);\n    }\n  }, [editor, isOpen]);\n\n  const closeBlockMenu = useCallback(() => {\n    if (isOpen) {\n      setIsOpen(false);\n      editor.commands.removeActiveDropbarExtension(CORE_EXTENSIONS.SIDE_MENU);\n    }\n  }, [editor, isOpen]);\n\n  // Handle click on drag handle\n  const handleClickDragHandle = useCallback(\n    (event: MouseEvent) => {\n      const target = event.target as HTMLElement;\n      const dragHandle = target.closest(\"#drag-handle\");\n\n      if (dragHandle) {\n        event.preventDefault();\n\n        // Update virtual reference with current drag handle position\n        virtualReferenceRef.current = {\n          getBoundingClientRect: () => dragHandle.getBoundingClientRect(),\n        };\n\n        // Set the virtual reference as the reference element\n        refs.setReference(virtualReferenceRef.current);\n\n        // Show the menu\n        openBlockMenu();\n        return;\n      }\n\n      // If clicking outside and not on a menu item, hide the menu\n      if (menuRef.current && !menuRef.current.contains(target)) {\n        closeBlockMenu();\n      }\n    },\n    [refs, openBlockMenu, closeBlockMenu]\n  );\n\n  // Set up event listeners\n  useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key === \"Escape\") {\n        closeBlockMenu();\n      }\n    };\n\n    const handleScroll = () => {\n      closeBlockMenu();\n    };\n\n    document.addEventListener(\"click\", handleClickDragHandle);\n    document.addEventListener(\"contextmenu\", handleClickDragHandle);\n    document.addEventListener(\"keydown\", handleKeyDown);\n    document.addEventListener(\"scroll\", handleScroll, true);\n\n    return () => {\n      document.removeEventListener(\"click\", handleClickDragHandle);\n      document.removeEventListener(\"contextmenu\", handleClickDragHandle);\n      document.removeEventListener(\"keydown\", handleKeyDown);\n      document.removeEventListener(\"scroll\", handleScroll, true);\n    };\n  }, [editor.commands, handleClickDragHandle, closeBlockMenu]);\n\n  // Animation effect\n  useEffect(() => {\n    if (isOpen) {\n      setIsAnimatedIn(false);\n      // Add a small delay before starting the animation\n      const timeout = setTimeout(() => {\n        requestAnimationFrame(() => {\n          setIsAnimatedIn(true);\n        });\n      }, 50);\n\n      return () => clearTimeout(timeout);\n    } else {\n      setIsAnimatedIn(false);\n    }\n  }, [isOpen]);\n\n  const MENU_ITEMS: BlockMenuOption[] = [\n    {\n      icon: Trash2,\n      key: \"delete\",\n      label: \"Delete\",\n      onClick: (_e) => {\n        // Execute the delete action\n        editor.chain().deleteSelection().focus().run();\n      },\n    },\n    {\n      icon: Copy,\n      key: \"duplicate\",\n      label: \"Duplicate\",\n      isDisabled:\n        editor.state.selection.content().content.firstChild?.type.name === CORE_EXTENSIONS.IMAGE ||\n        editor.isActive(CORE_EXTENSIONS.CUSTOM_IMAGE),\n      onClick: (_e) => {\n        try {\n          const { state } = editor;\n          const { selection } = state;\n          const firstChild = selection.content().content.firstChild;\n          const docSize = state.doc.content.size;\n\n          if (!firstChild) {\n            throw new Error(\"No content selected or content is not duplicable.\");\n          }\n\n          // Directly use selection.to as the insertion position\n          const insertPos = selection.to;\n\n          // Ensure the insertion position is within the document's bounds\n          if (insertPos < 0 || insertPos > docSize) {\n            throw new Error(\"The insertion position is invalid or outside the document.\");\n          }\n\n          const contentToInsert = firstChild.toJSON();\n\n          // Insert the content at the calculated position\n          editor\n            .chain()\n            .insertContentAt(insertPos, contentToInsert, {\n              updateSelection: true,\n            })\n            .focus(Math.min(insertPos + 1, docSize), { scrollIntoView: false })\n            .run();\n        } catch (error) {\n          if (error instanceof Error) {\n            console.error(error.message);\n          }\n        }\n      },\n    },\n    ...getNodeOptions(editor),\n  ];\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return (\n    <FloatingPortal>\n      <div\n        ref={(node) => {\n          refs.setFloating(node);\n          menuRef.current = node;\n        }}\n        style={{\n          ...floatingStyles,\n          animationFillMode: \"forwards\",\n          transitionTimingFunction: \"cubic-bezier(0.16, 1, 0.3, 1)\", // Expo ease out\n          zIndex: 100,\n        }}\n        className={cn(\n          \"max-h-60 min-w-[7rem] overflow-y-scroll rounded-lg border border-custom-border-200 bg-custom-background-100 p-1.5 shadow-custom-shadow-rg\",\n          \"transition-all duration-300 transform origin-top-right\",\n          isAnimatedIn ? \"opacity-100 scale-100\" : \"opacity-0 scale-75\"\n        )}\n        {...getFloatingProps()}\n      >\n        {MENU_ITEMS.map((item) => {\n          if (item.isDisabled) return null;\n\n          return (\n            <button\n              key={item.key}\n              type=\"button\"\n              className=\"flex w-full items-center gap-1.5 truncate rounded px-1 py-1.5 text-xs text-custom-text-200 hover:bg-custom-background-90\"\n              onClick={(e) => {\n                item.onClick(e);\n                e.preventDefault();\n                e.stopPropagation();\n                closeBlockMenu();\n              }}\n              disabled={item.isDisabled}\n            >\n              <item.icon className=\"h-3 w-3\" />\n              {item.label}\n            </button>\n          );\n        })}\n      </div>\n    </FloatingPortal>\n  );\n}\n","import type { Editor } from \"@tiptap/react\";\n\nexport const insertContentAtSavedSelection = (editor: Editor, content: string) => {\n  if (!editor || editor.isDestroyed) {\n    console.error(\"Editor reference is not available or has been destroyed.\");\n    return;\n  }\n\n  if (!editor.state.selection) {\n    console.error(\"Saved selection is invalid.\");\n    return;\n  }\n\n  const docSize = editor.state.doc.content.size;\n  const safePosition = Math.max(0, Math.min(editor.state.selection.anchor, docSize));\n\n  try {\n    editor.chain().focus().insertContentAt(safePosition, content).run();\n  } catch (error) {\n    console.error(\"An error occurred while inserting content at saved selection:\", error);\n  }\n};\n","import type { Editor } from \"@tiptap/react\";\n// types\nimport type { IMarking } from \"@/types\";\n\nfunction findNthH1(editor: Editor, n: number, level: number): number {\n  let count = 0;\n  let pos = 0;\n  editor.state.doc.descendants((node, position) => {\n    if (node.type.name === \"heading\" && node.attrs.level === level) {\n      count++;\n      if (count === n) {\n        pos = position;\n        return false;\n      }\n    }\n  });\n  return pos;\n}\n\nfunction scrollToNode(editor: Editor, pos: number): void {\n  const headingNode = editor.state.doc.nodeAt(pos);\n  if (headingNode) {\n    const headingDOM = editor.view.nodeDOM(pos);\n    if (headingDOM instanceof HTMLElement) {\n      headingDOM.scrollIntoView({ behavior: \"smooth\" });\n    }\n  }\n}\n\nexport function scrollToNodeViaDOMCoordinates(editor: Editor, pos: number, behavior?: ScrollBehavior): void {\n  const view = editor.view;\n\n  // Get the coordinates of the position\n  const coords = view.coordsAtPos(pos);\n\n  if (coords) {\n    // Scroll to the coordinates\n    window.scrollTo({\n      top: coords.top + window.scrollY - window.innerHeight / 2,\n      behavior: behavior,\n    });\n\n    // Optionally, you can also focus the editor\n    view.focus();\n  } else {\n    console.warn(\"Unable to find coordinates for the given position\");\n  }\n}\n\nexport function scrollSummary(editor: Editor, marking: IMarking) {\n  if (editor) {\n    const pos = findNthH1(editor, marking.sequence, marking.level);\n    scrollToNode(editor, pos);\n  }\n}\n","import type { HocuspocusProvider } from \"@hocuspocus/provider\";\nimport type { Editor } from \"@tiptap/core\";\nimport { DOMSerializer } from \"@tiptap/pm/model\";\nimport * as Y from \"yjs\";\n// plane imports\nimport { convertHTMLToMarkdown } from \"@plane/utils\";\n// components\nimport { getEditorMenuItems } from \"@/components/menus\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\nimport { CORE_EDITOR_META } from \"@/constants/meta\";\n// types\nimport type { EditorRefApi, IEditorProps, TEditorCommands } from \"@/types\";\n// local imports\nimport { getParagraphCount } from \"./common\";\nimport { insertContentAtSavedSelection } from \"./insert-content-at-cursor-position\";\nimport { scrollSummary, scrollToNodeViaDOMCoordinates } from \"./scroll-to-node\";\n\ntype TArgs = Pick<IEditorProps, \"getEditorMetaData\"> & {\n  editor: Editor | null;\n  provider: HocuspocusProvider | undefined;\n};\n\nexport const getEditorRefHelpers = (args: TArgs): EditorRefApi => {\n  const { editor, getEditorMetaData, provider } = args;\n\n  return {\n    blur: () => editor?.commands.blur(),\n    clearEditor: (emitUpdate = false) => {\n      editor?.chain().setMeta(CORE_EDITOR_META.SKIP_FILE_DELETION, true).clearContent(emitUpdate).run();\n    },\n    createSelectionAtCursorPosition: () => {\n      if (!editor) return;\n      const { empty } = editor.state.selection;\n\n      if (empty) {\n        // Get the text content and position info\n        const { $from } = editor.state.selection;\n        const textContent = $from.parent.textContent;\n        const posInNode = $from.parentOffset;\n\n        // Find word boundaries\n        let start = posInNode;\n        let end = posInNode;\n\n        // Move start position backwards until we hit a word boundary\n        while (start > 0 && /\\w/.test(textContent[start - 1])) {\n          start--;\n        }\n\n        // Move end position forwards until we hit a word boundary\n        while (end < textContent.length && /\\w/.test(textContent[end])) {\n          end++;\n        }\n\n        // If we found a word, select it using editor commands\n        if (start !== end) {\n          const from = $from.start() + start;\n          const to = $from.start() + end;\n          editor.commands.setTextSelection({ from, to });\n        }\n      }\n    },\n    getDocument: () => {\n      const documentBinary = provider?.document ? Y.encodeStateAsUpdate(provider?.document) : null;\n      const documentHTML = editor?.getHTML() ?? \"<p></p>\";\n      const documentJSON = editor?.getJSON() ?? null;\n\n      return {\n        binary: documentBinary,\n        html: documentHTML,\n        json: documentJSON,\n      };\n    },\n    getDocumentInfo: () => ({\n      characters: editor?.storage.characterCount?.characters?.() ?? 0,\n      paragraphs: getParagraphCount(editor?.state),\n      words: editor?.storage.characterCount?.words?.() ?? 0,\n    }),\n    getHeadings: () => (editor ? editor.storage.headingsList?.headings : []),\n    getMarkDown: () => {\n      if (!editor) return \"\";\n      const editorHTML = editor.getHTML();\n      const metaData = getEditorMetaData(editorHTML);\n      // convert to markdown\n      const markdown = convertHTMLToMarkdown({\n        description_html: editorHTML,\n        metaData,\n      });\n      return markdown;\n    },\n    copyMarkdownToClipboard: () => {\n      if (!editor) return;\n\n      const html = editor.getHTML();\n      const metaData = getEditorMetaData(html);\n      const markdown = convertHTMLToMarkdown({\n        description_html: html,\n        metaData,\n      });\n\n      const copyHandler = (event: ClipboardEvent) => {\n        event.preventDefault();\n        event.clipboardData?.setData(\"text/plain\", markdown);\n        event.clipboardData?.setData(\"text/html\", html);\n        event.clipboardData?.setData(\"text/plane-editor-html\", html);\n        document.removeEventListener(\"copy\", copyHandler);\n      };\n\n      document.addEventListener(\"copy\", copyHandler);\n      document.execCommand(\"copy\");\n    },\n    isAnyDropbarOpen: () => {\n      if (!editor) return false;\n      const utilityStorage = editor.storage.utility;\n      return utilityStorage.activeDropbarExtensions.length > 0;\n    },\n    scrollSummary: (marking) => {\n      if (!editor) return;\n      scrollSummary(editor, marking);\n    },\n    setEditorValue: (content, emitUpdate = false) => {\n      editor\n        ?.chain()\n        .setMeta(CORE_EDITOR_META.SKIP_FILE_DELETION, true)\n        .setMeta(CORE_EDITOR_META.INTENTIONAL_DELETION, true)\n        .setContent(content, emitUpdate, {\n          preserveWhitespace: true,\n        })\n        .run();\n    },\n    emitRealTimeUpdate: (message) => provider?.sendStateless(message),\n    executeMenuItemCommand: (props) => {\n      const { itemKey } = props;\n      const editorItems = getEditorMenuItems(editor);\n\n      const getEditorMenuItem = (itemKey: TEditorCommands) => editorItems.find((item) => item.key === itemKey);\n\n      const item = getEditorMenuItem(itemKey);\n      if (item) {\n        item.command(props);\n      } else {\n        console.warn(`No command found for item: ${itemKey}`);\n      }\n    },\n    focus: (args) => editor?.commands.focus(args),\n    getCoordsFromPos: (pos) => editor?.view.coordsAtPos(pos ?? editor.state.selection.from),\n    getCurrentCursorPosition: () => editor?.state.selection.from,\n    getAttributesWithExtendedMark: (mark, attribute) => {\n      if (!editor) return;\n      editor.commands.extendMarkRange(mark);\n      return editor.getAttributes(attribute);\n    },\n    getSelectedText: () => {\n      if (!editor) return null;\n\n      const { state } = editor;\n      const { from, to, empty } = state.selection;\n\n      if (empty) return null;\n\n      const nodesArray: string[] = [];\n      state.doc.nodesBetween(from, to, (node, _pos, parent) => {\n        if (parent === state.doc && editor) {\n          const serializer = DOMSerializer.fromSchema(editor.schema);\n          const dom = serializer.serializeNode(node);\n          const tempDiv = document.createElement(\"div\");\n          tempDiv.appendChild(dom);\n          nodesArray.push(tempDiv.innerHTML);\n        }\n      });\n      const selection = nodesArray.join(\"\");\n      return selection;\n    },\n    insertText: (contentHTML, insertOnNextLine) => {\n      if (!editor) return;\n      const { from, to, empty } = editor.state.selection;\n      if (empty) return;\n      if (insertOnNextLine) {\n        // move cursor to the end of the selection and insert a new line\n        editor.chain().focus().setTextSelection(to).insertContent(\"<br />\").insertContent(contentHTML).run();\n      } else {\n        // replace selected text with the content provided\n        editor.chain().focus().deleteRange({ from, to }).insertContent(contentHTML).run();\n      }\n    },\n    isEditorReadyToDiscard: () => editor?.storage?.utility?.uploadInProgress === false,\n    isMenuItemActive: (props) => {\n      const { itemKey } = props;\n      const editorItems = getEditorMenuItems(editor);\n\n      const getEditorMenuItem = (itemKey: TEditorCommands) => editorItems.find((item) => item.key === itemKey);\n      const item = getEditorMenuItem(itemKey);\n      if (!item) return false;\n\n      return item.isActive(props);\n    },\n    listenToRealTimeUpdate: () => provider && { on: provider.on.bind(provider), off: provider.off.bind(provider) },\n    onDocumentInfoChange: (callback) => {\n      const handleDocumentInfoChange = () => {\n        if (!editor?.storage) return;\n        callback({\n          characters: editor.storage.characterCount?.characters?.() ?? 0,\n          paragraphs: getParagraphCount(editor?.state),\n          words: editor.storage.characterCount?.words?.() ?? 0,\n        });\n      };\n\n      // Subscribe to update event emitted from character count extension\n      editor?.on(\"update\", handleDocumentInfoChange);\n      // Return a function to unsubscribe to the continuous transactions of\n      // the editor on unmounting the component that has subscribed to this\n      // method\n      return () => {\n        editor?.off(\"update\", handleDocumentInfoChange);\n      };\n    },\n    onHeadingChange: (callback) => {\n      const handleHeadingChange = () => {\n        if (!editor) return;\n        const headings = editor.storage.headingsList?.headings;\n        if (headings) {\n          callback(headings);\n        }\n      };\n\n      // Subscribe to update event emitted from headers extension\n      editor?.on(\"update\", handleHeadingChange);\n      // Return a function to unsubscribe to the continuous transactions of\n      // the editor on unmounting the component that has subscribed to this\n      // method\n      return () => {\n        editor?.off(\"update\", handleHeadingChange);\n      };\n    },\n    onStateChange: (callback) => {\n      // Subscribe to editor state changes\n      editor?.on(\"transaction\", callback);\n\n      // Return a function to unsubscribe to the continuous transactions of\n      // the editor on unmounting the component that has subscribed to this\n      // method\n      return () => {\n        editor?.off(\"transaction\", callback);\n      };\n    },\n    redo: () => editor?.commands.redo(),\n    scrollToNodeViaDOMCoordinates({ pos, behavior = \"smooth\" }) {\n      const resolvedPos = pos ?? editor?.state.selection.from;\n      if (!editor || !resolvedPos) return;\n      scrollToNodeViaDOMCoordinates(editor, resolvedPos, behavior);\n    },\n    setEditorValueAtCursorPosition: (content) => {\n      if (editor?.state.selection) {\n        insertContentAtSavedSelection(editor, content);\n      }\n    },\n    setFocusAtPosition: (position) => {\n      if (!editor || editor.isDestroyed) {\n        console.error(\"Editor reference is not available or has been destroyed.\");\n        return;\n      }\n      try {\n        const docSize = editor.state.doc.content.size;\n        const safePosition = Math.max(0, Math.min(position, docSize));\n        editor\n          .chain()\n          .insertContentAt(safePosition, [{ type: CORE_EXTENSIONS.PARAGRAPH }])\n          .focus()\n          .run();\n      } catch (error) {\n        console.error(\"An error occurred while setting focus at position:\", error);\n      }\n    },\n    setProviderDocument: (value) => {\n      const document = provider?.document;\n      if (!document) return;\n      Y.applyUpdate(document, value);\n    },\n    undo: () => editor?.commands.undo(),\n  };\n};\n","import { v4 as uuidv4 } from \"uuid\";\nimport { ECustomImageAttributeNames, ECustomImageStatus } from \"@/extensions/custom-image/types\";\n\nexport type AssetDuplicationContext = {\n  element: Element;\n  originalHtml: string;\n};\n\nexport type AssetDuplicationResult = {\n  modifiedHtml: string;\n  shouldProcess: boolean;\n};\n\nexport type AssetDuplicationHandler = (context: AssetDuplicationContext) => AssetDuplicationResult;\n\nconst imageComponentHandler: AssetDuplicationHandler = ({ element, originalHtml }) => {\n  const src = element.getAttribute(\"src\");\n\n  if (!src || src.startsWith(\"http\")) {\n    return { modifiedHtml: originalHtml, shouldProcess: false };\n  }\n\n  // Capture the original HTML BEFORE making any modifications\n  const originalTag = element.outerHTML;\n\n  // Use setAttribute to update attributes\n  const newId = uuidv4();\n  element.setAttribute(ECustomImageAttributeNames.STATUS, ECustomImageStatus.DUPLICATING);\n  element.setAttribute(ECustomImageAttributeNames.ID, newId);\n\n  // Get the modified HTML AFTER the changes\n  const modifiedTag = element.outerHTML;\n  const modifiedHtml = originalHtml.replaceAll(originalTag, modifiedTag);\n\n  return { modifiedHtml, shouldProcess: true };\n};\n\nexport const assetDuplicationHandlers: Record<string, AssetDuplicationHandler> = {\n  \"image-component\": imageComponentHandler,\n};\n","import { assetDuplicationHandlers } from \"@/plane-editor/helpers/asset-duplication\";\n\n// Utility function to process HTML content with all registered handlers\nexport const processAssetDuplication = (htmlContent: string): { processedHtml: string } => {\n  const tempDiv = document.createElement(\"div\");\n  tempDiv.innerHTML = htmlContent;\n\n  let processedHtml = htmlContent;\n\n  // Process each registered component type\n  for (const [componentName, handler] of Object.entries(assetDuplicationHandlers)) {\n    const elements = tempDiv.querySelectorAll(componentName);\n\n    if (elements.length > 0) {\n      elements.forEach((element) => {\n        const result = handler({ element, originalHtml: processedHtml });\n        if (result.shouldProcess) {\n          processedHtml = result.modifiedHtml;\n        }\n      });\n\n      // Update tempDiv with processed HTML for next iteration\n      tempDiv.innerHTML = processedHtml;\n    }\n  }\n\n  return { processedHtml };\n};\n","import { DOMParser } from \"@tiptap/pm/model\";\nimport type { EditorProps } from \"@tiptap/pm/view\";\n// plane utils\nimport { cn } from \"@plane/utils\";\n// helpers\nimport { processAssetDuplication } from \"@/helpers/paste-asset\";\n\ntype TArgs = {\n  editorClassName: string;\n};\n\nexport const CoreEditorProps = (props: TArgs): EditorProps => {\n  const { editorClassName } = props;\n\n  return {\n    attributes: {\n      class: cn(\n        \"prose prose-brand max-w-full prose-headings:font-display font-default focus:outline-none\",\n        editorClassName\n      ),\n    },\n    handleDOMEvents: {\n      keydown: (_view, event) => {\n        // prevent default event listeners from firing when slash command is active\n        if ([\"ArrowUp\", \"ArrowDown\", \"Enter\"].includes(event.key)) {\n          const slashCommand = document.querySelector(\"#slash-command\");\n          if (slashCommand) {\n            return true;\n          }\n        }\n      },\n    },\n    handlePaste: (view, event) => {\n      if (!event.clipboardData) return false;\n\n      const htmlContent = event.clipboardData.getData(\"text/plane-editor-html\");\n      if (!htmlContent) return false;\n\n      const { processedHtml } = processAssetDuplication(htmlContent);\n      view.pasteHTML(processedHtml);\n      return true;\n    },\n  };\n};\n","import { useEditorState, useEditor as useTiptapEditor } from \"@tiptap/react\";\nimport { useImperativeHandle, useEffect } from \"react\";\nimport type { MarkdownStorage } from \"tiptap-markdown\";\n// extensions\nimport { CoreEditorExtensions } from \"@/extensions\";\n// helpers\nimport { getEditorRefHelpers } from \"@/helpers/editor-ref\";\n// props\nimport { CoreEditorProps } from \"@/props\";\n// types\nimport type { TEditorHookProps } from \"@/types\";\n\ndeclare module \"@tiptap/core\" {\n  interface Storage {\n    markdown: MarkdownStorage;\n  }\n}\n\nexport const useEditor = (props: TEditorHookProps) => {\n  const {\n    autofocus = false,\n    disabledExtensions,\n    editable = true,\n    editorClassName = \"\",\n    editorProps = {},\n    enableHistory,\n    extendedEditorProps,\n    extensions = [],\n    fileHandler,\n    flaggedExtensions,\n    forwardedRef,\n    getEditorMetaData,\n    handleEditorReady,\n    id = \"\",\n    initialValue,\n    isTouchDevice,\n    mentionHandler,\n    onAssetChange,\n    onChange,\n    onEditorFocus,\n    onTransaction,\n    placeholder,\n    showPlaceholderOnEmpty,\n    tabIndex,\n    provider,\n    value,\n  } = props;\n\n  const editor = useTiptapEditor(\n    {\n      editable,\n      immediatelyRender: false,\n      shouldRerenderOnTransaction: false,\n      autofocus,\n      parseOptions: { preserveWhitespace: true },\n      editorProps: {\n        ...CoreEditorProps({\n          editorClassName,\n        }),\n        ...editorProps,\n      },\n      extensions: [\n        ...CoreEditorExtensions({\n          disabledExtensions,\n          editable,\n          enableHistory,\n          extendedEditorProps,\n          fileHandler,\n          flaggedExtensions,\n          getEditorMetaData,\n          isTouchDevice,\n          mentionHandler,\n          placeholder,\n          showPlaceholderOnEmpty,\n          tabIndex,\n          provider,\n        }),\n        ...extensions,\n      ],\n      content: initialValue,\n      onCreate: () => handleEditorReady?.(true),\n      onTransaction: () => {\n        onTransaction?.();\n      },\n      onUpdate: ({ editor, transaction }) => {\n        // Check if this update is only due to migration update\n        const isMigrationUpdate = transaction?.getMeta(\"uniqueIdOnlyChange\") === true;\n        onChange?.(editor.getJSON(), editor.getHTML(), { isMigrationUpdate });\n      },\n      onDestroy: () => handleEditorReady?.(false),\n      onFocus: onEditorFocus,\n    },\n    [editable]\n  );\n\n  // Effect for syncing SWR data\n  useEffect(() => {\n    // value is null when intentionally passed where syncing is not yet\n    // supported and value is undefined when the data from swr is not populated\n    if (value == null) return;\n    if (editor) {\n      const { uploadInProgress: isUploadInProgress } = editor.storage.utility;\n      if (!editor.isDestroyed && !isUploadInProgress) {\n        try {\n          editor.commands.setContent(value, false, {\n            preserveWhitespace: true,\n          });\n          if (editor.state.selection) {\n            const docLength = editor.state.doc.content.size;\n            const relativePosition = Math.min(editor.state.selection.from, docLength - 1);\n            editor.commands.setTextSelection(relativePosition);\n          }\n        } catch (error) {\n          console.error(\"Error syncing editor content with external value:\", error);\n        }\n      }\n    }\n  }, [editor, value, id]);\n\n  // update assets upload status\n  useEffect(() => {\n    if (!editor) return;\n    const assetsUploadStatus = fileHandler.assetsUploadStatus;\n    editor.commands.updateAssetsUploadStatus?.(assetsUploadStatus);\n  }, [editor, fileHandler.assetsUploadStatus]);\n\n  // subscribe to assets list changes\n  const assetsList = useEditorState({\n    editor,\n    selector: ({ editor }) => ({\n      assets: editor?.storage.utility?.assetsList ?? [],\n    }),\n  });\n  // trigger callback when assets list changes\n  useEffect(() => {\n    const assets = assetsList?.assets;\n    if (!assets || !onAssetChange) return;\n    onAssetChange(assets);\n  }, [assetsList?.assets, onAssetChange]);\n\n  useImperativeHandle(\n    forwardedRef,\n    () =>\n      getEditorRefHelpers({\n        editor,\n        getEditorMetaData,\n        provider,\n      }),\n    [editor, getEditorMetaData, provider]\n  );\n\n  if (!editor) {\n    return null;\n  }\n\n  return editor;\n};\n","import type { Editor } from \"@tiptap/core\";\nimport { Extension } from \"@tiptap/core\";\nimport { useCallback, useRef } from \"react\";\n\n/**\n * Creates a title editor extension that enables keyboard navigation to the main editor\n *\n * @param getMainEditor Function to get the main editor instance\n * @returns A Tiptap extension with keyboard shortcuts\n */\nexport const createTitleNavigationExtension = (getMainEditor: () => Editor | null) =>\n  Extension.create({\n    name: \"titleEditorNavigation\",\n    priority: 10,\n\n    addKeyboardShortcuts() {\n      return {\n        // Arrow down at end of title - Move to main editor\n        ArrowDown: () => {\n          const mainEditor = getMainEditor();\n          if (!mainEditor) return false;\n\n          // If cursor is at the end of the title\n          mainEditor.commands.focus(\"start\");\n          return true;\n        },\n\n        // Right arrow at end of title - Move to main editor\n        ArrowRight: ({ editor: titleEditor }) => {\n          const mainEditor = getMainEditor();\n          if (!mainEditor) return false;\n\n          const { from, to } = titleEditor.state.selection;\n          const documentLength = titleEditor.state.doc.content.size;\n\n          // If cursor is at the end of the title\n          if (from === to && to === documentLength - 1) {\n            mainEditor.commands.focus(\"start\");\n            return true;\n          }\n          return false;\n        },\n\n        // Enter - Create new line in main editor and focus\n        Enter: () => {\n          const mainEditor = getMainEditor();\n          if (!mainEditor) return false;\n\n          // Focus at the start of the main editor\n          mainEditor.chain().focus().insertContentAt(0, { type: \"paragraph\" }).run();\n          return true;\n        },\n      };\n    },\n  });\n\n/**\n * Creates a main editor extension that enables keyboard navigation to the title editor\n *\n * @param getTitleEditor Function to get the title editor instance\n * @returns A Tiptap extension with keyboard shortcuts\n */\nexport const createMainNavigationExtension = (getTitleEditor: () => Editor | null) =>\n  Extension.create({\n    name: \"mainEditorNavigation\",\n    priority: 10,\n\n    addKeyboardShortcuts() {\n      return {\n        // Arrow up at start of main editor - Move to title editor\n        ArrowUp: ({ editor: mainEditor }) => {\n          const titleEditor = getTitleEditor();\n          if (!titleEditor) return false;\n\n          const { from, to } = mainEditor.state.selection;\n\n          // If cursor is at the start of the main editor\n          if (from === 1 && to === 1) {\n            titleEditor.commands.focus(\"end\");\n            return true;\n          }\n          return false;\n        },\n\n        // Left arrow at start of main editor - Move to title editor\n        ArrowLeft: ({ editor: mainEditor }) => {\n          const titleEditor = getTitleEditor();\n          if (!titleEditor) return false;\n\n          const { from, to } = mainEditor.state.selection;\n\n          // If cursor is at the absolute start of the main editor\n          if (from === 1 && to === 1) {\n            titleEditor.commands.focus(\"end\");\n            return true;\n          }\n          return false;\n        },\n\n        // Backspace - Special handling for first paragraph\n        Backspace: ({ editor }) => {\n          const titleEditor = getTitleEditor();\n          if (!titleEditor) return false;\n\n          const { from, to, empty } = editor.state.selection;\n\n          // Only handle when cursor is at position 1 with empty selection\n          if (from === 1 && to === 1 && empty) {\n            const firstNode = editor.state.doc.firstChild;\n\n            // If first node is a paragraph\n            if (firstNode && firstNode.type.name === \"paragraph\") {\n              // If paragraph is already empty, delete it and focus title editor\n              if (firstNode.content.size === 0) {\n                editor.commands.deleteNode(\"paragraph\");\n                // Use setTimeout to ensure the node is deleted before changing focus\n                setTimeout(() => titleEditor.commands.focus(\"end\"), 0);\n                return true;\n              }\n              // If paragraph is not empty, just move focus to title editor\n              else {\n                titleEditor.commands.focus(\"end\");\n                return true;\n              }\n            }\n          }\n          return false;\n        },\n      };\n    },\n  });\n\n/**\n * Hook to manage navigation between title and main editors\n *\n * Creates extension factories for keyboard navigation between editors\n * and maintains references to both editors\n *\n * @returns Object with editor setters and extensions\n */\nexport const useEditorNavigation = () => {\n  // Create refs to store editor instances\n  const titleEditorRef = useRef<Editor | null>(null);\n  const mainEditorRef = useRef<Editor | null>(null);\n\n  // Create stable getter functions\n  const getTitleEditor = useCallback(() => titleEditorRef.current, []);\n  const getMainEditor = useCallback(() => mainEditorRef.current, []);\n\n  // Create stable setter functions\n  const setTitleEditor = useCallback((editor: Editor | null) => {\n    titleEditorRef.current = editor;\n  }, []);\n\n  const setMainEditor = useCallback((editor: Editor | null) => {\n    mainEditorRef.current = editor;\n  }, []);\n\n  // Create extension factories that access editor refs\n  const titleNavigationExtension = createTitleNavigationExtension(getMainEditor);\n  const mainNavigationExtension = createMainNavigationExtension(getTitleEditor);\n\n  return {\n    setTitleEditor,\n    setMainEditor,\n    titleNavigationExtension,\n    mainNavigationExtension,\n  };\n};\n","import type { HocuspocusProvider } from \"@hocuspocus/provider\";\nimport type { Extensions } from \"@tiptap/core\";\nimport { Placeholder } from \"@tiptap/extension-placeholder\";\nimport { useEditor } from \"@tiptap/react\";\nimport { useImperativeHandle } from \"react\";\n// constants\nimport { CORE_EDITOR_META } from \"@/constants/meta\";\n// extensions\nimport { TitleExtensions } from \"@/extensions/title-extension\";\n// helpers\nimport { getEditorRefHelpers } from \"@/helpers/editor-ref\";\n// types\nimport type { IEditorPropsExtended, IEditorProps } from \"@/types\";\nimport type { EditorTitleRefApi, ICollaborativeDocumentEditorProps } from \"@/types/editor\";\n\ntype Props = {\n  editable?: boolean;\n  provider: HocuspocusProvider;\n  titleRef?: React.MutableRefObject<EditorTitleRefApi | null>;\n  extensions?: Extensions;\n  initialValue?: string;\n  field?: string;\n  placeholder?: string;\n  updatePageProperties?: ICollaborativeDocumentEditorProps[\"updatePageProperties\"];\n  id: string;\n  extendedEditorProps?: IEditorPropsExtended;\n  getEditorMetaData?: IEditorProps[\"getEditorMetaData\"];\n};\n\n/**\n * A hook that creates a title editor with collaboration features\n * Uses the same Y.Doc as the main editor but a different field\n */\nexport const useTitleEditor = (props: Props) => {\n  const {\n    editable = true,\n    id,\n    initialValue = \"\",\n    extensions,\n    provider,\n    updatePageProperties,\n    titleRef,\n    getEditorMetaData,\n  } = props;\n\n  // Force editor recreation when Y.Doc changes (provider.document.guid)\n  const docKey = provider?.document?.guid ?? id;\n\n  const editor = useEditor(\n    {\n      onUpdate: ({ editor }) => {\n        updatePageProperties?.(id, \"property_updated\", { name: editor?.getText() });\n      },\n      editable,\n      immediatelyRender: false,\n      shouldRerenderOnTransaction: false,\n      extensions: [\n        ...TitleExtensions,\n        ...(extensions ?? []),\n        Placeholder.configure({\n          placeholder: () => \"Untitled\",\n          includeChildren: true,\n          showOnlyWhenEditable: false,\n        }),\n      ],\n      content: typeof initialValue === \"string\" && initialValue.trim() !== \"\" ? initialValue : \"<h1></h1>\",\n    },\n    [editable, initialValue, docKey]\n  );\n\n  useImperativeHandle(titleRef, () => ({\n    ...getEditorRefHelpers({\n      editor,\n      provider,\n      getEditorMetaData: getEditorMetaData ?? (() => ({ file_assets: [], user_mentions: [] })),\n    }),\n    clearEditor: (emitUpdate = false) => {\n      editor\n        ?.chain()\n        .setMeta(CORE_EDITOR_META.SKIP_FILE_DELETION, true)\n        .setMeta(CORE_EDITOR_META.INTENTIONAL_DELETION, true)\n        .clearContent(emitUpdate)\n        .run();\n    },\n    setEditorValue: (content: string) => {\n      editor?.commands.setContent(content, false);\n    },\n  }));\n\n  return editor;\n};\n","import type { HocuspocusProvider } from \"@hocuspocus/provider\";\nimport type { Extensions } from \"@tiptap/core\";\nimport Collaboration from \"@tiptap/extension-collaboration\";\n// react\nimport type React from \"react\";\nimport { useEffect, useMemo } from \"react\";\n// extensions\nimport { HeadingListExtension, SideMenuExtension } from \"@/extensions\";\n// hooks\nimport { useEditor } from \"@/hooks/use-editor\";\n// plane editor extensions\nimport { DocumentEditorAdditionalExtensions } from \"@/plane-editor/extensions\";\n// types\nimport type {\n  TCollaborativeEditorHookProps,\n  ICollaborativeDocumentEditorProps,\n  IEditorPropsExtended,\n  IEditorProps,\n  TEditorHookProps,\n  EditorTitleRefApi,\n} from \"@/types\";\n// local imports\nimport { useEditorNavigation } from \"./use-editor-navigation\";\nimport { useTitleEditor } from \"./use-title-editor\";\n\ntype UseCollaborativeEditorArgs = Omit<TCollaborativeEditorHookProps, \"realtimeConfig\" | \"serverHandler\" | \"user\"> & {\n  provider: HocuspocusProvider;\n  user: TCollaborativeEditorHookProps[\"user\"];\n  actions: {\n    signalForcedClose: (value: boolean) => void;\n  };\n};\n\nexport const useCollaborativeEditor = (props: UseCollaborativeEditorArgs) => {\n  const {\n    provider,\n    onAssetChange,\n    onChange,\n    onTransaction,\n    disabledExtensions,\n    editable,\n    editorClassName = \"\",\n    editorProps = {},\n    extendedEditorProps,\n    extensions = [],\n    fileHandler,\n    flaggedExtensions,\n    forwardedRef,\n    getEditorMetaData,\n    handleEditorReady,\n    id,\n    mentionHandler,\n    dragDropEnabled = true,\n    isTouchDevice,\n    onEditorFocus,\n    placeholder,\n    showPlaceholderOnEmpty,\n    tabIndex,\n    titleRef,\n    updatePageProperties,\n    user,\n    actions,\n  } = props;\n\n  const { mainNavigationExtension, titleNavigationExtension, setMainEditor, setTitleEditor } = useEditorNavigation();\n\n  // Memoize extensions to avoid unnecessary editor recreations\n  const editorExtensions = useMemo(\n    () => [\n      SideMenuExtension({\n        aiEnabled: !disabledExtensions?.includes(\"ai\"),\n        dragDropEnabled,\n      }),\n      HeadingListExtension,\n      Collaboration.configure({\n        document: provider.document,\n        field: \"default\",\n      }),\n      ...extensions,\n      ...DocumentEditorAdditionalExtensions({\n        disabledExtensions,\n        extendedEditorProps,\n        fileHandler,\n        flaggedExtensions,\n        isEditable: editable,\n        provider,\n        userDetails: user,\n      }),\n      mainNavigationExtension,\n    ],\n    [\n      provider,\n      disabledExtensions,\n      dragDropEnabled,\n      extensions,\n      extendedEditorProps,\n      fileHandler,\n      flaggedExtensions,\n      editable,\n      user,\n      mainNavigationExtension,\n    ]\n  );\n\n  // Editor configuration\n  const editorConfig = useMemo<TEditorHookProps>(\n    () => ({\n      disabledExtensions,\n      extendedEditorProps,\n      id,\n      editable,\n      editorProps,\n      editorClassName,\n      enableHistory: false,\n      extensions: editorExtensions,\n      fileHandler,\n      flaggedExtensions,\n      forwardedRef,\n      getEditorMetaData,\n      handleEditorReady,\n      isTouchDevice,\n      mentionHandler,\n      onAssetChange,\n      onChange,\n      onEditorFocus,\n      onTransaction,\n      placeholder,\n      showPlaceholderOnEmpty,\n      provider,\n      tabIndex,\n    }),\n    [\n      provider,\n      disabledExtensions,\n      extendedEditorProps,\n      id,\n      editable,\n      editorProps,\n      editorClassName,\n      editorExtensions,\n      fileHandler,\n      flaggedExtensions,\n      forwardedRef,\n      getEditorMetaData,\n      handleEditorReady,\n      isTouchDevice,\n      mentionHandler,\n      onAssetChange,\n      onChange,\n      onEditorFocus,\n      onTransaction,\n      placeholder,\n      showPlaceholderOnEmpty,\n      tabIndex,\n    ]\n  );\n\n  const editor = useEditor(editorConfig);\n\n  const titleExtensions = useMemo(\n    () => [\n      Collaboration.configure({\n        document: provider.document,\n        field: \"title\",\n      }),\n      titleNavigationExtension,\n    ],\n    [provider, titleNavigationExtension]\n  );\n\n  const titleEditorConfig = useMemo<{\n    id: string;\n    editable: boolean;\n    provider: HocuspocusProvider;\n    titleRef?: React.MutableRefObject<EditorTitleRefApi | null>;\n    updatePageProperties?: ICollaborativeDocumentEditorProps[\"updatePageProperties\"];\n    extensions: Extensions;\n    extendedEditorProps?: IEditorPropsExtended;\n    getEditorMetaData?: IEditorProps[\"getEditorMetaData\"];\n  }>(\n    () => ({\n      id,\n      editable,\n      provider,\n      titleRef,\n      updatePageProperties,\n      extensions: titleExtensions,\n      extendedEditorProps,\n      getEditorMetaData,\n    }),\n    [provider, id, editable, titleRef, updatePageProperties, titleExtensions, extendedEditorProps, getEditorMetaData]\n  );\n\n  const titleEditor = useTitleEditor(titleEditorConfig as Parameters<typeof useTitleEditor>[0]);\n\n  useEffect(() => {\n    if (editor && titleEditor) {\n      setMainEditor(editor);\n      setTitleEditor(titleEditor);\n    }\n  }, [editor, titleEditor, setMainEditor, setTitleEditor]);\n\n  return {\n    editor,\n    titleEditor,\n  };\n};\n","import React, { useMemo } from \"react\";\n// plane imports\nimport { cn } from \"@plane/utils\";\n// components\nimport { PageRenderer } from \"@/components/editors\";\n// constants\nimport { DEFAULT_DISPLAY_CONFIG } from \"@/constants/config\";\n// contexts\nimport { CollaborationProvider, useCollaboration } from \"@/contexts/collaboration-context\";\n// helpers\nimport { getEditorClassNames } from \"@/helpers/common\";\n// hooks\nimport { useCollaborativeEditor } from \"@/hooks/use-collaborative-editor\";\n// types\nimport type { EditorRefApi, ICollaborativeDocumentEditorProps } from \"@/types\";\n\n// Inner component that has access to collaboration context\nconst CollaborativeDocumentEditorInner: React.FC<ICollaborativeDocumentEditorProps> = (props) => {\n  const {\n    aiHandler,\n    bubbleMenuEnabled = true,\n    containerClassName,\n    documentLoaderClassName,\n    extensions = [],\n    disabledExtensions,\n    displayConfig = DEFAULT_DISPLAY_CONFIG,\n    editable,\n    editorClassName = \"\",\n    editorProps,\n    extendedEditorProps,\n    fileHandler,\n    flaggedExtensions,\n    forwardedRef,\n    getEditorMetaData,\n    handleEditorReady,\n    id,\n    dragDropEnabled = true,\n    isTouchDevice,\n    mentionHandler,\n    onAssetChange,\n    onChange,\n    onEditorFocus,\n    onTransaction,\n    placeholder,\n    tabIndex,\n    user,\n    extendedDocumentEditorProps,\n    titleRef,\n    updatePageProperties,\n    isFetchingFallbackBinary,\n  } = props;\n\n  // Get non-null provider from context\n  const { provider, state, actions } = useCollaboration();\n\n  // Editor initialization with guaranteed non-null provider\n  const { editor, titleEditor } = useCollaborativeEditor({\n    provider,\n    disabledExtensions,\n    editable,\n    editorClassName,\n    editorProps,\n    extendedEditorProps,\n    extensions,\n    fileHandler,\n    flaggedExtensions,\n    getEditorMetaData,\n    forwardedRef,\n    handleEditorReady,\n    id,\n    dragDropEnabled,\n    isTouchDevice,\n    mentionHandler,\n    onAssetChange,\n    onChange,\n    onEditorFocus,\n    onTransaction,\n    placeholder,\n    tabIndex,\n    titleRef,\n    updatePageProperties,\n    user,\n    actions,\n  });\n\n  const editorContainerClassNames = getEditorClassNames({\n    noBorder: true,\n    borderOnFocus: false,\n    containerClassName,\n  });\n\n  // Show loader ONLY when cache is known empty and server hasn't synced yet\n  const shouldShowSyncLoader = state.isCacheReady && !state.hasCachedContent && !state.isServerSynced;\n  const shouldWaitForFallbackBinary = isFetchingFallbackBinary && !state.hasCachedContent && state.isServerDisconnected;\n  const isLoading = shouldShowSyncLoader || shouldWaitForFallbackBinary;\n\n  // Gate content rendering on isDocReady to prevent empty editor flash\n  const showContentSkeleton = !state.isDocReady;\n\n  if (!editor || !titleEditor) return null;\n\n  return (\n    <>\n      <div\n        className={cn(\n          \"transition-opacity duration-200\",\n          showContentSkeleton && !isLoading && \"opacity-0 pointer-events-none\"\n        )}\n      >\n        <PageRenderer\n          aiHandler={aiHandler}\n          bubbleMenuEnabled={bubbleMenuEnabled}\n          displayConfig={displayConfig}\n          documentLoaderClassName={documentLoaderClassName}\n          disabledExtensions={disabledExtensions}\n          extendedDocumentEditorProps={extendedDocumentEditorProps}\n          editor={editor}\n          flaggedExtensions={flaggedExtensions}\n          titleEditor={titleEditor}\n          editorContainerClassName={cn(editorContainerClassNames, \"document-editor\")}\n          extendedEditorProps={extendedEditorProps}\n          id={id}\n          isLoading={isLoading}\n          isTouchDevice={!!isTouchDevice}\n          tabIndex={tabIndex}\n          provider={provider}\n          state={state}\n        />\n      </div>\n    </>\n  );\n};\n\n// Outer component that provides collaboration context\nconst CollaborativeDocumentEditor: React.FC<ICollaborativeDocumentEditorProps> = (props) => {\n  const { id, realtimeConfig, serverHandler, user } = props;\n\n  const token = useMemo(() => JSON.stringify(user), [user]);\n\n  return (\n    <CollaborationProvider\n      docId={id}\n      serverUrl={realtimeConfig.url}\n      authToken={token}\n      onStateChange={serverHandler?.onStateChange}\n    >\n      <CollaborativeDocumentEditorInner {...props} />\n    </CollaborationProvider>\n  );\n};\n\nconst CollaborativeDocumentEditorWithRef = React.forwardRef<EditorRefApi, ICollaborativeDocumentEditorProps>(\n  (props, ref) => (\n    <CollaborativeDocumentEditor key={props.id} {...props} forwardedRef={ref as React.MutableRefObject<EditorRefApi>} />\n  )\n);\n\nCollaborativeDocumentEditorWithRef.displayName = \"CollaborativeDocumentEditorWithRef\";\n\nexport { CollaborativeDocumentEditorWithRef };\n","import type { Extensions } from \"@tiptap/core\";\nimport type { MutableRefObject } from \"react\";\nimport { forwardRef, useMemo } from \"react\";\n// plane imports\nimport { cn } from \"@plane/utils\";\n// components\nimport { PageRenderer } from \"@/components/editors\";\n// constants\nimport { DEFAULT_DISPLAY_CONFIG } from \"@/constants/config\";\n// extensions\nimport { HeadingListExtension, SideMenuExtension } from \"@/extensions\";\n// helpers\nimport { getEditorClassNames } from \"@/helpers/common\";\n// hooks\nimport { useEditor } from \"@/hooks/use-editor\";\n// plane editor extensions\nimport { DocumentEditorAdditionalExtensions } from \"@/plane-editor/extensions\";\n// types\nimport type { EditorRefApi, IDocumentEditorProps } from \"@/types\";\n\nfunction DocumentEditor(props: IDocumentEditorProps) {\n  const {\n    bubbleMenuEnabled = false,\n    containerClassName,\n    disabledExtensions,\n    displayConfig = DEFAULT_DISPLAY_CONFIG,\n    editable,\n    editorClassName = \"\",\n    extendedEditorProps,\n    fileHandler,\n    flaggedExtensions,\n    forwardedRef,\n    getEditorMetaData,\n    handleEditorReady,\n    id,\n    isTouchDevice,\n    mentionHandler,\n    onChange,\n    user,\n    value,\n  } = props;\n  const extensions: Extensions = useMemo(() => {\n    const additionalExtensions: Extensions = [];\n    additionalExtensions.push(\n      SideMenuExtension({\n        aiEnabled: !disabledExtensions?.includes(\"ai\"),\n        dragDropEnabled: true,\n      }),\n      HeadingListExtension,\n      ...DocumentEditorAdditionalExtensions({\n        disabledExtensions,\n        extendedEditorProps,\n        flaggedExtensions,\n        isEditable: editable,\n        fileHandler,\n        userDetails: user ?? {\n          id: \"\",\n          name: \"\",\n          color: \"\",\n        },\n      })\n    );\n    return additionalExtensions;\n  }, [disabledExtensions, editable, extendedEditorProps, fileHandler, flaggedExtensions, user]);\n\n  const editor = useEditor({\n    disabledExtensions,\n    editable,\n    editorClassName,\n    enableHistory: true,\n    extendedEditorProps,\n    extensions,\n    fileHandler,\n    flaggedExtensions,\n    forwardedRef,\n    getEditorMetaData,\n    handleEditorReady,\n    id,\n    initialValue: value,\n    mentionHandler,\n    onChange,\n  });\n\n  const editorContainerClassName = getEditorClassNames({\n    containerClassName,\n  });\n\n  if (!editor) return null;\n\n  return (\n    <PageRenderer\n      bubbleMenuEnabled={bubbleMenuEnabled}\n      displayConfig={displayConfig}\n      editor={editor}\n      editorContainerClassName={cn(editorContainerClassName, \"document-editor\")}\n      extendedEditorProps={extendedEditorProps}\n      id={id}\n      flaggedExtensions={flaggedExtensions}\n      disabledExtensions={disabledExtensions}\n      isTouchDevice={!!isTouchDevice}\n    />\n  );\n}\n\nconst DocumentEditorWithRef = forwardRef(function DocumentEditorWithRef(\n  props: IDocumentEditorProps,\n  ref: React.ForwardedRef<EditorRefApi>\n) {\n  return <DocumentEditor {...props} forwardedRef={ref as MutableRefObject<EditorRefApi | null>} />;\n});\n\nDocumentEditorWithRef.displayName = \"DocumentEditorWithRef\";\n\nexport { DocumentEditorWithRef };\n","// plane imports\nimport { Loader } from \"@plane/ui\";\nimport { cn } from \"@plane/utils\";\n\ntype Props = {\n  className?: string;\n};\n\nexport function DocumentContentLoader(props: Props) {\n  const { className } = props;\n\n  return (\n    <div className={cn(\"document-editor-loader\", className)}>\n      <Loader className=\"relative space-y-4\">\n        <div className=\"space-y-2\">\n          <div className=\"py-2\">\n            <Loader.Item width=\"100%\" height=\"36px\" />\n          </div>\n          <Loader.Item width=\"80%\" height=\"22px\" />\n          <div className=\"relative flex items-center gap-2\">\n            <Loader.Item width=\"30px\" height=\"30px\" />\n            <Loader.Item width=\"30%\" height=\"22px\" />\n          </div>\n          <div className=\"py-2\">\n            <Loader.Item width=\"60%\" height=\"36px\" />\n          </div>\n          <Loader.Item width=\"70%\" height=\"22px\" />\n          <Loader.Item width=\"30%\" height=\"22px\" />\n          <div className=\"relative flex items-center gap-2\">\n            <Loader.Item width=\"30px\" height=\"30px\" />\n            <Loader.Item width=\"30%\" height=\"22px\" />\n          </div>\n          <div className=\"py-2\">\n            <Loader.Item width=\"50%\" height=\"30px\" />\n          </div>\n          <Loader.Item width=\"100%\" height=\"22px\" />\n          <div className=\"py-2\">\n            <Loader.Item width=\"30%\" height=\"30px\" />\n          </div>\n          <Loader.Item width=\"30%\" height=\"22px\" />\n          <div className=\"relative flex items-center gap-2\">\n            <div className=\"py-2\">\n              <Loader.Item width=\"30px\" height=\"30px\" />\n            </div>\n            <Loader.Item width=\"30%\" height=\"22px\" />\n          </div>\n        </div>\n      </Loader>\n    </div>\n  );\n}\n","import type { HocuspocusProvider } from \"@hocuspocus/provider\";\nimport type { Editor } from \"@tiptap/react\";\n// plane imports\nimport { cn } from \"@plane/utils\";\n// components\nimport { DocumentContentLoader, EditorContainer, EditorContentWrapper } from \"@/components/editors\";\nimport { BlockMenu, EditorBubbleMenu } from \"@/components/menus\";\n// types\nimport type { TCollabValue } from \"@/contexts\";\nimport type {\n  ICollaborativeDocumentEditorPropsExtended,\n  IEditorProps,\n  IEditorPropsExtended,\n  TAIHandler,\n  TDisplayConfig,\n} from \"@/types\";\n\ntype Props = {\n  aiHandler?: TAIHandler;\n  bubbleMenuEnabled: boolean;\n  disabledExtensions: IEditorProps[\"disabledExtensions\"];\n  displayConfig: TDisplayConfig;\n  documentLoaderClassName?: string;\n  editor: Editor;\n  titleEditor?: Editor;\n  editorContainerClassName: string;\n  extendedDocumentEditorProps?: ICollaborativeDocumentEditorPropsExtended;\n  extendedEditorProps: IEditorPropsExtended;\n  flaggedExtensions: IEditorProps[\"flaggedExtensions\"];\n  id: string;\n  isLoading?: boolean;\n  isTouchDevice: boolean;\n  tabIndex?: number;\n  provider?: HocuspocusProvider;\n  state?: TCollabValue[\"state\"];\n};\n\nexport function PageRenderer(props: Props) {\n  const {\n    bubbleMenuEnabled,\n    disabledExtensions,\n    displayConfig,\n    documentLoaderClassName,\n    editor,\n    editorContainerClassName,\n    extendedEditorProps,\n    flaggedExtensions,\n    id,\n    isLoading,\n    isTouchDevice,\n    tabIndex,\n    titleEditor,\n    provider,\n    state,\n  } = props;\n  return (\n    <div\n      className={cn(\"frame-renderer flex-grow w-full\", {\n        \"wide-layout\": displayConfig.wideLayout,\n      })}\n    >\n      {isLoading ? (\n        <DocumentContentLoader className={documentLoaderClassName} />\n      ) : (\n        <>\n          {titleEditor && (\n            <div className=\"relative w-full py-3\">\n              <EditorContainer\n                editor={titleEditor}\n                id={id + \"-title\"}\n                isTouchDevice={isTouchDevice}\n                editorContainerClassName=\"page-title-editor bg-transparent py-3 border-none\"\n                displayConfig={displayConfig}\n              >\n                <EditorContentWrapper\n                  editor={titleEditor}\n                  id={id + \"-title\"}\n                  tabIndex={tabIndex}\n                  className=\"no-scrollbar placeholder-custom-text-400 bg-transparent tracking-[-2%] font-bold text-[2rem] leading-[2.375rem] w-full outline-none p-0 border-none resize-none rounded-none\"\n                />\n              </EditorContainer>\n            </div>\n          )}\n          <EditorContainer\n            displayConfig={displayConfig}\n            editor={editor}\n            editorContainerClassName={editorContainerClassName}\n            id={id}\n            isTouchDevice={isTouchDevice}\n            provider={provider}\n            state={state}\n          >\n            <EditorContentWrapper editor={editor} id={id} tabIndex={tabIndex} />\n            {editor.isEditable && !isTouchDevice && (\n              <div>\n                {bubbleMenuEnabled && (\n                  <EditorBubbleMenu\n                    editor={editor}\n                    disabledExtensions={disabledExtensions}\n                    extendedEditorProps={extendedEditorProps}\n                    flaggedExtensions={flaggedExtensions}\n                  />\n                )}\n                <BlockMenu\n                  editor={editor}\n                  flaggedExtensions={flaggedExtensions}\n                  disabledExtensions={disabledExtensions}\n                />\n              </div>\n            )}\n          </EditorContainer>\n        </>\n      )}\n    </div>\n  );\n}\n","import { EditorContent } from \"@tiptap/react\";\nimport type { Editor } from \"@tiptap/react\";\nimport type { FC, ReactNode } from \"react\";\n\ntype Props = {\n  className?: string;\n  children?: ReactNode;\n  editor: Editor | null;\n  id: string;\n  tabIndex?: number;\n};\n\nexport const EditorContentWrapper: FC<Props> = (props) => {\n  const { editor, className, children, tabIndex, id } = props;\n\n  return (\n    <div\n      tabIndex={tabIndex}\n      onFocus={() => editor?.chain().focus(undefined, { scrollIntoView: false }).run()}\n      className={className}\n    >\n      <EditorContent editor={editor} id={id} />\n      {children}\n    </div>\n  );\n};\n","import type { Editor, Extensions } from \"@tiptap/core\";\n// components\nimport { EditorContainer } from \"@/components/editors\";\n// constants\nimport { DEFAULT_DISPLAY_CONFIG } from \"@/constants/config\";\n// hooks\nimport { getEditorClassNames } from \"@/helpers/common\";\nimport { useEditor } from \"@/hooks/use-editor\";\n// types\nimport type { IEditorProps } from \"@/types\";\nimport { EditorContentWrapper } from \"./editor-content\";\n\ntype Props = IEditorProps & {\n  children?: (editor: Editor) => React.ReactNode;\n  editable: boolean;\n  extensions: Extensions;\n};\n\nexport function EditorWrapper(props: Props) {\n  const {\n    children,\n    containerClassName,\n    disabledExtensions,\n    displayConfig = DEFAULT_DISPLAY_CONFIG,\n    editable,\n    editorClassName = \"\",\n    editorProps,\n    extendedEditorProps,\n    extensions,\n    getEditorMetaData,\n    id,\n    initialValue,\n    isTouchDevice,\n    fileHandler,\n    flaggedExtensions,\n    forwardedRef,\n    mentionHandler,\n    onChange,\n    onEditorFocus,\n    onTransaction,\n    handleEditorReady,\n    autofocus,\n    placeholder,\n    showPlaceholderOnEmpty,\n    tabIndex,\n    value,\n  } = props;\n\n  const editor = useEditor({\n    editable,\n    disabledExtensions,\n    editorClassName,\n    editorProps,\n    enableHistory: true,\n    extendedEditorProps,\n    extensions,\n    fileHandler,\n    flaggedExtensions,\n    forwardedRef,\n    getEditorMetaData,\n    id,\n    isTouchDevice,\n    initialValue,\n    mentionHandler,\n    onChange,\n    onEditorFocus,\n    onTransaction,\n    handleEditorReady,\n    autofocus,\n    placeholder,\n    showPlaceholderOnEmpty,\n    tabIndex,\n    value,\n  });\n\n  const editorContainerClassName = getEditorClassNames({\n    noBorder: true,\n    borderOnFocus: false,\n    containerClassName,\n  });\n\n  if (!editor) return null;\n\n  return (\n    <EditorContainer\n      displayConfig={displayConfig}\n      editor={editor}\n      editorContainerClassName={editorContainerClassName}\n      id={id}\n      isTouchDevice={!!isTouchDevice}\n    >\n      {children?.(editor)}\n      <div className=\"flex flex-col\">\n        <EditorContentWrapper editor={editor} id={id} tabIndex={tabIndex} />\n      </div>\n    </EditorContainer>\n  );\n}\n","import { forwardRef, useMemo } from \"react\";\n// components\nimport { EditorWrapper } from \"@/components/editors/editor-wrapper\";\n// extensions\nimport { EnterKeyExtension } from \"@/extensions\";\n// types\nimport type { EditorRefApi, ILiteTextEditorProps } from \"@/types\";\n\nfunction LiteTextEditor(props: ILiteTextEditorProps) {\n  const { onEnterKeyPress, disabledExtensions, extensions: externalExtensions = [] } = props;\n\n  const extensions = useMemo(() => {\n    const resolvedExtensions = [...externalExtensions];\n\n    if (!disabledExtensions?.includes(\"enter-key\")) {\n      resolvedExtensions.push(EnterKeyExtension(onEnterKeyPress));\n    }\n\n    return resolvedExtensions;\n  }, [externalExtensions, disabledExtensions, onEnterKeyPress]);\n\n  return <EditorWrapper {...props} extensions={extensions} />;\n}\n\nconst LiteTextEditorWithRef = forwardRef(function LiteTextEditorWithRef(\n  props: ILiteTextEditorProps,\n  ref: React.ForwardedRef<EditorRefApi>\n) {\n  return <LiteTextEditor {...props} forwardedRef={ref as React.MutableRefObject<EditorRefApi | null>} />;\n});\n\nLiteTextEditorWithRef.displayName = \"LiteTextEditorWithRef\";\n\nexport { LiteTextEditorWithRef };\n","import type { AnyExtension, Extensions } from \"@tiptap/core\";\n// extensions\nimport { SlashCommands } from \"@/extensions/slash-commands/root\";\n// types\nimport type { IEditorProps, TExtensions } from \"@/types\";\n\nexport type TRichTextEditorAdditionalExtensionsProps = Pick<\n  IEditorProps,\n  \"disabledExtensions\" | \"flaggedExtensions\" | \"fileHandler\" | \"extendedEditorProps\"\n>;\n\n/**\n * Registry entry configuration for extensions\n */\nexport type TRichTextEditorAdditionalExtensionsRegistry = {\n  /** Determines if the extension should be enabled based on disabled extensions */\n  isEnabled: (disabledExtensions: TExtensions[], flaggedExtensions: TExtensions[]) => boolean;\n  /** Returns the extension instance(s) when enabled */\n  getExtension: (props: TRichTextEditorAdditionalExtensionsProps) => AnyExtension | undefined;\n};\n\nconst extensionRegistry: TRichTextEditorAdditionalExtensionsRegistry[] = [\n  {\n    isEnabled: (disabledExtensions) => !disabledExtensions.includes(\"slash-commands\"),\n    getExtension: ({ disabledExtensions, flaggedExtensions }) =>\n      SlashCommands({\n        disabledExtensions,\n        flaggedExtensions,\n      }),\n  },\n];\n\nexport function RichTextEditorAdditionalExtensions(props: TRichTextEditorAdditionalExtensionsProps) {\n  const { disabledExtensions, flaggedExtensions } = props;\n\n  const extensions: Extensions = extensionRegistry\n    .filter((config) => config.isEnabled(disabledExtensions, flaggedExtensions))\n    .map((config) => config.getExtension(props))\n    .filter((extension): extension is AnyExtension => extension !== undefined);\n\n  return extensions;\n}\n","import { forwardRef, useCallback } from \"react\";\n// components\nimport { EditorWrapper } from \"@/components/editors\";\nimport { BlockMenu, EditorBubbleMenu } from \"@/components/menus\";\n// extensions\nimport { SideMenuExtension } from \"@/extensions\";\n// plane editor imports\nimport { RichTextEditorAdditionalExtensions } from \"@/plane-editor/extensions/rich-text-extensions\";\n// types\nimport type { EditorRefApi, IRichTextEditorProps } from \"@/types\";\n\nfunction RichTextEditor(props: IRichTextEditorProps) {\n  const {\n    bubbleMenuEnabled = true,\n    disabledExtensions,\n    dragDropEnabled,\n    extensions: externalExtensions = [],\n    fileHandler,\n    flaggedExtensions,\n    extendedEditorProps,\n    workItemIdentifier,\n  } = props;\n\n  const getExtensions = useCallback(() => {\n    const extensions = [\n      ...externalExtensions,\n      SideMenuExtension({\n        aiEnabled: false,\n        dragDropEnabled: !!dragDropEnabled,\n      }),\n      ...RichTextEditorAdditionalExtensions({\n        disabledExtensions,\n        fileHandler,\n        flaggedExtensions,\n        extendedEditorProps,\n      }),\n    ];\n\n    return extensions;\n  }, [dragDropEnabled, disabledExtensions, externalExtensions, fileHandler, flaggedExtensions, extendedEditorProps]);\n\n  return (\n    <EditorWrapper {...props} extensions={getExtensions()}>\n      {(editor) => (\n        <>\n          {editor && bubbleMenuEnabled && (\n            <EditorBubbleMenu\n              disabledExtensions={disabledExtensions}\n              editor={editor}\n              extendedEditorProps={extendedEditorProps}\n              flaggedExtensions={flaggedExtensions}\n            />\n          )}\n          <BlockMenu\n            editor={editor}\n            flaggedExtensions={flaggedExtensions}\n            disabledExtensions={disabledExtensions}\n            workItemIdentifier={workItemIdentifier}\n          />\n        </>\n      )}\n    </EditorWrapper>\n  );\n}\n\nconst RichTextEditorWithRef = forwardRef(function RichTextEditorWithRef(\n  props: IRichTextEditorProps,\n  ref: React.ForwardedRef<EditorRefApi>\n) {\n  return <RichTextEditor {...props} forwardedRef={ref as React.MutableRefObject<EditorRefApi | null>} />;\n});\n\nRichTextEditorWithRef.displayName = \"RichTextEditorWithRef\";\n\nexport { RichTextEditorWithRef };\n","import type { Node } from \"@tiptap/pm/model\";\nimport { Link2Off } from \"lucide-react\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\n// components\nimport type { LinkViewProps, LinkViews } from \"@/components/links\";\n// helpers\nimport { isValidHttpUrl } from \"@/helpers/common\";\n\ntype InputViewProps = {\n  label: string;\n  value: string;\n  placeholder: string;\n  onChange: (value: string) => void;\n  autoFocus?: boolean;\n};\n\nfunction InputView({ label, value, placeholder, onChange, autoFocus }: InputViewProps) {\n  return (\n    <div className=\"flex flex-col gap-1\">\n      <label className=\"inline-block font-semibold text-xs text-custom-text-400\">{label}</label>\n      <input\n        placeholder={placeholder}\n        onClick={(e) => e.stopPropagation()}\n        className=\"w-[280px] outline-none bg-custom-background-90 text-custom-text-900 text-sm border border-custom-border-300 rounded-md p-2\"\n        value={value}\n        onChange={(e) => onChange(e.target.value)}\n        autoFocus={autoFocus}\n      />\n    </div>\n  );\n}\n\ntype LinkEditViewProps = {\n  viewProps: LinkViewProps;\n  switchView: (view: LinkViews) => void;\n};\n\nexport function LinkEditView({ viewProps }: LinkEditViewProps) {\n  const { editor, from, to, url: initialUrl, text: initialText, closeLinkView } = viewProps;\n\n  // State\n  const [positionRef] = useState({ from, to });\n  const [localUrl, setLocalUrl] = useState(initialUrl);\n  const [localText, setLocalText] = useState(initialText ?? \"\");\n  const [linkRemoved, setLinkRemoved] = useState(false);\n  const hasSubmitted = useRef(false);\n\n  const removeLink = useCallback(() => {\n    editor.view.dispatch(editor.state.tr.removeMark(from, to, editor.schema.marks.link));\n    setLinkRemoved(true);\n    closeLinkView();\n  }, [editor, from, to, closeLinkView]);\n\n  // Effects\n  useEffect(\n    () =>\n      // Cleanup effect: Remove link if not submitted and url is empty\n      () => {\n        if (!hasSubmitted.current && !linkRemoved && initialUrl === \"\") {\n          try {\n            removeLink();\n          } catch (e) {\n            console.error(\"Error removing link\", e);\n          }\n        }\n      },\n    [removeLink, linkRemoved, initialUrl]\n  );\n\n  // Sync state with props\n  useEffect(() => {\n    setLocalUrl(initialUrl);\n  }, [initialUrl]);\n\n  useEffect(() => {\n    if (initialText) setLocalText(initialText);\n  }, [initialText]);\n\n  // Handlers\n  const handleTextChange = useCallback((value: string) => {\n    if (value.trim() !== \"\") setLocalText(value);\n  }, []);\n\n  const applyChanges = useCallback((): boolean => {\n    if (linkRemoved) return false;\n    hasSubmitted.current = true;\n\n    const { url, isValid } = isValidHttpUrl(localUrl);\n    if (to >= editor.state.doc.content.size || !isValid) return false;\n\n    // Apply URL change\n    const tr = editor.state.tr;\n    tr.removeMark(from, to, editor.schema.marks.link).addMark(from, to, editor.schema.marks.link.create({ href: url }));\n    editor.view.dispatch(tr);\n\n    // Apply text change if different\n    if (localText !== initialText) {\n      const node = editor.view.state.doc.nodeAt(from) as Node;\n      if (!node || !node.marks) return false;\n\n      editor\n        .chain()\n        .setTextSelection(from)\n        .deleteRange({ from: positionRef.from, to: positionRef.to })\n        .insertContent(localText)\n        .setTextSelection({ from, to: from + localText.length })\n        .run();\n      //\n      // Restore marks\n      node.marks.forEach((mark) => {\n        editor.chain().setMark(mark.type.name, mark.attrs).run();\n      });\n    }\n\n    return true;\n  }, [linkRemoved, positionRef, editor, from, to, initialText, localText, localUrl]);\n\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      if (e.key === \"Enter\") {\n        e.stopPropagation();\n        if (applyChanges()) {\n          closeLinkView();\n          setLocalUrl(\"\");\n          setLocalText(\"\");\n        }\n      }\n    },\n    [applyChanges, closeLinkView]\n  );\n\n  return (\n    <div\n      onKeyDown={handleKeyDown}\n      className=\"shadow-md rounded p-2 flex flex-col gap-3 bg-custom-background-90 border-custom-border-100 border-2 animate-in fade-in translate-y-1\"\n      style={{\n        transition: \"all 0.1s cubic-bezier(.55, .085, .68, .53)\",\n      }}\n      tabIndex={0}\n    >\n      <InputView label=\"URL\" placeholder=\"Enter or paste URL\" value={localUrl} onChange={setLocalUrl} autoFocus />\n      <InputView label=\"Text\" placeholder=\"Enter Text to display\" value={localText} onChange={handleTextChange} />\n      <div className=\"mb-1 bg-custom-border-300 h-[1px] w-full gap-2\" />\n      <div className=\"flex text-sm text-custom-text-800 gap-2 items-center\">\n        <Link2Off size={14} className=\"inline-block\" />\n        <button onClick={removeLink} className=\"cursor-pointer hover:text-custom-text-400 transition-colors\">\n          Remove Link\n        </button>\n      </div>\n    </div>\n  );\n}\n","import { Copy, GlobeIcon, Link2Off, PencilIcon } from \"lucide-react\";\n// components\nimport type { LinkViewProps, LinkViews } from \"@/components/links\";\n\nexport function LinkPreview({\n  viewProps,\n  switchView,\n}: {\n  viewProps: LinkViewProps;\n  switchView: (view: LinkViews) => void;\n}) {\n  const { editor, from, to, url } = viewProps;\n\n  const removeLink = () => {\n    editor.view.dispatch(editor.state.tr.removeMark(from, to, editor.schema.marks.link));\n    viewProps.closeLinkView();\n  };\n\n  const copyLinkToClipboard = () => {\n    navigator.clipboard.writeText(url);\n    viewProps.closeLinkView();\n  };\n\n  return (\n    <div\n      className=\"absolute left-0 top-0 max-w-max animate-in fade-in translate-y-1\"\n      style={{\n        transition: \"all 0.2s cubic-bezier(.55, .085, .68, .53)\",\n      }}\n    >\n      <div className=\"shadow-md items-center rounded p-2 flex gap-3 bg-custom-background-90 border-custom-border-100 border-2 text-custom-text-300 text-xs\">\n        <GlobeIcon size={14} className=\"inline-block\" />\n        <p>{url?.length > 40 ? url.slice(0, 40) + \"...\" : url}</p>\n        <div className=\"flex gap-2\">\n          <button onClick={copyLinkToClipboard} className=\"cursor-pointer hover:text-custom-text-100 transition-colors\">\n            <Copy size={14} className=\"inline-block\" />\n          </button>\n          {editor.isEditable && (\n            <>\n              <button\n                onClick={() => switchView(\"LinkEditView\")}\n                className=\"cursor-pointer hover:text-custom-text-100 transition-colors\"\n              >\n                <PencilIcon size={14} className=\"inline-block\" />\n              </button>\n              <button onClick={removeLink} className=\"cursor-pointer hover:text-custom-text-100 transition-colors\">\n                <Link2Off size={14} className=\"inline-block\" />\n              </button>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import type { Editor } from \"@tiptap/react\";\nimport type { CSSProperties } from \"react\";\nimport { useEffect, useState } from \"react\";\n// components\nimport { LinkEditView, LinkPreview } from \"@/components/links\";\n\nexport type LinkViews = \"LinkPreview\" | \"LinkEditView\";\n\nexport type LinkViewProps = {\n  view?: LinkViews;\n  editor: Editor;\n  from: number;\n  to: number;\n  url: string;\n  text?: string;\n  closeLinkView: () => void;\n};\n\nexport function LinkView(props: LinkViewProps & { style: CSSProperties }) {\n  const [currentView, setCurrentView] = useState<LinkViews>(props.view ?? \"LinkPreview\");\n  const [prevFrom, setPrevFrom] = useState(props.from);\n\n  const switchView = (view: LinkViews) => {\n    setCurrentView(view);\n  };\n\n  useEffect(() => {\n    if (props.from !== prevFrom) {\n      setCurrentView(\"LinkPreview\");\n      setPrevFrom(props.from);\n    }\n  }, [prevFrom, props.from]);\n\n  return (\n    <>\n      {currentView === \"LinkPreview\" && <LinkPreview viewProps={props} switchView={switchView} />}\n      {currentView === \"LinkEditView\" && <LinkEditView viewProps={props} switchView={switchView} />}\n    </>\n  );\n}\n","import { autoUpdate, flip, hide, shift, useDismiss, useFloating, useInteractions } from \"@floating-ui/react\";\nimport type { Editor } from \"@tiptap/react\";\nimport { useEditorState } from \"@tiptap/react\";\nimport type { FC } from \"react\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\n\n// components\nimport type { LinkViewProps } from \"@/components/links\";\nimport { LinkView } from \"@/components/links\";\n\ntype Props = {\n  editor: Editor;\n  containerRef: React.RefObject<HTMLDivElement>;\n};\n\nexport function LinkViewContainer({ editor, containerRef }: Props) {\n  const [linkViewProps, setLinkViewProps] = useState<LinkViewProps>();\n  const [isOpen, setIsOpen] = useState(false);\n  const [virtualElement, setVirtualElement] = useState<Element | null>(null);\n  const hoverTimeoutRef = useRef<number | null>(null);\n\n  const editorState = useEditorState({\n    editor,\n    selector: ({ editor }: { editor: Editor }) => ({\n      linkExtensionStorage: editor.storage.link,\n    }),\n  });\n\n  const { refs, floatingStyles, context } = useFloating({\n    open: isOpen,\n    onOpenChange: setIsOpen,\n    elements: {\n      reference: virtualElement,\n    },\n    middleware: [\n      flip({\n        fallbackPlacements: [\"top\", \"bottom\"],\n      }),\n      shift({\n        padding: 5,\n      }),\n      hide(),\n    ],\n    whileElementsMounted: autoUpdate,\n    placement: \"bottom-start\",\n  });\n\n  const dismiss = useDismiss(context);\n\n  const { getReferenceProps, getFloatingProps } = useInteractions([dismiss]);\n\n  // Clear any existing timeout\n  const clearHoverTimeout = useCallback(() => {\n    if (hoverTimeoutRef.current) {\n      window.clearTimeout(hoverTimeoutRef.current);\n      hoverTimeoutRef.current = null;\n    }\n  }, []);\n\n  // Set timeout to close link view after delay\n  const setCloseTimeout = useCallback(() => {\n    clearHoverTimeout();\n    hoverTimeoutRef.current = window.setTimeout(() => {\n      setIsOpen(false);\n      editorState.linkExtensionStorage.isPreviewOpen = false;\n    }, 400);\n  }, [clearHoverTimeout, editorState.linkExtensionStorage]);\n\n  const handleLinkHover = useCallback(\n    (event: MouseEvent) => {\n      if (!editor || editorState.linkExtensionStorage?.isBubbleMenuOpen) return;\n\n      // Find the closest anchor tag from the event target\n      const target = (event.target as HTMLElement)?.closest(\"a\");\n      if (!target) return;\n\n      const referenceProps = getReferenceProps();\n      Object.entries(referenceProps).forEach(([key, value]) => {\n        target.setAttribute(key, value as string);\n      });\n\n      const view = editor.view;\n      if (!view) return;\n\n      try {\n        const pos = view.posAtDOM(target, 0);\n        if (pos === undefined || pos < 0) return;\n\n        const node = view.state.doc.nodeAt(pos);\n        if (!node) return;\n\n        const linkMark = node.marks?.find((mark) => mark.type.name === \"link\");\n        if (!linkMark) return;\n\n        setVirtualElement(target);\n\n        // Clear any pending close timeout when hovering over a link\n        clearHoverTimeout();\n\n        // Only update if not already open or if hovering over a different link\n        if (!isOpen || (linkViewProps && (linkViewProps.from !== pos || linkViewProps.to !== pos + node.nodeSize))) {\n          setLinkViewProps({\n            view: \"LinkPreview\", // Always start with preview for new links\n            url: linkMark.attrs.href,\n            text: node.text || \"\",\n            editor: editor,\n            from: pos,\n            to: pos + node.nodeSize,\n            closeLinkView: () => {\n              setIsOpen(false);\n              editorState.linkExtensionStorage.isPreviewOpen = false;\n            },\n          });\n          setIsOpen(true);\n        }\n      } catch (error) {\n        console.error(\"Error handling link hover:\", error);\n      }\n    },\n    [editor, editorState.linkExtensionStorage, getReferenceProps, isOpen, linkViewProps, clearHoverTimeout]\n  );\n\n  // Handle mouse enter on floating element (cancel close timeout)\n  const handleFloatingMouseEnter = useCallback(() => {\n    clearHoverTimeout();\n  }, [clearHoverTimeout]);\n\n  // Handle mouse leave from floating element (start close timeout)\n  const handleFloatingMouseLeave = useCallback(() => {\n    setCloseTimeout();\n  }, [setCloseTimeout]);\n\n  const handleContainerMouseEnter = useCallback(() => {\n    // Cancel any pending close timeout when mouse enters container\n    clearHoverTimeout();\n  }, [clearHoverTimeout]);\n\n  const handleContainerMouseLeave = useCallback(\n    (event: MouseEvent) => {\n      if (!editor || !isOpen) return;\n\n      // Check if mouse is truly leaving the container area\n      const relatedTarget = event.relatedTarget as HTMLElement;\n      const container = containerRef.current;\n      const floatingElement = refs.floating;\n\n      // Only start close timeout if mouse is not moving to the floating element\n      // and is actually leaving the container\n      if (\n        container &&\n        relatedTarget &&\n        !container.contains(relatedTarget) &&\n        (!floatingElement || !floatingElement.current?.contains(relatedTarget))\n      ) {\n        setCloseTimeout();\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [editor, isOpen, setCloseTimeout, refs.floating]\n  );\n\n  // Set up event listeners\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n\n    container.addEventListener(\"mouseover\", handleLinkHover);\n    container.addEventListener(\"mouseenter\", handleContainerMouseEnter);\n    container.addEventListener(\"mouseleave\", handleContainerMouseLeave);\n\n    return () => {\n      container.removeEventListener(\"mouseover\", handleLinkHover);\n      container.removeEventListener(\"mouseenter\", handleContainerMouseEnter);\n      container.removeEventListener(\"mouseleave\", handleContainerMouseLeave);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [handleLinkHover, handleContainerMouseEnter, handleContainerMouseLeave]);\n\n  // Cleanup timeout on unmount\n  useEffect(() => () => clearHoverTimeout(), [clearHoverTimeout]);\n\n  // Close link view when bubble menu opens\n  useEffect(() => {\n    if (editorState.linkExtensionStorage?.isBubbleMenuOpen && isOpen) {\n      setIsOpen(false);\n    }\n  }, [editorState.linkExtensionStorage, isOpen]);\n\n  return (\n    <>\n      {isOpen && linkViewProps && virtualElement && (\n        <div\n          ref={refs.setFloating}\n          style={{ ...floatingStyles, zIndex: 100 }}\n          {...getFloatingProps()}\n          onMouseEnter={handleFloatingMouseEnter}\n          onMouseLeave={handleFloatingMouseLeave}\n        >\n          <LinkView {...linkViewProps} style={floatingStyles} />\n        </div>\n      )}\n    </>\n  );\n}\n","import type { Editor } from \"@tiptap/core\";\nimport { LinkViewContainer } from \"@/components/editors/link-view-container\";\n\nexport function LinkContainer({\n  editor,\n  containerRef,\n}: {\n  editor: Editor;\n  containerRef: React.RefObject<HTMLDivElement>;\n}) {\n  return (\n    <>\n      <LinkViewContainer editor={editor} containerRef={containerRef} />\n    </>\n  );\n}\n","import { Plugin, PluginKey } from \"@tiptap/pm/state\";\nimport { Decoration, DecorationSet } from \"@tiptap/pm/view\";\n\ntype NodeHighlightState = {\n  highlightedNodeId: string | null;\n  decorations: DecorationSet;\n};\n\ntype NodeHighlightMeta = {\n  nodeId?: string | null;\n};\n\nexport const nodeHighlightPluginKey = new PluginKey<NodeHighlightState>(\"nodeHighlight\");\n\nconst buildDecorations = (doc: Parameters<typeof DecorationSet.create>[0], highlightedNodeId: string | null) => {\n  if (!highlightedNodeId) {\n    return DecorationSet.empty;\n  }\n\n  const decorations: Decoration[] = [];\n  const highlightClassNames = [\"bg-custom-primary-100/20\", \"transition-all\", \"duration-300\", \"rounded\"];\n\n  doc.descendants((node, pos) => {\n    // Check if this node has the id we're looking for\n    if (node.attrs && node.attrs.id === highlightedNodeId) {\n      const decorationAttrs: Record<string, string> = {\n        \"data-node-highlighted\": \"true\",\n        class: highlightClassNames.join(\" \"),\n      };\n\n      // For text nodes, highlight the inline content\n      if (node.isText) {\n        decorations.push(\n          Decoration.inline(pos, pos + node.nodeSize, decorationAttrs, {\n            inclusiveStart: true,\n            inclusiveEnd: true,\n          })\n        );\n      } else {\n        // For block nodes, add a node decoration\n        decorations.push(Decoration.node(pos, pos + node.nodeSize, decorationAttrs));\n      }\n\n      return false; // Stop searching once we found the node\n    }\n\n    return true;\n  });\n\n  return DecorationSet.create(doc, decorations);\n};\n\nexport const NodeHighlightPlugin = () =>\n  new Plugin<NodeHighlightState>({\n    key: nodeHighlightPluginKey,\n    state: {\n      init: () => ({\n        highlightedNodeId: null,\n        decorations: DecorationSet.empty,\n      }),\n      apply: (tr, value, _oldState, newState) => {\n        let highlightedNodeId = value.highlightedNodeId;\n        let decorations = value.decorations;\n\n        const meta = tr.getMeta(nodeHighlightPluginKey) as NodeHighlightMeta | undefined;\n        let shouldRecalculate = tr.docChanged;\n\n        if (meta) {\n          if (meta.nodeId !== undefined) {\n            highlightedNodeId = typeof meta.nodeId === \"string\" && meta.nodeId.length > 0 ? meta.nodeId : null;\n            shouldRecalculate = true;\n          }\n        }\n\n        if (shouldRecalculate) {\n          decorations = buildDecorations(newState.doc, highlightedNodeId);\n        } else if (tr.docChanged) {\n          decorations = decorations.map(tr.mapping, newState.doc);\n        }\n\n        return {\n          highlightedNodeId,\n          decorations,\n        };\n      },\n    },\n    props: {\n      decorations(state) {\n        return nodeHighlightPluginKey.getState(state)?.decorations ?? DecorationSet.empty;\n      },\n    },\n  });\n","import type { HocuspocusProvider } from \"@hocuspocus/provider\";\nimport type { Editor } from \"@tiptap/react\";\nimport type { FC, ReactNode } from \"react\";\nimport { useCallback, useEffect, useRef } from \"react\";\n// plane utils\nimport { cn } from \"@plane/utils\";\n// constants\nimport { DEFAULT_DISPLAY_CONFIG } from \"@/constants/config\";\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n// components\nimport type { TCollabValue } from \"@/contexts\";\nimport { LinkContainer } from \"@/plane-editor/components/link-container\";\n// plugins\nimport { nodeHighlightPluginKey } from \"@/plugins/highlight\";\n// types\nimport type { TDisplayConfig } from \"@/types\";\n\ntype Props = {\n  children: ReactNode;\n  displayConfig: TDisplayConfig;\n  editor: Editor;\n  editorContainerClassName: string;\n  id: string;\n  isTouchDevice: boolean;\n  provider?: HocuspocusProvider | undefined;\n  state?: TCollabValue[\"state\"];\n};\n\nexport const EditorContainer: FC<Props> = (props) => {\n  const { children, displayConfig, editor, editorContainerClassName, id, isTouchDevice, provider, state } = props;\n  // refs\n  const containerRef = useRef<HTMLDivElement>(null);\n  const hasScrolledOnce = useRef(false);\n  const scrollToNode = useCallback(\n    (nodeId: string) => {\n      if (!editor) return false;\n\n      const doc = editor.state.doc;\n      let pos: number | null = null;\n\n      doc.descendants((node, position) => {\n        if (node.attrs && node.attrs.id === nodeId) {\n          pos = position;\n          return false;\n        }\n      });\n\n      if (pos === null) {\n        return false;\n      }\n\n      const nodePosition = pos;\n      const tr = editor.state.tr.setMeta(nodeHighlightPluginKey, { nodeId });\n      editor.view.dispatch(tr);\n\n      requestAnimationFrame(() => {\n        const domNode = editor.view.nodeDOM(nodePosition);\n        if (domNode instanceof HTMLElement) {\n          domNode.scrollIntoView({ behavior: \"instant\", block: \"center\" });\n        }\n      });\n\n      editor.once(\"focus\", () => {\n        const clearTr = editor.state.tr.setMeta(nodeHighlightPluginKey, { nodeId: null });\n        editor.view.dispatch(clearTr);\n      });\n\n      hasScrolledOnce.current = true;\n      return true;\n    },\n\n    [editor]\n  );\n\n  useEffect(() => {\n    const nodeId = window.location.href.split(\"#\")[1];\n\n    const handleSynced = () => scrollToNode(nodeId);\n\n    if (nodeId && !hasScrolledOnce.current) {\n      if (provider && state) {\n        const { hasCachedContent } = state;\n        // If the provider is synced or the cached content is available and the server is disconnected, scroll to the node\n        if (hasCachedContent) {\n          const hasScrolled = handleSynced();\n          if (!hasScrolled) {\n            provider.on(\"synced\", handleSynced);\n          }\n        } else if (provider.isSynced) {\n          handleSynced();\n        } else {\n          provider.on(\"synced\", handleSynced);\n        }\n      } else {\n        handleSynced();\n      }\n      return () => {\n        if (provider) {\n          provider.off(\"synced\", handleSynced);\n        }\n      };\n    }\n  }, [scrollToNode, provider, state]);\n\n  const handleContainerClick = (event: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (event.target !== event.currentTarget) return;\n    if (!editor) return;\n    if (!editor.isEditable) return;\n    try {\n      if (editor.isFocused) return; // If editor is already focused, do nothing\n\n      const { selection } = editor.state;\n      const currentNode = selection.$from.node();\n\n      editor?.chain().focus(\"end\", { scrollIntoView: false }).run(); // Focus the editor at the end\n\n      if (\n        currentNode.content.size === 0 && // Check if the current node is empty\n        !(\n          editor.isActive(CORE_EXTENSIONS.ORDERED_LIST) ||\n          editor.isActive(CORE_EXTENSIONS.BULLET_LIST) ||\n          editor.isActive(CORE_EXTENSIONS.TASK_ITEM) ||\n          editor.isActive(CORE_EXTENSIONS.TABLE) ||\n          editor.isActive(CORE_EXTENSIONS.BLOCKQUOTE) ||\n          editor.isActive(CORE_EXTENSIONS.CODE_BLOCK)\n        ) // Check if it's an empty node within an orderedList, bulletList, taskItem, table, quote or code block\n      ) {\n        return;\n      }\n\n      // Get the last child node in the document\n      const doc = editor.state.doc;\n      const lastNode = doc.lastChild;\n\n      // Check if its last node and add new node\n      if (lastNode) {\n        const isLastNodeParagraph = lastNode.type.name === CORE_EXTENSIONS.PARAGRAPH;\n        // Insert a new paragraph if the last node is not a paragraph and not a doc node\n        if (!isLastNodeParagraph && lastNode.type.name !== CORE_EXTENSIONS.DOCUMENT) {\n          // Only insert a new paragraph if the last node is not an empty paragraph and not a doc node\n          const endPosition = editor?.state.doc.content.size;\n          editor?.chain().insertContentAt(endPosition, { type: \"paragraph\" }).focus(\"end\").run();\n        }\n      }\n    } catch (error) {\n      console.error(\"An error occurred while handling container click to insert new empty node at bottom:\", error);\n    }\n  };\n\n  const handleContainerMouseLeave = () => {\n    const dragHandleElement = document.querySelector(\"#editor-side-menu\");\n    if (!dragHandleElement?.classList.contains(\"side-menu-hidden\")) {\n      dragHandleElement?.classList.add(\"side-menu-hidden\");\n    }\n  };\n\n  return (\n    <>\n      <div\n        ref={containerRef}\n        id={`editor-container-${id}`}\n        onClick={handleContainerClick}\n        onMouseLeave={handleContainerMouseLeave}\n        className={cn(\n          `editor-container cursor-text relative line-spacing-${displayConfig.lineSpacing ?? DEFAULT_DISPLAY_CONFIG.lineSpacing}`,\n          {\n            \"active-editor\": editor?.isFocused && editor?.isEditable,\n          },\n          displayConfig.fontSize ?? DEFAULT_DISPLAY_CONFIG.fontSize,\n          displayConfig.fontStyle ?? DEFAULT_DISPLAY_CONFIG.fontStyle,\n          editorContainerClassName\n        )}\n      >\n        {children}\n        {!isTouchDevice && <LinkContainer editor={editor} containerRef={containerRef} />}\n      </div>\n    </>\n  );\n};\n","import { Extension } from \"@tiptap/core\";\nimport type { NodeType, Node as ProseMirrorNode } from \"@tiptap/pm/model\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\n// constants\nimport { CORE_EXTENSIONS } from \"@/constants/extension\";\n\nfunction nodeEqualsType({ types, node }: { types: NodeType[]; node: ProseMirrorNode | null }) {\n  // TODO: check this logic, might be wrong\n  // @ts-expect-error - logic might be wrong\n  return (Array.isArray(types) && types.includes(node?.type)) || node?.type === types;\n}\n\nexport interface TrailingNodeOptions {\n  node: string;\n  notAfter: string[];\n}\n\nexport const TrailingNode = Extension.create<TrailingNodeOptions>({\n  name: \"trailingNode\",\n\n  addOptions() {\n    return {\n      node: CORE_EXTENSIONS.PARAGRAPH,\n      notAfter: [CORE_EXTENSIONS.PARAGRAPH],\n    };\n  },\n\n  addProseMirrorPlugins() {\n    const plugin = new PluginKey(this.name);\n    const disabledNodes = Object.entries(this.editor.schema.nodes)\n      .map(([, value]) => value)\n      .filter((node) => this.options.notAfter.includes(node.name));\n\n    return [\n      new Plugin({\n        key: plugin,\n        appendTransaction: (_, __, state) => {\n          const { doc, tr, schema } = state;\n          const shouldInsertNodeAtEnd = plugin.getState(state);\n          const endPosition = doc.content.size;\n          const type = schema.nodes[this.options.node];\n\n          if (!shouldInsertNodeAtEnd) {\n            return;\n          }\n\n          return tr.insert(endPosition, type.create());\n        },\n        state: {\n          init: (_, state) => {\n            const lastNode = state.tr.doc.lastChild;\n\n            return !nodeEqualsType({ node: lastNode, types: disabledNodes });\n          },\n          apply: (tr, value) => {\n            if (!tr.docChanged) {\n              return value;\n            }\n\n            const lastNode = tr.doc.lastChild;\n\n            return !nodeEqualsType({ node: lastNode, types: disabledNodes });\n          },\n        },\n      }),\n    ];\n  },\n});\n"],"mappings":"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CA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACD,CACF;CAuDD,MAAM,SAASC,YApDM,eACZ;EACL;EACA;EACA;EACA;EACA;EACA;EACA,eAAe;EACf,YAAY;EACZ;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACD,GACD;EACE;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACD,CACF,CAEqC;CAEtC,MAAM,kBAAkB,cAChB,CACJ,cAAc,UAAU;EACtB,UAAU,SAAS;EACnB,OAAO;EACR,CAAC,EACF,yBACD,EACD,CAAC,UAAU,yBAAyB,CACrC;CAyBD,MAAM,cAAc,eAvBM,eAUjB;EACL;EACA;EACA;EACA;EACA;EACA,YAAY;EACZ;EACA;EACD,GACD;EAAC;EAAU;EAAI;EAAU;EAAU;EAAsB;EAAiB;EAAqB;EAAkB,CAClH,CAE4F;AAE7F,iBAAgB;AACd,MAAI,UAAU,aAAa;AACzB,iBAAc,OAAO;AACrB,kBAAe,YAAY;;IAE5B;EAAC;EAAQ;EAAa;EAAe;EAAe,CAAC;AAExD,QAAO;EACL;EACA;EACD;;;;;AC5LH,MAAMC,oCAAiF,UAAU;CAC/F,MAAM,EACJ,WACA,oBAAoB,MACpB,oBACA,yBACA,aAAa,EAAE,EACf,oBACA,gBAAgB,wBAChB,UACA,kBAAkB,IAClB,aACA,qBACA,aACA,mBACA,cACA,mBACA,mBACA,IACA,kBAAkB,MAClB,eACA,gBACA,eACA,UACA,eACA,eACA,aACA,UACA,MACA,6BACA,UACA,sBACA,6BACE;CAGJ,MAAM,EAAE,UAAU,OAAO,YAAY,kBAAkB;CAGvD,MAAM,EAAE,QAAQ,gBAAgB,uBAAuB;EACrD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACD,CAAC;CAE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"}