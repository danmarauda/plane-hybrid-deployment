{"version":3,"file":"index.js","names":["TreeMapTooltip","TreeMapChart"],"sources":["../../../src/charts/tree-map/map-content.tsx","../../../src/charts/tree-map/tooltip.tsx","../../../src/charts/tree-map/root.tsx"],"sourcesContent":["import React, { useMemo } from \"react\";\n// plane imports\nimport type { TBottomSectionConfig, TContentVisibility, TTopSectionConfig } from \"@plane/types\";\nimport { cn } from \"../../utils/classname\";\n\nconst LAYOUT = {\n  PADDING: 2,\n  RADIUS: 6,\n  TEXT: {\n    PADDING_LEFT: 8,\n    PADDING_RIGHT: 8,\n    VERTICAL_OFFSET: 20,\n    ELLIPSIS_OFFSET: -4,\n    FONT_SIZES: {\n      SM: 12.6,\n      XS: 10.8,\n    },\n  },\n  ICON: {\n    SIZE: 16,\n    GAP: 6,\n  },\n  MIN_DIMENSIONS: {\n    HEIGHT_FOR_BOTH: 42,\n    HEIGHT_FOR_TOP: 35,\n    HEIGHT_FOR_DOTS: 20,\n    WIDTH_FOR_ICON: 30,\n    WIDTH_FOR_DOTS: 15,\n  },\n};\n\nconst calculateContentWidth = (text: string | number, fontSize: number): number => String(text).length * fontSize * 0.7;\n\nconst calculateTopSectionConfig = (effectiveWidth: number, name: string, hasIcon: boolean): TTopSectionConfig => {\n  const iconWidth = hasIcon ? LAYOUT.ICON.SIZE + LAYOUT.ICON.GAP : 0;\n  const nameWidth = calculateContentWidth(name, LAYOUT.TEXT.FONT_SIZES.SM);\n  const totalPadding = LAYOUT.TEXT.PADDING_LEFT + LAYOUT.TEXT.PADDING_RIGHT;\n\n  // First check if we can show icon\n  const canShowIcon = hasIcon && effectiveWidth >= LAYOUT.MIN_DIMENSIONS.WIDTH_FOR_ICON;\n\n  // If we can't even show icon, check if we can show dots\n  if (!canShowIcon) {\n    return {\n      showIcon: false,\n      showName: effectiveWidth >= LAYOUT.MIN_DIMENSIONS.WIDTH_FOR_DOTS,\n      nameTruncated: true,\n    };\n  }\n\n  // We can show icon, now check if we have space for name\n  const availableWidthForName = effectiveWidth - (canShowIcon ? iconWidth : 0) - totalPadding;\n  const canShowFullName = availableWidthForName >= nameWidth;\n\n  return {\n    showIcon: canShowIcon,\n    showName: availableWidthForName > 0,\n    nameTruncated: !canShowFullName,\n  };\n};\n\nconst calculateBottomSectionConfig = (\n  effectiveWidth: number,\n  effectiveHeight: number,\n  value: number | undefined,\n  label: string | undefined\n): TBottomSectionConfig => {\n  // If height is not enough for bottom section\n  if (effectiveHeight < LAYOUT.MIN_DIMENSIONS.HEIGHT_FOR_BOTH) {\n    return {\n      show: false,\n      showValue: false,\n      showLabel: false,\n      labelTruncated: false,\n    };\n  }\n\n  // Calculate widths\n  const totalPadding = LAYOUT.TEXT.PADDING_LEFT + LAYOUT.TEXT.PADDING_RIGHT;\n  const valueWidth = value ? calculateContentWidth(value, LAYOUT.TEXT.FONT_SIZES.XS) : 0;\n  const labelWidth = label ? calculateContentWidth(label, LAYOUT.TEXT.FONT_SIZES.XS) + 4 : 0; // 4px for spacing\n  const availableWidth = effectiveWidth - totalPadding;\n\n  // If we can't even show value\n  if (availableWidth < Math.max(valueWidth, LAYOUT.MIN_DIMENSIONS.WIDTH_FOR_DOTS)) {\n    return {\n      show: true,\n      showValue: false,\n      showLabel: false,\n      labelTruncated: false,\n    };\n  }\n\n  // If we can show value but not full label\n  const canShowFullLabel = availableWidth >= valueWidth + labelWidth;\n\n  return {\n    show: true,\n    showValue: true,\n    showLabel: true,\n    labelTruncated: !canShowFullLabel,\n  };\n};\n\nconst calculateVisibility = (\n  width: number,\n  height: number,\n  hasIcon: boolean,\n  name: string,\n  value: number | undefined,\n  label: string | undefined\n): TContentVisibility => {\n  const effectiveWidth = width - LAYOUT.PADDING * 2;\n  const effectiveHeight = height - LAYOUT.PADDING * 2;\n\n  // If extremely small, show only dots\n  if (\n    effectiveHeight < LAYOUT.MIN_DIMENSIONS.HEIGHT_FOR_DOTS ||\n    effectiveWidth < LAYOUT.MIN_DIMENSIONS.WIDTH_FOR_DOTS\n  ) {\n    return {\n      top: { showIcon: false, showName: false, nameTruncated: false },\n      bottom: { show: false, showValue: false, showLabel: false, labelTruncated: false },\n    };\n  }\n\n  const topSection = calculateTopSectionConfig(effectiveWidth, name, hasIcon);\n  const bottomSection = calculateBottomSectionConfig(effectiveWidth, effectiveHeight, value, label);\n\n  return {\n    top: topSection,\n    bottom: bottomSection,\n  };\n};\n\nconst truncateText = (text: string | number, maxWidth: number, fontSize: number, reservedWidth: number = 0): string => {\n  const availableWidth = maxWidth - reservedWidth;\n  if (availableWidth <= 0) return \"\";\n\n  const avgCharWidth = fontSize * 0.7;\n  const maxChars = Math.floor(availableWidth / avgCharWidth);\n  const stringText = String(text);\n\n  if (maxChars <= 3) return \"\";\n  if (stringText.length <= maxChars) return stringText;\n  return `${stringText.slice(0, maxChars - 3)}...`;\n};\n\nexport function CustomTreeMapContent({\n  x,\n  y,\n  width,\n  height,\n  name,\n  value,\n  label,\n  fillColor,\n  fillClassName,\n  textClassName,\n  icon,\n}: any) {\n  const dimensions = useMemo(() => {\n    const pX = x + LAYOUT.PADDING;\n    const pY = y + LAYOUT.PADDING;\n    const pWidth = Math.max(0, width - LAYOUT.PADDING * 2);\n    const pHeight = Math.max(0, height - LAYOUT.PADDING * 2);\n    return { pX, pY, pWidth, pHeight };\n  }, [x, y, width, height]);\n\n  const visibility = useMemo(\n    () => calculateVisibility(width, height, !!icon, name, value, label),\n    [width, height, icon, name, value, label]\n  );\n\n  if (!name || width <= 0 || height <= 0) return null;\n\n  const renderContent = () => {\n    const { pX, pY, pWidth, pHeight } = dimensions;\n    const { top, bottom } = visibility;\n\n    const availableTextWidth = pWidth - LAYOUT.TEXT.PADDING_LEFT - LAYOUT.TEXT.PADDING_RIGHT;\n    const iconSpace = top.showIcon ? LAYOUT.ICON.SIZE + LAYOUT.ICON.GAP : 0;\n\n    return (\n      <g>\n        {/* Background shape */}\n        <path\n          d={`\n            M${pX + LAYOUT.RADIUS},${pY}\n            L${pX + pWidth - LAYOUT.RADIUS},${pY}\n            Q${pX + pWidth},${pY} ${pX + pWidth},${pY + LAYOUT.RADIUS}\n            L${pX + pWidth},${pY + pHeight - LAYOUT.RADIUS}\n            Q${pX + pWidth},${pY + pHeight} ${pX + pWidth - LAYOUT.RADIUS},${pY + pHeight}\n            L${pX + LAYOUT.RADIUS},${pY + pHeight}\n            Q${pX},${pY + pHeight} ${pX},${pY + pHeight - LAYOUT.RADIUS}\n            L${pX},${pY + LAYOUT.RADIUS}\n            Q${pX},${pY} ${pX + LAYOUT.RADIUS},${pY}\n          `}\n          className={cn(\"transition-colors duration-200 hover:opacity-90\", fillClassName)}\n          fill={fillColor ?? \"currentColor\"}\n        />\n\n        {/* Top section */}\n        <g>\n          {top.showIcon && icon && (\n            <foreignObject\n              x={pX + LAYOUT.TEXT.PADDING_LEFT}\n              y={pY + LAYOUT.TEXT.PADDING_LEFT}\n              width={LAYOUT.ICON.SIZE}\n              height={LAYOUT.ICON.SIZE}\n              className={textClassName || \"text-custom-text-300\"}\n            >\n              {React.cloneElement(icon, {\n                className: cn(\"size-4\", icon?.props?.className),\n                \"aria-hidden\": true,\n              })}\n            </foreignObject>\n          )}\n          {top.showName && (\n            <text\n              x={pX + LAYOUT.TEXT.PADDING_LEFT + iconSpace}\n              y={pY + LAYOUT.TEXT.VERTICAL_OFFSET}\n              textAnchor=\"start\"\n              className={cn(\n                \"text-sm font-extralight tracking-wider select-none\",\n                textClassName || \"text-custom-text-300\"\n              )}\n              fill=\"currentColor\"\n            >\n              {top.nameTruncated ? truncateText(name, availableTextWidth, LAYOUT.TEXT.FONT_SIZES.SM, iconSpace) : name}\n            </text>\n          )}\n        </g>\n\n        {/* Bottom section */}\n        {bottom.show && (\n          <g>\n            {bottom.showValue && value !== undefined && (\n              <text\n                x={pX + LAYOUT.TEXT.PADDING_LEFT}\n                y={pY + pHeight - LAYOUT.TEXT.PADDING_LEFT}\n                textAnchor=\"start\"\n                className={cn(\n                  \"text-sm font-extralight tracking-wider select-none\",\n                  textClassName || \"text-custom-text-300\"\n                )}\n                fill=\"currentColor\"\n              >\n                {value.toLocaleString()}\n                {bottom.showLabel && label && (\n                  <tspan dx={4}>\n                    {bottom.labelTruncated\n                      ? truncateText(\n                          label,\n                          availableTextWidth - calculateContentWidth(value, LAYOUT.TEXT.FONT_SIZES.SM) - 4,\n                          LAYOUT.TEXT.FONT_SIZES.SM\n                        )\n                      : label}\n                  </tspan>\n                )}\n                {!bottom.showLabel && label && <tspan dx={4}>...</tspan>}\n              </text>\n            )}\n          </g>\n        )}\n      </g>\n    );\n  };\n\n  return (\n    <g>\n      <rect x={x} y={y} width={width} height={height} fill=\"transparent\" />\n      {renderContent()}\n    </g>\n  );\n}\n","import React from \"react\";\n// plane imports\nimport { Card, ECardSpacing } from \"../../card\";\n\ninterface TreeMapTooltipProps {\n  active: boolean | undefined;\n  payload: any[] | undefined;\n}\n\nexport const TreeMapTooltip = React.memo(function TreeMapTooltip({ active, payload }: TreeMapTooltipProps) {\n  if (!active || !payload || !payload[0]?.payload) return null;\n\n  const data = payload[0].payload;\n\n  return (\n    <Card className=\"flex flex-col space-y-1.5\" spacing={ECardSpacing.SM}>\n      <div className=\"flex items-center gap-2 border-b border-custom-border-200 pb-2.5\">\n        {data?.icon}\n        <p className=\"text-xs text-custom-text-100 font-medium capitalize\">{data?.name}</p>\n      </div>\n      <span className=\"text-xs font-medium text-custom-text-200\">\n        {data?.value.toLocaleString()}\n        {data.label && ` ${data.label}`}\n      </span>\n    </Card>\n  );\n});\n\nTreeMapTooltip.displayName = \"TreeMapTooltip\";\n","import React from \"react\";\nimport { Treemap, ResponsiveContainer, Tooltip } from \"recharts\";\n// plane imports\nimport type { TreeMapChartProps } from \"@plane/types\";\n// local imports\nimport { cn } from \"../../utils/classname\";\nimport { CustomTreeMapContent } from \"./map-content\";\nimport { TreeMapTooltip } from \"./tooltip\";\n\nexport const TreeMapChart = React.memo(function TreeMapChart(props: TreeMapChartProps) {\n  const { data, className = \"w-full h-96\", isAnimationActive = false, showTooltip = true } = props;\n  return (\n    <div className={cn(className)}>\n      <ResponsiveContainer width=\"100%\" height=\"100%\">\n        <Treemap\n          data={data}\n          nameKey=\"name\"\n          dataKey=\"value\"\n          stroke=\"currentColor\"\n          className=\"text-custom-background-100 bg-custom-background-100\"\n          content={<CustomTreeMapContent />}\n          animationEasing=\"ease-out\"\n          isUpdateAnimationActive={isAnimationActive}\n          animationBegin={100}\n          animationDuration={500}\n        >\n          {showTooltip && (\n            <Tooltip\n              content={({ active, payload }) => <TreeMapTooltip active={active} payload={payload} />}\n              cursor={{\n                fill: \"currentColor\",\n                className: \"text-custom-background-90/80 cursor-pointer\",\n              }}\n              wrapperStyle={{\n                pointerEvents: \"auto\",\n              }}\n            />\n          )}\n        </Treemap>\n      </ResponsiveContainer>\n    </div>\n  );\n});\nTreeMapChart.displayName = \"TreeMapChart\";\n"],"mappings":"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"}